      *{TOTEM}PRG-COMMENT
      * appuntamenti.Cbl
      * appuntamenti.Cbl is generated by TOTEM
      * This is a generated file. DO NOT modify this file directly.
      *{TOTEM}END
       IDENTIFICATION       DIVISION.
      *{TOTEM}PRGID
       PROGRAM-ID.          appuntamenti.
       AUTHOR.              andre.
       DATE-WRITTEN.        martedì 14 maggio 2019 17:13:41.
       REMARKS.
      *{TOTEM}END

       ENVIRONMENT          DIVISION.
       CONFIGURATION        SECTION.
       SPECIAL-NAMES.
      *{TOTEM}SPECIAL-NAME
      * <TOTEM:EPT. INIT:appuntamenti, INIT:appuntamenti, SpecialName>
      * <TOTEM:END>
      *{TOTEM}END
      *{TOTEM}ACTIVEX-DEF
      *{TOTEM}END
      *{TOTEM}DECIMAL-POINT
           DECIMAL-POINT IS COMMA.
      *{TOTEM}END

       INPUT-OUTPUT         SECTION.
       FILE-CONTROL.
      *{TOTEM}FILE-CONTROL
           COPY "appuntamenti.sl".
           COPY "clienti.sl".
           COPY "lineseq.sl".
      *{TOTEM}END
       DATA                 DIVISION.
       FILE                 SECTION.
      *{TOTEM}FILE
           COPY "appuntamenti.fd".
           COPY "clienti.fd".
           COPY "lineseq.fd".
      *{TOTEM}END

       WORKING-STORAGE      SECTION.
      *{TOTEM}ACU-DEF
               COPY "acugui.def".
               COPY "acucobol.def".
               COPY "fonts.def".
               COPY "crtvars.def".
               COPY "showmsg.def".
               COPY "totem.def".
               COPY "comune.def".
               COPY "custom.def".
               COPY "UTYDATA.DEF".
      *{TOTEM}END

      *{TOTEM}COPY-WORKING
      * Key Status
       77 Key-Status IS SPECIAL-NAMES CRT STATUS PIC 9(5) VALUE 0.
          88 Enter-Pushed VALUE 13.
          88 Exit-Pushed VALUE 27.
          88 Message-Received VALUE 95.
          88 Event-Occurred VALUE 96.
          88 Screen-No-Input-Field VALUE 97.
      * Properties & User defined Working Stoarge
       77 CourierNew
                  USAGE IS HANDLE OF FONT.
       77 Form1-Handle
                  USAGE IS HANDLE OF WINDOW.
       77 r-stampa         PIC  99.
       77 pag  PIC  999.
       77 pag-di           PIC  999.
       77 pag-x            PIC  xxx.
       77 pag-di-x         PIC  xxx.
       77 resto            PIC  99.
       77 LogoHandle
                  USAGE IS HANDLE OF BITMAP.
       77 path-logo        PIC  x(256).
       01 r-testata1.
           05 FILLER           PIC  x(35)
                      VALUE IS "Appuntamenti cliente:  ".
       01 r-testata2.
           05 t2-cliente       PIC  x(50).
       01 r-testata3.
           05 FILLER           PIC  x(13)
                      VALUE IS "Periodo: dal ".
           05 t3-dal           PIC  99/99/9999.
           05 FILLER           PIC  x(4)
                      VALUE IS " al ".
           05 t3-al            PIC  99/99/9999.
       01 r-piede.
           05 FILLER           PIC  x.
           05 FILLER           PIC  x(13)
                      VALUE IS "Stampato il: ".
           05 p-data           PIC  99/99/9999.
           05 FILLER           PIC  x(7)
                      VALUE IS " alle: ".
           05 p-ora            PIC  x(5).
           05 FILLER           PIC  x(40).
           05 FILLER           PIC  x(4)
                      VALUE IS "Pag. ".
           05 p-pag            PIC  x(10).
       01 r-titolo.
           05 FILLER           PIC  x.
           05 r1   PIC  x(10)
                      VALUE IS "Data".
           05 FILLER           PIC  x(3).
           05 r2   PIC  x(5)
                      VALUE IS "Ora".
           05 FILLER           PIC  x(3).
           05 r3   PIC  x(20)
                      VALUE IS "Stato".
           05 FILLER           PIC  x(3).
           05 r4   PIC  x(30)
                      VALUE IS "Recupero".
           05 FILLER           PIC  x(3).
           05 r5   PIC  x(10)
                      VALUE IS "Pagato".
       01 riga-stampa.
           05 FILLER           PIC  x.
           05 r-data-c         PIC  99/99/9999.
           05 FILLER           PIC  x(3).
           05 r-ora-c          PIC  99.99.
           05 FILLER           PIC  x(3).
           05 r-stato-c        PIC  x(20).
           05 FILLER           PIC  x(3).
           05 r-recupero-c     PIC  x(30).
           05 FILLER           PIC  x(3).
           05 r-pag-c          PIC  X(10).
           COPY  "SPOOLER.DEF".
       77 giorno           PIC  9(8).
           COPY  "SELPRINT.LKS".
       77 Form1-Tb-1-Handle
                  USAGE IS HANDLE OF WINDOW.
       78 titolo VALUE IS "Studio - Ricerca appuntamenti". 
       77 E-ESCI           PIC  9
                  VALUE IS 1.
       77 E-NUOVO          PIC  9
                  VALUE IS 1.
       77 E-CANCELLA       PIC  9
                  VALUE IS 1.
       77 E-SALVA          PIC  9
                  VALUE IS 1.
       77 E-ANTEPRIMA      PIC  9
                  VALUE IS 0.
       77 E-MODIFICA       PIC  9
                  VALUE IS 1.
       77 E-STAMPA         PIC  9
                  VALUE IS 0.
       77 E-CERCA          PIC  9
                  VALUE IS 1.
       77 last-data        PIC  9(8).
       77 edit-icon-bmp    PIC  s9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 Small-Font
                  USAGE IS HANDLE OF FONT SMALL-FONT.
       77 toolbar-bmp      PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 Default-Font
                  USAGE IS HANDLE OF FONT DEFAULT-FONT.
       77 DEFAULT-BMP      PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 Form1-St-1-Handle
                  USAGE IS HANDLE OF STATUS-BAR.
       77 AUTO-ID          PIC  9(6)
                  VALUE IS 3.
       77 Form1-Bt-1-Handle            PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 solo-logo-bmp    PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 como-numero      PIC  s9(18)
                  VALUE IS 0.
       77 como-riga        PIC  999
                  VALUE IS 0.
       77 como-cliente     PIC  x(100).
       77 como-data-da     PIC  9(8).
       77 como-data-a      PIC  9(8).
       77 sw-agisci        PIC  9.
       77 como-chiave      PIC  x(200).
       77 como-recupero    PIC  x(200).
       77 ins-data         PIC  9(8).
       77 start-data       PIC  9(8).
       77 tot-idx          PIC  9(8).
       77 old-riga         PIC  9(8).
       77 new-riga         PIC  9(8).
       77 idx2 PIC  9(8).
       77 presenze         PIC  9(8).
       77 cmd  PIC  x(200).
       77 StatusCode
                  USAGE IS SIGNED-SHORT.
       01 FILLER           PIC  9
                  VALUE IS 0.
           88 ModificaInLine VALUE IS 1    WHEN SET TO FALSE  0. 
       01 FILLER           PIC  9.
           88 attesa-app VALUE IS 1. 
           88 attesa-test VALUE IS 2. 
       01 rec-test.
           05 col-data-t       PIC  99/99/9999.
           05 col-ora-t        PIC  99.99.
           05 col-cliente-t    PIC  x(100).
       01 el-chiave2
                  OCCURS 999 TIMES.
           05 el-data2         PIC  9(8).
           05 el-ora2          PIC  9(4).
           05 el-cliente2      PIC  x(6).
           05 el-prog2         PIC  9(18).
       01 el-chiave
                  OCCURS 999 TIMES.
           05 el-data          PIC  9(8).
           05 el-ora           PIC  9(4).
           05 el-cliente       PIC  x(6).
           05 el-prog          PIC  9(18).
       01 old-app-chiave.
           05 old-app-inser.
               10 old--app-data    PIC  9(8).
               10 old-app-ora      PIC  9(4).
           05 old-app-cliente  PIC  x(6).
           05 old-app-prog     PIC  9(18).
       01 new-app-chiave.
           05 new-app-inser.
               10 new--app-data    PIC  9(8).
               10 new-app-ora      PIC  9(4).
           05 new-app-cliente  PIC  x(6).
           05 new-app-prog     PIC  9(18).
       77 dati-new         PIC  x(5000).
       77 dati-old         PIC  x(5000).
       01 sav-chiave.
           05 sav-inser.
               10 sav-data         PIC  9(8).
               10 sav-ora          PIC  9(4).
           05 sav-cliente      PIC  x(6).
           05 sav-prog         PIC  9(18).
       01 tab-date
                  OCCURS 6 TIMES.
           05 col-giorno       PIC  x(3).
           05 col-data         PIC  99/99/9999.
       77 como-giorno      PIC  x(16).
       77 logo-piccolo-bmp PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 Calibri14-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 Calibri14B-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 STATUS-appuntamenti          PIC  X(2).
           88 Valid-STATUS-appuntamenti VALUE IS "00" THRU "09". 
       77 STATUS-clienti   PIC  X(2).
           88 Valid-STATUS-clienti VALUE IS "00" THRU "09". 
       01 rec-grid.
           05 col-ora-1        PIC  99.99
                      BLANK WHEN ZERO.
           05 col-stato-1      PIC  x.
           05 col-pag-1        PIC  x.
           05 col-cliente-1    PIC  x(50).
           05 col-recupero-1   PIC  X(50).
           05 col-ora-2        PIC  99.99
                      BLANK WHEN ZERO.
           05 col-stato-2      PIC  x.
           05 col-pag-2        PIC  x.
           05 col-cliente-2    PIC  x(50).
           05 col-recupero-2   PIC  X(50).
           05 col-ora-3        PIC  99.99
                      BLANK WHEN ZERO.
           05 col-stato-3      PIC  x.
           05 col-pag-3        PIC  x.
           05 col-cliente-3    PIC  x(50).
           05 col-recupero-3   PIC  X(50).
           05 col-ora-4        PIC  99.99
                      BLANK WHEN ZERO.
           05 col-stato-4      PIC  x.
           05 col-pag-4        PIC  x.
           05 col-cliente-4    PIC  x(50).
           05 col-recupero-4   PIC  X(50).
           05 col-ora-5        PIC  99.99
                      BLANK WHEN ZERO.
           05 col-stato-5      PIC  x.
           05 col-pag-5        PIC  x.
           05 col-cliente-5    PIC  x(50).
           05 col-recupero-5   PIC  X(50).
           05 col-ora-6        PIC  99.99
                      BLANK WHEN ZERO.
           05 col-stato-6      PIC  x.
           05 col-pag-6        PIC  x.
           05 col-cliente-6    PIC  x(50).
           05 col-recupero-6   PIC  X(50).
       77 Courier-New8-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 como-valore      PIC  x(50).
       01 FILLER           PIC  9
                  VALUE IS 0.
           88 AggiornaAppuntamenti VALUE IS 1    WHEN SET TO FALSE  0. 
       01 FILLER           PIC  9
                  VALUE IS 0.
           88 ModificaAppuntamento VALUE IS 1    WHEN SET TO FALSE  0. 
       77 como-entry       PIC  x.
       77 Courier-New9B-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 Courier-New9-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 Courier-New10-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 scr-singolo-Handle
                  USAGE IS HANDLE OF WINDOW.
       77 tsc-cliente      PIC  x(6).
       77 CERCA-BMP        PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 FATCLI-BMP       PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 lab-cliente-buf  PIC  x(100).
       77 ef-data-buf      PIC  99/99/9999.
       77 ef-ora-buf       PIC  99.99.
       77 ef-cliente-buf   PIC  x(100).
       77 Calibri16B-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 v-modifica       PIC  9
                  VALUE IS 0.
       77 calendar-png     PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 calendar-bmp     PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 scar-cancella-r-Handle
                  USAGE IS HANDLE OF WINDOW.
       77 chk-recupero-cr-buf          PIC  9
                  VALUE IS 0.
       77 chk-presente-cr-buf          PIC  9
                  VALUE IS 0.
       77 chk-assente-cr-buf           PIC  9
                  VALUE IS 0.
       77 chk-nessuno-cr-buf           PIC  9
                  VALUE IS 0.
       77 lab-cliente-cr-buf           PIC  x(100).
       77 ef-clientecr-buf PIC  x(6).
       77 ef-cliente-cr-buf            PIC  x(6).
       77 ef-dal-cr-buf    PIC  99/99/9999.
       77 ef-al-cr-buf     PIC  99/99/9999.
       77 ef-cliente-ar-buf            PIC  x(6).
       77 lab-cliente-ar-buf           PIC  x(100).
       77 ef-dal-ar-buf    PIC  99/99/9999.
       77 ef-al-ar-buf     PIC  99/99/9999.
       77 ef-ora-ar-buf    PIC  99.99.
       77 chk-lun-buf      PIC  9
                  VALUE IS 0.
       77 chk-mar-buf      PIC  9
                  VALUE IS 0.
       77 chk-sab-buf      PIC  9
                  VALUE IS 0.
       77 chk-ven-buf      PIC  9
                  VALUE IS 0.
       77 chk-gio-buf      PIC  9
                  VALUE IS 0.
       77 chk-mer-buf      PIC  9
                  VALUE IS 0.
       77 scar-cerca-Handle
                  USAGE IS HANDLE OF WINDOW.
       77 ef-cliente-c-buf PIC  x(100).
       77 chk-pag-si-buf   PIC  9
                  VALUE IS 0.
       77 chk-pag-n-buf    PIC  9
                  VALUE IS 0.
       77 chk-nessuno-c-buf            PIC  9
                  VALUE IS 0.
       77 chk-recupero-c-buf           PIC  9
                  VALUE IS 0.
       77 chk-presente-c-buf           PIC  9
                  VALUE IS 0.
       77 chk-assente-c-buf            PIC  9
                  VALUE IS 0.
       77 ef-dal-c-buf     PIC  99/99/9999.
       77 ef-al-c-buf      PIC  99/99/9999.
       77 lab-cliente-c-buf            PIC  x(100).
       01 rec-cerca.
           05 col-data-c       PIC  99/99/9999.
           05 col-ora-c        PIC  99.99.
           05 col-stato-c      PIC  x(20).
           05 col-recupero-c   PIC  x(50).
           05 col-pag-c        PIC  X(10).
       77 lab-cliente-rec-buf          PIC  x(100).
       77 ef-data-rec-buf  PIC  99/99/9999.
       77 ef-ora-rec-buf   PIC  99.99.
       77 lab-app-buf      PIC  x(100).
       77 lab-app-rec-buf  PIC  x(100).
       77 scr-recupero-Handle
                  USAGE IS HANDLE OF WINDOW.
       77 tit-frame        PIC  x(50).
       77 STRIP-MENU-BMP   PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 e-cliente        PIC  9
                  VALUE IS 1.
       77 chk-inizio-cr-buf            PIC  9
                  VALUE IS 0.
       77 chk-inizio-c-buf PIC  9
                  VALUE IS 0.
       77 chk-pag-ft-buf   PIC  9
                  VALUE IS 0.
       77 scr-attesa-Handle
                  USAGE IS HANDLE OF WINDOW.
       77 Calibri24B-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 counter          PIC  9(6).
       77 counter2         PIC  9(6).
       77 lab-attesa-buf   PIC  zzz.zzz.
       01 FILLER           PIC  9.
           88 LoadingAll VALUE IS 1    WHEN SET TO FALSE  0. 
       77 ef-al-t-buf      PIC  99/99/9999.
       77 ef-dal-t-buf     PIC  99/99/9999.
       77 ef-cliente-t-buf PIC  x(100).
       77 chk-solo-test-buf            PIC  9
                  VALUE IS 0.
       01 rec-verifica.
           05 col-cliente-v    PIC  x(100).
           05 col-presenze-v   PIC  999.
           05 col-ultima-v     PIC  x(30).
       77 lab-cliente-t-buf            PIC  x(100).
       77 chk-test-cr-buf  PIC  9
                  VALUE IS 0.
       77 chk-test-c-buf   PIC  9
                  VALUE IS 0.
       77 ef-dal-v-buf     PIC  99/99/9999.
       77 EXCEL-BMP        PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 toEXCEL-BMP      PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 toEXCEL2-BMP     PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 stampa2-BMP      PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 wstampa          PIC  X(256).
       77 STATUS-lineseq   PIC  X(2).
           88 Valid-STATUS-lineseq VALUE IS "00" THRU "09". 
       77 chk-terapia-cr-buf           PIC  9
                  VALUE IS 0.
       77 chk-terapia-c-buf            PIC  9
                  VALUE IS 0.

      ***********************************************************
      *   Code Gen's Buffer                                     *
      ***********************************************************
       77 STATUS-Form1-FLAG-REFRESH PIC  9.
          88 Form1-FLAG-REFRESH  VALUE 1 FALSE 0. 
       77 TMP-Form1-KEY1-ORDER  PIC X VALUE "A".
       77 TMP-Form1-appuntamenti-RESTOREBUF  PIC X(2052).
       77 TMP-Form1-KEYIS  PIC 9(3) VALUE 1.
       77 Form1-MULKEY-TMPBUF   PIC X(2052).
       77 STATUS-scr-singolo-FLAG-REFRESH PIC  9.
          88 scr-singolo-FLAG-REFRESH  VALUE 1 FALSE 0. 
       77 STATUS-scr-cancella-r-FLAG-REFRESH PIC  9.
          88 scr-cancella-r-FLAG-REFRESH  VALUE 1 FALSE 0. 
       77 STATUS-scr-aggiungi-r-FLAG-REFRESH PIC  9.
          88 scr-aggiungi-r-FLAG-REFRESH  VALUE 1 FALSE 0. 
       77 STATUS-scr-cerca-FLAG-REFRESH PIC  9.
          88 scr-cerca-FLAG-REFRESH  VALUE 1 FALSE 0. 
       77 STATUS-scr-recupero-FLAG-REFRESH PIC  9.
          88 scr-recupero-FLAG-REFRESH  VALUE 1 FALSE 0. 
       77 STATUS-scr-attesa-FLAG-REFRESH PIC  9.
          88 scr-attesa-FLAG-REFRESH  VALUE 1 FALSE 0. 
       77 STATUS-scr-test-FLAG-REFRESH PIC  9.
          88 scr-test-FLAG-REFRESH  VALUE 1 FALSE 0. 
       77 TMP-DataSet1-appuntamenti-BUF     PIC X(2052).
       77 TMP-DataSet1-clienti-BUF     PIC X(2204).
       77 TMP-DataSet1-lineseq-BUF     PIC X(900).
      * VARIABLES FOR RECORD LENGTH.
       77  TotemFdSlRecordClearOffset   PIC 9(5) COMP-4.
       77  TotemFdSlRecordLength        PIC 9(5) COMP-4.
      * FILE'S LOCK MODE FLAG
       77 DataSet1-appuntamenti-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-appuntamenti-LOCK  VALUE "Y".
       77 DataSet1-KEYIS   PIC 9(3) VALUE 1.
       77 DataSet1-appuntamenti-KEY1-ORDER  PIC X VALUE "A".
          88 DataSet1-appuntamenti-KEY1-Asc  VALUE "A".
          88 DataSet1-appuntamenti-KEY1-Desc VALUE "D".
       77 DataSet1-clienti-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-clienti-LOCK  VALUE "Y".
       77 DataSet1-clienti-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-clienti-KEY-Asc  VALUE "A".
          88 DataSet1-clienti-KEY-Desc VALUE "D".
       77 DataSet1-lineseq-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-lineseq-LOCK  VALUE "Y".
       77 DataSet1-lineseq-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-lineseq-KEY-Asc  VALUE "A".
          88 DataSet1-lineseq-KEY-Desc VALUE "D".

       77 appuntamenti-k-clidata-SPLITBUF  PIC X(20).
       77 appuntamenti-k-statocli-SPLITBUF  PIC X(20).
       77 appuntamenti-k-ricerca-SPLITBUF  PIC X(21).
       77 appuntamenti-k-pagato-SPLITBUF  PIC X(20).
       77 appuntamenti-k-recupero-SPLITBUF  PIC X(33).
       77 appuntamenti-k-statodata-SPLITBUF  PIC X(20).
       77 clienti-cli-k-ragsoc-SPLITBUF  PIC X(57).

      *{TOTEM}END

      *{TOTEM}ID-LOGICI
      ***** Elenco ID Logici *****
       78  78-ID-gd-app VALUE 5001.
       78  78-ID-ef-data VALUE 5001.
       78  78-ID-ef-ora VALUE 5002.
       78  78-ID-ef-cliente VALUE 5003.
       78  78-ID-cbo-stato VALUE 5004.
       78  78-ID-cbo-pagato VALUE 5005.
       78  78-ID-ef-cliente-cr VALUE 5001.
       78  78-ID-ef-dal-cr VALUE 5002.
       78  78-ID-ef-al-cr VALUE 5003.
       78  78-ID-chk-nessuno-cr VALUE 5004.
       78  78-ID-chk-assente-cr VALUE 5005.
       78  78-ID-chk-presente-cr VALUE 5006.
       78  78-ID-chk-recupero-cr VALUE 5007.
       78  78-ID-chk-inizio-cr VALUE 5008.
       78  78-ID-ef-cliente-ar VALUE 5001.
       78  78-ID-ef-dal-ar VALUE 5002.
       78  78-ID-ef-al-ar VALUE 5003.
       78  78-ID-ef-ora-ar VALUE 5004.
       78  78-ID-chk-lun VALUE 5005.
       78  78-ID-chk-mar VALUE 5006.
       78  78-ID-chk-mer VALUE 5007.
       78  78-ID-chk-ven VALUE 5008.
       78  78-ID-ef-cliente-c VALUE 5001.
       78  78-ID-ef-dal-c VALUE 5002.
       78  78-ID-ef-al-c VALUE 5003.
       78  78-ID-chk-nessuno-c VALUE 5004.
       78  78-ID-chk-assente-c VALUE 5005.
       78  78-ID-chk-presente-c VALUE 5006.
       78  78-ID-chk-recupero-c VALUE 5007.
       78  78-ID-chk-inizio-c VALUE 5008.
       78  78-ID-chk-pag-n VALUE 5009.
       78  78-ID-chk-pag-si VALUE 5010.
       78  78-ID-chk-pag-ft VALUE 5011.
       78  78-ID-ef-data-rec VALUE 5001.
       78  78-ID-ef-ora-rec VALUE 5002.
       78  78-ID-ef-dal-t VALUE 5001.
       78  78-ID-ef-al-t VALUE 5002.
       78  78-ID-ef-cliente-t VALUE 5003.
       78  78-ID-ef-dal-v VALUE 5004.
      ***** Fine ID Logici *****
      *{TOTEM}END

       LINKAGE          SECTION.
      *{TOTEM}LINKAGE
           COPY  "BLOCKPGM.LKS".

      *{TOTEM}END

       SCREEN           SECTION.
      *{TOTEM}COPY-SCREEN
      * FORM
       01 
           Form1, 
           .

      * GRID
       05
           gd-app, 
           Grid, 
           COL 2,00, 
           LINE 4,83,
           LINES 34,30 CELLS,
           SIZE 163,90 CELLS,
           BOXED,
           CENTERED-HEADINGS,
           DATA-COLUMNS (1, 6, 7, 8, 58, 108, 113, 114, 115, 165, 215, 
           220, 221, 222, 272, 322, 327, 328, 329, 379, 429, 434, 435, 
           436, 486, 536, 541, 542, 543, 593),
           ALIGNMENT ("C", "C", "C", "U", "U", "C", "C", "C", "U", "U", 
           "C", "C", "C", "U", "U", "C", "C", "C", "U", "U", "C", "C", 
           "C", "U", "U", "C", "C", "C", "U", "U"),
           SEPARATION (5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 
           5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5),
           DATA-TYPES ("x(5)", "U(1)", "U(1)", "X", "X", "x(5)", "U(1)"
           , "U(1)", "X", "X", "x(5)", "U(1)", "U(1)", "X", "X", "x(5)"
           , "U(1)", "U(1)", "X", "X", "x(5)", "U(1)", "U(1)", "X", "X"
           , "x(5)", "U(1)", "U(1)", "X", "X"),
           NUM-COL-HEADINGS 2,
           COLUMN-HEADINGS,
           CURSOR-FRAME-WIDTH 0,
           DIVIDER-COLOR 1,
           FONT IS Courier-New8-Occidentale,
           HEADING-COLOR 304,
           HEADING-DIVIDER-COLOR 1,
           HEADING-FONT IS Courier-New10-Occidentale,
           HSCROLL,
           ID IS 78-ID-gd-app,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           NUM-ROWS 150,
           RECORD-DATA rec-grid,
           TILED-HEADINGS,
           VIRTUAL-WIDTH 372,
           VPADDING 50,
           VSCROLL,
           EVENT PROCEDURE Form1-Gd-1-Event-Proc,
           .

      * PUSH BUTTON
       05
           pb-settimana-prev, 
           Push-Button, 
           COL 2,00, 
           LINE 1,17,
           LINES 1,61 CELLS,
           SIZE 13,00 CELLS,
           EXCEPTION-VALUE 1000,
           ID IS 2,
           SELF-ACT,
           TITLE "SETTIMANA <",
           MULTILINE
           .

      * PUSH BUTTON
       05
           pb-settimana-next, 
           Push-Button, 
           COL 2,00, 
           LINE 2,96,
           LINES 1,61 CELLS,
           SIZE 13,00 CELLS,
           EXCEPTION-VALUE 1001,
           ID IS 6,
           SELF-ACT,
           TITLE "SETTIMANA >",
           VISIBLE 1,
           MULTILINE
           .

      * PUSH BUTTON
       05
           pb-giorno-prev, 
           Push-Button, 
           COL 15,80, 
           LINE 1,17,
           LINES 1,61 CELLS,
           SIZE 13,00 CELLS,
           EXCEPTION-VALUE 1002,
           ID IS 4,
           SELF-ACT,
           TITLE "GIORNO <",
           MULTILINE
           .

      * PUSH BUTTON
       05
           pb-giorno-next, 
           Push-Button, 
           COL 15,80, 
           LINE 2,96,
           LINES 1,61 CELLS,
           SIZE 13,00 CELLS,
           EXCEPTION-VALUE 1003,
           ID IS 5,
           SELF-ACT,
           TITLE "GIORNO >",
           VISIBLE 1,
           MULTILINE
           .

      * PUSH BUTTON
       05
           pb-su, 
           Push-Button, 
           COL 31,00, 
           LINE 1,17,
           LINES 1,61 CELLS,
           SIZE 13,00 CELLS,
           EXCEPTION-VALUE 1004,
           ID IS 7,
           SELF-ACT,
           TITLE "SPOSTA SU",
           VISIBLE 0,
           MULTILINE
           .

      * PUSH BUTTON
       05
           pb-giu, 
           Push-Button, 
           COL 31,00, 
           LINE 2,96,
           LINES 1,61 CELLS,
           SIZE 13,00 CELLS,
           EXCEPTION-VALUE 1005,
           ID IS 9,
           SELF-ACT,
           TITLE "SPOSTA GIU",
           VISIBLE 0,
           MULTILINE
           .

      * PUSH BUTTON
       05
           pb-aggiungi, 
           Push-Button, 
           COL 46,30, 
           LINE 1,17,
           LINES 1,61 CELLS,
           SIZE 24,00 CELLS,
           EXCEPTION-VALUE 1006,
           ID IS 10,
           SELF-ACT,
           TITLE "INSERISCI APPUNTAMENTO",
           MULTILINE
           .

      * PUSH BUTTON
       05
           pb-aggiungi-r, 
           Push-Button, 
           COL 46,30, 
           LINE 2,96,
           LINES 1,61 CELLS,
           SIZE 24,00 CELLS,
           EXCEPTION-VALUE 1007,
           ID IS 11,
           SELF-ACT,
           TITLE "APPUNTAMENTI RIPETUTI",
           VISIBLE 1,
           MULTILINE
           .

      * PUSH BUTTON
       05
           pb-cancella, 
           Push-Button, 
           COL 70,90, 
           LINE 1,17,
           LINES 1,61 CELLS,
           SIZE 24,00 CELLS,
           EXCEPTION-VALUE 1008,
           ID IS 12,
           SELF-ACT,
           TITLE "CANCELLA APPUNTAMENTO",
           MULTILINE
           .

      * PUSH BUTTON
       05
           pb-cancella-r, 
           Push-Button, 
           COL 70,90, 
           LINE 2,96,
           LINES 1,61 CELLS,
           SIZE 24,00 CELLS,
           EXCEPTION-VALUE 1009,
           ID IS 16,
           SELF-ACT,
           TITLE "CANCELLA RIPETUTI",
           VISIBLE 1,
           MULTILINE
           .

      * PUSH BUTTON
       05
           pb-recupero, 
           Push-Button, 
           COL 97,40, 
           LINE 1,17,
           LINES 1,61 CELLS,
           SIZE 13,00 CELLS,
           EXCEPTION-VALUE 1010,
           ID IS 13,
           SELF-ACT,
           TITLE "RECUPERO",
           MULTILINE
           .

      * PUSH BUTTON
       05
           pb-cerca, 
           Push-Button, 
           COL 97,40, 
           LINE 2,96,
           LINES 1,61 CELLS,
           SIZE 13,00 CELLS,
           EXCEPTION-VALUE 1011,
           ID IS 14,
           SELF-ACT,
           TITLE "CERCA",
           VISIBLE 1,
           MULTILINE
           .

      * PUSH BUTTON
       05
           pb-cal, 
           Push-Button, 
           COL 112,20, 
           LINE 1,17,
           LINES 1,61 CELLS,
           SIZE 13,00 CELLS,
           EXCEPTION-VALUE 1012,
           ID IS 15,
           SELF-ACT,
           TITLE "CALENDARIO",
           MULTILINE
           .

      * PUSH BUTTON
       05
           pb-test, 
           Push-Button, 
           COL 112,20, 
           LINE 2,96,
           LINES 1,61 CELLS,
           SIZE 13,00 CELLS,
           EXCEPTION-VALUE 1013,
           ID IS 17,
           SELF-ACT,
           TITLE "TEST",
           VISIBLE 1,
           MULTILINE
           .

      * PUSH BUTTON
       05
           pb-uscita, 
           Push-Button, 
           COL 127,20, 
           LINE 1,22,
           LINES 1,61 CELLS,
           SIZE 13,00 CELLS,
           EXCEPTION-VALUE 27,
           ID IS 18,
           SELF-ACT,
           ESCAPE-BUTTON,
           TITLE "ESCI",
           VISIBLE 1,
           MULTILINE
           .

      * BITMAP
       05
           Form1-Bt-1, 
           Bitmap, 
           COL 161,40, 
           LINE 1,26,
           LINES 64,00 ,
           SIZE 48,00 ,
           BITMAP-HANDLE LOGO_PICCOLO-BMP,
           BITMAP-NUMBER 1,
           ID IS 8,
           .

      * LABEL
       05
           Form1-blockpgm-1, 
           Label, 
           COL 154,50, 
           LINE 2,96,
           LINES 1,65 CELLS,
           SIZE 5,00 CELLS,
           ID IS 3,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "BlockPgm",
           VISIBLE v-custom,
           .

      * FORM
       01 
           scr-singolo, 
           .

      * ENTRY FIELD
       05
           ef-data, 
           Entry-Field, 
           COL 9,10, 
           LINE 1,74,
           LINES 1,30 ,
           SIZE 10,80 ,
           BOXED,
           COLOR IS 513,
           ID IS 78-ID-ef-data,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           VALUE ef-data-buf,
           AFTER PROCEDURE ef-data-AfterProcedure, 
           BEFORE PROCEDURE ef-data-BeforeProcedure, 
           .

      * PUSH BUTTON
       05
           pb-calendario, 
           Push-Button, 
           COL 20,60, 
           LINE 1,65,
           LINES 24,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE CALENDAR-BMP,
           BITMAP-NUMBER 1,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 101,
           ID IS 104,
           NO-TAB,
           SELF-ACT,
           TITLE "Calendario",
           .

      * ENTRY FIELD
       05
           ef-ora, 
           Entry-Field, 
           COL 33,10, 
           LINE 1,74,
           LINES 1,30 ,
           SIZE 5,00 ,
           BOXED,
           COLOR IS 513,
           ID IS 78-ID-ef-ora,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           VALUE ef-ora-buf,
           AFTER PROCEDURE ef-ora-AfterProcedure, 
           BEFORE PROCEDURE ef-ora-BeforeProcedure, 
           .

      * ENTRY FIELD
       05
           ef-cliente, 
           Entry-Field, 
           COL 9,10, 
           LINE 3,87,
           LINES 1,30 ,
           SIZE 10,80 ,
           BOXED,
           COLOR IS 513,
           ENABLED e-cliente,
           ID IS 78-ID-ef-cliente,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           VALUE ef-cliente-buf,
           AFTER PROCEDURE ef-cliente-AfterProcedure, 
           BEFORE PROCEDURE ef-cliente-BeforeProcedure, 
           .

      * PUSH BUTTON
       05
           pb-cerca-cli, 
           Push-Button, 
           COL 20,60, 
           LINE 3,87,
           LINES 24,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE CERCA-BMP,
           BITMAP-NUMBER 1,
           FRAMED,
           SQUARE,
           ENABLED e-cliente,
           EXCEPTION-VALUE 102,
           ID IS 2,
           NO-TAB,
           SELF-ACT,
           TITLE "Cerca",
           .

      * COMBO-BOX
       05
           cbo-stato, 
           Combo-Box, 
           COL 9,10, 
           LINE 6,00,
           LINES 6,00 ,
           SIZE 14,80 ,
           BOXED,
           COLOR IS 513,
           ENABLED e-cliente,
           ID IS 78-ID-cbo-stato,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MASS-UPDATE 0,
           DROP-LIST,
           UNSORTED,
           VISIBLE v-modifica,
           AFTER PROCEDURE scr-singol-Cm-1-AfterProcedure, 
           BEFORE PROCEDURE scr-singol-Cm-1-BeforeProcedure, 
           .
      * COMBO-BOX
       05
           cbo-pagato, 
           Combo-Box, 
           COL 33,10, 
           LINE 6,00,
           LINES 6,00 ,
           SIZE 14,80 ,
           BOXED,
           COLOR IS 513,
           ID IS 78-ID-cbo-pagato,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MASS-UPDATE 0,
           DROP-LIST,
           UNSORTED,
           VISIBLE v-modifica,
           AFTER PROCEDURE scr-singol-Cm-1-AfterProcedure, 
           BEFORE PROCEDURE scr-singol-Cm-1-BeforeProcedure, 
           .
      * LABEL
       05
           Screen1-La-1a, 
           Label, 
           COL 2,10, 
           LINE 3,87,
           LINES 1,30 ,
           SIZE 6,00 ,
           ID IS 100,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Cliente",
           .

      * PUSH BUTTON
       05
           pb-procedi, 
           Push-Button, 
           COL 68,60, 
           LINE 6,00,
           LINES 114,00 ,
           SIZE 96,00 ,
           BITMAP-HANDLE FATCLI-BMP,
           BITMAP-NUMBER 1,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 13,
           ID IS 101,
           NO-TAB,
           SELF-ACT,
           .

      * PUSH BUTTON
       05
           pb-procedia, 
           Push-Button, 
           COL 80,30, 
           LINE 6,00,
           LINES 114,00 ,
           SIZE 96,00 ,
           BITMAP-HANDLE FATCLI-BMP,
           BITMAP-NUMBER 2,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 27,
           ID IS 102,
           NO-TAB,
           SELF-ACT,
           .

      * LABEL
       05
           Screen1-La-1aa, 
           Label, 
           COL 2,10, 
           LINE 1,74,
           LINES 1,30 ,
           SIZE 6,00 ,
           ID IS 103,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Data",
           .

      * LABEL
       05
           Screen1-La-1aaa, 
           Label, 
           COL 26,20, 
           LINE 1,74,
           LINES 1,30 ,
           SIZE 4,00 ,
           ID IS 105,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Ora",
           .

      * LABEL
       05
           lab-cliente, 
           Label, 
           COL 26,20, 
           LINE 3,87,
           LINES 1,30 ,
           SIZE 61,70 ,
           COLOR IS 9,
           FONT IS Calibri16B-Occidentale,
           ID IS 3,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-cliente-buf,
           .

      * LABEL
       05
           scr-singol-Custom1-1, 
           Label, 
           COL 89,70, 
           LINE 2,30,
           LINES 1,00 ,
           SIZE 1,00 ,
           FONT IS Default-Font,
           ID IS 1,
           TRANSPARENT,
           TITLE "CUSTOM CONTROL",
           VISIBLE v-custom,
           .

      * LABEL
       05
           Screen1-La-1ab, 
           Label, 
           COL 2,10, 
           LINE 6,04,
           LINES 1,30 ,
           SIZE 6,00 ,
           ID IS 9,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Stato",
           VISIBLE v-modifica,
           .

      * LABEL
       05
           Screen1-La-1aba, 
           Label, 
           COL 26,20, 
           LINE 6,04,
           LINES 1,30 ,
           SIZE 6,00 ,
           ID IS 10,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Pagato",
           VISIBLE v-modifica,
           .

      * FORM
       01 
           scr-cancella-r, 
           .

      * ENTRY FIELD
       05
           ef-cliente-cr, 
           Entry-Field, 
           COL 9,10, 
           LINE 1,91,
           LINES 1,30 ,
           SIZE 10,80 ,
           BOXED,
           COLOR IS 513,
           ID IS 78-ID-ef-cliente-cr,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           VALUE ef-cliente-cr-buf,
           AFTER PROCEDURE ef-cliente-cr-AfterProcedure, 
           BEFORE PROCEDURE ef-cliente-cr-BeforeProcedure, 
           .

      * ENTRY FIELD
       05
           ef-dal-cr, 
           Entry-Field, 
           COL 9,10, 
           LINE 3,91,
           LINES 1,30 ,
           SIZE 10,80 ,
           BOXED,
           COLOR IS 513,
           ID IS 78-ID-ef-dal-cr,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           VALUE ef-dal-cr-buf,
           AFTER PROCEDURE ef-dal-cr-AfterProcedure, 
           BEFORE PROCEDURE ef-data-BeforeProcedure, 
           .

      * ENTRY FIELD
       05
           ef-al-cr, 
           Entry-Field, 
           COL 28,10, 
           LINE 3,91,
           LINES 1,30 ,
           SIZE 10,80 ,
           BOXED,
           COLOR IS 513,
           ID IS 78-ID-ef-al-cr,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           VALUE ef-al-cr-buf,
           AFTER PROCEDURE ef-al-cr-AfterProcedure, 
           BEFORE PROCEDURE ef-data-BeforeProcedure, 
           .

      * CHECK BOX
       05
           chk-nessuno-cr, 
           Check-Box, 
           COL 9,10, 
           LINE 6,00,
           LINES 1,30 ,
           SIZE 10,80 ,
           FLAT,
           ID IS 78-ID-chk-nessuno-cr,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Nessuno",
           VALUE chk-nessuno-cr-buf,
           AFTER PROCEDURE Screen1-Cb-1-AfterProcedure,
           BEFORE PROCEDURE Screen1-Cb-1-BeforeProcedure, 
           .
      * CHECK BOX
       05
           chk-assente-cr, 
           Check-Box, 
           COL 9,10, 
           LINE 7,48,
           LINES 1,30 ,
           SIZE 10,80 ,
           FLAT,
           ID IS 78-ID-chk-assente-cr,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Assente",
           VALUE chk-assente-cr-buf,
           AFTER PROCEDURE Screen1-Cb-1-AfterProcedure,
           BEFORE PROCEDURE Screen1-Cb-1-BeforeProcedure, 
           .
      * CHECK BOX
       05
           chk-presente-cr, 
           Check-Box, 
           COL 9,10, 
           LINE 9,00,
           LINES 1,30 ,
           SIZE 10,80 ,
           FLAT,
           ID IS 78-ID-chk-presente-cr,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Presente",
           VALUE chk-presente-cr-buf,
           AFTER PROCEDURE Screen1-Cb-1-AfterProcedure,
           BEFORE PROCEDURE Screen1-Cb-1-BeforeProcedure, 
           .
      * CHECK BOX
       05
           chk-recupero-cr, 
           Check-Box, 
           COL 9,10, 
           LINE 10,48,
           LINES 1,30 ,
           SIZE 10,80 ,
           FLAT,
           ID IS 78-ID-chk-recupero-cr,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Recupero",
           VALUE chk-recupero-cr-buf,
           AFTER PROCEDURE Screen1-Cb-1-AfterProcedure,
           BEFORE PROCEDURE Screen1-Cb-1-BeforeProcedure, 
           .
      * CHECK BOX
       05
           chk-test-cr, 
           Check-Box, 
           COL 9,10, 
           LINE 12,00,
           LINES 1,30 ,
           SIZE 10,80 ,
           FLAT,
           ID IS 11,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Test",
           VALUE chk-test-cr-buf,
           AFTER PROCEDURE Screen1-Cb-1-AfterProcedure,
           BEFORE PROCEDURE Screen1-Cb-1-BeforeProcedure, 
           .
      * CHECK BOX
       05
           chk-inizio-cr, 
           Check-Box, 
           COL 24,10, 
           LINE 6,00,
           LINES 1,30 ,
           SIZE 10,80 ,
           FLAT,
           ID IS 78-ID-chk-inizio-cr,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Inizio",
           VALUE chk-inizio-cr-buf,
           AFTER PROCEDURE Screen1-Cb-1-AfterProcedure,
           BEFORE PROCEDURE Screen1-Cb-1-BeforeProcedure, 
           .
      * CHECK BOX
       05
           chk-terapia-cr, 
           Check-Box, 
           COL 24,10, 
           LINE 7,48,
           LINES 1,30 ,
           SIZE 10,80 ,
           FLAT,
           ID IS 13,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Terapia",
           VALUE chk-terapia-cr-buf,
           AFTER PROCEDURE Screen1-Cb-1-AfterProcedure,
           BEFORE PROCEDURE Screen1-Cb-1-BeforeProcedure, 
           .
      * PUSH BUTTON
       05
           pb-dal-cr, 
           Push-Button, 
           COL 20,60, 
           LINE 3,87,
           LINES 24,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE CALENDAR-BMP,
           BITMAP-NUMBER 1,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 1001,
           ID IS 104,
           NO-TAB,
           SELF-ACT,
           TITLE "Calendario",
           .

      * PUSH BUTTON
       05
           pb-cerca-cli-cr, 
           Push-Button, 
           COL 20,60, 
           LINE 1,91,
           LINES 24,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE CERCA-BMP,
           BITMAP-NUMBER 1,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 1000,
           ID IS 2,
           NO-TAB,
           SELF-ACT,
           TITLE "Cerca",
           .

      * LABEL
       05
           Screen1-La-1ac, 
           Label, 
           COL 2,10, 
           LINE 1,91,
           LINES 1,30 ,
           SIZE 6,00 ,
           ID IS 100,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Cliente",
           .

      * PUSH BUTTON
       05
           pb-procedi-cr, 
           Push-Button, 
           COL 68,60, 
           LINE 6,00,
           LINES 114,00 ,
           SIZE 96,00 ,
           BITMAP-HANDLE FATCLI-BMP,
           BITMAP-NUMBER 1,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 1002,
           ID IS 101,
           NO-TAB,
           SELF-ACT,
           .

      * PUSH BUTTON
       05
           pb-exit-cr, 
           Push-Button, 
           COL 80,30, 
           LINE 6,00,
           LINES 114,00 ,
           SIZE 96,00 ,
           BITMAP-HANDLE FATCLI-BMP,
           BITMAP-NUMBER 2,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 27,
           ID IS 102,
           NO-TAB,
           SELF-ACT,
           .

      * LABEL
       05
           Screen1-La-1aab, 
           Label, 
           COL 2,10, 
           LINE 3,91,
           LINES 1,30 ,
           SIZE 6,00 ,
           ID IS 103,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Dal",
           .

      * LABEL
       05
           lab-cliente-cr, 
           Label, 
           COL 26,20, 
           LINE 1,91,
           LINES 1,30 ,
           SIZE 61,70 ,
           COLOR IS 9,
           FONT IS Calibri16B-Occidentale,
           ID IS 3,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-cliente-cr-buf,
           .

      * LABEL
       05
           scr-singol-Custom1-1a, 
           Label, 
           COL 89,70, 
           LINE 2,30,
           LINES 1,00 ,
           SIZE 1,00 ,
           FONT IS Default-Font,
           ID IS 1,
           TRANSPARENT,
           TITLE "CUSTOM CONTROL",
           VISIBLE v-custom,
           .

      * LABEL
       05
           Screen1-La-1abb, 
           Label, 
           COL 2,10, 
           LINE 6,04,
           LINES 1,30 ,
           SIZE 6,00 ,
           ID IS 14,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Stato",
           .

      * PUSH BUTTON
       05
           pb-al-cr, 
           Push-Button, 
           COL 39,60, 
           LINE 3,87,
           LINES 24,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE CALENDAR-BMP,
           BITMAP-NUMBER 1,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 1003,
           ID IS 15,
           NO-TAB,
           SELF-ACT,
           TITLE "Calendario",
           .

      * LABEL
       05
           Screen1-La-1aaba, 
           Label, 
           COL 25,90, 
           LINE 3,91,
           LINES 1,30 ,
           SIZE 1,80 ,
           ID IS 16,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Al",
           .

      * FORM
       01 
           scr-aggiungi-r, 
           .

      * ENTRY FIELD
       05
           ef-cliente-ar, 
           Entry-Field, 
           COL 9,10, 
           LINE 1,91,
           LINES 1,30 ,
           SIZE 10,80 ,
           BOXED,
           COLOR IS 513,
           ID IS 78-ID-ef-cliente-ar,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           VALUE ef-cliente-ar-buf,
           AFTER PROCEDURE ef-cliente-ar-AfterProcedure, 
           BEFORE PROCEDURE ef-cliente-ar-BeforeProcedure, 
           .

      * ENTRY FIELD
       05
           ef-dal-ar, 
           Entry-Field, 
           COL 9,10, 
           LINE 3,87,
           LINES 1,30 ,
           SIZE 10,80 ,
           BOXED,
           COLOR IS 513,
           ID IS 78-ID-ef-dal-ar,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           VALUE ef-dal-ar-buf,
           AFTER PROCEDURE ef-dal-ar-AfterProcedure, 
           BEFORE PROCEDURE ef-dal-ar-BeforeProcedure, 
           .

      * ENTRY FIELD
       05
           ef-al-ar, 
           Entry-Field, 
           COL 28,10, 
           LINE 3,87,
           LINES 1,30 ,
           SIZE 10,80 ,
           BOXED,
           COLOR IS 513,
           ID IS 78-ID-ef-al-ar,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           VALUE ef-al-ar-buf,
           AFTER PROCEDURE ef-al-ar-AfterProcedure, 
           BEFORE PROCEDURE ef-al-ar-BeforeProcedure, 
           .

      * ENTRY FIELD
       05
           ef-ora-ar, 
           Entry-Field, 
           COL 9,10, 
           LINE 5,70,
           LINES 1,30 ,
           SIZE 5,00 ,
           BOXED,
           COLOR IS 513,
           ID IS 78-ID-ef-ora-ar,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           VALUE ef-ora-ar-buf,
           AFTER PROCEDURE ef-ora-ar-AfterProcedure, 
           BEFORE PROCEDURE ef-ora-ar-BeforeProcedure, 
           .

      * CHECK BOX
       05
           chk-lun, 
           Check-Box, 
           COL 9,10, 
           LINE 7,52,
           LINES 1,30 ,
           SIZE 10,80 ,
           FLAT,
           ID IS 78-ID-chk-lun,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Lunedì",
           VALUE chk-lun-buf,
           AFTER PROCEDURE Screen1-Cb-1-AfterProcedure,
           BEFORE PROCEDURE Screen1-Cb-1-BeforeProcedure, 
           .
      * CHECK BOX
       05
           chk-mar, 
           Check-Box, 
           COL 9,10, 
           LINE 9,00,
           LINES 1,30 ,
           SIZE 10,80 ,
           FLAT,
           ID IS 78-ID-chk-mar,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Martedì",
           VALUE chk-mar-buf,
           AFTER PROCEDURE Screen1-Cb-1-AfterProcedure,
           BEFORE PROCEDURE Screen1-Cb-1-BeforeProcedure, 
           .
      * CHECK BOX
       05
           chk-mer, 
           Check-Box, 
           COL 9,10, 
           LINE 10,52,
           LINES 1,30 ,
           SIZE 10,80 ,
           FLAT,
           ID IS 78-ID-chk-mer,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Mercoledì",
           VALUE chk-mer-buf,
           AFTER PROCEDURE Screen1-Cb-1-AfterProcedure,
           BEFORE PROCEDURE Screen1-Cb-1-BeforeProcedure, 
           .
      * CHECK BOX
       05
           chk-gio, 
           Check-Box, 
           COL 24,40, 
           LINE 7,52,
           LINES 1,30 ,
           SIZE 10,80 ,
           FLAT,
           ID IS 12,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Giovedì",
           VALUE chk-gio-buf,
           AFTER PROCEDURE Screen1-Cb-1-AfterProcedure,
           BEFORE PROCEDURE Screen1-Cb-1-BeforeProcedure, 
           .
      * CHECK BOX
       05
           chk-ven, 
           Check-Box, 
           COL 24,40, 
           LINE 9,00,
           LINES 1,30 ,
           SIZE 10,80 ,
           FLAT,
           ID IS 78-ID-chk-ven,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Venerdì",
           VALUE chk-ven-buf,
           AFTER PROCEDURE Screen1-Cb-1-AfterProcedure,
           BEFORE PROCEDURE Screen1-Cb-1-BeforeProcedure, 
           .
      * CHECK BOX
       05
           chk-sab, 
           Check-Box, 
           COL 24,40, 
           LINE 10,52,
           LINES 1,30 ,
           SIZE 10,80 ,
           FLAT,
           ID IS 13,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Sabato",
           VALUE chk-sab-buf,
           AFTER PROCEDURE Screen1-Cb-1-AfterProcedure,
           BEFORE PROCEDURE Screen1-Cb-1-BeforeProcedure, 
           .
      * PUSH BUTTON
       05
           pb-dal-ar, 
           Push-Button, 
           COL 20,60, 
           LINE 3,83,
           LINES 24,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE CALENDAR-BMP,
           BITMAP-NUMBER 1,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 1001,
           ID IS 104,
           NO-TAB,
           SELF-ACT,
           TITLE "Calendario",
           .

      * PUSH BUTTON
       05
           pb-cerca-cli-ar, 
           Push-Button, 
           COL 20,60, 
           LINE 1,91,
           LINES 24,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE CERCA-BMP,
           BITMAP-NUMBER 1,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 1000,
           ID IS 2,
           NO-TAB,
           SELF-ACT,
           TITLE "Cerca",
           .

      * LABEL
       05
           Screen1-La-1aca, 
           Label, 
           COL 2,10, 
           LINE 1,91,
           LINES 1,30 ,
           SIZE 6,00 ,
           ID IS 100,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Cliente",
           .

      * PUSH BUTTON
       05
           pb-procedi-ar, 
           Push-Button, 
           COL 68,60, 
           LINE 6,00,
           LINES 114,00 ,
           SIZE 96,00 ,
           BITMAP-HANDLE FATCLI-BMP,
           BITMAP-NUMBER 1,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 1002,
           ID IS 101,
           NO-TAB,
           SELF-ACT,
           .

      * PUSH BUTTON
       05
           pb-exit-ar, 
           Push-Button, 
           COL 80,30, 
           LINE 6,00,
           LINES 114,00 ,
           SIZE 96,00 ,
           BITMAP-HANDLE FATCLI-BMP,
           BITMAP-NUMBER 2,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 27,
           ID IS 102,
           NO-TAB,
           SELF-ACT,
           .

      * LABEL
       05
           Screen1-La-1aabb, 
           Label, 
           COL 2,10, 
           LINE 3,87,
           LINES 1,30 ,
           SIZE 6,00 ,
           ID IS 103,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Dal",
           .

      * LABEL
       05
           lab-cliente-ar, 
           Label, 
           COL 26,20, 
           LINE 1,91,
           LINES 1,30 ,
           SIZE 61,70 ,
           COLOR IS 9,
           FONT IS Calibri16B-Occidentale,
           ID IS 3,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-cliente-ar-buf,
           .

      * LABEL
       05
           scr-singol-Custom1-1aa, 
           Label, 
           COL 89,70, 
           LINE 2,30,
           LINES 1,00 ,
           SIZE 1,00 ,
           FONT IS Default-Font,
           ID IS 1,
           TRANSPARENT,
           TITLE "CUSTOM CONTROL",
           VISIBLE v-custom,
           .

      * LABEL
       05
           Screen1-La-1abba, 
           Label, 
           COL 2,10, 
           LINE 7,57,
           LINES 1,30 ,
           SIZE 6,00 ,
           ID IS 14,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Giorno",
           .

      * PUSH BUTTON
       05
           pb-al-ar, 
           Push-Button, 
           COL 39,60, 
           LINE 3,83,
           LINES 24,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE CALENDAR-BMP,
           BITMAP-NUMBER 1,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 1003,
           ID IS 15,
           NO-TAB,
           SELF-ACT,
           TITLE "Calendario",
           .

      * LABEL
       05
           Screen1-La-1aabaa, 
           Label, 
           COL 25,60, 
           LINE 3,87,
           LINES 1,30 ,
           SIZE 2,00 ,
           ID IS 16,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Al",
           .

      * LABEL
       05
           Screen1-La-1aaaa, 
           Label, 
           COL 2,10, 
           LINE 5,70,
           LINES 1,30 ,
           SIZE 4,00 ,
           ID IS 105,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Ora",
           .

      * FORM
       01 
           scr-cerca, 
           .

      * ENTRY FIELD
       05
           ef-cliente-c, 
           Entry-Field, 
           COL 9,10, 
           LINE 1,91,
           LINES 1,30 ,
           SIZE 10,80 ,
           BOXED,
           COLOR IS 513,
           ID IS 78-ID-ef-cliente-c,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           VALUE ef-cliente-c-buf,
           AFTER PROCEDURE ef-cliente-c-AfterProcedure, 
           BEFORE PROCEDURE ef-cliente-c-BeforeProcedure, 
           .

      * ENTRY FIELD
       05
           ef-dal-c, 
           Entry-Field, 
           COL 9,10, 
           LINE 3,91,
           LINES 1,30 ,
           SIZE 10,80 ,
           BOXED,
           COLOR IS 513,
           ID IS 78-ID-ef-dal-c,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           VALUE ef-dal-c-buf,
           AFTER PROCEDURE ef-dal-c-AfterProcedure, 
           BEFORE PROCEDURE ef-dal-c-BeforeProcedure, 
           .

      * ENTRY FIELD
       05
           ef-al-c, 
           Entry-Field, 
           COL 28,10, 
           LINE 3,91,
           LINES 1,30 ,
           SIZE 10,80 ,
           BOXED,
           COLOR IS 513,
           ID IS 78-ID-ef-al-c,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           VALUE ef-al-c-buf,
           AFTER PROCEDURE ef-al-c-AfterProcedure, 
           BEFORE PROCEDURE ef-al-cra-BeforeProcedure, 
           .

      * CHECK BOX
       05
           chk-nessuno-c, 
           Check-Box, 
           COL 9,10, 
           LINE 6,48,
           LINES 1,30 ,
           SIZE 9,00 ,
           FLAT,
           ID IS 78-ID-chk-nessuno-c,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Nessuno",
           VALUE chk-nessuno-c-buf,
           AFTER PROCEDURE Screen1-Cb-1-AfterProcedure,
           BEFORE PROCEDURE Screen1-Cb-1-BeforeProcedure, 
           .
      * CHECK BOX
       05
           chk-assente-c, 
           Check-Box, 
           COL 19,60, 
           LINE 6,48,
           LINES 1,30 ,
           SIZE 8,50 ,
           FLAT,
           ID IS 78-ID-chk-assente-c,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Assente",
           VALUE chk-assente-c-buf,
           AFTER PROCEDURE Screen1-Cb-1-AfterProcedure,
           BEFORE PROCEDURE Screen1-Cb-1-BeforeProcedure, 
           .
      * CHECK BOX
       05
           chk-presente-c, 
           Check-Box, 
           COL 29,10, 
           LINE 6,48,
           LINES 1,30 ,
           SIZE 9,00 ,
           FLAT,
           ID IS 78-ID-chk-presente-c,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Presente",
           VALUE chk-presente-c-buf,
           AFTER PROCEDURE Screen1-Cb-1-AfterProcedure,
           BEFORE PROCEDURE Screen1-Cb-1-BeforeProcedure, 
           .
      * CHECK BOX
       05
           chk-recupero-c, 
           Check-Box, 
           COL 39,10, 
           LINE 6,48,
           LINES 1,30 ,
           SIZE 9,50 ,
           FLAT,
           ID IS 78-ID-chk-recupero-c,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Recupero",
           VALUE chk-recupero-c-buf,
           AFTER PROCEDURE Screen1-Cb-1-AfterProcedure,
           BEFORE PROCEDURE Screen1-Cb-1-BeforeProcedure, 
           .
      * CHECK BOX
       05
           chk-inizio-c, 
           Check-Box, 
           COL 49,60, 
           LINE 6,48,
           LINES 1,30 ,
           SIZE 7,00 ,
           FLAT,
           ID IS 78-ID-chk-inizio-c,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Inizio",
           VALUE chk-inizio-c-buf,
           AFTER PROCEDURE Screen1-Cb-1-AfterProcedure,
           BEFORE PROCEDURE Screen1-Cb-1-BeforeProcedure, 
           .
      * CHECK BOX
       05
           chk-test-c, 
           Check-Box, 
           COL 58,10, 
           LINE 6,48,
           LINES 1,30 ,
           SIZE 6,00 ,
           FLAT,
           ID IS 12,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Test",
           VALUE chk-test-c-buf,
           AFTER PROCEDURE Screen1-Cb-1-AfterProcedure,
           BEFORE PROCEDURE Screen1-Cb-1-BeforeProcedure, 
           .
      * CHECK BOX
       05
           chk-terapia-c, 
           Check-Box, 
           COL 64,60, 
           LINE 6,48,
           LINES 1,30 ,
           SIZE 8,00 ,
           FLAT,
           ID IS 13,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Terapia",
           VALUE chk-terapia-c-buf,
           AFTER PROCEDURE Screen1-Cb-1-AfterProcedure,
           BEFORE PROCEDURE Screen1-Cb-1-BeforeProcedure, 
           .
      * CHECK BOX
       05
           chk-pag-n, 
           Check-Box, 
           COL 9,10, 
           LINE 8,22,
           LINES 1,30 ,
           SIZE 9,00 ,
           FLAT,
           ID IS 78-ID-chk-pag-n,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Nessuno",
           VALUE chk-pag-n-buf,
           AFTER PROCEDURE Screen1-Cb-1-AfterProcedure,
           BEFORE PROCEDURE Screen1-Cb-1-BeforeProcedure, 
           .
      * CHECK BOX
       05
           chk-pag-si, 
           Check-Box, 
           COL 19,60, 
           LINE 8,22,
           LINES 1,30 ,
           SIZE 8,50 ,
           FLAT,
           ID IS 78-ID-chk-pag-si,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Si",
           VALUE chk-pag-si-buf,
           AFTER PROCEDURE Screen1-Cb-1-AfterProcedure,
           BEFORE PROCEDURE Screen1-Cb-1-BeforeProcedure, 
           .
      * CHECK BOX
       05
           chk-pag-ft, 
           Check-Box, 
           COL 29,10, 
           LINE 8,22,
           LINES 1,30 ,
           SIZE 9,00 ,
           FLAT,
           ID IS 78-ID-chk-pag-ft,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Fattura",
           VALUE chk-pag-ft-buf,
           AFTER PROCEDURE Screen1-Cb-1-AfterProcedure,
           BEFORE PROCEDURE Screen1-Cb-1-BeforeProcedure, 
           .
      * PUSH BUTTON
       05
           pb-dal-c, 
           Push-Button, 
           COL 20,60, 
           LINE 3,87,
           LINES 24,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE CALENDAR-BMP,
           BITMAP-NUMBER 1,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 1001,
           ID IS 104,
           NO-TAB,
           SELF-ACT,
           TITLE "Calendario",
           .

      * PUSH BUTTON
       05
           pb-cerca-cli-c, 
           Push-Button, 
           COL 20,60, 
           LINE 1,91,
           LINES 24,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE CERCA-BMP,
           BITMAP-NUMBER 1,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 1000,
           ID IS 2,
           NO-TAB,
           SELF-ACT,
           TITLE "Cerca",
           .

      * LABEL
       05
           Screen1-La-1acb, 
           Label, 
           COL 2,10, 
           LINE 1,91,
           LINES 1,30 ,
           SIZE 6,00 ,
           ID IS 100,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Cliente",
           .

      * PUSH BUTTON
       05
           pb-procedi-c, 
           Push-Button, 
           COL 74,10, 
           LINE 4,26,
           LINES 114,00 ,
           SIZE 96,00 ,
           BITMAP-HANDLE FATCLI-BMP,
           BITMAP-NUMBER 1,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 1002,
           ID IS 101,
           NO-TAB,
           SELF-ACT,
           .

      * PUSH BUTTON
       05
           pb-exit-c, 
           Push-Button, 
           COL 84,90, 
           LINE 4,26,
           LINES 114,00 ,
           SIZE 96,00 ,
           BITMAP-HANDLE FATCLI-BMP,
           BITMAP-NUMBER 2,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 27,
           ID IS 102,
           NO-TAB,
           SELF-ACT,
           .

      * LABEL
       05
           Screen1-La-1aabc, 
           Label, 
           COL 2,10, 
           LINE 3,91,
           LINES 1,30 ,
           SIZE 6,00 ,
           ID IS 103,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Dal",
           .

      * LABEL
       05
           lab-cliente-c, 
           Label, 
           COL 24,70, 
           LINE 1,91,
           LINES 1,30 ,
           SIZE 46,50 ,
           COLOR IS 9,
           FONT IS Calibri16B-Occidentale,
           ID IS 3,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-cliente-c-buf,
           .

      * LABEL
       05
           scr-singol-Custom1-1ab, 
           Label, 
           COL 47,30, 
           LINE 1,65,
           LINES 1,00 ,
           SIZE 1,00 ,
           FONT IS Default-Font,
           ID IS 1,
           TRANSPARENT,
           TITLE "CUSTOM CONTROL",
           VISIBLE v-custom,
           .

      * LABEL
       05
           Screen1-La-1abbb, 
           Label, 
           COL 2,10, 
           LINE 6,48,
           LINES 1,30 ,
           SIZE 6,00 ,
           ID IS 17,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Stato",
           .

      * PUSH BUTTON
       05
           pb-al-c, 
           Push-Button, 
           COL 39,60, 
           LINE 3,87,
           LINES 24,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE CALENDAR-BMP,
           BITMAP-NUMBER 1,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 1003,
           ID IS 18,
           NO-TAB,
           SELF-ACT,
           TITLE "Calendario",
           .

      * LABEL
       05
           Screen1-La-1aabab, 
           Label, 
           COL 25,50, 
           LINE 3,91,
           LINES 1,30 ,
           SIZE 2,20 ,
           ID IS 19,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Al",
           .

      * LABEL
       05
           Screen1-La-1abbba, 
           Label, 
           COL 2,10, 
           LINE 8,22,
           LINES 1,30 ,
           SIZE 6,00 ,
           ID IS 20,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Pagato",
           .

      * GRID
       05
           gd-cerca, 
           Grid, 
           COL 2,40, 
           LINE 10,52,
           LINES 14,52 ,
           SIZE 91,90 ,
           ADJUSTABLE-COLUMNS,
           BOXED,
           DATA-COLUMNS (1, 11, 16, 36, 86, 88),
           ALIGNMENT ("C", "U", "U", "U", "U", "C"),
           SEPARATION (5, 5, 5, 5, 5, 5),
           NUM-COL-HEADINGS 1,
           COLUMN-HEADINGS,
           CURSOR-FRAME-WIDTH 0,
           DIVIDER-COLOR 1,
           HEADING-COLOR 257,
           HEADING-DIVIDER-COLOR 1,
           HSCROLL,
           ID IS 21,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TILED-HEADINGS,
           VIRTUAL-WIDTH 90,
           VPADDING 50,
           VSCROLL,
           EVENT PROCEDURE Screen1b-Gd-1-Event-Proc,
           .

      * PUSH BUTTON
       05
           pb-excel-c, 
           Push-Button, 
           COL 84,90, 
           LINE 1,61,
           LINES 50,00 ,
           SIZE 96,00 ,
           BITMAP-HANDLE toEXCEL2-BMP,
           BITMAP-NUMBER 1,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 1004,
           ID IS 22,
           NO-TAB,
           SELF-ACT,
           TITLE "Porta in &Excel",
           .

      * PUSH BUTTON
       05
           pb-stampa, 
           Push-Button, 
           COL 74,10, 
           LINE 1,61,
           LINES 50,00 ,
           SIZE 96,00 ,
           BITMAP-HANDLE stampa2-BMP,
           BITMAP-NUMBER 1,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 1005,
           ID IS 23,
           NO-TAB,
           SELF-ACT,
           TITLE "&Stampa",
           .

      * FORM
       01 
           scr-recupero, 
           .

      * ENTRY FIELD
       05
           ef-data-rec, 
           Entry-Field, 
           COL 9,10, 
           LINE 5,39,
           LINES 1,30 ,
           SIZE 10,80 ,
           BOXED,
           COLOR IS 513,
           ID IS 78-ID-ef-data-rec,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           VALUE ef-data-rec-buf,
           AFTER PROCEDURE ef-data-rec-AfterProcedure, 
           BEFORE PROCEDURE ef-data-rec-BeforeProcedure, 
           .

      * PUSH BUTTON
       05
           pb-calendario-rec, 
           Push-Button, 
           COL 20,60, 
           LINE 5,35,
           LINES 24,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE CALENDAR-BMP,
           BITMAP-NUMBER 1,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 1001,
           ID IS 104,
           NO-TAB,
           SELF-ACT,
           TITLE "Calendario",
           .

      * ENTRY FIELD
       05
           ef-ora-rec, 
           Entry-Field, 
           COL 33,10, 
           LINE 5,39,
           LINES 1,30 ,
           SIZE 5,00 ,
           BOXED,
           COLOR IS 513,
           ID IS 78-ID-ef-ora-rec,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           VALUE ef-ora-rec-buf,
           AFTER PROCEDURE ef-ora-rec-AfterProcedure, 
           BEFORE PROCEDURE ef-ora-rec-BeforeProcedure, 
           .

      * PUSH BUTTON
       05
           pb-procedi-rec, 
           Push-Button, 
           COL 68,60, 
           LINE 1,65,
           LINES 114,00 ,
           SIZE 96,00 ,
           BITMAP-HANDLE FATCLI-BMP,
           BITMAP-NUMBER 1,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 1000,
           ID IS 101,
           NO-TAB,
           SELF-ACT,
           .

      * PUSH BUTTON
       05
           pb-procediaa, 
           Push-Button, 
           COL 80,30, 
           LINE 1,65,
           LINES 114,00 ,
           SIZE 96,00 ,
           BITMAP-HANDLE FATCLI-BMP,
           BITMAP-NUMBER 2,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 27,
           ID IS 102,
           NO-TAB,
           SELF-ACT,
           .

      * LABEL
       05
           Screen1-La-1aac, 
           Label, 
           COL 2,10, 
           LINE 5,39,
           LINES 1,30 ,
           SIZE 6,00 ,
           ID IS 103,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Data",
           .

      * LABEL
       05
           Screen1-La-1aaab, 
           Label, 
           COL 26,20, 
           LINE 5,39,
           LINES 1,30 ,
           SIZE 4,00 ,
           ID IS 105,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Ora",
           .

      * LABEL
       05
           lab-cliente-rec, 
           Label, 
           COL 2,20, 
           LINE 1,43,
           LINES 1,30 ,
           SIZE 61,70 ,
           COLOR IS 9,
           FONT IS Calibri16B-Occidentale,
           ID IS 3,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-cliente-rec-buf,
           .

      * LABEL
       05
           scr-singol-Custom1-1b, 
           Label, 
           COL 89,70, 
           LINE 2,30,
           LINES 1,00 ,
           SIZE 1,00 ,
           FONT IS Default-Font,
           ID IS 1,
           TRANSPARENT,
           TITLE "CUSTOM CONTROL",
           VISIBLE v-custom,
           .

      * LABEL
       05
           lab-app-rec, 
           Label, 
           COL 2,20, 
           LINE 2,87,
           LINES 1,30 ,
           SIZE 61,70 ,
           COLOR IS 9,
           FONT IS Calibri16B-Occidentale,
           ID IS 2,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-app-rec-buf,
           .

      * BAR
       05
           Screen2-Br-1, 
           Bar,
           COL 1,00, 
           LINE 4,74,
           SIZE 65,90 ,
           ID IS 4,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           COLORS (11, 11),
           WIDTH 2,
           .

      * FORM
       01 
           scr-attesa, 
           .

      * LABEL
       05
           scr-attesa-La-1, 
           Label, 
           COL 7,55, 
           LINE 2,23,
           LINES 1,85 ,
           SIZE 31,18 ,
           FONT IS Calibri24B-Occidentale,
           ID IS 1,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE "ATTENDERE PREGO....",
           .

      * LABEL
       05
           lab-attesa, 
           Label, 
           COL 13,73, 
           LINE 4,27,
           LINES 1,08 ,
           SIZE 18,73 ,
           ID IS 2,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE lab-attesa-buf,
           .

      * FORM
       01 
           scr-test, 
           .

      * ENTRY FIELD
       05
           ef-dal-t, 
           Entry-Field, 
           COL 9,60, 
           LINE 1,87,
           LINES 1,30 ,
           SIZE 10,80 ,
           BOXED,
           COLOR IS 513,
           ID IS 78-ID-ef-dal-t,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           VALUE ef-dal-t-buf,
           AFTER PROCEDURE ef-dal-t-AfterProcedure, 
           BEFORE PROCEDURE ef-dal-t-BeforeProcedure, 
           .

      * ENTRY FIELD
       05
           ef-al-t, 
           Entry-Field, 
           COL 29,10, 
           LINE 1,87,
           LINES 1,30 ,
           SIZE 10,80 ,
           BOXED,
           COLOR IS 513,
           ID IS 78-ID-ef-al-t,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           VALUE ef-al-t-buf,
           AFTER PROCEDURE ef-al-t-AfterProcedure, 
           BEFORE PROCEDURE ef-al-t-BeforeProcedure, 
           .

      * ENTRY FIELD
       05
           ef-cliente-t, 
           Entry-Field, 
           COL 9,60, 
           LINE 3,65,
           LINES 1,30 ,
           SIZE 10,80 ,
           BOXED,
           COLOR IS 513,
           ID IS 78-ID-ef-cliente-t,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           VALUE ef-cliente-t-buf,
           AFTER PROCEDURE ef-cliente-t-AfterProcedure, 
           BEFORE PROCEDURE ef-cliente-t-BeforeProcedure, 
           .

      * GRID
       05
           gd-test, 
           Grid, 
           COL 2,70, 
           LINE 7,48,
           LINES 11,83 ,
           SIZE 61,90 ,
           ADJUSTABLE-COLUMNS,
           BOXED,
           DATA-COLUMNS (1, 11, 16),
           ALIGNMENT ("C", "C", "U"),
           SEPARATION (5, 5, 5),
           NUM-COL-HEADINGS 1,
           COLUMN-HEADINGS,
           CURSOR-FRAME-WIDTH 0,
           DIVIDER-COLOR 1,
           HEADING-COLOR 257,
           HEADING-DIVIDER-COLOR 1,
           ID IS 19,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TILED-HEADINGS,
           VIRTUAL-WIDTH 60,
           VPADDING 15,
           VSCROLL,
           EVENT PROCEDURE Screen1b-Gd-1-Event-Proc,
           .

      * ENTRY FIELD
       05
           ef-dal-v, 
           Entry-Field, 
           COL 9,60, 
           LINE 20,43,
           LINES 1,30 ,
           SIZE 10,80 ,
           BOXED,
           COLOR IS 513,
           ID IS 78-ID-ef-dal-v,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           VALUE ef-dal-v-buf,
           AFTER PROCEDURE ef-dal-v-AfterProcedure, 
           BEFORE PROCEDURE ef-dal-v-BeforeProcedure, 
           .

      * CHECK BOX
       05
           chk-solo-test, 
           Check-Box, 
           COL 28,50, 
           LINE 20,43,
           LINES 1,22 ,
           SIZE 2,00 ,
           FLAT,
           FONT IS Small-Font,
           ID IS 9,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           VALUE chk-solo-test-buf,
           AFTER PROCEDURE Screen3-Cb-1-AfterProcedure,
           BEFORE PROCEDURE Screen3-Cb-1-BeforeProcedure, 
           .
      * GRID
       05
           gd-verifica, 
           Grid, 
           COL 2,70, 
           LINE 23,87,
           LINES 11,83 ,
           SIZE 61,90 ,
           ADJUSTABLE-COLUMNS,
           BOXED,
           DATA-COLUMNS (1, 101, 104),
           ALIGNMENT ("U", "R", "C"),
           SEPARATION (5, 5, 5),
           NUM-COL-HEADINGS 1,
           COLUMN-HEADINGS,
           CURSOR-FRAME-WIDTH 0,
           DIVIDER-COLOR 1,
           HEADING-COLOR 257,
           HEADING-DIVIDER-COLOR 1,
           ID IS 10,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TILED-HEADINGS,
           VIRTUAL-WIDTH 60,
           VPADDING 15,
           VSCROLL,
           EVENT PROCEDURE Screen1b-Gd-1-Event-Proc,
           .

      * PUSH BUTTON
       05
           pb-dal-t, 
           Push-Button, 
           COL 21,10, 
           LINE 1,87,
           LINES 24,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE CALENDAR-BMP,
           BITMAP-NUMBER 1,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 1001,
           ID IS 104,
           NO-TAB,
           SELF-ACT,
           TITLE "Calendario",
           .

      * PUSH BUTTON
       05
           pb-cerca-cli-t, 
           Push-Button, 
           COL 21,10, 
           LINE 3,65,
           LINES 24,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE CERCA-BMP,
           BITMAP-NUMBER 1,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 1000,
           ID IS 2,
           NO-TAB,
           SELF-ACT,
           TITLE "Cerca",
           .

      * LABEL
       05
           Screen1-La-1acba, 
           Label, 
           COL 2,70, 
           LINE 3,65,
           LINES 1,30 ,
           SIZE 6,00 ,
           ID IS 100,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Cliente",
           .

      * PUSH BUTTON
       05
           pb-procedi-t, 
           Push-Button, 
           COL 66,20, 
           LINE 7,48,
           LINES 114,00 ,
           SIZE 96,00 ,
           BITMAP-HANDLE FATCLI-BMP,
           BITMAP-NUMBER 1,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 1005,
           ID IS 101,
           NO-TAB,
           SELF-ACT,
           .

      * PUSH BUTTON
       05
           pb-exit-t, 
           Push-Button, 
           COL 66,20, 
           LINE 1,65,
           LINES 114,00 ,
           SIZE 96,00 ,
           BITMAP-HANDLE FATCLI-BMP,
           BITMAP-NUMBER 2,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 27,
           ID IS 102,
           NO-TAB,
           SELF-ACT,
           .

      * LABEL
       05
           Screen1-La-1aabca, 
           Label, 
           COL 2,70, 
           LINE 1,87,
           LINES 1,30 ,
           SIZE 6,00 ,
           ID IS 103,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Dal",
           .

      * LABEL
       05
           lab-cliente-t, 
           Label, 
           COL 25,60, 
           LINE 3,65,
           LINES 1,30 ,
           SIZE 39,30 ,
           COLOR IS 9,
           FONT IS Calibri16B-Occidentale,
           ID IS 3,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-cliente-t-buf,
           .

      * LABEL
       05
           scr-singol-Custom1-1aba, 
           Label, 
           COL 50,80, 
           LINE 2,26,
           LINES 1,00 ,
           SIZE 1,00 ,
           FONT IS Default-Font,
           ID IS 1,
           TRANSPARENT,
           TITLE "CUSTOM CONTROL",
           VISIBLE v-custom,
           .

      * PUSH BUTTON
       05
           pb-al-t, 
           Push-Button, 
           COL 41,10, 
           LINE 1,87,
           LINES 24,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE CALENDAR-BMP,
           BITMAP-NUMBER 1,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 1002,
           ID IS 16,
           NO-TAB,
           SELF-ACT,
           TITLE "Calendario",
           .

      * LABEL
       05
           Screen1-La-1aababa, 
           Label, 
           COL 25,60, 
           LINE 1,87,
           LINES 1,30 ,
           SIZE 2,40 ,
           ID IS 17,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Al",
           .

      * LABEL
       05
           Screen3-La-1, 
           Label, 
           COL 2,70, 
           LINE 5,52,
           LINES 1,70 ,
           SIZE 61,90 ,
           FONT IS Calibri24B-Occidentale,
           ID IS 7,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE "VERIFICA TEST FATTI",
           .

      * BAR
       05
           Screen3-Br-1, 
           Bar,
           COL 1,00, 
           LINE 19,78,
           SIZE 76,80 ,
           ID IS 8,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           WIDTH 1,
           .

      * PUSH BUTTON
       05
           pb-dal-v, 
           Push-Button, 
           COL 21,10, 
           LINE 20,43,
           LINES 24,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE CALENDAR-BMP,
           BITMAP-NUMBER 1,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 1004,
           ID IS 11,
           NO-TAB,
           SELF-ACT,
           TITLE "Calendario",
           .

      * PUSH BUTTON
       05
           pb-procedi-v, 
           Push-Button, 
           COL 66,20, 
           LINE 24,00,
           LINES 114,00 ,
           SIZE 96,00 ,
           BITMAP-HANDLE FATCLI-BMP,
           BITMAP-NUMBER 1,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 1006,
           ID IS 12,
           NO-TAB,
           SELF-ACT,
           .

      * LABEL
       05
           Screen1-La-1aabcaa, 
           Label, 
           COL 2,70, 
           LINE 20,43,
           LINES 1,30 ,
           SIZE 6,00 ,
           ID IS 13,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Dal",
           .

      * LABEL
       05
           Screen3-La-1a, 
           Label, 
           COL 2,70, 
           LINE 21,91,
           LINES 1,52 ,
           SIZE 61,90 ,
           FONT IS Calibri24B-Occidentale,
           ID IS 14,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE "VERIFICA TEST DA FARE / PRESENZE",
           .

      * LABEL
       05
           Screen1-La-1acbaa, 
           Label, 
           COL 31,70, 
           LINE 20,43,
           LINES 1,30 ,
           SIZE 15,00 ,
           ID IS 15,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Solo da testare",
           .

      *{TOTEM}END

      *{TOTEM}LINKPARA
       PROCEDURE  DIVISION USING LK-BLOCKPGM.
      *{TOTEM}END

      *{TOTEM}DECLARATIVE
       DECLARATIVES.
      * <TOTEM:EPT. INIT:appuntamenti, INIT:appuntamenti, BeforeDeclarative>
       APPUNTAMENTI-ERR SECTION.
           use after error procedure on APPUNTAMENTI.
           evaluate status-APPUNTAMENTI 
           when "35"
                display message "File [APPUNTAMENTI] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [APPUNTAMENTI] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[APPUNTAMENTI] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.

      * <TOTEM:END>
       INPUT-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON INPUT.
       0100-DECL.
           EXIT.
       I-O-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON I-O.
       0200-DECL.
           EXIT.
       OUTPUT-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON OUTPUT.
       0300-DECL.
           EXIT.
       TRANSACTION-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON TRANSACTION.
       0400-DECL.
           EXIT.
       END DECLARATIVES.
      *{TOTEM}END

       MAIN-LOGIC.
      *{TOTEM}ENTRY-BEFPRG
      *    Before-Program
           PERFORM appuntamenti-Ev-Before-Program
      *{TOTEM}END
           PERFORM INITIALIZE-ROUTINE.
      * run main screen
      *{TOTEM}RUN-MAINSCR
           PERFORM Form1-OPEN-ROUTINE.
      *{TOTEM}END

      *{TOTEM}COPY-PROCEDURE
       EXIT-STOP-ROUTINE.
           PERFORM CLOSE-FILE-RTN
      * <TOTEM:EPT. INIT:appuntamenti, INIT:appuntamenti, BeforeDestroyResource>
      * <TOTEM:END>
           DESTROY Courier-New8-Occidentale
           DESTROY Courier-New10-Occidentale
           DESTROY Calibri14-Occidentale
           DESTROY Calibri16B-Occidentale
           DESTROY Calibri24B-Occidentale
           CALL "w$bitmap" USING WBITMAP-DESTROY, LOGO_PICCOLO-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, CALENDAR-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, CERCA-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, FATCLI-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, toEXCEL2-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, stampa2-BMP
      *    After-Program
           PERFORM appuntamenti-Ev-After-Program
           EXIT PROGRAM TOTEM-PgmStatus
           STOP RUN.

       INITIALIZE-ROUTINE.
      *    Before Init
      * initialize program status variable
           Initialize TOTEM-PgmStatus.
      * get system information
           ACCEPT SYSTEM-INFORMATION FROM SYSTEM-INFO.
      * get terminal information
           ACCEPT TERMINAL-ABILITIES FROM TERMINAL-INFO.
      * set font
           PERFORM INIT-FONT.
      * load bitmap
           PERFORM INIT-BMP.
      * load resource
           PERFORM INIT-RES.
      * create pop-up menu
           PERFORM INIT-POPUP.
      * open files
           PERFORM OPEN-FILE-RTN.
      *    After Init
           .
    
       INIT-FONT.
      * Courier-New8-Occidentale
           INITIALIZE WFONT-DATA Courier-New8-Occidentale
           MOVE 8 TO WFONT-SIZE
           MOVE "Courier New" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO FALSE
           SET WFONT-ITALIC TO FALSE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Courier-New8-Occidentale, WFONT-DATA
      * Courier-New10-Occidentale
           INITIALIZE WFONT-DATA Courier-New10-Occidentale
           MOVE 10 TO WFONT-SIZE
           MOVE "Courier New" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO FALSE
           SET WFONT-ITALIC TO FALSE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Courier-New10-Occidentale, WFONT-DATA
      * Calibri14-Occidentale
           INITIALIZE WFONT-DATA Calibri14-Occidentale
           MOVE 14 TO WFONT-SIZE
           MOVE "Calibri" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO FALSE
           SET WFONT-ITALIC TO FALSE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Calibri14-Occidentale, WFONT-DATA
      * Calibri16B-Occidentale
           INITIALIZE WFONT-DATA Calibri16B-Occidentale
           MOVE 16 TO WFONT-SIZE
           MOVE "Calibri" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO TRUE
           SET WFONT-ITALIC TO FALSE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Calibri16B-Occidentale, WFONT-DATA
      * Calibri24B-Occidentale
           INITIALIZE WFONT-DATA Calibri24B-Occidentale
           MOVE 24 TO WFONT-SIZE
           MOVE "Calibri" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO TRUE
           SET WFONT-ITALIC TO FALSE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Calibri24B-Occidentale, WFONT-DATA
           .

       INIT-BMP.
      * Form1-Bt-1
           COPY RESOURCE "C:\DF\StudioPostura\RESOURCE\LOGO_PICCOLO.BMP"
           .
           CALL "w$bitmap" USING WBITMAP-LOAD "LOGO_PICCOLO.BMP", 
                   GIVING LOGO_PICCOLO-BMP.
      * pb-calendario
           COPY RESOURCE "C:\DF\StudioPostura\RESOURCE\CALENDAR.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "CALENDAR.BMP", 
                   GIVING CALENDAR-BMP.
      * pb-cerca-cli
           COPY RESOURCE "C:\DF\StudioPostura\RESOURCE\CERCA.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "CERCA.BMP", 
                   GIVING CERCA-BMP.
      * pb-procedi
           COPY RESOURCE "C:\DF\StudioPostura\RESOURCE\FATCLI.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "FATCLI.BMP", 
                   GIVING FATCLI-BMP.
      * pb-excel-c
           COPY RESOURCE "C:\DF\StudioPostura\RESOURCE\toEXCEL2.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "toEXCEL2.BMP", 
                   GIVING toEXCEL2-BMP.
      * pb-stampa
           COPY RESOURCE "C:\DF\StudioPostura\RESOURCE\stampa2.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "stampa2.BMP", 
                   GIVING stampa2-BMP.
           .

       INIT-RES.
           .

       INIT-POPUP.
           .

       OPEN-FILE-RTN.
      *    Before Open
           PERFORM OPEN-appuntamenti
           PERFORM OPEN-clienti
      *    lineseq OPEN MODE IS FALSE
      *    PERFORM OPEN-lineseq
      *    After Open
           .

       OPEN-appuntamenti.
      * <TOTEM:EPT. INIT:appuntamenti, FD:appuntamenti, BeforeOpen>
      * <TOTEM:END>
           OPEN  I-O appuntamenti
           IF STATUS-appuntamenti = "35"
              OPEN OUTPUT appuntamenti
                IF Valid-STATUS-appuntamenti
                   CLOSE appuntamenti
                   OPEN I-O appuntamenti
                END-IF
           END-IF
           IF NOT Valid-STATUS-appuntamenti
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:appuntamenti, FD:appuntamenti, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-clienti.
      * <TOTEM:EPT. INIT:appuntamenti, FD:clienti, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT clienti
           IF NOT Valid-STATUS-clienti
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:appuntamenti, FD:clienti, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-lineseq.
      * <TOTEM:EPT. INIT:appuntamenti, FD:lineseq, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT lineseq
           IF NOT Valid-STATUS-lineseq
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:appuntamenti, FD:lineseq, AfterOpen>
      * <TOTEM:END>
           .

       CLOSE-FILE-RTN.
      *    Before Close
           PERFORM CLOSE-appuntamenti
           PERFORM CLOSE-clienti
      *    lineseq CLOSE MODE IS FALSE
      *    PERFORM CLOSE-lineseq
      *    After Close
           .

       CLOSE-appuntamenti.
      * <TOTEM:EPT. INIT:appuntamenti, FD:appuntamenti, BeforeClose>
      * <TOTEM:END>
           CLOSE appuntamenti
           .

       CLOSE-clienti.
      * <TOTEM:EPT. INIT:appuntamenti, FD:clienti, BeforeClose>
      * <TOTEM:END>
           CLOSE clienti
           .

       CLOSE-lineseq.
      * <TOTEM:EPT. INIT:appuntamenti, FD:lineseq, BeforeClose>
      * <TOTEM:END>
           .

       appuntamenti-k-clidata-MERGE-SPLITBUF.
           INITIALIZE appuntamenti-k-clidata-SPLITBUF
           MOVE app-cliente(1:6) TO appuntamenti-k-clidata-SPLITBUF(1:6)
           MOVE app-data(1:8) TO appuntamenti-k-clidata-SPLITBUF(7:8)
           MOVE app-ora(1:4) TO appuntamenti-k-clidata-SPLITBUF(15:4)
           MOVE app-stato(1:1) TO appuntamenti-k-clidata-SPLITBUF(19:1)
           .

       appuntamenti-k-statocli-MERGE-SPLITBUF.
           INITIALIZE appuntamenti-k-statocli-SPLITBUF
           MOVE app-stato(1:1) TO appuntamenti-k-statocli-SPLITBUF(1:1)
           MOVE app-cliente(1:6) TO 
           appuntamenti-k-statocli-SPLITBUF(2:6)
           MOVE app-data(1:8) TO appuntamenti-k-statocli-SPLITBUF(8:8)
           MOVE app-ora(1:4) TO appuntamenti-k-statocli-SPLITBUF(16:4)
           .

       appuntamenti-k-ricerca-MERGE-SPLITBUF.
           INITIALIZE appuntamenti-k-ricerca-SPLITBUF
           MOVE app-cliente(1:6) TO appuntamenti-k-ricerca-SPLITBUF(1:6)
           MOVE app-data(1:8) TO appuntamenti-k-ricerca-SPLITBUF(7:8)
           MOVE app-ora(1:4) TO appuntamenti-k-ricerca-SPLITBUF(15:4)
           MOVE app-stato(1:1) TO appuntamenti-k-ricerca-SPLITBUF(19:1)
           MOVE app-pagato(1:1) TO appuntamenti-k-ricerca-SPLITBUF(20:1)
           .

       appuntamenti-k-pagato-MERGE-SPLITBUF.
           INITIALIZE appuntamenti-k-pagato-SPLITBUF
           MOVE app-pagato(1:1) TO appuntamenti-k-pagato-SPLITBUF(1:1)
           MOVE app-cliente(1:6) TO appuntamenti-k-pagato-SPLITBUF(2:6)
           MOVE app-data(1:8) TO appuntamenti-k-pagato-SPLITBUF(8:8)
           MOVE app-ora(1:4) TO appuntamenti-k-pagato-SPLITBUF(16:4)
           .

       appuntamenti-k-recupero-MERGE-SPLITBUF.
           INITIALIZE appuntamenti-k-recupero-SPLITBUF
           MOVE app-recup(1:14) TO 
           appuntamenti-k-recupero-SPLITBUF(1:14)
           MOVE app-cliente(1:6) TO 
           appuntamenti-k-recupero-SPLITBUF(15:6)
           MOVE app-data(1:8) TO appuntamenti-k-recupero-SPLITBUF(21:8)
           MOVE app-ora(1:4) TO appuntamenti-k-recupero-SPLITBUF(29:4)
           .

       appuntamenti-k-statodata-MERGE-SPLITBUF.
           INITIALIZE appuntamenti-k-statodata-SPLITBUF
           MOVE app-stato(1:1) TO appuntamenti-k-statodata-SPLITBUF(1:1)
           MOVE app-data(1:8) TO appuntamenti-k-statodata-SPLITBUF(2:8)
           MOVE app-cliente(1:6) TO 
           appuntamenti-k-statodata-SPLITBUF(10:6)
           MOVE app-ora(1:4) TO appuntamenti-k-statodata-SPLITBUF(16:4)
           .

       DataSet1-appuntamenti-INITSTART.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-appuntamenti-KEY1-Asc
                 MOVE Low-Value TO app-chiave
              ELSE
                 MOVE High-Value TO app-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-appuntamenti-INITEND.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-appuntamenti-KEY1-Asc
                 MOVE High-Value TO app-chiave
              ELSE
                 MOVE Low-Value TO app-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-CHANGETO-KEY1.
           MOVE 1 TO DataSet1-KEYIS
           .   

       DataSet1-Change-CurrentKey-Asc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "A" TO DataSet1-appuntamenti-KEY1-ORDER
           END-EVALUATE
           .

       DataSet1-Change-CurrentKey-Desc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "D" TO DataSet1-appuntamenti-KEY1-ORDER
           END-EVALUATE
           .

      * appuntamenti
       DataSet1-appuntamenti-START.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-appuntamenti-KEY1-Asc
                 START appuntamenti KEY >= app-chiave
              ELSE
                 START appuntamenti KEY <= app-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-appuntamenti-START-NOTGREATER.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-appuntamenti-KEY1-Asc
                 START appuntamenti KEY <= app-chiave
              ELSE
                 START appuntamenti KEY >= app-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-appuntamenti-START-GREATER.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-appuntamenti-KEY1-Asc
                 START appuntamenti KEY > app-chiave
              ELSE
                 START appuntamenti KEY < app-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-appuntamenti-START-LESS.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-appuntamenti-KEY1-Asc
                 START appuntamenti KEY < app-chiave
              ELSE
                 START appuntamenti KEY > app-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-appuntamenti-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:appuntamenti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:appuntamenti, BeforeReadRecord>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-appuntamenti-LOCK
                 READ appuntamenti WITH LOCK 
                 KEY app-chiave
              ELSE
                 READ appuntamenti WITH NO LOCK 
                 KEY app-chiave
              END-IF
           END-EVALUATE
           PERFORM appuntamenti-k-clidata-MERGE-SPLITBUF
           PERFORM appuntamenti-k-statocli-MERGE-SPLITBUF
           PERFORM appuntamenti-k-ricerca-MERGE-SPLITBUF
           PERFORM appuntamenti-k-pagato-MERGE-SPLITBUF
           PERFORM appuntamenti-k-recupero-MERGE-SPLITBUF
           PERFORM appuntamenti-k-statodata-MERGE-SPLITBUF
           MOVE STATUS-appuntamenti TO TOTEM-ERR-STAT 
           MOVE "appuntamenti" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:appuntamenti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:appuntamenti, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-appuntamenti-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:appuntamenti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:appuntamenti, BeforeReadNext>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-appuntamenti-KEY1-Asc
                 IF DataSet1-appuntamenti-LOCK
                    READ appuntamenti NEXT WITH LOCK
                 ELSE
                    READ appuntamenti NEXT WITH NO LOCK
                 END-IF
              ELSE
                 IF DataSet1-appuntamenti-LOCK
                    READ appuntamenti PREVIOUS WITH LOCK
                 ELSE
                    READ appuntamenti PREVIOUS WITH NO LOCK
                 END-IF
              END-IF
           END-EVALUATE
           PERFORM appuntamenti-k-clidata-MERGE-SPLITBUF
           PERFORM appuntamenti-k-statocli-MERGE-SPLITBUF
           PERFORM appuntamenti-k-ricerca-MERGE-SPLITBUF
           PERFORM appuntamenti-k-pagato-MERGE-SPLITBUF
           PERFORM appuntamenti-k-recupero-MERGE-SPLITBUF
           PERFORM appuntamenti-k-statodata-MERGE-SPLITBUF
           MOVE STATUS-appuntamenti TO TOTEM-ERR-STAT
           MOVE "appuntamenti" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:appuntamenti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:appuntamenti, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-appuntamenti-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:appuntamenti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:appuntamenti, BeforeReadPrev>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-appuntamenti-KEY1-Asc
                 IF DataSet1-appuntamenti-LOCK
                    READ appuntamenti PREVIOUS WITH LOCK
                 ELSE
                    READ appuntamenti PREVIOUS WITH NO LOCK
                 END-IF
              ELSE
                 IF DataSet1-appuntamenti-LOCK
                    READ appuntamenti NEXT WITH LOCK
                 ELSE
                    READ appuntamenti NEXT WITH NO LOCK
                 END-IF
              END-IF
           END-EVALUATE
           PERFORM appuntamenti-k-clidata-MERGE-SPLITBUF
           PERFORM appuntamenti-k-statocli-MERGE-SPLITBUF
           PERFORM appuntamenti-k-ricerca-MERGE-SPLITBUF
           PERFORM appuntamenti-k-pagato-MERGE-SPLITBUF
           PERFORM appuntamenti-k-recupero-MERGE-SPLITBUF
           PERFORM appuntamenti-k-statodata-MERGE-SPLITBUF
           MOVE STATUS-appuntamenti TO TOTEM-ERR-STAT
           MOVE "appuntamenti" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:appuntamenti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:appuntamenti, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-appuntamenti-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:appuntamenti, BeforeWrite>
      * <TOTEM:END>
           WRITE app-rec OF appuntamenti.
           MOVE STATUS-appuntamenti TO TOTEM-ERR-STAT
           MOVE "appuntamenti" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:appuntamenti, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-appuntamenti-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:appuntamenti, BeforeRewrite>
      * <TOTEM:END>
           REWRITE app-rec OF appuntamenti.
           MOVE STATUS-appuntamenti TO TOTEM-ERR-STAT
           MOVE "appuntamenti" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:appuntamenti, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-appuntamenti-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:appuntamenti, BeforeDelete>
      * <TOTEM:END>
           DELETE appuntamenti.
           MOVE STATUS-appuntamenti TO TOTEM-ERR-STAT
           MOVE "appuntamenti" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:appuntamenti, AfterDelete>
      * <TOTEM:END>
           .

       clienti-cli-k-ragsoc-MERGE-SPLITBUF.
           INITIALIZE clienti-cli-k-ragsoc-SPLITBUF
           MOVE cli-ragsoc(1:50) TO clienti-cli-k-ragsoc-SPLITBUF(1:50)
           MOVE cli-chiave(1:6) TO clienti-cli-k-ragsoc-SPLITBUF(51:6)
           .

       DataSet1-clienti-INITSTART.
           IF DataSet1-clienti-KEY-Asc
              MOVE Low-Value TO cli-chiave
           ELSE
              MOVE High-Value TO cli-chiave
           END-IF
           .

       DataSet1-clienti-INITEND.
           IF DataSet1-clienti-KEY-Asc
              MOVE High-Value TO cli-chiave
           ELSE
              MOVE Low-Value TO cli-chiave
           END-IF
           .

      * clienti
       DataSet1-clienti-START.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY >= cli-chiave
           ELSE
              START clienti KEY <= cli-chiave
           END-IF
           .

       DataSet1-clienti-START-NOTGREATER.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY <= cli-chiave
           ELSE
              START clienti KEY >= cli-chiave
           END-IF
           .

       DataSet1-clienti-START-GREATER.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY > cli-chiave
           ELSE
              START clienti KEY < cli-chiave
           END-IF
           .

       DataSet1-clienti-START-LESS.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY < cli-chiave
           ELSE
              START clienti KEY > cli-chiave
           END-IF
           .

       DataSet1-clienti-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-clienti-LOCK
              READ clienti WITH LOCK 
              KEY cli-chiave
           ELSE
              READ clienti WITH NO LOCK 
              KEY cli-chiave
           END-IF
           PERFORM clienti-cli-k-ragsoc-MERGE-SPLITBUF
           MOVE STATUS-clienti TO TOTEM-ERR-STAT 
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-clienti-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-clienti-KEY-Asc
              IF DataSet1-clienti-LOCK
                 READ clienti NEXT WITH LOCK
              ELSE
                 READ clienti NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-clienti-LOCK
                 READ clienti PREVIOUS WITH LOCK
              ELSE
                 READ clienti PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM clienti-cli-k-ragsoc-MERGE-SPLITBUF
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-clienti-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-clienti-KEY-Asc
              IF DataSet1-clienti-LOCK
                 READ clienti PREVIOUS WITH LOCK
              ELSE
                 READ clienti PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-clienti-LOCK
                 READ clienti NEXT WITH LOCK
              ELSE
                 READ clienti NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM clienti-cli-k-ragsoc-MERGE-SPLITBUF
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-clienti-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-clienti-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-clienti-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-lineseq-INITSTART.
           .

       DataSet1-lineseq-INITEND.
           .

       DataSet1-lineseq-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-lineseq-LOCK
              READ lineseq WITH LOCK 
           ELSE
              READ lineseq WITH NO LOCK 
           END-IF
           MOVE STATUS-lineseq TO TOTEM-ERR-STAT 
           MOVE "lineseq" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-lineseq-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-lineseq-KEY-Asc
              IF DataSet1-lineseq-LOCK
                 READ lineseq NEXT WITH LOCK
              ELSE
                 READ lineseq NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-lineseq TO TOTEM-ERR-STAT
           MOVE "lineseq" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-lineseq-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, BeforeReadPrev>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-lineseq-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-lineseq TO TOTEM-ERR-STAT
           MOVE "lineseq" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-lineseq-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-lineseq TO TOTEM-ERR-STAT
           MOVE "lineseq" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-lineseq-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-lineseq TO TOTEM-ERR-STAT
           MOVE "lineseq" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-INIT-RECORD.
           INITIALIZE app-rec OF appuntamenti
           INITIALIZE cli-rec OF clienti
           INITIALIZE line-riga OF lineseq
           .


      * GRID
       gd-app-Content.
      * CELLS' SETTING
              MODIFY gd-app, X = 1, Y = 1,
                CELL-DATA = "ORA",
      * CELLS' SETTING
              MODIFY gd-app, X = 6, Y = 1,
                CELL-DATA = "ORA",
      * CELLS' SETTING
              MODIFY gd-app, X = 11, Y = 1,
                CELL-DATA = "ORA",
      * CELLS' SETTING
              MODIFY gd-app, X = 16, Y = 1,
                CELL-DATA = "ORA",
      * CELLS' SETTING
              MODIFY gd-app, X = 21, Y = 1,
                CELL-DATA = "ORA",
      * CELLS' SETTING
              MODIFY gd-app, X = 26, Y = 1,
                CELL-DATA = "ORA",
      * CELLS' SETTING
              MODIFY gd-app, X = 2, Y = 2,
                CELL-DATA = "S",
      * CELLS' SETTING
              MODIFY gd-app, X = 3, Y = 2,
                CELL-DATA = "P",
      * CELLS' SETTING
              MODIFY gd-app, X = 4, Y = 2,
                CELL-DATA = "NOMINATIVO",
      * CELLS' SETTING
              MODIFY gd-app, X = 5, Y = 2,
                CELL-DATA = "RECUPERO",
      * CELLS' SETTING
              MODIFY gd-app, X = 7, Y = 2,
                CELL-DATA = "S",
      * CELLS' SETTING
              MODIFY gd-app, X = 8, Y = 2,
                CELL-DATA = "P",
      * CELLS' SETTING
              MODIFY gd-app, X = 9, Y = 2,
                CELL-DATA = "NOMINATIVO",
      * CELLS' SETTING
              MODIFY gd-app, X = 10, Y = 2,
                CELL-DATA = "RECUPERO",
      * CELLS' SETTING
              MODIFY gd-app, X = 12, Y = 2,
                CELL-DATA = "S",
      * CELLS' SETTING
              MODIFY gd-app, X = 13, Y = 2,
                CELL-DATA = "P",
      * CELLS' SETTING
              MODIFY gd-app, X = 14, Y = 2,
                CELL-DATA = "NOMINATIVO",
      * CELLS' SETTING
              MODIFY gd-app, X = 15, Y = 2,
                CELL-DATA = "RECUPERO",
      * CELLS' SETTING
              MODIFY gd-app, X = 17, Y = 2,
                CELL-DATA = "S",
      * CELLS' SETTING
              MODIFY gd-app, X = 18, Y = 2,
                CELL-DATA = "P",
      * CELLS' SETTING
              MODIFY gd-app, X = 19, Y = 2,
                CELL-DATA = "NOMINATIVO",
      * CELLS' SETTING
              MODIFY gd-app, X = 20, Y = 2,
                CELL-DATA = "RECUPERO",
      * CELLS' SETTING
              MODIFY gd-app, X = 22, Y = 2,
                CELL-DATA = "S",
      * CELLS' SETTING
              MODIFY gd-app, X = 23, Y = 2,
                CELL-DATA = "P",
      * CELLS' SETTING
              MODIFY gd-app, X = 24, Y = 2,
                CELL-DATA = "NOMINATIVO",
      * CELLS' SETTING
              MODIFY gd-app, X = 25, Y = 2,
                CELL-DATA = "RECUPERO",
      * CELLS' SETTING
              MODIFY gd-app, X = 27, Y = 2,
                CELL-DATA = "S",
      * CELLS' SETTING
              MODIFY gd-app, X = 28, Y = 2,
                CELL-DATA = "P",
      * CELLS' SETTING
              MODIFY gd-app, X = 29, Y = 2,
                CELL-DATA = "NOMINATIVO",
      * CELLS' SETTING
              MODIFY gd-app, X = 30, Y = 2,
                CELL-DATA = "RECUPERO",
      * COLUMNS' SETTING
              MODIFY gd-app, X = 1  
                COLUMN-COLOR = 256,
      * COLUMNS' SETTING
              MODIFY gd-app, X = 2  
                COLUMN-COLOR = 257,
      * COLUMNS' SETTING
              MODIFY gd-app, X = 3  
                COLUMN-COLOR = 257,
      * COLUMNS' SETTING
              MODIFY gd-app, X = 4  
                COLUMN-COLOR = 257,
      * COLUMNS' SETTING
              MODIFY gd-app, X = 5  
                COLUMN-COLOR = 257,
      * COLUMNS' SETTING
              MODIFY gd-app, X = 11  
                COLUMN-COLOR = 257,
      * COLUMNS' SETTING
              MODIFY gd-app, X = 12  
                COLUMN-COLOR = 257,
      * COLUMNS' SETTING
              MODIFY gd-app, X = 13  
                COLUMN-COLOR = 257,
      * COLUMNS' SETTING
              MODIFY gd-app, X = 14  
                COLUMN-COLOR = 257,
      * COLUMNS' SETTING
              MODIFY gd-app, X = 15  
                COLUMN-COLOR = 257,
      * COLUMNS' SETTING
              MODIFY gd-app, X = 21  
                COLUMN-COLOR = 257,
      * COLUMNS' SETTING
              MODIFY gd-app, X = 22  
                COLUMN-COLOR = 257,
      * COLUMNS' SETTING
              MODIFY gd-app, X = 23  
                COLUMN-COLOR = 257,
      * COLUMNS' SETTING
              MODIFY gd-app, X = 24  
                COLUMN-COLOR = 257,
      * COLUMNS' SETTING
              MODIFY gd-app, X = 25  
                COLUMN-COLOR = 257,
           .

      * COMBO-BOX
       cbo-stato-Content.
              MODIFY cbo-stato, RESET-LIST = 1
              MODIFY cbo-stato, 
                  ITEM-TO-ADD = (
                    "Nessuno",
                    "Presente",
                    "Assente",
                    "Inizio",
                    "Test",
                    "Terapia",
                    )
           .

      * COMBO-BOX
       cbo-pagato-Content.
              MODIFY cbo-pagato, RESET-LIST = 1
              MODIFY cbo-pagato, 
                  ITEM-TO-ADD = (
                    "Nessuno",
                    "Pagato",
                    "Fattura",
                    )
           .

      * GRID
       gd-cerca-Content.
      * CELLS' SETTING
              MODIFY gd-cerca, X = 1, Y = 1,
                CELL-DATA = "Data",
      * CELLS' SETTING
              MODIFY gd-cerca, X = 2, Y = 1,
                CELL-DATA = "Ora",
      * CELLS' SETTING
              MODIFY gd-cerca, X = 3, Y = 1,
                CELL-DATA = "Stato",
      * CELLS' SETTING
              MODIFY gd-cerca, X = 4, Y = 1,
                CELL-DATA = "Recupero",
      * CELLS' SETTING
              MODIFY gd-cerca, X = 5, Y = 1,
                CELL-DATA = "Pagato",
           .

      * GRID
       gd-test-Content.
      * CELLS' SETTING
              MODIFY gd-test, X = 1, Y = 1,
                CELL-DATA = "Data",
      * CELLS' SETTING
              MODIFY gd-test, X = 2, Y = 1,
                CELL-DATA = "Ora",
      * CELLS' SETTING
              MODIFY gd-test, X = 3, Y = 1,
                CELL-DATA = "Cliente",
           .

      * GRID
       gd-verifica-Content.
      * CELLS' SETTING
              MODIFY gd-verifica, X = 1, Y = 1,
                CELL-DATA = "Cliente",
      * CELLS' SETTING
              MODIFY gd-verifica, X = 2, Y = 1,
                CELL-DATA = "Presenze",
      * CELLS' SETTING
              MODIFY gd-verifica, X = 3, Y = 1,
                CELL-DATA = "Ultima",
           .

      * FD's Initialize Paragraph
       DataSet1-appuntamenti-INITREC.
           INITIALIZE app-rec OF appuntamenti
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-clienti-INITREC.
           INITIALIZE cli-rec OF clienti
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-lineseq-INITREC.
           INITIALIZE line-riga OF lineseq
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      *
       DataSet1-DISPATCH-BUFTOFLD.
           EVALUATE TOTEM-Form-Index ALSO TOTEM-Frame-Index
              WHEN 1 ALSO 0
                  PERFORM Form1-Buf-To-Fld
           END-EVALUATE
           .

       Form1-DISPLAY-STATUS-MSG.
            MODIFY Form1-St-1-Handle PANEL-INDEX = 1
                PANEL-TEXT = TOTEM-HINT-TEXT
           .

       Form1-CLEAR-STATUS-MSG.
           MOVE SPACES TO TOTEM-MSG-1, TOTEM-MSG-2, TOTEM-MSG-3, 
           TOTEM-MSG-TEXT
           PERFORM Form1-DISPLAY-STATUS-MSG
           .

       Form1-Open-Routine.
           PERFORM Form1-Scrn
           PERFORM Form1-Proc
           .

       Form1-Scrn.
           PERFORM Form1-Create-Win
           PERFORM Form1-Init-Value
           PERFORM Form1-Init-Data
      * Tab keystrok settings
      * Tool Bar
           PERFORM Form1-DISPLAY
           .

       Form1-Create-Win.
           Display Independent GRAPHICAL WINDOW
              SCREEN LINE 2,
              SCREEN COLUMN 2,
              LINES 39,83,
              SIZE 166,70,
              CELL HEIGHT 23,
              CELL WIDTH 10,
              COLOR 131329,
              CONTROL FONT Calibri14-Occidentale,
              LINK TO THREAD,
              NO SCROLL,
              TITLE-BAR,
              TITLE titolo,
              AUTO-MINIMIZE,
              WITH SYSTEM MENU,
              USER-WHITE,
              No WRAP,
              EVENT PROCEDURE Form1-Event-Proc,
              HANDLE IS Form1-Handle,
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterCreateWin>
      * <TOTEM:END>


      * Tool Bar    
      * Status-bar
           DISPLAY STATUS-BAR
              GRIP,
              PANEL-WIDTHS (40, 25, 999),
              PANEL-STYLE  (1, 1, 1),
              PANEL-TEXT   (SPACE, SPACE, SPACE),
              HANDLE IS Form1-St-1-Handle
           DISPLAY Form1 UPON Form1-Handle
      * DISPLAY-COLUMNS settings
              MODIFY gd-app, DISPLAY-COLUMNS (1, 7, 10, 13, 38, 63, 69, 
           72, 75, 100, 125, 131, 134, 137, 162, 187, 193, 196, 199, 
           224, 249, 255, 258, 261, 286, 311, 317, 320, 323, 348)
           .

       Form1-PROC.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeAccept>
           accept como-data from century-date.
           move como-data to start-data.
           perform AGGIORNA-APPUNTAMENTI.

           move 78-ID-gd-app to control-id.
           move 4 to accept-control.

           move 3 to event-data-2.
           move 1 to event-data-1.

           modify gd-app, cursor-y 3, cursor-x 1.
           perform SPOSTAMENTO.

           .
      * <TOTEM:END>
           PERFORM UNTIL Exit-Pushed
              ACCEPT Form1
                 ON EXCEPTION
                    PERFORM Form1-Evaluate-Func
                 MOVE 1 TO TOTEM-Form-Index
              END-ACCEPT
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterEndAccept>
           if ModificaAppuntamento
              set ModificaAppuntamento to false
              evaluate event-data-1
              when  1 thru 5
                   move 1 to colonna                   
                   inquire gd-app(event-data-2, 1), 
                           hidden-data app-chiave
              when  6 thru 10       
                   move 2 to colonna                                    
             
                   inquire gd-app(event-data-2, 6), 
                           hidden-data app-chiave
              when 11 thru 15                                           
             
                   move 3 to colonna
                   inquire gd-app(event-data-2, 11), 
                           hidden-data app-chiave
              when 16 thru 20                                           
             
                   move 4 to colonna
                   inquire gd-app(event-data-2, 16), 
                           hidden-data app-chiave
              when 21 thru 25                                           
             
                   move 5 to colonna
                   inquire gd-app(event-data-2, 21), 
                           hidden-data app-chiave
              when 26 thru 30                                           
             
                   move 6 to colonna
                   inquire gd-app(event-data-2, 26), 
                           hidden-data app-chiave
              end-evaluate                 
              if app-cliente not = spaces
                 move app-chiave to sav-chiave
                 read appuntamenti no lock
                 move 0 to sw-agisci
                 if app-recup-data not = 0 and app-assente
                    move 1 to sw-agisci
                    display message "Impossibile modificare un assenza r
      -    "ecuperata"
                             x"0d0a""Cancellare prima il recupero."
                              title titolo
                 end-if
                 if sw-agisci = 0
                    perform SCR-SINGOLO-OPEN-ROUTINE
                    if AggiornaAppuntamenti
                       move col-data(1) to como-data
                       perform DATE-TO-FILE
                       move como-data   to start-data
                       perform AGGIORNA-APPUNTAMENTI
                    end-if
                 end-if
              else
                 perform PB-AGGIUNGI-A-LINKTO
              end-if
           end-if

      * <TOTEM:END>
           END-PERFORM
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDestroyWindow>
      * <TOTEM:END>
           DESTROY Form1-Handle
           INITIALIZE Key-Status
           .

       Form1-Evaluate-Func.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterAccept>
      * <TOTEM:END>
           EVALUATE TRUE
              WHEN Exit-Pushed
                 PERFORM Form1-Exit
              WHEN Event-Occurred
                 IF Event-Type = Cmd-Close
                    PERFORM Form1-Exit
                 END-IF
              WHEN Key-Status = 1000
                 PERFORM pb-settimana-prev-LinkTo
              WHEN Key-Status = 1001
                 PERFORM pb-settimana-next-LinkTo
              WHEN Key-Status = 1002
                 PERFORM pb-giorno-prev-LinkTo
              WHEN Key-Status = 1003
                 PERFORM pb-giorno-next-LinkTo
              WHEN Key-Status = 1004
                 PERFORM pb-su-LinkTo
              WHEN Key-Status = 1005
                 PERFORM pb-giu-LinkTo
              WHEN Key-Status = 1006
                 PERFORM pb-aggiungi-a-LinkTo
              WHEN Key-Status = 1007
                 PERFORM pb-aggiungi-r-LinkTo
              WHEN Key-Status = 1008
                 PERFORM pb-cancella-LinkTo
              WHEN Key-Status = 1009
                 PERFORM pb-cancella-r-LinkTo
              WHEN Key-Status = 1010
                 PERFORM pb-recupero-LinkTo
              WHEN Key-Status = 1011
                 PERFORM pb-cerca-LinkTo
              WHEN Key-Status = 1012
                 PERFORM pb-cal-LinkTo
              WHEN Key-Status = 1013
                 PERFORM pb-test-LinkTo
              WHEN Key-Status = 27
                 PERFORM pb-cal-LinkTo
           END-EVALUATE
      * avoid changing focus
           MOVE 4 TO Accept-Control
           .

       Form1-CLEAR.
           PERFORM Form1-INIT-VALUE
           PERFORM Form1-DISPLAY
           .

       Form1-DISPLAY.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDisplay>
      * <TOTEM:END>
           DISPLAY Form1 UPON Form1-Handle
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterDisplay>




           SET LK-BL-SCRITTURA     TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           MOVE FORM1-HANDLE       TO LK-HND-WIN.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           CANCEL "BLOCKPGM".

           .
      * <TOTEM:END>
           .

       Form1-Exit.
      * for main screen
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeExit>
      * <TOTEM:END>
           MOVE 27 TO Key-Status
           .

       Form1-Init-Data.
           MOVE 1 TO TOTEM-Form-Index
           MOVE 0 TO TOTEM-Frame-Index
      * GRID
           PERFORM gd-app-Content
           .

       Form1-DataSet1-CHANGETO-KEY1.
           MOVE 1 TO DataSet1-KEYIS
           PERFORM Form1-DataSet1-Update-Key
           .

       Form1-DataSet1-Change-CurrentKey-Asc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "A" TO DataSet1-appuntamenti-KEY1-ORDER
           END-EVALUATE
           PERFORM Form1-DataSet1-Update-Key
           .

       Form1-DataSet1-Change-CurrentKey-Desc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "D" TO DataSet1-appuntamenti-KEY1-ORDER
           END-EVALUATE
           PERFORM Form1-DataSet1-Update-Key
           .

       Form1-DataSet1-Update-Key.
           MOVE app-rec OF appuntamenti TO
                     Form1-MULKEY-TMPBUF
           PERFORM Form1-CLEAR
           PERFORM Form1-INIT-DATA
           MOVE Form1-MULKEY-TMPBUF TO
                     app-rec OF appuntamenti
           PERFORM DataSet1-appuntamenti-Read
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-CURR
           PERFORM Form1-IUD-Display
           .

       Form1-DUPLICATE-MOVEKEY.
           .

       Form1-First.
           PERFORM Form1-DUMMY-FIRST
           PERFORM DataSet1-appuntamenti-INITSTART
           PERFORM DataSet1-appuntamenti-START
           IF NOT Valid-STATUS-appuntamenti
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeFirst>
      * <TOTEM:END>
           PERFORM DataSet1-appuntamenti-Read-Next
           IF NOT Valid-STATUS-appuntamenti
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterFirst>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY.
           PERFORM Form1-IUD-Display
           .

       Form1-Previous.
              PERFORM Form1-Buf-To-Fld
              PERFORM DataSet1-appuntamenti-START-LESS
           IF NOT Valid-STATUS-appuntamenti
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforePrevious>
      * <TOTEM:END>
           PERFORM DataSet1-appuntamenti-Read-Prev
           IF NOT Valid-STATUS-appuntamenti
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterPrevious>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-PREVIOUS
           PERFORM Form1-IUD-Display
           .

       Form1-Next.
              PERFORM Form1-Buf-To-Fld
              PERFORM DataSet1-appuntamenti-START-GREATER
           IF NOT Valid-STATUS-appuntamenti
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeNext>
      * <TOTEM:END>
           PERFORM DataSet1-appuntamenti-Read-Next
           IF NOT Valid-STATUS-appuntamenti
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterNext>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-NEXT
           PERFORM Form1-IUD-Display
           .
      
       Form1-Last.
           PERFORM Form1-DUMMY-LAST
           PERFORM DataSet1-appuntamenti-INITEND
           PERFORM DataSet1-appuntamenti-START-NOTGREATER
           IF NOT Valid-STATUS-appuntamenti
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeLast>
      * <TOTEM:END>
           PERFORM DataSet1-appuntamenti-Read-Prev
           IF NOT Valid-STATUS-appuntamenti
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterLast>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY.
           PERFORM Form1-IUD-Display
           .

       Form1-Curr.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeCurrent>
      * <TOTEM:END>
           PERFORM Form1-Buf-To-Fld
           PERFORM DataSet1-appuntamenti-Read
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-CURR
           PERFORM Form1-IUD-Display
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterCurrent>
      * <TOTEM:END>
           .

       Form1-IUD-Display.
           IF Valid-STATUS-appuntamenti
              PERFORM Form1-ALLGRID-RESET
              PERFORM Form1-Fld-To-Buf
              PERFORM Form1-NAVI-FOR-MASTERGRID
              PERFORM Form1-DISPLAY
           ELSE
              IF Form1-FLAG-REFRESH
                 CONTINUE
              ELSE
                 PERFORM Form1-Extended-File-Status
              END-IF
           END-IF
           .

       Form1-Add.
           PERFORM Form1-Buf-To-Fld
           PERFORM Form1-VALIDATION-ROUTINE
           IF NOT TOTEM-CHECK-OK
               EXIT PARAGRAPH
           END-IF
           PERFORM Form1-DUMMY-ADD
           PERFORM DataSet1-appuntamenti-INITREC
           PERFORM Form1-Buf-To-Fld
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeAdd>
      * <TOTEM:END>
      * write
           PERFORM DataSet1-appuntamenti-Rec-Write
           IF Valid-STATUS-appuntamenti
              PERFORM Form1-RESUMMARY-INS
              PERFORM Form1-DUMMY-UPDATE-INIT
              MOVE "301" TO TOTEM-MSG-ID
              PERFORM Form1-IUD-Display
           END-IF
           PERFORM Form1-ERR-CHECKING
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterAdd>
      * <TOTEM:END>
           .
     
       Form1-Update.
           PERFORM Form1-Buf-To-Fld
           PERFORM DataSet1-appuntamenti-START              
           IF NOT Valid-STATUS-appuntamenti
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
           PERFORM DataSet1-appuntamenti-Read
           PERFORM Form1-Buf-To-Fld
           PERFORM Form1-VALIDATION-ROUTINE
           IF NOT TOTEM-CHECK-OK
               EXIT PARAGRAPH
           END-IF
           PERFORM Form1-DUMMY-UPDATE
           PERFORM Form1-Buf-To-Fld
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeUpdate>
      * <TOTEM:END>
      * write
           PERFORM DataSet1-appuntamenti-Rec-Rewrite
           IF Valid-STATUS-appuntamenti
              PERFORM Form1-RESUMMARY-DEL
              PERFORM Form1-DUMMY-UPDATE-INIT
              MOVE "302" TO TOTEM-MSG-ID
              PERFORM Form1-IUD-Display
           END-IF
           PERFORM Form1-ERR-CHECKING
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterUpdate>
      * <TOTEM:END>
           .

       Form1-Delete.
           MOVE "203" TO TOTEM-MSG-ID
           PERFORM MESSAGE-BOX-DISPLAY
           IF TOTEM-MSG-RETURN-VALUE NOT = 1
              INITIALIZE TOTEM-MSG-TEXT
              EXIT PARAGRAPH 
           END-IF
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDelete>
      * <TOTEM:END>
           PERFORM Form1-DUMMY-DELETE
      * delete
           PERFORM Form1-Buf-To-Fld
           PERFORM DataSet1-appuntamenti-Rec-Delete
           IF Valid-STATUS-appuntamenti
              PERFORM Form1-CLEAR
              PERFORM Form1-DUMMY-DELETE-INIT
              MOVE "303" TO TOTEM-MSG-ID
              MOVE "00" to STATUS-appuntamenti
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterDelete>
      * <TOTEM:END>
           PERFORM Form1-ERR-CHECKING
           .

       Form1-NAVI-FOR-MASTERGRID.
           .

       Form1-ERR-CHECKING.
           IF Valid-STATUS-appuntamenti
              PERFORM Form1-SHOW-MSG-ROUTINE
           ELSE
              PERFORM Form1-Extended-File-Status
           END-IF
           .

       Form1-RESUMMARY-INS.
           .

       Form1-RESUMMARY-DEL.
           .


       Form1-DUMMY-FIRST.
           .

       Form1-DUMMY-PREVIOUS.
           .

       Form1-DUMMY-NEXT.
           .

       Form1-DUMMY-LAST.
           .

       Form1-DUMMY-CURR.
           .

       Form1-DUMMY-ADD.
           .

       Form1-DUMMY-UPDATE.
           .

       Form1-DUMMY-UPDATE-INIT.
           .

       Form1-DUMMY-DELETE.
           .

       Form1-DUMMY-DELETE-INIT.
           .

       Form1-Init-Value.
           MOVE titolo TO TOTEM-MSG-TITLE
      * FORM : Form1
           PERFORM DataSet1-INIT-RECORD
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, SetDefault>
      * <TOTEM:END>
           PERFORM Form1-FLD-TO-BUF
           .


       Form1-ALLGRID-RESET.
           .

      * for Form's Validation
       Form1-VALIDATION-ROUTINE.
           SET TOTEM-CHECK-OK TO TRUE
           .


       Form1-Buf-To-Fld.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeBufToFld>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterBufToFld>
      * <TOTEM:END>
           .

       Form1-Fld-To-Buf.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeFldToBuf>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterFldToBuf>
      * <TOTEM:END>
           .

       Form1-CONTROLLO-OLD.
           set SiSalvato to true.
           if mod = 0 exit paragraph end-if.
           perform Form1-BUF-TO-FLD.
           move 0 to scelta.
           .
       Form1-EXTENDED-FILE-STATUS.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
           MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           PERFORM Form1-SHOW-MSG-ROUTINE
           .

       Form1-SHOW-MSG-ROUTINE.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM Form1-DISPLAY-MESSAGE
           .

       Form1-DISPLAY-MESSAGE.
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

       Form1-Save-Status.
           MOVE DataSet1-appuntamenti-KEY1-ORDER TO TMP-Form1-KEY1-ORDER
           MOVE DataSet1-KEYIS TO TMP-Form1-KEYIS
           MOVE app-rec OF appuntamenti TO 
              TMP-Form1-appuntamenti-RESTOREBUF
           .             

       Form1-Restore-Status.
           MOVE TMP-Form1-KEY1-ORDER TO DataSet1-appuntamenti-KEY1-ORDER
           MOVE TMP-Form1-KEYIS TO DataSet1-KEYIS
           MOVE TMP-Form1-appuntamenti-RESTOREBUF TO
              app-rec OF appuntamenti
           PERFORM DataSet1-appuntamenti-START
           IF Valid-STATUS-appuntamenti
              PERFORM DataSet1-appuntamenti-Read-Next
           ELSE
              PERFORM DataSet1-appuntamenti-INITREC
           END-IF
           PERFORM UNTIL NOT Valid-STATUS-appuntamenti OR
              (Valid-STATUS-appuntamenti AND
                 app-rec OF appuntamenti = 
                   TMP-Form1-appuntamenti-RESTOREBUF)
              PERFORM DataSet1-appuntamenti-Read-Next
           END-PERFORM
           .

       scr-singolo-Open-Routine.
           PERFORM scr-singolo-Scrn
           PERFORM scr-singolo-Proc
           .

       scr-singolo-Scrn.
           PERFORM scr-singolo-Create-Win
           PERFORM scr-singolo-Init-Value
           PERFORM scr-singolo-Init-Data
      * Tab keystrok settings
      * Tool Bar
           PERFORM scr-singolo-DISPLAY
           .

       scr-singolo-Create-Win.
           Display Floating GRAPHICAL WINDOW
              LINES 11,09,
              SIZE 91,30,
              HEIGHT-IN-CELLS,
              WIDTH-IN-CELLS,
              COLOR 131329,
              CONTROL FONT Calibri14-Occidentale,
              LINK TO THREAD,
              NO SCROLL,
              TITLE-BAR,
              TITLE "Studio - Nuovo appuntamento",
              WITH SYSTEM MENU,
              USER-GRAY,
              USER-WHITE,
              No WRAP,
              EVENT PROCEDURE scr-singolo-Event-Proc,
              HANDLE IS scr-singolo-Handle,
      * <TOTEM:EPT. FORM:scr-singolo, FORM:scr-singolo, AfterCreateWin>
      * <TOTEM:END>


      * Tool Bar    
      * Status-bar
           DISPLAY scr-singolo UPON scr-singolo-Handle
      * DISPLAY-COLUMNS settings
           .

       scr-singolo-PROC.
      * <TOTEM:EPT. FORM:scr-singolo, FORM:scr-singolo, BeforeAccept>
           set AggiornaAppuntamenti to false.
           move 1 to e-cliente.
           if sav-cliente = spaces
              move 0 to v-modifica
              move spaces to lab-cliente-buf
              modify scr-singolo-handle, title = "Studio - Nuovo appunta
      -    "mento"
              if ins-data not = 0
                 move ins-data to como-data
                 perform DATE-TO-SCREEN
                 move como-data to ef-data-buf
              end-if
           else                                                        
              modify scr-singolo-handle, title = "Studio - Modifica appu
      -    "ntamento"
              move 1 to v-modifica
              move sav-chiave to app-chiave
              read appuntamenti no lock invalid continue end-read
              evaluate true
              when app-pagato-si 
                   modify cbo-pagato, value "Pagato"
              when app-pagato-ft
                   modify cbo-pagato, value "Fattura"
              when other
                   modify cbo-pagato, value "Nessuno"
              end-evaluate

              evaluate true   
              when app-inizio 
                   modify cbo-stato, value "Inizio"
              when app-assente 
                   modify cbo-stato, value "Assente"
              when app-terapia
                   modify cbo-stato, value "Terapia" 
              when app-test
                   modify cbo-stato, value "Test"
              when app-presente
                   modify cbo-stato, value "Presente"
              when app-recupero
                   move 0 to e-cliente                     
                   modify cbo-stato, item-to-add "Recupero"
                   modify cbo-stato, value "Recupero"
              when other
                   modify cbo-stato, value "Nessuno"
              end-evaluate     
           
              move sav-data    to como-data
              perform DATE-TO-SCREEN
              move como-data   to ef-data-buf

           end-if.          
           move sav-cliente to cli-codice.
           read clienti no lock
                invalid move spaces to cli-nome cli-cognome
           end-read.
           initialize lab-cliente-buf
           inspect cli-cognome replacing trailing spaces by low-value
           string  cli-cognome delimited low-value
                   " "         delimited size
                   cli-nome    delimited size
              into lab-cliente-buf
           end-string.         
           move sav-ora     to ef-ora-buf.
           move sav-cliente to ef-cliente-buf.

           display scr-singolo.

           move 78-ID-ef-data to control-id.
           move 4 to accept-control.

           .
      * <TOTEM:END>
           PERFORM UNTIL Exit-Pushed
              ACCEPT scr-singolo
                 ON EXCEPTION
                    PERFORM scr-singolo-Evaluate-Func
                 MOVE 2 TO TOTEM-Form-Index
              END-ACCEPT
      * <TOTEM:EPT. FORM:scr-singolo, FORM:scr-singolo, AfterEndAccept>
      * <TOTEM:END>
           END-PERFORM
      * <TOTEM:EPT. FORM:scr-singolo, FORM:scr-singolo, BeforeDestroyWindow>
      * <TOTEM:END>
           DESTROY scr-singolo-Handle
           INITIALIZE Key-Status
           .

       scr-singolo-Evaluate-Func.
      * <TOTEM:EPT. FORM:scr-singolo, FORM:scr-singolo, AfterAccept>
      * <TOTEM:END>
           EVALUATE TRUE
              WHEN Exit-Pushed
                 PERFORM scr-singolo-Exit
              WHEN Event-Occurred
                 IF Event-Type = Cmd-Close
                    PERFORM scr-singolo-Exit
                 END-IF
              WHEN Key-Status = 101
                 PERFORM pb-calendario-LinkTo
              WHEN Key-Status = 102
                 PERFORM pb-cerca-cli-LinkTo
              WHEN Key-Status = 13
                 PERFORM pb-procedi-LinkTo
           END-EVALUATE
      * avoid changing focus
           MOVE 4 TO Accept-Control
           .

       scr-singolo-CLEAR.
           PERFORM scr-singolo-INIT-VALUE
           PERFORM scr-singolo-DISPLAY
           .

       scr-singolo-DISPLAY.
      * <TOTEM:EPT. FORM:scr-singolo, FORM:scr-singolo, BeforeDisplay>
      * <TOTEM:END>
           DISPLAY scr-singolo UPON scr-singolo-Handle
      * <TOTEM:EPT. FORM:scr-singolo, FORM:scr-singolo, AfterDisplay>

           SET LK-BL-SCRITTURA     TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           MOVE FORM1-HANDLE       TO LK-HND-WIN.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           CANCEL "BLOCKPGM".

           .
      * <TOTEM:END>
           .

       scr-singolo-Exit.
      * for main screen
      * <TOTEM:EPT. FORM:scr-singolo, FORM:scr-singolo, BeforeExit>
      * <TOTEM:END>
           MOVE 27 TO Key-Status
           .

       scr-singolo-Init-Data.
           MOVE 2 TO TOTEM-Form-Index
           MOVE 0 TO TOTEM-Frame-Index
      * COMBO-BOX
           PERFORM cbo-stato-Content
      * COMBO-BOX
           PERFORM cbo-pagato-Content
           .

       scr-singolo-Init-Value.
      * <TOTEM:EPT. FORM:scr-singolo, FORM:scr-singolo, SetDefault>
      * <TOTEM:END>
           PERFORM scr-singolo-FLD-TO-BUF
           .


       scr-singolo-ALLGRID-RESET.
           .

      * for Form's Validation
       scr-singolo-VALIDATION-ROUTINE.
           SET TOTEM-CHECK-OK TO TRUE
           .


       scr-singolo-Buf-To-Fld.
      * <TOTEM:EPT. FORM:scr-singolo, FORM:scr-singolo, BeforeBufToFld>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:scr-singolo, FORM:scr-singolo, AfterBufToFld>
      * <TOTEM:END>
           .

       scr-singolo-Fld-To-Buf.
      * <TOTEM:EPT. FORM:scr-singolo, FORM:scr-singolo, BeforeFldToBuf>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:scr-singolo, FORM:scr-singolo, AfterFldToBuf>
      * <TOTEM:END>
           .

       scr-singolo-CONTROLLO-OLD.
           set SiSalvato to true.
           if mod = 0 exit paragraph end-if.
           perform scr-singolo-BUF-TO-FLD.
           move 0 to scelta.
           .
       scr-singolo-EXTENDED-FILE-STATUS.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
           MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           PERFORM scr-singolo-SHOW-MSG-ROUTINE
           .

       scr-singolo-SHOW-MSG-ROUTINE.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM scr-singolo-DISPLAY-MESSAGE
           .

       scr-singolo-DISPLAY-MESSAGE.
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

       scr-singolo-Save-Status.
           .             

       scr-singolo-Restore-Status.
           .

       scr-cancella-r-Open-Routine.
           PERFORM scr-cancella-r-Scrn
           PERFORM scr-cancella-r-Proc
           .

       scr-cancella-r-Scrn.
           PERFORM scr-cancella-r-Create-Win
           PERFORM scr-cancella-r-Init-Value
           PERFORM scr-cancella-r-Init-Data
      * Tab keystrok settings
      * Tool Bar
           PERFORM scr-cancella-r-DISPLAY
           .

       scr-cancella-r-Create-Win.
           Display Floating GRAPHICAL WINDOW
              LINES 12,61,
              SIZE 91,30,
              HEIGHT-IN-CELLS,
              WIDTH-IN-CELLS,
              COLOR 131329,
              CONTROL FONT Calibri14-Occidentale,
              LINK TO THREAD,
              NO SCROLL,
              TITLE-BAR,
              TITLE "Studio - Cancella appuntamenti",
              WITH SYSTEM MENU,
              USER-GRAY,
              USER-WHITE,
              No WRAP,
              EVENT PROCEDURE scr-singolo-Event-Proc,
              HANDLE IS scar-cancella-r-Handle,
      * <TOTEM:EPT. FORM:scr-cancella-r, FORM:scr-cancella-r, AfterCreateWin>
      * <TOTEM:END>


      * Tool Bar    
      * Status-bar
           DISPLAY scr-cancella-r UPON scar-cancella-r-Handle
      * DISPLAY-COLUMNS settings
           .

       scr-cancella-r-PROC.
      * <TOTEM:EPT. FORM:scr-cancella-r, FORM:scr-cancella-r, BeforeAccept>
           move spaces to ef-cliente-cr-buf lab-cliente-cr-buf
           move 0 to ef-dal-cr-buf ef-al-cr-buf 
           move 1 to chk-nessuno-cr-buf
                     chk-presente-cr-buf chk-assente-cr-buf 
           chk-inizio-cr-buf
                     chk-recupero-cr-buf chk-test-cr-buf 
           chk-terapia-cr-buf.
           display scr-cancella-r.  

           move 78-ID-ef-cliente-cr to control-id.
           move 4 to accept-control.

           .
      * <TOTEM:END>
           PERFORM UNTIL Exit-Pushed
              ACCEPT scr-cancella-r
                 ON EXCEPTION
                    PERFORM scr-cancella-r-Evaluate-Func
                 MOVE 3 TO TOTEM-Form-Index
              END-ACCEPT
      * <TOTEM:EPT. FORM:scr-cancella-r, FORM:scr-cancella-r, AfterEndAccept>
      * <TOTEM:END>
           END-PERFORM
      * <TOTEM:EPT. FORM:scr-cancella-r, FORM:scr-cancella-r, BeforeDestroyWindow>
      * <TOTEM:END>
           DESTROY scar-cancella-r-Handle
           INITIALIZE Key-Status
           .

       scr-cancella-r-Evaluate-Func.
      * <TOTEM:EPT. FORM:scr-cancella-r, FORM:scr-cancella-r, AfterAccept>
      * <TOTEM:END>
           EVALUATE TRUE
              WHEN Exit-Pushed
                 PERFORM scr-cancella-r-Exit
              WHEN Event-Occurred
                 IF Event-Type = Cmd-Close
                    PERFORM scr-cancella-r-Exit
                 END-IF
              WHEN Key-Status = 1001
                 PERFORM pb-dal-cr-LinkTo
              WHEN Key-Status = 1000
                 PERFORM pb-cerca-cli-cr-LinkTo
              WHEN Key-Status = 1002
                 PERFORM pb-procedi-cr-LinkTo
              WHEN Key-Status = 1003
                 PERFORM pb-al-cr-LinkTo
           END-EVALUATE
      * avoid changing focus
           MOVE 4 TO Accept-Control
           .

       scr-cancella-r-CLEAR.
           PERFORM scr-cancella-r-INIT-VALUE
           PERFORM scr-cancella-r-DISPLAY
           .

       scr-cancella-r-DISPLAY.
      * <TOTEM:EPT. FORM:scr-cancella-r, FORM:scr-cancella-r, BeforeDisplay>
      * <TOTEM:END>
           DISPLAY scr-cancella-r UPON scar-cancella-r-Handle
      * <TOTEM:EPT. FORM:scr-cancella-r, FORM:scr-cancella-r, AfterDisplay>

           SET LK-BL-SCRITTURA     TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           MOVE FORM1-HANDLE       TO LK-HND-WIN.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           CANCEL "BLOCKPGM".

           .
      * <TOTEM:END>
           .

       scr-cancella-r-Exit.
      * for main screen
      * <TOTEM:EPT. FORM:scr-cancella-r, FORM:scr-cancella-r, BeforeExit>
      * <TOTEM:END>
           MOVE 27 TO Key-Status
           .

       scr-cancella-r-Init-Data.
           MOVE 3 TO TOTEM-Form-Index
           MOVE 0 TO TOTEM-Frame-Index
           .

       scr-cancella-r-Init-Value.
      * <TOTEM:EPT. FORM:scr-cancella-r, FORM:scr-cancella-r, SetDefault>
      * <TOTEM:END>
           PERFORM scr-cancella-r-FLD-TO-BUF
           .


       scr-cancella-r-ALLGRID-RESET.
           .

      * for Form's Validation
       scr-cancella-r-VALIDATION-ROUTINE.
           SET TOTEM-CHECK-OK TO TRUE
           .


       scr-cancella-r-Buf-To-Fld.
      * <TOTEM:EPT. FORM:scr-cancella-r, FORM:scr-cancella-r, BeforeBufToFld>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:scr-cancella-r, FORM:scr-cancella-r, AfterBufToFld>
      * <TOTEM:END>
           .

       scr-cancella-r-Fld-To-Buf.
      * <TOTEM:EPT. FORM:scr-cancella-r, FORM:scr-cancella-r, BeforeFldToBuf>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:scr-cancella-r, FORM:scr-cancella-r, AfterFldToBuf>
      * <TOTEM:END>
           .

       scr-cancella-r-CONTROLLO-OLD.
           set SiSalvato to true.
           if mod = 0 exit paragraph end-if.
           perform scr-cancella-r-BUF-TO-FLD.
           move 0 to scelta.
           .
       scr-cancella-r-EXTENDED-FILE-STATUS.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
           MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           PERFORM scr-cancella-r-SHOW-MSG-ROUTINE
           .

       scr-cancella-r-SHOW-MSG-ROUTINE.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM scr-cancella-r-DISPLAY-MESSAGE
           .

       scr-cancella-r-DISPLAY-MESSAGE.
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

       scr-cancella-r-Save-Status.
           .             

       scr-cancella-r-Restore-Status.
           .

       scr-aggiungi-r-Open-Routine.
           PERFORM scr-aggiungi-r-Scrn
           PERFORM scr-aggiungi-r-Proc
           .

       scr-aggiungi-r-Scrn.
           PERFORM scr-aggiungi-r-Create-Win
           PERFORM scr-aggiungi-r-Init-Value
           PERFORM scr-aggiungi-r-Init-Data
      * Tab keystrok settings
      * Tool Bar
           PERFORM scr-aggiungi-r-DISPLAY
           .

       scr-aggiungi-r-Create-Win.
           Display Floating GRAPHICAL WINDOW
              LINES 11,09,
              SIZE 91,30,
              HEIGHT-IN-CELLS,
              WIDTH-IN-CELLS,
              COLOR 131329,
              CONTROL FONT Calibri14-Occidentale,
              LINK TO THREAD,
              NO SCROLL,
              TITLE-BAR,
              TITLE "Studio - Aggiungi appuntamenti",
              WITH SYSTEM MENU,
              USER-GRAY,
              USER-WHITE,
              No WRAP,
              EVENT PROCEDURE scr-singolo-Event-Proc,
              HANDLE IS scar-cancella-r-Handle,
      * <TOTEM:EPT. FORM:scr-aggiungi-r, FORM:scr-aggiungi-r, AfterCreateWin>
      * <TOTEM:END>


      * Tool Bar    
      * Status-bar
           DISPLAY scr-aggiungi-r UPON scar-cancella-r-Handle
      * DISPLAY-COLUMNS settings
           .

       scr-aggiungi-r-PROC.
      * <TOTEM:EPT. FORM:scr-aggiungi-r, FORM:scr-aggiungi-r, BeforeAccept>
           move spaces to ef-cliente-ar-buf lab-cliente-ar-buf
           move 0 to ef-dal-ar-buf ef-al-ar-buf ef-ora-ar-buf
                     chk-lun-buf chk-mar-buf chk-mer-buf chk-gio-buf
                     chk-ven-buf chk-sab-buf.
           display scr-aggiungi-r.  

           move 78-ID-ef-cliente-ar to control-id.
           move 4 to accept-control.

           .
      * <TOTEM:END>
           PERFORM UNTIL Exit-Pushed
              ACCEPT scr-aggiungi-r
                 ON EXCEPTION
                    PERFORM scr-aggiungi-r-Evaluate-Func
                 MOVE 4 TO TOTEM-Form-Index
              END-ACCEPT
      * <TOTEM:EPT. FORM:scr-aggiungi-r, FORM:scr-aggiungi-r, AfterEndAccept>
      * <TOTEM:END>
           END-PERFORM
      * <TOTEM:EPT. FORM:scr-aggiungi-r, FORM:scr-aggiungi-r, BeforeDestroyWindow>
      * <TOTEM:END>
           DESTROY scar-cancella-r-Handle
           INITIALIZE Key-Status
           .

       scr-aggiungi-r-Evaluate-Func.
      * <TOTEM:EPT. FORM:scr-aggiungi-r, FORM:scr-aggiungi-r, AfterAccept>
      * <TOTEM:END>
           EVALUATE TRUE
              WHEN Exit-Pushed
                 PERFORM scr-aggiungi-r-Exit
              WHEN Event-Occurred
                 IF Event-Type = Cmd-Close
                    PERFORM scr-aggiungi-r-Exit
                 END-IF
              WHEN Key-Status = 1001
                 PERFORM pb-dal-ar-LinkTo
              WHEN Key-Status = 1000
                 PERFORM pb-cerca-cli-ar-LinkTo
              WHEN Key-Status = 1002
                 PERFORM pb-procedi-ar-LinkTo
              WHEN Key-Status = 1003
                 PERFORM pb-al-ar-LinkTo
           END-EVALUATE
      * avoid changing focus
           MOVE 4 TO Accept-Control
           .

       scr-aggiungi-r-CLEAR.
           PERFORM scr-aggiungi-r-INIT-VALUE
           PERFORM scr-aggiungi-r-DISPLAY
           .

       scr-aggiungi-r-DISPLAY.
      * <TOTEM:EPT. FORM:scr-aggiungi-r, FORM:scr-aggiungi-r, BeforeDisplay>
      * <TOTEM:END>
           DISPLAY scr-aggiungi-r UPON scar-cancella-r-Handle
      * <TOTEM:EPT. FORM:scr-aggiungi-r, FORM:scr-aggiungi-r, AfterDisplay>

           SET LK-BL-SCRITTURA     TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           MOVE FORM1-HANDLE       TO LK-HND-WIN.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           CANCEL "BLOCKPGM".

           .
      * <TOTEM:END>
           .

       scr-aggiungi-r-Exit.
      * for main screen
      * <TOTEM:EPT. FORM:scr-aggiungi-r, FORM:scr-aggiungi-r, BeforeExit>
      * <TOTEM:END>
           MOVE 27 TO Key-Status
           .

       scr-aggiungi-r-Init-Data.
           MOVE 4 TO TOTEM-Form-Index
           MOVE 0 TO TOTEM-Frame-Index
           .

       scr-aggiungi-r-Init-Value.
      * <TOTEM:EPT. FORM:scr-aggiungi-r, FORM:scr-aggiungi-r, SetDefault>
      * <TOTEM:END>
           PERFORM scr-aggiungi-r-FLD-TO-BUF
           .


       scr-aggiungi-r-ALLGRID-RESET.
           .

      * for Form's Validation
       scr-aggiungi-r-VALIDATION-ROUTINE.
           SET TOTEM-CHECK-OK TO TRUE
           .


       scr-aggiungi-r-Buf-To-Fld.
      * <TOTEM:EPT. FORM:scr-aggiungi-r, FORM:scr-aggiungi-r, BeforeBufToFld>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:scr-aggiungi-r, FORM:scr-aggiungi-r, AfterBufToFld>
      * <TOTEM:END>
           .

       scr-aggiungi-r-Fld-To-Buf.
      * <TOTEM:EPT. FORM:scr-aggiungi-r, FORM:scr-aggiungi-r, BeforeFldToBuf>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:scr-aggiungi-r, FORM:scr-aggiungi-r, AfterFldToBuf>
      * <TOTEM:END>
           .

       scr-aggiungi-r-CONTROLLO-OLD.
           set SiSalvato to true.
           if mod = 0 exit paragraph end-if.
           perform scr-aggiungi-r-BUF-TO-FLD.
           move 0 to scelta.
           .
       scr-aggiungi-r-EXTENDED-FILE-STATUS.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
           MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           PERFORM scr-aggiungi-r-SHOW-MSG-ROUTINE
           .

       scr-aggiungi-r-SHOW-MSG-ROUTINE.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM scr-aggiungi-r-DISPLAY-MESSAGE
           .

       scr-aggiungi-r-DISPLAY-MESSAGE.
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

       scr-aggiungi-r-Save-Status.
           .             

       scr-aggiungi-r-Restore-Status.
           .

       scr-cerca-Open-Routine.
           PERFORM scr-cerca-Scrn
           PERFORM scr-cerca-Proc
           .

       scr-cerca-Scrn.
           PERFORM scr-cerca-Create-Win
           PERFORM scr-cerca-Init-Value
           PERFORM scr-cerca-Init-Data
      * Tab keystrok settings
      * Tool Bar
           PERFORM scr-cerca-DISPLAY
           .

       scr-cerca-Create-Win.
           Display Floating GRAPHICAL WINDOW
              LINES 25,30,
              SIZE 94,80,
              HEIGHT-IN-CELLS,
              WIDTH-IN-CELLS,
              COLOR 131329,
              CONTROL FONT Calibri14-Occidentale,
              LINK TO THREAD,
              NO SCROLL,
              TITLE-BAR,
              TITLE "Studio - Cerca appuntamenti",
              WITH SYSTEM MENU,
              USER-GRAY,
              USER-WHITE,
              No WRAP,
              EVENT PROCEDURE scr-singolo-Event-Proc,
              HANDLE IS scar-cerca-Handle,
      * <TOTEM:EPT. FORM:scr-cerca, FORM:scr-cerca, AfterCreateWin>
      * <TOTEM:END>


      * Tool Bar    
      * Status-bar
           DISPLAY scr-cerca UPON scar-cerca-Handle
      * DISPLAY-COLUMNS settings
              MODIFY gd-cerca, DISPLAY-COLUMNS (1, 14, 23, 41, 76, 86)
           .

       scr-cerca-PROC.
      * <TOTEM:EPT. FORM:scr-cerca, FORM:scr-cerca, BeforeAccept>
           set ModificaAppuntamento to false.
           move spaces to ef-cliente-c-buf lab-cliente-c-buf
           move 0 to ef-dal-c-buf ef-al-c-buf 
           move 1 to chk-nessuno-c-buf chk-test-c-buf chk-terapia-c-buf
                     chk-presente-c-buf chk-assente-c-buf 
           chk-inizio-c-buf
                     chk-recupero-c-buf chk-pag-n-buf chk-pag-si-buf
                     chk-pag-ft-buf.
           display scr-cerca.

           move 78-ID-ef-cliente-c to control-id.
           move 4 to accept-control.

           .
      * <TOTEM:END>
           PERFORM UNTIL Exit-Pushed
              ACCEPT scr-cerca
                 ON EXCEPTION
                    PERFORM scr-cerca-Evaluate-Func
                 MOVE 5 TO TOTEM-Form-Index
              END-ACCEPT
      * <TOTEM:EPT. FORM:scr-cerca, FORM:scr-cerca, AfterEndAccept>
           if ModificaInLine
              set ModificaInLine to false
              perform SCR-SINGOLO-OPEN-ROUTINE
              if AggiornaAppuntamenti
                 perform PB-PROCEDI-C-LINKTO
              end-if
           end-if
           if ModificaAppuntamento
              move 27 to key-status
           end-if

      * <TOTEM:END>
           END-PERFORM
      * <TOTEM:EPT. FORM:scr-cerca, FORM:scr-cerca, BeforeDestroyWindow>
      * <TOTEM:END>
           DESTROY scar-cerca-Handle
           INITIALIZE Key-Status
           .

       scr-cerca-Evaluate-Func.
      * <TOTEM:EPT. FORM:scr-cerca, FORM:scr-cerca, AfterAccept>
      * <TOTEM:END>
           EVALUATE TRUE
              WHEN Exit-Pushed
                 PERFORM scr-cerca-Exit
              WHEN Event-Occurred
                 IF Event-Type = Cmd-Close
                    PERFORM scr-cerca-Exit
                 END-IF
              WHEN Key-Status = 1001
                 PERFORM pb-dal-c-LinkTo
              WHEN Key-Status = 1000
                 PERFORM pb-cerca-cli-c-LinkTo
              WHEN Key-Status = 1002
                 PERFORM pb-procedi-c-LinkTo
              WHEN Key-Status = 1003
                 PERFORM pb-al-c-LinkTo
              WHEN Key-Status = 1004
                 PERFORM pb-excel-c-LinkTo
              WHEN Key-Status = 1005
                 PERFORM pb-stampa-LinkTo
           END-EVALUATE
      * avoid changing focus
           MOVE 4 TO Accept-Control
           .

       scr-cerca-CLEAR.
           PERFORM scr-cerca-INIT-VALUE
           PERFORM scr-cerca-DISPLAY
           .

       scr-cerca-DISPLAY.
      * <TOTEM:EPT. FORM:scr-cerca, FORM:scr-cerca, BeforeDisplay>
      * <TOTEM:END>
           DISPLAY scr-cerca UPON scar-cerca-Handle
      * <TOTEM:EPT. FORM:scr-cerca, FORM:scr-cerca, AfterDisplay>

           SET LK-BL-SCRITTURA     TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           MOVE FORM1-HANDLE       TO LK-HND-WIN.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           CANCEL "BLOCKPGM".

           .
      * <TOTEM:END>
           .

       scr-cerca-Exit.
      * for main screen
      * <TOTEM:EPT. FORM:scr-cerca, FORM:scr-cerca, BeforeExit>
      * <TOTEM:END>
           MOVE 27 TO Key-Status
           .

       scr-cerca-Init-Data.
           MOVE 5 TO TOTEM-Form-Index
           MOVE 0 TO TOTEM-Frame-Index
      * GRID
           PERFORM gd-cerca-Content
           .

       scr-cerca-Init-Value.
      * <TOTEM:EPT. FORM:scr-cerca, FORM:scr-cerca, SetDefault>
      * <TOTEM:END>
           PERFORM scr-cerca-FLD-TO-BUF
           .


       scr-cerca-ALLGRID-RESET.
           .

      * for Form's Validation
       scr-cerca-VALIDATION-ROUTINE.
           SET TOTEM-CHECK-OK TO TRUE
           .


       scr-cerca-Buf-To-Fld.
      * <TOTEM:EPT. FORM:scr-cerca, FORM:scr-cerca, BeforeBufToFld>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:scr-cerca, FORM:scr-cerca, AfterBufToFld>
      * <TOTEM:END>
           .

       scr-cerca-Fld-To-Buf.
      * <TOTEM:EPT. FORM:scr-cerca, FORM:scr-cerca, BeforeFldToBuf>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:scr-cerca, FORM:scr-cerca, AfterFldToBuf>
      * <TOTEM:END>
           .

       scr-cerca-CONTROLLO-OLD.
           set SiSalvato to true.
           if mod = 0 exit paragraph end-if.
           perform scr-cerca-BUF-TO-FLD.
           move 0 to scelta.
           .
       scr-cerca-EXTENDED-FILE-STATUS.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
           MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           PERFORM scr-cerca-SHOW-MSG-ROUTINE
           .

       scr-cerca-SHOW-MSG-ROUTINE.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM scr-cerca-DISPLAY-MESSAGE
           .

       scr-cerca-DISPLAY-MESSAGE.
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

       scr-cerca-Save-Status.
           .             

       scr-cerca-Restore-Status.
           .

       scr-recupero-Open-Routine.
           PERFORM scr-recupero-Scrn
           PERFORM scr-recupero-Proc
           .

       scr-recupero-Scrn.
           PERFORM scr-recupero-Create-Win
           PERFORM scr-recupero-Init-Value
           PERFORM scr-recupero-Init-Data
      * Tab keystrok settings
      * Tool Bar
           PERFORM scr-recupero-DISPLAY
           .

       scr-recupero-Create-Win.
           Display Floating GRAPHICAL WINDOW
              LINES 6,35,
              SIZE 91,30,
              HEIGHT-IN-CELLS,
              WIDTH-IN-CELLS,
              COLOR 131329,
              CONTROL FONT Calibri14-Occidentale,
              LINK TO THREAD,
              NO SCROLL,
              TITLE-BAR,
              TITLE "Studio - Recupero appuntamento",
              WITH SYSTEM MENU,
              USER-GRAY,
              USER-WHITE,
              No WRAP,
              EVENT PROCEDURE scr-singolo-Event-Proc,
              HANDLE IS scr-recupero-Handle,
      * <TOTEM:EPT. FORM:scr-recupero, FORM:scr-recupero, AfterCreateWin>
      * <TOTEM:END>


      * Tool Bar    
      * Status-bar
           DISPLAY scr-recupero UPON scr-recupero-Handle
      * DISPLAY-COLUMNS settings
           .

       scr-recupero-PROC.
      * <TOTEM:EPT. FORM:scr-recupero, FORM:scr-recupero, BeforeAccept>
           move sav-cliente to cli-codice
           read clienti no lock
                invalid move spaces to cli-nome cli-cognome
           end-read.
           initialize lab-cliente-rec-buf
           inspect cli-cognome replacing trailing spaces by low-value
           string  cli-cognome delimited low-value
                   " "         delimited size
                   cli-nome    delimited size
              into lab-cliente-rec-buf
           end-string.
           display lab-cliente-rec.

           initialize lab-app-rec-buf.
           string "APPUNTAMENTO DEL " delimited size
                  sav-data(7:2)       delimited size
                  "/"                 delimited size
                  sav-data(5:2)       delimited size
                  "/"                 delimited size
                  sav-data(1:4)       delimited size
                  " ALLE "            delimited size
                  sav-ora(1:2)        delimited size
                  "."                 delimited size
                  sav-ora(3:2)        delimited size
             into lab-app-rec-buf
           end-string.
           display lab-app-rec.

           move 0 to ef-data-rec-buf.
           move sav-ora to ef-ora-rec-buf.
           display ef-data-rec ef-ora-rec.

           .
      * <TOTEM:END>
           PERFORM UNTIL Exit-Pushed
              ACCEPT scr-recupero
                 ON EXCEPTION
                    PERFORM scr-recupero-Evaluate-Func
                 MOVE 6 TO TOTEM-Form-Index
              END-ACCEPT
      * <TOTEM:EPT. FORM:scr-recupero, FORM:scr-recupero, AfterEndAccept>
      * <TOTEM:END>
           END-PERFORM
      * <TOTEM:EPT. FORM:scr-recupero, FORM:scr-recupero, BeforeDestroyWindow>
      * <TOTEM:END>
           DESTROY scr-recupero-Handle
           INITIALIZE Key-Status
           .

       scr-recupero-Evaluate-Func.
      * <TOTEM:EPT. FORM:scr-recupero, FORM:scr-recupero, AfterAccept>
      * <TOTEM:END>
           EVALUATE TRUE
              WHEN Exit-Pushed
                 PERFORM scr-recupero-Exit
              WHEN Event-Occurred
                 IF Event-Type = Cmd-Close
                    PERFORM scr-recupero-Exit
                 END-IF
              WHEN Key-Status = 1001
                 PERFORM pb-calendario-rec-LinkTo
              WHEN Key-Status = 1000
                 PERFORM pb-procedi-rec-LinkTo
           END-EVALUATE
      * avoid changing focus
           MOVE 4 TO Accept-Control
           .

       scr-recupero-CLEAR.
           PERFORM scr-recupero-INIT-VALUE
           PERFORM scr-recupero-DISPLAY
           .

       scr-recupero-DISPLAY.
      * <TOTEM:EPT. FORM:scr-recupero, FORM:scr-recupero, BeforeDisplay>
      * <TOTEM:END>
           DISPLAY scr-recupero UPON scr-recupero-Handle
      * <TOTEM:EPT. FORM:scr-recupero, FORM:scr-recupero, AfterDisplay>

           SET LK-BL-SCRITTURA     TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           MOVE FORM1-HANDLE       TO LK-HND-WIN.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           CANCEL "BLOCKPGM".

           .
      * <TOTEM:END>
           .

       scr-recupero-Exit.
      * for main screen
      * <TOTEM:EPT. FORM:scr-recupero, FORM:scr-recupero, BeforeExit>
      * <TOTEM:END>
           MOVE 27 TO Key-Status
           .

       scr-recupero-Init-Data.
           MOVE 6 TO TOTEM-Form-Index
           MOVE 0 TO TOTEM-Frame-Index
           .

       scr-recupero-Init-Value.
      * <TOTEM:EPT. FORM:scr-recupero, FORM:scr-recupero, SetDefault>
      * <TOTEM:END>
           PERFORM scr-recupero-FLD-TO-BUF
           .


       scr-recupero-ALLGRID-RESET.
           .

      * for Form's Validation
       scr-recupero-VALIDATION-ROUTINE.
           SET TOTEM-CHECK-OK TO TRUE
           .


       scr-recupero-Buf-To-Fld.
      * <TOTEM:EPT. FORM:scr-recupero, FORM:scr-recupero, BeforeBufToFld>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:scr-recupero, FORM:scr-recupero, AfterBufToFld>
      * <TOTEM:END>
           .

       scr-recupero-Fld-To-Buf.
      * <TOTEM:EPT. FORM:scr-recupero, FORM:scr-recupero, BeforeFldToBuf>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:scr-recupero, FORM:scr-recupero, AfterFldToBuf>
      * <TOTEM:END>
           .

       scr-recupero-CONTROLLO-OLD.
           set SiSalvato to true.
           if mod = 0 exit paragraph end-if.
           perform scr-recupero-BUF-TO-FLD.
           move 0 to scelta.
           .
       scr-recupero-EXTENDED-FILE-STATUS.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
           MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           PERFORM scr-recupero-SHOW-MSG-ROUTINE
           .

       scr-recupero-SHOW-MSG-ROUTINE.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM scr-recupero-DISPLAY-MESSAGE
           .

       scr-recupero-DISPLAY-MESSAGE.
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

       scr-recupero-Save-Status.
           .             

       scr-recupero-Restore-Status.
           .

       scr-attesa-Open-Routine.
           PERFORM scr-attesa-Scrn
           PERFORM scr-attesa-Proc
           .

       scr-attesa-Scrn.
           PERFORM scr-attesa-Create-Win
           PERFORM scr-attesa-Init-Value
           PERFORM scr-attesa-Init-Data
      * Tab keystrok settings
      * Tool Bar
           PERFORM scr-attesa-DISPLAY
           .

       scr-attesa-Create-Win.
           Display Floating GRAPHICAL WINDOW
              LINES 4,96,
              SIZE 44,27,
              HEIGHT-IN-CELLS,
              WIDTH-IN-CELLS,
              COLOR 131329,
              CONTROL FONT Calibri16B-Occidentale,
              LINK TO THREAD,
              MODELESS,
              NO SCROLL,
              No WRAP,
              EVENT PROCEDURE scr-attesa-Event-Proc,
              HANDLE IS scr-attesa-Handle,
      * <TOTEM:EPT. FORM:scr-attesa, FORM:scr-attesa, AfterCreateWin>
      * <TOTEM:END>


      * Tool Bar    
      * Status-bar
           DISPLAY scr-attesa UPON scr-attesa-Handle
      * DISPLAY-COLUMNS settings
           .

       scr-attesa-PROC.
      * <TOTEM:EPT. FORM:scr-attesa, FORM:scr-attesa, BeforeAccept>
           if attesa-app
              modify gd-app,        mass-update = 1, enabled = 0
              perform INTESTAZIONE-DATE
              set LoadingAll to true
              perform CARICA-APPUNTAMENTI
              set LoadingAll to false
              modify gd-app,        mass-update = 0, enabled = 1
              modify form1-handle,  visible 1
           else
              perform ELABORA-TEST
           end-if.
           move 27 to key-status.

           .
      * <TOTEM:END>
           PERFORM UNTIL Exit-Pushed
              ACCEPT OMITTED LINE 1 COL 1
                 ON EXCEPTION
                    PERFORM scr-attesa-Evaluate-Func
                 MOVE 7 TO TOTEM-Form-Index
              END-ACCEPT
      * <TOTEM:EPT. FORM:scr-attesa, FORM:scr-attesa, AfterEndAccept>
      * <TOTEM:END>
           END-PERFORM
      * <TOTEM:EPT. FORM:scr-attesa, FORM:scr-attesa, BeforeDestroyWindow>
      * <TOTEM:END>
           DESTROY scr-attesa-Handle
           INITIALIZE Key-Status
           .

       scr-attesa-Evaluate-Func.
      * <TOTEM:EPT. FORM:scr-attesa, FORM:scr-attesa, AfterAccept>
      * <TOTEM:END>
           EVALUATE TRUE
              WHEN Exit-Pushed
                 PERFORM scr-attesa-Exit
              WHEN Event-Occurred
                 IF Event-Type = Cmd-Close
                    PERFORM scr-attesa-Exit
                 END-IF
           END-EVALUATE
      * avoid changing focus
           MOVE 4 TO Accept-Control
           .

       scr-attesa-CLEAR.
           PERFORM scr-attesa-INIT-VALUE
           PERFORM scr-attesa-DISPLAY
           .

       scr-attesa-DISPLAY.
      * <TOTEM:EPT. FORM:scr-attesa, FORM:scr-attesa, BeforeDisplay>
      * <TOTEM:END>
           DISPLAY scr-attesa UPON scr-attesa-Handle
      * <TOTEM:EPT. FORM:scr-attesa, FORM:scr-attesa, AfterDisplay>
           SET LK-BL-SCRITTURA     TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           MOVE FORM1-HANDLE       TO LK-HND-WIN.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           CANCEL "BLOCKPGM".

           .
      * <TOTEM:END>
           .

       scr-attesa-Exit.
      * for main screen
      * <TOTEM:EPT. FORM:scr-attesa, FORM:scr-attesa, BeforeExit>
      * <TOTEM:END>
           MOVE 27 TO Key-Status
           .

       scr-attesa-Init-Data.
           MOVE 7 TO TOTEM-Form-Index
           MOVE 0 TO TOTEM-Frame-Index
           .

       scr-attesa-Init-Value.
      * <TOTEM:EPT. FORM:scr-attesa, FORM:scr-attesa, SetDefault>
      * <TOTEM:END>
           PERFORM scr-attesa-FLD-TO-BUF
           .


       scr-attesa-ALLGRID-RESET.
           .

      * for Form's Validation
       scr-attesa-VALIDATION-ROUTINE.
           SET TOTEM-CHECK-OK TO TRUE
           .


       scr-attesa-Buf-To-Fld.
      * <TOTEM:EPT. FORM:scr-attesa, FORM:scr-attesa, BeforeBufToFld>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:scr-attesa, FORM:scr-attesa, AfterBufToFld>
      * <TOTEM:END>
           .

       scr-attesa-Fld-To-Buf.
      * <TOTEM:EPT. FORM:scr-attesa, FORM:scr-attesa, BeforeFldToBuf>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:scr-attesa, FORM:scr-attesa, AfterFldToBuf>
      * <TOTEM:END>
           .

       scr-attesa-CONTROLLO-OLD.
           set SiSalvato to true.
           if mod = 0 exit paragraph end-if.
           perform scr-attesa-BUF-TO-FLD.
           move 0 to scelta.
           .
       scr-attesa-EXTENDED-FILE-STATUS.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
           MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           PERFORM scr-attesa-SHOW-MSG-ROUTINE
           .

       scr-attesa-SHOW-MSG-ROUTINE.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM scr-attesa-DISPLAY-MESSAGE
           .

       scr-attesa-DISPLAY-MESSAGE.
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

       scr-attesa-Save-Status.
           .             

       scr-attesa-Restore-Status.
           .

       scr-test-Open-Routine.
           PERFORM scr-test-Scrn
           PERFORM scr-test-Proc
           .

       scr-test-Scrn.
           PERFORM scr-test-Create-Win
           PERFORM scr-test-Init-Value
           PERFORM scr-test-Init-Data
      * Tab keystrok settings
      * Tool Bar
           PERFORM scr-test-DISPLAY
           .

       scr-test-Create-Win.
           Display Floating GRAPHICAL WINDOW
              LINES 35,04,
              SIZE 77,00,
              HEIGHT-IN-CELLS,
              WIDTH-IN-CELLS,
              COLOR 131329,
              CONTROL FONT Calibri14-Occidentale,
              LINK TO THREAD,
              NO SCROLL,
              TITLE-BAR,
              TITLE "Studio - TEST",
              WITH SYSTEM MENU,
              USER-GRAY,
              USER-WHITE,
              No WRAP,
              EVENT PROCEDURE scr-singolo-Event-Proc,
              HANDLE IS scar-cerca-Handle,
      * <TOTEM:EPT. FORM:scr-test, FORM:scr-test, AfterCreateWin>
      * <TOTEM:END>


      * Tool Bar    
      * Status-bar
           DISPLAY scr-test UPON scar-cerca-Handle
      * DISPLAY-COLUMNS settings
              MODIFY gd-test, DISPLAY-COLUMNS (1, 14, 23)
              MODIFY gd-verifica, DISPLAY-COLUMNS (1, 39, 47)
           .

       scr-test-PROC.
      * <TOTEM:EPT. FORM:scr-test, FORM:scr-test, BeforeAccept>
           move 0 to ef-dal-t-buf ef-dal-v-buf.
           move 99999999 to ef-al-t-buf.
           move spaces   to ef-cliente-t-buf.
           move "TUTTI I CLIENTI" to lab-cliente-t-buf.
           display scr-test.

           .
      * <TOTEM:END>
           PERFORM UNTIL Exit-Pushed
              ACCEPT scr-test
                 ON EXCEPTION
                    PERFORM scr-test-Evaluate-Func
                 MOVE 8 TO TOTEM-Form-Index
              END-ACCEPT
      * <TOTEM:EPT. FORM:scr-test, FORM:scr-test, AfterEndAccept>
      * <TOTEM:END>
           END-PERFORM
      * <TOTEM:EPT. FORM:scr-test, FORM:scr-test, BeforeDestroyWindow>
      * <TOTEM:END>
           DESTROY scar-cerca-Handle
           INITIALIZE Key-Status
           .

       scr-test-Evaluate-Func.
      * <TOTEM:EPT. FORM:scr-test, FORM:scr-test, AfterAccept>
      * <TOTEM:END>
           EVALUATE TRUE
              WHEN Exit-Pushed
                 PERFORM scr-test-Exit
              WHEN Event-Occurred
                 IF Event-Type = Cmd-Close
                    PERFORM scr-test-Exit
                 END-IF
              WHEN Key-Status = 1001
                 PERFORM pb-dal-t-LinkTo
              WHEN Key-Status = 1000
                 PERFORM pb-cerca-cli-t-LinkTo
              WHEN Key-Status = 1005
                 PERFORM pb-procedi-t-LinkTo
              WHEN Key-Status = 1002
                 PERFORM pb-al-t-LinkTo
              WHEN Key-Status = 1004
                 PERFORM pb-dal-v-LinkTo
              WHEN Key-Status = 1006
                 PERFORM pb-procedi-v-LinkTo
           END-EVALUATE
      * avoid changing focus
           MOVE 4 TO Accept-Control
           .

       scr-test-CLEAR.
           PERFORM scr-test-INIT-VALUE
           PERFORM scr-test-DISPLAY
           .

       scr-test-DISPLAY.
      * <TOTEM:EPT. FORM:scr-test, FORM:scr-test, BeforeDisplay>
      * <TOTEM:END>
           DISPLAY scr-test UPON scar-cerca-Handle
      * <TOTEM:EPT. FORM:scr-test, FORM:scr-test, AfterDisplay>
           SET LK-BL-SCRITTURA     TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           MOVE FORM1-HANDLE       TO LK-HND-WIN.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           CANCEL "BLOCKPGM".

           .
      * <TOTEM:END>
           .

       scr-test-Exit.
      * for main screen
      * <TOTEM:EPT. FORM:scr-test, FORM:scr-test, BeforeExit>
      * <TOTEM:END>
           MOVE 27 TO Key-Status
           .

       scr-test-Init-Data.
           MOVE 8 TO TOTEM-Form-Index
           MOVE 0 TO TOTEM-Frame-Index
      * GRID
           PERFORM gd-test-Content
      * GRID
           PERFORM gd-verifica-Content
           .

       scr-test-Init-Value.
      * <TOTEM:EPT. FORM:scr-test, FORM:scr-test, SetDefault>
      * <TOTEM:END>
           PERFORM scr-test-FLD-TO-BUF
           .


       scr-test-ALLGRID-RESET.
           .

      * for Form's Validation
       scr-test-VALIDATION-ROUTINE.
           SET TOTEM-CHECK-OK TO TRUE
           .


       scr-test-Buf-To-Fld.
      * <TOTEM:EPT. FORM:scr-test, FORM:scr-test, BeforeBufToFld>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:scr-test, FORM:scr-test, AfterBufToFld>
      * <TOTEM:END>
           .

       scr-test-Fld-To-Buf.
      * <TOTEM:EPT. FORM:scr-test, FORM:scr-test, BeforeFldToBuf>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:scr-test, FORM:scr-test, AfterFldToBuf>
      * <TOTEM:END>
           .

       scr-test-CONTROLLO-OLD.
           set SiSalvato to true.
           if mod = 0 exit paragraph end-if.
           perform scr-test-BUF-TO-FLD.
           move 0 to scelta.
           .
       scr-test-EXTENDED-FILE-STATUS.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
           MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           PERFORM scr-test-SHOW-MSG-ROUTINE
           .

       scr-test-SHOW-MSG-ROUTINE.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM scr-test-DISPLAY-MESSAGE
           .

       scr-test-DISPLAY-MESSAGE.
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

       scr-test-Save-Status.
           .             

       scr-test-Restore-Status.
           .



       Form1-Event-Proc.
           .

       Form1-Gd-1-Event-Proc.
           EVALUATE Event-Type ALSO Event-Control-Id ALSO
                                    Event-Window-Handle
           WHEN Msg-Begin-Drag ALSO 5001 ALSO
                    Form1-Handle 
              PERFORM gd-app-Ev-Msg-Begin-Drag
           WHEN Msg-Begin-Entry ALSO 5001 ALSO
                    Form1-Handle 
              PERFORM gd-app-Ev-Msg-Begin-Entry
           WHEN Msg-End-Drag ALSO 5001 ALSO
                    Form1-Handle 
              PERFORM gd-app-Ev-Msg-End-Drag
           WHEN Msg-Goto-Cell ALSO 5001 ALSO
                    Form1-Handle 
              PERFORM gd-app-Ev-Msg-Goto-Cell
           WHEN Msg-Goto-Cell-Drag ALSO 5001 ALSO
                    Form1-Handle 
              PERFORM gd-app-Ev-Msg-Goto-Cell-Drag
           WHEN Msg-Goto-Cell-Mouse ALSO 5001 ALSO
                    Form1-Handle 
              PERFORM gd-app-Ev-Msg-Goto-Cell-Mouse
           END-EVALUATE
           .

       scr-singolo-Event-Proc.
           .

       Screen1b-Gd-1-Event-Proc.
           EVALUATE Event-Type ALSO Event-Control-Id ALSO
                                    Event-Window-Handle
           WHEN Msg-Begin-Drag ALSO 21 ALSO
                    scar-cerca-Handle 
              PERFORM gd-cerca-Ev-Msg-Begin-Drag
           WHEN Msg-Begin-Entry ALSO 21 ALSO
                    scar-cerca-Handle 
              PERFORM gd-cerca-Ev-Msg-Begin-Entry
           WHEN Msg-End-Drag ALSO 21 ALSO
                    scar-cerca-Handle 
              PERFORM gd-cerca-Ev-Msg-End-Drag
           WHEN Msg-Goto-Cell ALSO 21 ALSO
                    scar-cerca-Handle 
              PERFORM gd-cerca-Ev-Msg-Goto-Cell
           WHEN Msg-Goto-Cell-Drag ALSO 21 ALSO
                    scar-cerca-Handle 
              PERFORM gd-cerca-Ev-Msg-Goto-Cell-Drag
           WHEN Msg-Goto-Cell-Mouse ALSO 21 ALSO
                    scar-cerca-Handle 
              PERFORM gd-cerca-Ev-Msg-Goto-Cell-Mouse
           WHEN Msg-Begin-Drag ALSO 19 ALSO
                    scar-cerca-Handle 
              PERFORM gd-test-Ev-Msg-Begin-Drag
           WHEN Msg-Begin-Entry ALSO 19 ALSO
                    scar-cerca-Handle 
              PERFORM gd-test-Ev-Msg-Begin-Entry
           WHEN Msg-End-Drag ALSO 19 ALSO
                    scar-cerca-Handle 
              PERFORM gd-test-Ev-Msg-End-Drag
           WHEN Msg-Goto-Cell ALSO 19 ALSO
                    scar-cerca-Handle 
              PERFORM gd-test-Ev-Msg-Goto-Cell
           WHEN Msg-Goto-Cell-Drag ALSO 19 ALSO
                    scar-cerca-Handle 
              PERFORM gd-test-Ev-Msg-Goto-Cell-Drag
           WHEN Msg-Goto-Cell-Mouse ALSO 19 ALSO
                    scar-cerca-Handle 
              PERFORM gd-test-Ev-Msg-Goto-Cell-Mouse
           WHEN Msg-Begin-Drag ALSO 10 ALSO
                    scar-cerca-Handle 
              PERFORM gd-verifica-Ev-Msg-Begin-Drag
           WHEN Msg-Begin-Entry ALSO 10 ALSO
                    scar-cerca-Handle 
              PERFORM gd-verifica-Ev-Msg-Begin-Entry
           WHEN Msg-End-Drag ALSO 10 ALSO
                    scar-cerca-Handle 
              PERFORM gd-verifica-Ev-Msg-End-Drag
           WHEN Msg-Goto-Cell ALSO 10 ALSO
                    scar-cerca-Handle 
              PERFORM gd-verifica-Ev-Msg-Goto-Cell
           WHEN Msg-Goto-Cell-Drag ALSO 10 ALSO
                    scar-cerca-Handle 
              PERFORM gd-verifica-Ev-Msg-Goto-Cell-Drag
           WHEN Msg-Goto-Cell-Mouse ALSO 10 ALSO
                    scar-cerca-Handle 
              PERFORM gd-verifica-Ev-Msg-Goto-Cell-Mouse
           END-EVALUATE
           .

       scr-attesa-Event-Proc.
           .

      * USER DEFINE PARAGRAPH
       ADD-GIORNO.
      * <TOTEM:PARA. ADD-GIORNO>
           compute como-numero = function integer-of-date(como-data).
           add 1 to como-numero.
           compute como-data = function date-of-integer(como-numero).

           perform TROVA-GIORNO.
           if giorno = 7
              compute como-numero = function integer-of-date(como-data)
              add 1 to como-numero
              compute como-data = function date-of-integer(como-numero)
           end-if 
           .
      * <TOTEM:END>

       AGGIORNA-APPUNTAMENTI.
      * <TOTEM:PARA. AGGIORNA-APPUNTAMENTI>
           move 0 to lab-attesa-buf counter counter2.
           set attesa-app to true.
           perform SCR-ATTESA-OPEN-ROUTINE 
           .
      * <TOTEM:END>

       AGGIORNA-GIORNO.
      * <TOTEM:PARA. AGGIORNA-GIORNO>
           move 0 to colonna

           move col-data(1) to como-data
           perform DATE-TO-FILE
           if sav-data = como-data
              move 1 to colonna
           else
              move col-data(2) to como-data
              perform DATE-TO-FILE
              if sav-data = como-data
                 move 2 to colonna
              else           
                 move col-data(3) to como-data
                 perform DATE-TO-FILE
                 if sav-data = como-data
                    move 3 to colonna
                 else           
                    move col-data(4) to como-data
                    perform DATE-TO-FILE
                    if sav-data = como-data
                       move 4 to colonna
                    else           
                       move col-data(5) to como-data
                       perform DATE-TO-FILE
                       if sav-data = como-data
                          move 5 to colonna
                       else
                          move col-data(6) to como-data
                          perform DATE-TO-FILE
                          if sav-data = como-data
                             move 6 to colonna
                          end-if
                       end-if
                    end-if
                 end-if
              end-if
           end-if
           if colonna not = 0
              move sav-data to como-data
              modify gd-app, mass-update = 1
              perform RESET-GIORNO
              perform CARICA-GIORNO
              modify gd-app, mass-update = 0
           end-if 
           .
      * <TOTEM:END>

       CANCELLA.
      * <TOTEM:PARA. CANCELLA>
           .
      * <TOTEM:END>

       CARICA-APPUNTAMENTI.
      * <TOTEM:PARA. CARICA-APPUNTAMENTI>
           perform RESET-APPUNTAMENTI.
           perform varying colonna from 1 by 1 
                     until colonna = 7
              move col-data(colonna) to como-data
              perform DATE-TO-FILE
              move como-data to sav-data
              perform CARICA-GIORNO
           end-perform 
           .
      * <TOTEM:END>

       CARICA-GIORNO.
      * <TOTEM:PARA. CARICA-GIORNO>
           move low-value to app-chiave.
           move sav-data  to app-data.
           start appuntamenti key >= app-chiave
                 invalid continue
             not invalid
                 move 2 to riga
                 perform until 1 = 2
                    read appuntamenti next no lock at end exit perform 
           end-read
                    if app-data not = sav-data
                       exit perform
                    end-if

                    if LoadingAll
                       add 1 to counter counter2
                       if counter = 10
                          move 0 to counter
                          move counter2 to lab-attesa-buf
                          display lab-attesa
                       end-if              
                    end-if

                    add 1 to riga
                    evaluate colonna                                    
              
                    when 1
                         move app-ora to col-ora-1
                         move app-cliente to cli-codice
                         read clienti no lock 
                              invalid move "NON TROVATO" to 
           col-cliente-1
                          not invalid  
                              initialize col-cliente-1
                              inspect cli-cognome replacing trailing 
           spaces by low-value
                              string  cli-cognome delimited low-value
                                      " "         delimited size
                                      cli-nome    delimited size
                                 into col-cliente-1
                             end-string
                         end-read       
                         move app-stato  to col-stato-1
                         move app-pagato to col-pag-1

                         perform COMPONI-RECUPERO
                         move como-recupero to col-recupero-1

                         modify gd-app(riga, 1), hidden-data = 
           app-chiave
                         modify gd-app(riga, 1), cell-data = col-ora-1
                         modify gd-app(riga, 2), cell-data = col-stato-1
                         modify gd-app(riga, 3), cell-data = col-pag-1
                         modify gd-app(riga, 4), cell-data = 
           col-cliente-1
                         modify gd-app(riga, 5), cell-data = 
           col-recupero-1
                    when 2
                         move app-ora to col-ora-2
                         move app-cliente to cli-codice
                         read clienti no lock 
                              invalid move "NON TROVATO" to 
           col-cliente-2
                          not invalid  
                              initialize col-cliente-2
                              inspect cli-cognome replacing trailing 
           spaces by low-value
                              string  cli-cognome delimited low-value
                                      " "         delimited size
                                      cli-nome    delimited size
                                 into col-cliente-2
                             end-string
                         end-read       
                         move app-stato  to col-stato-2
                         move app-pagato to col-pag-2  

                         perform COMPONI-RECUPERO
                         move como-recupero to col-recupero-2

                         modify gd-app(riga, 6), hidden-data = 
           app-chiave
                         modify gd-app(riga, 6), cell-data = col-ora-2
                         modify gd-app(riga, 7), cell-data = col-stato-2
                         modify gd-app(riga, 8), cell-data = col-pag-2
                         modify gd-app(riga, 9), cell-data = 
           col-cliente-2
                         modify gd-app(riga, 10), cell-data = 
           col-recupero-2
                    when 3
                         move app-ora to col-ora-3
                         move app-cliente to cli-codice
                         read clienti no lock 
                              invalid move "NON TROVATO" to 
           col-cliente-3
                          not invalid  
                              initialize col-cliente-3
                              inspect cli-cognome replacing trailing 
           spaces by low-value
                              string  cli-cognome delimited low-value
                                      " "         delimited size
                                      cli-nome    delimited size
                                 into col-cliente-3
                             end-string
                         end-read       
                         move app-stato  to col-stato-3
                         move app-pagato to col-pag-3  

                         perform COMPONI-RECUPERO
                         move como-recupero to col-recupero-3

                         modify gd-app(riga, 11), hidden-data = 
           app-chiave
                         modify gd-app(riga, 11), cell-data = col-ora-3
                         modify gd-app(riga, 12), cell-data = 
           col-stato-3
                         modify gd-app(riga, 13), cell-data = col-pag-3
                         modify gd-app(riga, 14), cell-data = 
           col-cliente-3
                         modify gd-app(riga, 15), cell-data = 
           col-recupero-3
                    when 4
                         move app-ora to col-ora-4
                         move app-cliente to cli-codice
                         read clienti no lock 
                              invalid move "NON TROVATO" to 
           col-cliente-4
                          not invalid  
                              initialize col-cliente-4
                              inspect cli-cognome replacing trailing 
           spaces by low-value
                              string  cli-cognome delimited low-value
                                      " "         delimited size
                                      cli-nome    delimited size
                                 into col-cliente-4
                             end-string
                         end-read       
                         move app-stato  to col-stato-4
                         move app-pagato to col-pag-4    

                         perform COMPONI-RECUPERO
                         move como-recupero to col-recupero-4

                         modify gd-app(riga, 16), hidden-data = 
           app-chiave
                         modify gd-app(riga, 16), cell-data = col-ora-4
                         modify gd-app(riga, 17), cell-data = 
           col-stato-4
                         modify gd-app(riga, 18), cell-data = col-pag-4
                         modify gd-app(riga, 19), cell-data = 
           col-cliente-4
                         modify gd-app(riga, 20), cell-data = 
           col-recupero-4
                    when 5
                         move app-ora to col-ora-5
                         move app-cliente to cli-codice
                         read clienti no lock 
                              invalid move "NON TROVATO" to 
           col-cliente-5
                          not invalid  
                              initialize col-cliente-5
                              inspect cli-cognome replacing trailing 
           spaces by low-value
                              string  cli-cognome delimited low-value
                                      " "         delimited size
                                      cli-nome    delimited size
                                 into col-cliente-5
                             end-string
                         end-read       
                         move app-stato  to col-stato-5
                         move app-pagato to col-pag-5   

                         perform COMPONI-RECUPERO
                         move como-recupero to col-recupero-5

                         modify gd-app(riga, 21), hidden-data = 
           app-chiave
                         modify gd-app(riga, 21), cell-data = col-ora-5
                         modify gd-app(riga, 22), cell-data = 
           col-stato-5
                         modify gd-app(riga, 23), cell-data = col-pag-5
                         modify gd-app(riga, 24), cell-data = 
           col-cliente-5
                         modify gd-app(riga, 25), cell-data = 
           col-recupero-5
                    when 6
                         move app-ora to col-ora-6
                         move app-cliente to cli-codice
                         read clienti no lock 
                              invalid move "NON TROVATO" to 
           col-cliente-6
                          not invalid  
                              initialize col-cliente-6
                              inspect cli-cognome replacing trailing 
           spaces by low-value
                              string  cli-cognome delimited low-value
                                      " "         delimited size
                                      cli-nome    delimited size
                                 into col-cliente-6
                             end-string
                         end-read       
                         move app-stato  to col-stato-6
                         move app-pagato to col-pag-6    

                         perform COMPONI-RECUPERO
                         move como-recupero to col-recupero-6
              
                         modify gd-app(riga, 26), hidden-data = 
           app-chiave
                         modify gd-app(riga, 26), cell-data = col-ora-6
                         modify gd-app(riga, 27), cell-data = 
           col-stato-6
                         modify gd-app(riga, 28), cell-data = col-pag-6
                         modify gd-app(riga, 29), cell-data = 
           col-cliente-6
                         modify gd-app(riga, 30), cell-data = 
           col-recupero-6
                    end-evaluate
                 end-perform
           end-start    
           .
      * <TOTEM:END>

       CERCA.
      * <TOTEM:PARA. CERCA>
      *****     evaluate control-id
      *****     when 78-ID-ef-iva
      *****          inquire ef-iva, value in iva-codice
      *****          move "codiva"       to como-File
      *****          call   "zoom-gt" using como-file, iva-rec
      *****                          giving stato-zoom
      *****          cancel "zoom-gt"
      *****          if stato-zoom = 0
      *****             move iva-codice      to  ef-iva-buf
      *****             move iva-descrizione to lab-iva-buf
      *****             display ef-iva lab-iva
      *****          end-if
      *****     end-evaluate 
           .
      * <TOTEM:END>

       CERCA-APPUNTAMENTO.
      * <TOTEM:PARA. CERCA-APPUNTAMENTO>
           move spaces to app-cliente
           move 0      to app-prog.
           start appuntamenti key >= app-chiave
                 invalid continue 
             not invalid
                 read appuntamenti next
                 if app-data = como-data and
                    app-ora  = como-ora  and
                    app-cliente = ef-cliente-buf
                    display message "E' già presente un appuntamento"
                             x"0d0a""per i dati inseriti."
                             x"0d0a""Aggiungere comunque?"
                               type mb-yes-no
                             default mb-no
                               title titolo
                              giving scelta
                                icon 2
                    if scelta = mb-no
                       move 26 to key-status
                    end-if
                 else
                    if app-data = como-data and
                       app-ora  = como-ora

                       move app-cliente to cli-codice
                       read clienti no lock
                       initialize como-cliente
                       inspect cli-cognome replacing trailing spaces by 
           low-value
                       string cli-cognome delimited low-value
                              " "         delimited size
                              cli-nome    delimited size
                         into como-cliente
                       end-string
                       display message "E' già presente un appuntamento"
                                x"0d0a""per i dati inseriti con il clien
      -    "te"
                                x"0d0a" como-cliente
                                x"0d0a""Aggiungere comunque?"
                                  type mb-yes-no
                                default mb-no
                                  title titolo
                                 giving scelta
                                   icon 2
                       if scelta = mb-no
                          move 26 to key-status
                       end-if
                    end-if
                 end-if
           end-start 
           .
      * <TOTEM:END>

       COMPONI-RECUPERO.
      * <TOTEM:PARA. COMPONI-RECUPERO>
           initialize como-recupero.
           if app-recup-data not = 0 
              if app-vuoto or app-assente
                 initialize como-recupero
                 string "AL "               delimited size
                        app-recup-data(7:2) delimited size
                        "/"                 delimited size
                        app-recup-data(5:2) delimited size
                        "/"                 delimited size
                        app-recup-data(1:4) delimited size
                        " - "               delimited size
                        app-recup-ora(1:2)  delimited size
                        "."                 delimited size
                        app-recup-ora(3:2)  delimited size
                   into como-recupero
                 end-string
              else
                 initialize como-recupero
                 string "DEL "              delimited size
                        app-recup-data(7:2) delimited size
                        "/"                 delimited size
                        app-recup-data(5:2) delimited size
                        "/"                 delimited size
                        app-recup-data(1:4) delimited size
                        " - "               delimited size
                        app-recup-ora(1:2)  delimited size
                        "."                 delimited size
                        app-recup-ora(3:2)  delimited size
                   into como-recupero
                 end-string
              end-if
           end-if 
           .
      * <TOTEM:END>

       CONTROLLO-AR.
      * <TOTEM:PARA. CONTROLLO-AR>
           set tutto-ok to true.
      
           evaluate CONTROL-ID  
           when 78-ID-ef-dal-ar
                inquire ef-dal-ar, value in ef-dal-ar-buf
                move ef-dal-ar-buf to como-data
                perform DATE-FORMAT
                move como-data to ef-dal-ar-buf
                display ef-dal-ar

           when 78-ID-ef-al-ar
                inquire ef-al-ar, value in ef-al-ar-buf
                move ef-al-ar-buf to como-data
                perform DATE-FORMAT
                move como-data to ef-al-ar-buf
                display ef-al-ar              

                inquire ef-al-ar, value in ef-al-ar-buf
                move ef-al-ar-buf to como-data
                perform DATE-TO-FILE
                move como-data to como-data-a 

                inquire ef-dal-ar, value in ef-dal-ar-buf
                move ef-dal-ar-buf to como-data
                perform DATE-TO-FILE
                move como-data to como-data-da

                if como-data-da > como-data-a
                   set errori to true
                   display message "Periodo errato"
                             title tit-err
                              icon 2
                   move 78-ID-ef-dal-ar to control-id
                end-if   

           when 78-ID-ef-ora-ar
                inquire ef-ora-ar, value in ef-ora-ar-buf
                move ef-ora-ar-buf to como-ora
                if como-ora > 2400 or como-ora = 0
                   set errori to true
                end-if                   

           when 78-ID-ef-cliente-ar
                inquire ef-cliente-ar, value in cli-codice
                read clienti no lock
                     invalid 
                     set errori to true
                     display message "Cliente non valido"
                               title tit-err
                                icon 2
                     move spaces to lab-cliente-ar-buf
                     move 4 to accept-control
                 not invalid
                     initialize lab-cliente-ar-buf
                     inspect cli-cognome replacing trailing spaces by 
           low-value
                     string  cli-cognome delimited low-value
                             " "         delimited size
                             cli-nome    delimited size
                        into lab-cliente-ar-buf
                     end-string
                end-read
                display lab-cliente-ar
           end-evaluate.
      
           if errori
              perform CANCELLA-COLORE
              move control-id to store-id
              move 4          to accept-control
           end-if 
           .
      * <TOTEM:END>

       CONTROLLO-C.
      * <TOTEM:PARA. CONTROLLO-C>
           set tutto-ok to true.
      
           evaluate CONTROL-ID   
           when 78-ID-ef-dal-c
                inquire ef-dal-c, value in ef-dal-c-buf
                move ef-dal-c-buf to como-data
                perform DATE-FORMAT
                move como-data to ef-dal-c-buf
                display ef-dal-c

           when 78-ID-ef-al-c
                inquire ef-al-c, value in ef-al-c-buf
                move ef-al-c-buf to como-data
                perform DATE-FORMAT
                move como-data to ef-al-c-buf
                display ef-al-c

                inquire ef-al-c, value in ef-al-c-buf
                move ef-al-c-buf to como-data
                perform DATE-TO-FILE
                move como-data to como-data-a 

                inquire ef-dal-c, value in ef-dal-c-buf
                move ef-dal-c-buf to como-data
                perform DATE-TO-FILE
                move como-data to como-data-da

                if como-data-da > como-data-a
                   set errori to true
                   display message "Periodo errato"
                             title tit-err
                              icon 2
                   move 78-ID-ef-dal-c to control-id
                end-if                   

           when 78-ID-ef-cliente-c
                inquire ef-cliente-c, value in cli-codice
                read clienti no lock
                     invalid 
                     move low-value to cli-codice
                     inquire ef-cliente-c, value in cli-ragsoc
                     start clienti key >= cli-ragsoc
                           invalid set errori to true
                       not invalid
                           read clienti next
                           if cli-ragsoc = ef-cliente-c-buf
                              modify ef-cliente-c, value cli-codice
                              initialize lab-cliente-c-buf
                              inspect cli-cognome replacing trailing 
           spaces by low-value
                              string  cli-cognome delimited low-value
                                      " "         delimited size
                                      cli-nome    delimited size
                                 into lab-cliente-c-buf
                              end-string
                           else
                              move "clienti-alfa" to como-file
                              call   "zoom-gt" using como-file, cli-rec
                                              giving stato-zoom
                              cancel "zoom-gt"
                              if stato-zoom = 0
                                 modify ef-cliente-c, value cli-codice
                                 move 78-ID-ef-cliente-c to control-id
                                 initialize lab-cliente-c-buf
                                 inspect cli-cognome replacing trailing 
           spaces by low-value
                                 string  cli-cognome delimited low-value
                                         " "         delimited size
                                         cli-nome    delimited size
                                    into lab-cliente-c-buf
                                 end-string
                              else
                                 set errori to true
                              end-if
                           end-if
                     end-start
                     if errori
                        set errori to true
                        display message "Cliente non valido"
                                  title tit-err
                                   icon 2
                        move spaces to lab-cliente-c-buf
                        move 4 to accept-control
                     end-if
                 not invalid
                     initialize lab-cliente-c-buf
                     inspect cli-cognome replacing trailing spaces by 
           low-value
                     string  cli-cognome delimited low-value
                             " "         delimited size
                             cli-nome    delimited size
                        into lab-cliente-c-buf
                     end-string
                end-read
                display lab-cliente-c
           end-evaluate.
      
           if errori
              perform CANCELLA-COLORE
              move control-id to store-id
              move 4          to accept-control
           end-if 
           .
      * <TOTEM:END>

       CONTROLLO-CR.
      * <TOTEM:PARA. CONTROLLO-CR>
           set tutto-ok to true.
      
           evaluate CONTROL-ID   
           when 78-ID-ef-dal-cr
                inquire ef-dal-cr, value in ef-dal-cr-buf
                move ef-dal-cr-buf to como-data
                perform DATE-FORMAT
                move como-data to ef-dal-cr-buf
                display ef-dal-cr

           when 78-ID-ef-al-cr
                inquire ef-al-cr, value in ef-al-cr-buf
                move ef-al-cr-buf to como-data
                perform DATE-FORMAT
                move como-data to ef-al-cr-buf
                display ef-al-cr              

                inquire ef-al-cr, value in ef-al-cr-buf
                move ef-al-cr-buf to como-data
                perform DATE-TO-FILE
                move como-data to como-data-a 

                inquire ef-dal-cr, value in ef-dal-cr-buf
                move ef-dal-cr-buf to como-data
                perform DATE-TO-FILE
                move como-data to como-data-da

                if como-data-da > como-data-a
                   set errori to true
                   display message "Periodo errato"
                             title tit-err
                              icon 2
                   move 78-ID-ef-dal-cr to control-id
                end-if                   

           when 78-ID-ef-cliente-cr
                inquire ef-cliente-cr, value in cli-codice
                read clienti no lock
                     invalid 
                     set errori to true
                     display message "Cliente non valido"
                               title tit-err
                                icon 2
                     move spaces to lab-cliente-cr-buf
                     move 4 to accept-control
                 not invalid
                     initialize lab-cliente-cr-buf
                     inspect cli-cognome replacing trailing spaces by 
           low-value
                     string  cli-cognome delimited low-value
                             " "         delimited size
                             cli-nome    delimited size
                        into lab-cliente-cr-buf
                     end-string
                end-read
                display lab-cliente-cr
           end-evaluate.
      
           if errori
              perform CANCELLA-COLORE
              move control-id to store-id
              move 4          to accept-control
           end-if 
           .
      * <TOTEM:END>

       CONTROLLO-REC.
      * <TOTEM:PARA. CONTROLLO-REC>
           set tutto-ok to true.
      
           evaluate CONTROL-ID
           when 78-ID-ef-data-rec
                inquire ef-data-rec, value in ef-data-rec-buf
                move ef-data-rec-buf to como-data
                perform DATE-FORMAT
                move como-data to ef-data-rec-buf
                display ef-data-rec
                perform DATE-TO-FILE
                perform TROVA-GIORNO
                if giorno = 7
                   set errori to true
                   display message "Impossibile lavorare anche di domeni
      -    "ca"
                             title tit-err
                              icon 2
                end-if   

           when 78-ID-ef-ora-rec
                inquire ef-ora-rec, value in ef-ora-rec-buf
                move ef-ora-rec-buf to como-ora
                if como-ora > 2400 or como-ora = 0
                   set errori to true
                end-if                   
           end-evaluate.
      
           if errori
              perform CANCELLA-COLORE
              move control-id to store-id
              move 4          to accept-control
           end-if 
           .
      * <TOTEM:END>

       CONTROLLO-T.
      * <TOTEM:PARA. CONTROLLO-T>
           set tutto-ok to true.
      
           evaluate CONTROL-ID   
           when 78-ID-ef-dal-t
                inquire ef-dal-t, value in ef-dal-t-buf
                move ef-dal-t-buf to como-data
                if como-data not = 0
                   perform DATE-FORMAT
                   move como-data to ef-dal-t-buf
                   display ef-dal-t
                end-if

           when 78-ID-ef-al-t
                inquire ef-al-t, value in ef-al-t-buf
                move ef-al-t-buf to como-data
                if como-data = 0
                   move 99999999 to como-data
                   move como-data to ef-al-t-buf
                   display ef-al-t
                end-if

                if como-data not = 99999999
                   perform DATE-FORMAT
                   move como-data to ef-al-t-buf
                   display ef-al-t
                end-if

                inquire ef-al-t, value in ef-al-t-buf
                move ef-al-t-buf to como-data
                perform DATE-TO-FILE
                move como-data to como-data-a

                inquire ef-dal-t, value in ef-dal-t-buf
                move ef-dal-t-buf to como-data
                perform DATE-TO-FILE
                move como-data to como-data-da

                if como-data-da > como-data-a
                   set errori to true
                   display message "Periodo errato"
                             title tit-err
                              icon 2
                   move 78-ID-ef-dal-t to control-id
                end-if                   

           when 78-ID-ef-cliente-t
                inquire ef-cliente-t, value in cli-codice
                if cli-codice = spaces
                   move "TUTTI I CLIENTI" to lab-cliente-t-buf
                else
                   read clienti no lock
                        invalid 
                        move low-value to cli-codice
                        inquire ef-cliente-t value in cli-ragsoc
                        start clienti key >= cli-ragsoc
                              invalid set errori to true
                          not invalid         
                              read clienti next
                              if cli-ragsoc = ef-cliente-t-buf
                                 modify ef-cliente-t, value cli-codice
                                 initialize lab-cliente-t-buf
                                 inspect cli-cognome replacing trailing 
           spaces by low-value
                                 string  cli-cognome delimited low-value
                                         " "         delimited size
                                         cli-nome    delimited size
                                    into lab-cliente-t-buf
                                 end-string
                              else
                                 move "clienti-alfa" to como-file
                                 call "zoom-gt" using como-file, cli-rec
                                               giving stato-zoom
                                 cancel "zoom-gt"
                                 if stato-zoom = 0
                                    modify ef-cliente-t, value 
           cli-codice
                                    move 78-ID-ef-cliente-t to 
           control-id
                                    initialize lab-cliente-t-buf
                                    inspect cli-cognome replacing 
           trailing spaces by low-value
                                    string  cli-cognome delimited 
           low-value
                                            " "         delimited size
                                            cli-nome    delimited size
                                       into lab-cliente-t-buf
                                    end-string
                                 else
                                    set errori to true
                                 end-if
                              end-if
                        end-start
                        if errori
                           display message "Cliente non valido"
                                     title titolo
                                      icon 2
                           move spaces to lab-cliente-buf
                           move 4 to accept-control
                        end-if
                    not invalid
                        initialize lab-cliente-t-buf
                        inspect cli-cognome replacing trailing spaces 
           by low-value
                        string  cli-cognome delimited low-value
                                " "         delimited size
                                cli-nome    delimited size
                           into lab-cliente-t-buf
                        end-string
                   end-read
                end-if
                display lab-cliente-t
           end-evaluate.
      
           if errori
              perform CANCELLA-COLORE
              move control-id to store-id
              move 4          to accept-control
           end-if 
           .
      * <TOTEM:END>

       CONTROLLO-V.
      * <TOTEM:PARA. CONTROLLO-V>
           set tutto-ok to true.
      
           evaluate CONTROL-ID   
           when 78-ID-ef-dal-v
                inquire ef-dal-v, value in ef-dal-v-buf
                move ef-dal-v-buf to como-data
                if como-data not = 0
                   perform DATE-FORMAT
                   move como-data to ef-dal-v-buf
                   display ef-dal-v
                end-if
                perform DATE-TO-FILE
                move como-data to como-data-da
           end-evaluate.

           if errori
              perform CANCELLA-COLORE
              move control-id to store-id
              move 4          to accept-control
           end-if 
           .
      * <TOTEM:END>

       CONTROLLO-SINGOLO.
      * <TOTEM:PARA. CONTROLLO-SINGOLO>
           set tutto-ok to true.
      
           evaluate CONTROL-ID
           when 78-ID-ef-data
                inquire ef-data, value in ef-data-buf
                move ef-data-buf to como-data
                perform DATE-FORMAT
                move como-data to ef-data-buf
                display ef-data
                perform DATE-TO-FILE
                perform TROVA-GIORNO
                if giorno = 7
                   set errori to true
                   display message "Impossibile lavorare anche di domeni
      -    "ca"
                             title tit-err
                              icon 2
                end-if   

           when 78-ID-ef-ora     
                inquire ef-ora, value in ef-ora-buf
                move ef-ora-buf to como-ora
                if como-ora > 2400 or como-ora = 0
                   set errori to true
                end-if                   

           when 78-ID-ef-cliente
                inquire ef-cliente, value in cli-codice
                read clienti no lock
                     invalid    
                     move low-value to cli-codice
                     inquire ef-cliente, value in cli-ragsoc
                     start clienti key >= cli-ragsoc
                           invalid set errori to true
                       not invalid
                           read clienti next
                           if cli-ragsoc = ef-cliente-buf
                              modify ef-cliente, value cli-codice
                              initialize lab-cliente-buf
                              inspect cli-cognome replacing trailing 
           spaces by low-value
                              string  cli-cognome delimited low-value
                                      " "         delimited size
                                      cli-nome    delimited size
                                 into lab-cliente-buf
                              end-string
                           else
                              move "clienti-alfa" to como-file
                              call   "zoom-gt" using como-file, cli-rec
                                              giving stato-zoom
                              cancel "zoom-gt"
                              if stato-zoom = 0
                                 modify ef-cliente, value cli-codice
                                 move 78-ID-ef-cliente to control-id
                                 initialize lab-cliente-buf
                                 inspect cli-cognome replacing trailing 
           spaces by low-value
                                 string  cli-cognome delimited low-value
                                         " "         delimited size
                                         cli-nome    delimited size
                                    into lab-cliente-buf
                                 end-string
                              else
                                 set errori to true
                              end-if
                           end-if
                     end-start
                     if errori
                        set errori to true
                        display message "Cliente non valido"
                                  title tit-err
                                   icon 2
                        move spaces to lab-cliente-buf
                        move 4 to accept-control
                     end-if
                 not invalid
                     initialize lab-cliente-buf
                     inspect cli-cognome replacing trailing spaces by 
           low-value
                     string  cli-cognome delimited low-value
                             " "         delimited size
                             cli-nome    delimited size
                        into lab-cliente-buf
                     end-string
                end-read
                display lab-cliente
           end-evaluate.
      
           if errori
              perform CANCELLA-COLORE
              move control-id to store-id
              move 4          to accept-control
           end-if 
           .
      * <TOTEM:END>

       ELABORA-TEST.
      * <TOTEM:PARA. ELABORA-TEST>
           perform varying control-id from 78-id-ef-dal-v by 1 
                     until control-id > 78-id-ef-dal-v
              perform CONTROLLO-V
              if errori
                 exit perform
              end-if
           end-perform.

           if errori
              exit paragraph
           end-if.

           modify gd-verifica, reset-grid = 1, mass-update = 1.
           perform GD-VERIFICA-CONTENT.

           move high-value to app-rec.
           start appuntamenti key <= k-clidata
                 invalid continue
             not invalid
                 move 1 to riga
                 move 0 to presenze
                 move spaces to sav-cliente
                 perform until 1 = 2
                    read appuntamenti previous
                      at end
                      if sav-cliente not = spaces
                         perform AGGIUNGI-RIGA
                      end-if
                      exit perform
                    end-read
                    add 1 to counter counter2
                    if counter = 10
                       move 0 to counter
                       move counter2 to lab-attesa-buf
                       display lab-attesa
                    end-if

                    if app-cliente not = sav-cliente
                       if sav-cliente not = spaces
                          perform AGGIUNGI-RIGA
                       end-if
                       move 0 to presenze last-data
                       move app-cliente to sav-cliente
                    end-if
                    if app-presente or app-recupero 
                       if app-data >= como-data-da
                          if last-data = 0
                             move app-data to last-data
                          end-if
                          add 1 to presenze
                       end-if
                    end-if

                    if app-test or app-data < como-data-da
                       perform AGGIUNGI-RIGA
                       move low-value to app-data app-ora
                       move spaces to app-stato
                       start appuntamenti key <= k-clidata
                             invalid exit perform
                       end-start
                       move spaces to sav-cliente
                    end-if
                 end-perform
           end-start.
           modify gd-verifica, mass-update = 0.

      ***---
       AGGIUNGI-RIGA.
           if presenze = 0 exit paragraph end-if.
           if chk-solo-test-buf = 1 and presenze < 12
              exit paragraph
           end-if.
           move sav-cliente to cli-codice
           read clienti no lock
                invalid move "NON TROVATO" to cli-cognome
                        move spaces to cli-nome
           end-read.
           initialize col-cliente-v. 
           inspect cli-cognome replacing trailing spaces by low-value
           string  cli-cognome delimited low-value
                   " "         delimited size
                   cli-nome    delimited size
              into col-cliente-v
           end-string.
           move presenze to col-presenze-v.
           add 1 to riga.
           modify gd-verifica(riga, 1), hidden-data app-chiave.
           modify gd-verifica(riga, 1), cell-data col-cliente-v
           modify gd-verifica(riga, 2), cell-data col-presenze-v
           if presenze > 12
              modify gd-verifica(riga, 2), row-color 13
           else                                            
              modify gd-verifica(riga, 2), row-color 1
           end-if.
           initialize col-ultima-v.
           string last-data(7:2) delimited size
                  "/"            delimited size
                  last-data(5:2) delimited size
                  "/"            delimited size
                  last-data(1:4) delimited size
             into col-ultima-v
           end-string.
           modify gd-verifica(riga, 3), cell-data col-ultima-v 
           .
      * <TOTEM:END>

       INTESTAZIONE-DATE.
      * <TOTEM:PARA. INTESTAZIONE-DATE>
           move start-data to como-data.

           perform varying idx from 1 by 1 
                     until idx > 6
              if idx > 1
                 perform ADD-GIORNO
              end-if
              perform ASSEGNA-GIORNO 
              perform DATE-TO-SCREEN 
              move como-data to col-data(idx)
              perform DATE-TO-FILE
           end-perform.
                      
           move 1 to idx.
           perform COMPONI-GIORNO.
           modify gd-app(1, 4),  cell-data = como-giorno.
                       
           move 2 to idx.
           perform COMPONI-GIORNO.
           modify gd-app(1, 9),  cell-data = como-giorno.
                                                      
           move 3 to idx.
           perform COMPONI-GIORNO.
           modify gd-app(1, 14),  cell-data = como-giorno.              
                 

           move 4 to idx.
           perform COMPONI-GIORNO.
           modify gd-app(1, 19),  cell-data = como-giorno.
           
           move 5 to idx.
           perform COMPONI-GIORNO.
           modify gd-app(1, 24),  cell-data = como-giorno.
                 
           move 6 to idx.
           perform COMPONI-GIORNO.
           modify gd-app(1, 29),  cell-data = como-giorno.

      ***---
       ASSEGNA-GIORNO.
           perform TROVA-GIORNO.
           evaluate giorno
           when 1 move "LUN" to como-giorno
           when 2 move "MAR" to como-giorno
           when 3 move "MER" to como-giorno
           when 4 move "GIO" to como-giorno
           when 5 move "VEN" to como-giorno
           when 6 move "SAB" to como-giorno
           end-evaluate.
           move como-giorno to col-giorno(idx).

      ***---
       COMPONI-GIORNO.                                
           initialize como-giorno.
           string col-giorno(idx) delimited size
                  " - "           delimited size
                  col-data(idx)   delimited size
             into como-giorno 
           end-string 
           .
      * <TOTEM:END>

       PARAGRAFO-COPY.
      * <TOTEM:PARA. PARAGRAFO-COPY>
           copy "color-custom.cpy".   
           copy "utydata.cpy" 
           .
      * <TOTEM:END>

       RESET-APPUNTAMENTI.
      * <TOTEM:PARA. RESET-APPUNTAMENTI>
           perform varying colonna from 1 by 1 
                     until colonna = 7
              perform RESET-GIORNO
           end-perform 
           .
      * <TOTEM:END>

       RESET-GIORNO.
      * <TOTEM:PARA. RESET-GIORNO>
           inquire gd-app, last-row in tot-righe.
           perform varying riga from 3 by 1 
                     until riga > tot-righe
              evaluate colonna
              when 1 
                   move 0 to col-ora-1 
                   move spaces to col-stato-1 col-pag-1 
                                  col-cliente-1 col-recupero-1       
                   modify gd-app(riga, 1), cell-data = col-ora-1
                                         hidden-data = spaces
                   modify gd-app(riga, 2), cell-data = col-stato-1
                   modify gd-app(riga, 3), cell-data = col-pag-1
                   modify gd-app(riga, 4), cell-data = col-cliente-1
                   modify gd-app(riga, 5), cell-data = col-recupero-1

              when 2 
                   move 0 to col-ora-2 
                   move spaces to col-stato-2 col-pag-2
                                  col-cliente-2 col-recupero-2
                   modify gd-app(riga, 6),  cell-data = col-ora-2
                                          hidden-data = spaces
                   modify gd-app(riga, 7),  cell-data = col-stato-2
                   modify gd-app(riga, 8),  cell-data = col-pag-2
                   modify gd-app(riga, 9),  cell-data = col-cliente-2
                   modify gd-app(riga, 10), cell-data = col-recupero-2

              when 3 
                   move 0 to col-ora-3 
                   move spaces to col-stato-3 col-pag-3
                                  col-cliente-3 col-recupero-3
                   modify gd-app(riga, 11), cell-data = col-ora-3
                                          hidden-data = spaces
                   modify gd-app(riga, 12), cell-data = col-stato-3
                   modify gd-app(riga, 13), cell-data = col-pag-3
                   modify gd-app(riga, 14), cell-data = col-cliente-3
                   modify gd-app(riga, 15), cell-data = col-recupero-3

              when 4 
                   move 0 to col-ora-4 
                   move spaces to col-stato-4 col-pag-4
                                  col-cliente-4 col-recupero-4
                   modify gd-app(riga, 16), cell-data = col-ora-4
                                          hidden-data = spaces
                   modify gd-app(riga, 17), cell-data = col-stato-4
                   modify gd-app(riga, 18), cell-data = col-pag-4
                   modify gd-app(riga, 19), cell-data = col-cliente-4
                   modify gd-app(riga, 20), cell-data = col-recupero-4

              when 5 
                   move 0 to col-ora-5 
                   move spaces to col-stato-5 col-pag-5
                                  col-cliente-5 col-recupero-5
                   modify gd-app(riga, 21), cell-data = col-ora-5 
                                          hidden-data = spaces
                   modify gd-app(riga, 22), cell-data = col-stato-5
                   modify gd-app(riga, 23), cell-data = col-pag-5
                   modify gd-app(riga, 24), cell-data = col-cliente-5
                   modify gd-app(riga, 25), cell-data = col-recupero-5

              when 6 
                   move 0 to col-ora-6 
                   move spaces to col-stato-6 col-pag-6
                                  col-cliente-6 col-recupero-6
                   modify gd-app(riga, 26), cell-data = col-ora-6 
                                          hidden-data = spaces
                   modify gd-app(riga, 27), cell-data = col-stato-6
                   modify gd-app(riga, 28), cell-data = col-pag-6
                   modify gd-app(riga, 29), cell-data = col-cliente-6
                   modify gd-app(riga, 30), cell-data = col-recupero-6
              end-evaluate
           end-perform 
           .
      * <TOTEM:END>

       SALVA.
      * <TOTEM:PARA. SALVA>
      *****     if mod = 0 exit paragraph end-if.
      *****
      *****     set tutto-ok to true.
      *****
      *****     perform varying CONTROL-ID from 78-ID-ef-anno by 1
      *****               until CONTROL-ID > 78-ID-ef-data-n
      *****        perform CONTROLLO
      *****        if errori exit perform end-if
      *****     end-perform.
      *****
      *****     if tutto-ok
      *****        set vecchio       to true
      *****
      *****        perform FORM1-BUF-TO-FLD
      *****        perform CANCELLA-COLORE 
      *****        write prm-rec invalid rewrite prm-rec end-write
      ***** 
      *****        set vecchio to true       
      *****        perform TORNA-IN-VISUA            
      *****     end-if.   
      *****           
      *****     perform DISPLAY-SCREEN 
           .
      * <TOTEM:END>

       SPOSTA-GIORNO.
      * <TOTEM:PARA. SPOSTA-GIORNO>
           move riga      to new-riga.
           move como-riga to old-riga.

           initialize old-app-chiave new-app-chiave
                      replacing numeric data by zeroes
                           alphanumeric data by spaces.

           evaluate colonna
           when  1 thru 5
                move 1 to colonna
                inquire gd-app(riga, 1), 
                        hidden-data old-app-chiave
                inquire gd-app(como-riga, 1), 
                        hidden-data new-app-chiave
           when  6 thru 10       
                move 2 to colonna                                      
                inquire gd-app(riga, 6), 
                        hidden-data old-app-chiave
                inquire gd-app(como-riga, 6), 
                        hidden-data new-app-chiave
           when 11 thru 15                                             
                move 3 to colonna
                inquire gd-app(riga, 11), 
                        hidden-data old-app-chiave
                inquire gd-app(como-riga, 11), 
                        hidden-data new-app-chiave
           when 16 thru 20                                             
                move 4 to colonna
                inquire gd-app(riga, 16), 
                        hidden-data old-app-chiave
                inquire gd-app(como-riga, 16), 
                        hidden-data new-app-chiave
           when 21 thru 25                                             
                move 5 to colonna
                inquire gd-app(riga, 21), 
                        hidden-data old-app-chiave
                inquire gd-app(como-riga, 21), 
                        hidden-data new-app-chiave
           when 26 thru 30                                             
                move 6 to colonna
                inquire gd-app(riga, 26), 
                        hidden-data old-app-chiave
                inquire gd-app(como-riga, 26), 
                        hidden-data new-app-chiave
           end-evaluate.             

           if old-app-cliente = spaces or new-app-cliente = spaces |sono su una riga vuota o è vuota la destinazione
              exit paragraph
           end-if.
           move new-app-chiave to app-chiave.
           read appuntamenti no lock. |leggo i dati nuovi
           move app-dati to dati-new. |salvo i dati nuovi

           move old-app-chiave to app-chiave.
           read appuntamenti no lock. |leggo i dati vecchi
           move app-dati to dati-old. |salvo i dati vecchi

           move old-app-chiave to app-chiave. |valorizzo la vecchia chiave
           delete appuntamenti record.        |cancello i vecchi
                                                                        
                        
           move new-app-cliente to app-cliente |assegno il nuovo cliente alla vecchia
           move new-app-prog    to app-prog    |assegno il nuovo prog alla vecchia
           move dati-new        to app-dati.   |con i dati nuovi
           write app-rec |Aggiungo il vecchio
                 invalid rewrite app-rec end-rewrite |se c'è già la aggiorno
             not invalid |Altrimenti la cancello
                 move new-app-chiave to app-chiave |valorizzo la nuova chiave
                 delete appuntamenti record        |cancello i nuovi
           end-write.   
                                           
           move old-app-cliente to app-cliente |assegno il vecchio cliente alla nuova
           move old-app-prog    to app-prog |assegno il vecchio prog alla nuova
           move dati-old        to app-dati.   |con i dati vecchi
           write app-rec invalid rewrite app-rec end-write.  |e scrivo i vecchi 
               
           move col-data(colonna) to como-data
           perform DATE-TO-FILE
           move como-data to sav-data
      
           perform AGGIORNA-GIORNO. 

           |Riallineo gli appuntamenti con i recuperi e viceversa
           evaluate colonna
           when 1 move 1  to colonna
           when 2 move 6  to colonna                                    
             
           when 3 move 11 to colonna
           when 4 move 16 to colonna
           when 5 move 21 to colonna
           when 6 move 26 to colonna
           end-evaluate.          

           inquire gd-app, last-row in tot-righe.
           perform varying riga from 3 by 1 
                     until riga > tot-righe 
              inquire gd-app(riga, colonna), hidden-data in app-chiave
              if app-cliente = spaces exit perform end-if
              read appuntamenti no lock
              |Se trovo un recupero o un appuntamento recuperato
              if app-recupero or  
               ( app-vuoto and app-recup-data not = 0 )
                 |Salvo la k di origine
                 move app-chiave     to sav-chiave
                 move app-recup-data to app-data
                 move app-recup-ora  to app-ora
                 move app-recup-prog to app-prog
                 |leggo l'appuntamento/recupero relativo
                 read appuntamenti no lock
                 move sav-data to app-recup-data
                 move sav-ora  to app-recup-ora
                 move sav-prog to app-recup-prog
                 |aggiorno i dati di collegamento con la k origine
                 rewrite app-rec
              end-if
           end-perform.
 
           move col-data(1) to como-data.
           perform DATE-TO-FILE.
           move como-data to start-data.

           perform AGGIORNA-APPUNTAMENTI.  

           move como-riga to event-data-2.
           modify  gd-app, cursor-y como-riga.
           inquire gd-app, cursor-x in event-data-1.
           perform COLORA-RIGA       
         
           
           .
      * <TOTEM:END>

       SPOSTAMENTO.
      * <TOTEM:PARA. SPOSTAMENTO>
           perform COLORA-RIGA.
                  

      ***---
       COLORA-RIGA.
           evaluate event-data-1
           when  1 thru 5
                modify gd-app, start-y = event-data-2, y = event-data-2,
                               start-x = 1, x = 5,
                               region-color = 357
           when  6 thru 10                       
                modify gd-app, start-y = event-data-2, y = event-data-2,
                               start-x = 6, x = 10,
                               region-color = 357
           when 11 thru 15                        
                modify gd-app, start-y = event-data-2, y = event-data-2,
                               start-x = 11, x = 15,
                               region-color = 357
           when 16 thru 20                        
                modify gd-app, start-y = event-data-2, y = event-data-2,
                               start-x = 16, x = 20,
                               region-color = 357
           when 21 thru 25                         
                modify gd-app, start-y = event-data-2, y = event-data-2,
                               start-x = 21, x = 25,
                               region-color = 357
           when 26 thru 30                        
                modify gd-app, start-y = event-data-2, y = event-data-2,
                               start-x = 26, x = 30,
                               region-color = 357
           end-evaluate            
           .
      * <TOTEM:END>

       SPOSTAMENTO-C.
      * <TOTEM:PARA. SPOSTAMENTO-C>
           modify gd-cerca, start-y = event-data-2, y = event-data-2,
                            start-x = 1, x = 6,
                            region-color = 357 
           .
      * <TOTEM:END>

       SPOSTAMENTO-T.
      * <TOTEM:PARA. SPOSTAMENTO-T>
           modify gd-test, start-y = event-data-2, y = event-data-2,
                           start-x = 1, x = 3,
                           region-color = 357 
           .
      * <TOTEM:END>

       SPOSTAMENTO-V.
      * <TOTEM:PARA. SPOSTAMENTO-V>
           modify gd-verifica, start-y = event-data-2, y = event-data-2,
                               start-x = 1, x = 3,
                               region-color = 357 
           .
      * <TOTEM:END>

       TROVA-GIORNO.
      * <TOTEM:PARA. TROVA-GIORNO>
           call "utydata" using dom-lun, 1, como-data, giorno 
           .
      * <TOTEM:END>

       ef-dal-ta-BeforeProcedure.
      * <TOTEM:PARA. ef-dal-ta-BeforeProcedure>
           .
      * <TOTEM:END>

      * EVENT PARAGRAPH
       pb-cerca-cli-LinkTo.
      * <TOTEM:PARA. pb-cerca-cli-LinkTo>
           inquire ef-cliente, value in cli-codice
           move "clienti-alfa" to como-file
           call "zoom-gt"   using como-file, cli-rec
                           giving stato-zoom
           cancel "zoom-gt"
           if stato-zoom = 0          
              modify ef-cliente, value cli-codice
              move 78-ID-ef-cliente to control-id
              perform ef-cliente-AfterProcedure
              modify ef-cliente, value cli-codice
           end-if 
           .
      * <TOTEM:END>
       pb-procedi-LinkTo.
      * <TOTEM:PARA. pb-procedi-LinkTo>
           perform varying control-id from 78-ID-ef-data by 1 
                     until control-id > 78-ID-ef-cliente
              perform CONTROLLO-SINGOLO
              if errori 
                 exit perform
              end-if
           end-perform.
           if errori
              exit paragraph
           end-if. 
           
           move 27 to key-status.  
           perform RIEMPI-CHIAVE.
           if v-modifica = 0
              move app-data    to sav-data
              move app-ora     to sav-ora
              move app-cliente to sav-cliente
              move low-value   to app-prog
              perform CERCA-APPUNTAMENTO
              perform RIEMPI-CHIAVE
              |Scrivo il nuovo appuntamento assegnando il progressivo
              if key-status = 27
                 initialize app-rec replacing numeric data by zeroes
                                         alphanumeric data by spaces
                 move sav-chiave to app-chiave
                 perform RIEMPI-DATI
                 move 1 to app-prog
                 perform until 1 = 2
                    write app-rec 
                          invalid add 1 to app-prog
                      not invalid exit perform
                    end-write
                 end-perform
              end-if
           else
              |Ho richiesto la modifica di un 
              |appuntamento ma poi cambio la chiave
              if app-data    not = sav-data    or
                 app-cliente not = sav-cliente or
                 app-ora     not = sav-ora
                 move low-value to app-prog
                 |Cerco un appuntamento già presente con la nuova chiave
                 perform CERCA-APPUNTAMENTO
                 if key-status = 27
                    |Cancello il vecchio appuntamento
                    move sav-chiave to app-chiave
                    read appuntamenti no lock
                    delete appuntamenti record

                    |Mi salvo i dati dell'appuntamento di riferimento
                    if app-recupero 
                       move app-recup-data  to sav-data
                       move app-recup-ora   to sav-ora
                       move app-recup-prog  to sav-prog
                    end-if

                    |ed aggiungo quello nuovo
                    initialize app-rec replacing numeric data by zeroes
                                            alphanumeric data by spaces
                    perform RIEMPI-CHIAVE
                    perform RIEMPI-DATI  
                    |Ripristino i dati dell'appuntamento di 
                    |riferimento nel recupero
                    if app-recupero 
                       move sav-data to app-recup-data  
                       move sav-ora  to app-recup-ora   
                       move sav-prog to app-recup-prog  
                    end-if
                    move 1 to app-prog
                    perform until 1 = 2
                       write app-rec 
                             invalid add 1 to app-prog
                         not invalid exit perform
                       end-write
                    end-perform

                    |Se modifico un recupero aggiorno anche
                    |l'appuntamento di riferimento
                    if app-recupero
                       |Mi salvo la chiave del recupero
                       move app-chiave      to como-chiave

                       |leggo l'appuntamento
                       move sav-chiave to app-chiave
                       read appuntamenti no lock
                            invalid continue
                        not invalid
                            |Metto la chiave del recupero nel riferimento
                            move como-chiave to sav-chiave
                            move sav-data to app-recup-data
                            move sav-ora  to app-recup-ora
                            move sav-prog to app-recup-prog
                            rewrite app-rec
                       end-read
                    end-if
                 end-if
              else
                 |Riassegno la chiave per il progressivo
                 move sav-chiave to app-chiave
                 read appuntamenti no lock
                 perform RIEMPI-DATI
                 rewrite app-rec
              end-if
           end-if.

           if key-status = 27
              set AggiornaAppuntamenti to true
           end-if.

      ***---
       RIEMPI-CHIAVE.
           move ef-data-buf to como-data.
           perform DATE-TO-FILE.
           move como-data  to app-data.
           move ef-ora-buf to app-ora.
           move ef-cliente-buf to app-cliente.

      ***---
       RIEMPI-DATI. 
           inquire cbo-pagato, value in como-valore.
           evaluate como-valore
           when "Pagato"     set app-pagato-si to true
           when "Fattura"    set app-pagato-ft to true
           when other        set app-pagato-vuoto to true
           end-evaluate.                            

           inquire cbo-stato, value in como-valore.
           evaluate como-valore           
           when "Inizio"   set app-inizio   to true 
           when "Assente"  set app-assente  to true 
           when "Terapia"  set app-terapia  to true 
           when "Test"     set app-test     to true      
           when "Presente" set app-presente to true
           when "Recupero" set app-recupero to true
           when other      set app-vuoto    to true
           end-evaluate 
           .
      * <TOTEM:END>
       ef-cliente-BeforeProcedure.
      * <TOTEM:PARA. ef-cliente-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-cliente-AfterProcedure.
      * <TOTEM:PARA. ef-cliente-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO-SINGOLO.
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       ef-data-BeforeProcedure.
      * <TOTEM:PARA. ef-data-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-data-AfterProcedure.
      * <TOTEM:PARA. ef-data-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO-SINGOLO.
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       ef-ora-BeforeProcedure.
      * <TOTEM:PARA. ef-ora-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-ora-AfterProcedure.
      * <TOTEM:PARA. ef-ora-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO-SINGOLO.
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       pb-calendario-LinkTo.
      * <TOTEM:PARA. pb-calendario-LinkTo>
           accept como-data from century-date.
           CALL "SELDATA" USING como-data, 1.
           perform DATE-TO-SCREEN.
           move como-data to ef-data-buf.
           display ef-data 
           .
      * <TOTEM:END>
       gd-app-Ev-Msg-Begin-Drag.
      * <TOTEM:PARA. gd-app-Ev-Msg-Begin-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       gd-app-Ev-Msg-End-Drag.
      * <TOTEM:PARA. gd-app-Ev-Msg-End-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       gd-app-Ev-Msg-Goto-Cell.
      * <TOTEM:PARA. gd-app-Ev-Msg-Goto-Cell>
           inquire gd-app, cursor-y in riga, cursor-x in colonna.
           if event-data-1 > colonna
              evaluate colonna
              when  1 thru  5 move  6 to event-data-1
              when  6 thru 10 move 11 to event-data-1
              when 11 thru 15 move 16 to event-data-1
              when 16 thru 20 move 21 to event-data-1
              when 21 thru 25 move 26 to event-data-1
              end-evaluate
              set event-action to event-action-fail
              move event-data-1 to colonna
              modify gd-app, cursor-x = colonna, cursor-y = event-data-2
           else                                               
              if event-data-1 < colonna
                 evaluate colonna
                 when  6 thru 10 move  1 to event-data-1
                 when 11 thru 15 move  6 to event-data-1
                 when 16 thru 20 move 11 to event-data-1
                 when 21 thru 25 move 16 to event-data-1
                 when 26 thru 30 move 21 to event-data-1
                 end-evaluate                      
                 set event-action to event-action-fail
                 move event-data-1 to colonna
                 modify gd-app, cursor-x = colonna, cursor-y = 
           event-data-2
              end-if
           end-if.
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       gd-app-Ev-Msg-Goto-Cell-Drag.
      * <TOTEM:PARA. gd-app-Ev-Msg-Goto-Cell-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       gd-app-Ev-Msg-Goto-Cell-Mouse.
      * <TOTEM:PARA. gd-app-Ev-Msg-Goto-Cell-Mouse>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       scr-singol-Cm-1-BeforeProcedure.
      * <TOTEM:PARA. scr-singol-Cm-1-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       scr-singol-Cm-1-AfterProcedure.
      * <TOTEM:PARA. scr-singol-Cm-1-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       gd-app-Ev-Msg-Begin-Entry.
      * <TOTEM:PARA. gd-app-Ev-Msg-Begin-Entry>
           set event-action to event-action-fail-terminate.
           inquire gd-app, entry-reason in como-entry.
           if como-entry = x"13" or x"20" or x"0d" or x"00"        
              set ModificaAppuntamento to true
           end-if 
           .
      * <TOTEM:END>
       Screen1-Cb-1-BeforeProcedure.
      * <TOTEM:PARA. Screen1-Cb-1-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       Screen1-Cb-1-AfterProcedure.
      * <TOTEM:PARA. Screen1-Cb-1-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       ef-cliente-cr-BeforeProcedure.
      * <TOTEM:PARA. ef-cliente-cr-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-cliente-cr-AfterProcedure.
      * <TOTEM:PARA. ef-cliente-cr-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO-CR.
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       ef-dal-cr-AfterProcedure.
      * <TOTEM:PARA. ef-dal-cr-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO-CR.
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       ef-al-cr-AfterProcedure.
      * <TOTEM:PARA. ef-al-cr-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO-CR.
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       pb-dal-cr-LinkTo.
      * <TOTEM:PARA. pb-dal-cr-LinkTo>
           accept como-data from century-date.
           CALL "SELDATA" USING como-data, 1.
           perform DATE-TO-SCREEN.
           move como-data to ef-dal-cr-buf.
           display ef-dal-cr 
           .
      * <TOTEM:END>
       pb-cerca-cli-cr-LinkTo.
      * <TOTEM:PARA. pb-cerca-cli-cr-LinkTo>
           inquire ef-cliente-cr, value in cli-codice
           move "clienti-alfa" to como-file
           call "zoom-gt"   using como-file, cli-rec
                           giving stato-zoom
           cancel "zoom-gt"
           if stato-zoom = 0          
              modify ef-cliente-cr, value cli-codice
              move 78-ID-ef-cliente-cr to control-id
              perform EF-CLIENTE-CR-AFTERPROCEDURE
              modify ef-cliente-cr, value cli-codice
           end-if 
           .
      * <TOTEM:END>
       pb-procedi-cr-LinkTo.
      * <TOTEM:PARA. pb-procedi-cr-LinkTo>
           set AggiornaAppuntamenti to false.
           perform varying control-id from 78-ID-ef-cliente-cr by 1 
                     until control-id > 78-ID-ef-al-cr
              perform CONTROLLO-CR
              if errori 
                 exit perform
              end-if
           end-perform.
           if errori
              exit paragraph
           end-if.        

           if chk-nessuno-cr-buf  = 0 and
              chk-assente-cr-buf  = 0 and
              chk-presente-cr-buf = 0 and
              chk-inizio-cr-buf   = 0 and
              chk-recupero-cr-buf = 0 and
              chk-test-cr-buf     = 0 and
              chk-terapia-cr-buf  = 0
              display message "Selezionare almeno uno stato"
                        title tit-err
                         icon 2
              exit paragraph
           end-if.

           display message "Confermi la cancellazione degli appuntamenti
      -    "?"
                     title titolo
                      icon 2
                      type mb-yes-no
                   default mb-no
                    giving scelta

           if scelta = mb-no exit paragraph end-if.
           
           move 27 to key-status.
                          
           move 0 to idx idx2.
           set AggiornaAppuntamenti to true.
           move low-value to app-rec.
           move ef-cliente-cr-buf to app-cliente.
           move como-data-da to app-data
           start appuntamenti key >= k-clidata
                 invalid continue
             not invalid
                 perform until 1 = 2
                    read appuntamenti next at end exit perform end-read
                    if app-cliente not = ef-cliente-cr-buf
                       exit perform
                    end-if
                    if app-data > como-data-a
                       exit perform
                    end-if          

                    move 0 to sw-agisci

                    if chk-nessuno-cr-buf  = 1 and app-vuoto
                       move 1 to sw-agisci
                    end-if

                    if chk-assente-cr-buf  = 1 and app-assente
                       move 1 to sw-agisci
                    end-if

                    if chk-inizio-cr-buf  = 1 and app-inizio
                       move 1 to sw-agisci
                    end-if

                    if chk-presente-cr-buf = 1 and app-presente
                       move 1 to sw-agisci
                    end-if

                    if chk-recupero-cr-buf = 1 and app-recupero
                       move 1 to sw-agisci
                    end-if

                    if chk-test-cr-buf = 1 and app-test
                       move 1 to sw-agisci
                    end-if

                    if chk-terapia-cr-buf = 1 and app-terapia
                       move 1 to sw-agisci
                    end-if

                    if sw-agisci = 1
                       delete appuntamenti record
                       evaluate true
                       when app-recupero
                            add 1 to idx
                            move app-recup-data to el-data(idx)
                            move app-recup-ora  to el-ora(idx)
                            move app-cliente    to el-cliente(idx)
                            move app-recup-prog to el-prog(idx)
                       when app-vuoto
                            if app-recup-data not = 0
                               add 1 to idx2
                               move app-recup-data to el-data2(idx2)
                               move app-recup-ora  to el-ora2(idx2)
                               move app-cliente    to el-cliente2(idx2)
                               move app-recup-prog to el-prog2(idx2)
                            end-if
                       end-evaluate
                    end-if
                 end-perform
           end-start.

           |Se ho cancellato dei recuperi devo levare il riferimento
           move idx to tot-idx.
           perform varying idx from 1 by 1 
                     until idx > tot-idx
              move el-chiave(idx) to app-chiave 
              read appuntamenti no lock
                   invalid continue
               not invalid
                   move 0 to app-recup-data app-recup-ora app-recup-prog
                   rewrite app-rec
              end-read
           end-perform.

           |Se ho cancellato dei gli appuntamenti coi recuperi
           |devo cancellare anche il recupero di riferimento
           move idx2 to tot-idx.
           perform varying idx2 from 1 by 1 
                     until idx2 > tot-idx
              move el-chiave2(idx2) to app-chiave 
              delete appuntamenti record
           end-perform 
           .
      * <TOTEM:END>
       ef-cliente-ar-BeforeProcedure.
      * <TOTEM:PARA. ef-cliente-ar-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-dal-ar-BeforeProcedure.
      * <TOTEM:PARA. ef-dal-ar-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-al-ar-BeforeProcedure.
      * <TOTEM:PARA. ef-al-ar-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-ora-ar-BeforeProcedure.
      * <TOTEM:PARA. ef-ora-ar-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-cliente-ar-AfterProcedure.
      * <TOTEM:PARA. ef-cliente-ar-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO-AR.
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       ef-dal-ar-AfterProcedure.
      * <TOTEM:PARA. ef-dal-ar-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO-AR.
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       ef-al-ar-AfterProcedure.
      * <TOTEM:PARA. ef-al-ar-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO-AR.
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       ef-ora-ar-AfterProcedure.
      * <TOTEM:PARA. ef-ora-ar-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO-AR.
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       pb-procedi-ar-LinkTo.
      * <TOTEM:PARA. pb-procedi-ar-LinkTo>
           set AggiornaAppuntamenti to false.
           perform varying control-id from 78-ID-ef-cliente-ar by 1 
                     until control-id > 78-ID-ef-ora-ar
              perform CONTROLLO-AR
              if errori 
                 exit perform
              end-if
           end-perform.
           if errori
              exit paragraph
           end-if.        

           if chk-lun-buf = 0 and
              chk-mar-buf = 0 and
              chk-mer-buf = 0 and
              chk-gio-buf = 0 and
              chk-ven-buf = 0 and
              chk-sab-buf = 0
              display message "Selezionare almeno uno giorno"
                        title tit-err
                         icon 2
              exit paragraph
           end-if.

           display message "Confermi l'aggiunta degli appuntamenti?"
                     title titolo
                      icon 2
                      type mb-yes-no
                   default mb-no
                    giving scelta

           if scelta = mb-no exit paragraph end-if.
           
           set AggiornaAppuntamenti to true.
           move 27 to key-status.

           initialize app-rec replacing numeric data by zeroes
                                   alphanumeric data by spaces.
           move ef-cliente-ar-buf to app-cliente.
           move como-data-da to como-data.
           perform until 1 = 2
              if como-data > como-data-a
                 exit perform
              end-if
              move 0 to sw-agisci
              perform TROVA-GIORNO
              evaluate giorno
              when 1 if chk-lun-buf = 1 move 1 to sw-agisci end-if
              when 2 if chk-mar-buf = 1 move 1 to sw-agisci end-if
              when 3 if chk-mer-buf = 1 move 1 to sw-agisci end-if
              when 4 if chk-gio-buf = 1 move 1 to sw-agisci end-if
              when 5 if chk-ven-buf = 1 move 1 to sw-agisci end-if
              when 6 if chk-sab-buf = 1 move 1 to sw-agisci end-if
              end-evaluate
              if sw-agisci = 1
                 move como-data to app-data
                 move ef-ora-ar-buf to app-ora
                 move 1 to app-prog
                 write app-rec invalid continue end-write
              end-if
              compute como-numero = function integer-of-date (como-data)
              add 1 to como-numero
              compute como-data = function date-of-integer (como-numero)
           end-perform.
                 
      **     move como-data-da to app-data
      **     start appuntamenti key >= k-clidata
      **           invalid continue
      **       not invalid
      **           perform until 1 = 2
      **              read appuntamenti next at end exit perform end-read
      **              if app-cliente not = ef-cliente-cr-buf
      **                 exit perform
      **              end-if
      **              if app-data > como-data-a
      **                 exit perform
      **              end-if
      **              delete appuntamenti record
      **           end-perform
      **     end-start 
           .
      * <TOTEM:END>
       pb-settimana-prev-LinkTo.
      * <TOTEM:PARA. pb-settimana-prev-LinkTo>
           move col-data(1) to como-data.
           perform DATE-TO-FILE.
           compute como-numero = function integer-of-date(como-data).
           subtract 7 from como-numero.
           compute como-data = function date-of-integer(como-numero).

           perform TROVA-GIORNO.
           if giorno = 7 
              compute como-numero = function integer-of-date(como-data)
              subtract 1 from como-numero
              compute como-data = function date-of-integer(como-numero)
           end-if.

           move como-data to start-data.
           perform AGGIORNA-APPUNTAMENTI 
           .
      * <TOTEM:END>
       pb-giorno-prev-LinkTo.
      * <TOTEM:PARA. pb-giorno-prev-LinkTo>

           move col-data(1) to como-data.    
           perform DATE-TO-FILE.
           compute como-numero = function integer-of-date(como-data).
           subtract 1 from como-numero.
           compute como-data = function date-of-integer(como-numero).

           perform TROVA-GIORNO.
           if giorno = 7 
              compute como-numero = function integer-of-date(como-data)
              subtract 1 from como-numero
              compute como-data = function date-of-integer(como-numero)
           end-if.

           move como-data to start-data.
           perform AGGIORNA-APPUNTAMENTI 
           
           .
      * <TOTEM:END>
       pb-giorno-next-LinkTo.
      * <TOTEM:PARA. pb-giorno-next-LinkTo>
           move col-data(1) to como-data. 
           perform DATE-TO-FILE.
           compute como-numero = function integer-of-date(como-data).
           add 1 to como-numero.
           compute como-data = function date-of-integer(como-numero).

           perform TROVA-GIORNO.
           if giorno = 7 
              compute como-numero = function integer-of-date(como-data)
              add 1 to como-numero
              compute como-data = function date-of-integer(como-numero)
           end-if.

           move como-data to start-data
           perform AGGIORNA-APPUNTAMENTI 
           .
      * <TOTEM:END>
       pb-settimana-next-LinkTo.
      * <TOTEM:PARA. pb-settimana-next-LinkTo>
           move col-data(6) to como-data.    
           perform DATE-TO-FILE.
           compute como-numero = function integer-of-date(como-data).
           add 1 to como-numero.
           compute como-data = function date-of-integer(como-numero).

           perform TROVA-GIORNO.
           if giorno = 7
              compute como-numero = function integer-of-date(como-data)
              add 1 to como-numero
              compute como-data = function date-of-integer(como-numero)
           end-if.

           move como-data to start-data.
           perform AGGIORNA-APPUNTAMENTI 
           .
      * <TOTEM:END>
       pb-su-LinkTo.
      * <TOTEM:PARA. pb-su-LinkTo>
           inquire gd-app, cursor-y in riga, cursor-x in colonna.
           if riga = 3 exit paragraph end-if.
           compute como-riga = riga - 1.

           perform SPOSTA-GIORNO 
           .
      * <TOTEM:END>
       pb-giu-LinkTo.
      * <TOTEM:PARA. pb-giu-LinkTo>
           inquire gd-app, cursor-y in riga, cursor-x in colonna.
           compute como-riga = riga + 1.

           evaluate colonna
           when  1 thru 5
                move 1 to colonna
                inquire gd-app(como-riga, 1) hidden-data in app-chiave

           when  6 thru 10        
                move 2 to colonna
                inquire gd-app(como-riga, 6) hidden-data in app-chiave

           when 11 thru 15                 
                move 3 to colonna
                inquire gd-app(como-riga, 11) hidden-data in app-chiave

           when 16 thru 20                 
                move 4 to colonna     
                inquire gd-app(como-riga, 16) hidden-data in app-chiave

           when 21 thru 25                 
                move 5 to colonna      
                inquire gd-app(como-riga, 21) hidden-data in app-chiave

           when 26 thru 30                 
                move 6 to colonna     
                inquire gd-app(como-riga, 26) hidden-data in app-chiave

           when other 
                move 0 to colonna

           end-evaluate.
           if app-cliente not = spaces
              inquire gd-app, cursor-y in riga, cursor-x in colonna
              perform SPOSTA-GIORNO
           end-if 
           .
      * <TOTEM:END>
       pb-aggiungi-a-LinkTo.
      * <TOTEM:PARA. pb-aggiungi-a-LinkTo>

           inquire gd-app, cursor-x in colonna, cursor-y in riga.
           evaluate colonna
           when  1 thru 5  move col-data(1) to como-data
           when  6 thru 10 move col-data(2) to como-data
           when 11 thru 15 move col-data(3) to como-data
           when 16 thru 20 move col-data(4) to como-data
           when 21 thru 25 move col-data(5) to como-data
           when 26 thru 30 move col-data(6) to como-data
           end-evaluate.   

           perform DATE-TO-FILE.
           move como-data to ins-data.

           initialize sav-chiave replacing numeric data by zeroes
                                      alphanumeric data by spaces.
                        
           perform SCR-SINGOLO-OPEN-ROUTINE.
           if AggiornaAppuntamenti
              perform AGGIORNA-GIORNO
           end-if 
           .
      * <TOTEM:END>
       pb-cancella-LinkTo.
      * <TOTEM:PARA. pb-cancella-LinkTo>
           inquire gd-app, cursor-x in colonna, cursor-y in riga.
           evaluate colonna
           when  1 thru 5 
                inquire gd-app(riga, 1) cell-data col-ora-1
                if col-ora-1 = spaces
                   exit paragraph
                end-if
           when  6 thru 10
                inquire gd-app(riga, 6) cell-data col-ora-2
                if col-ora-2 = spaces
                   exit paragraph
                end-if
           when 11 thru 15
                inquire gd-app(riga, 11) cell-data col-ora-3
                if col-ora-3 = spaces
                   exit paragraph
                end-if
           when 16 thru 20
                inquire gd-app(riga, 16) cell-data col-ora-4
                if col-ora-4 = spaces
                   exit paragraph
                end-if
           when 21 thru 25 
                inquire gd-app(riga, 21) cell-data col-ora-5
                if col-ora-5 = spaces
                   exit paragraph
                end-if
           when 26 thru 30
                inquire gd-app(riga, 26) cell-data col-ora-6
                if col-ora-6 = spaces
                   exit paragraph
                end-if
           end-evaluate.

           display message "Eliminare l'appuntamento selezionato?"
                     title titolo
                      type mb-yes-no
                   default mb-no
                    giving scelta
           if scelta = mb-yes
              inquire gd-app, cursor-x in colonna, cursor-y in riga
              evaluate colonna
              when  1 thru 5
                   move 1 to colonna
                   inquire gd-app(riga, 1) hidden-data in app-chiave

              when  6 thru 10        
                   move 2 to colonna
                   inquire gd-app(riga, 6) hidden-data in app-chiave

              when 11 thru 15                 
                   move 3 to colonna
                   inquire gd-app(riga, 11) hidden-data in app-chiave

              when 16 thru 20                 
                   move 4 to colonna     
                   inquire gd-app(riga, 16) hidden-data in app-chiave

              when 21 thru 25                 
                   move 5 to colonna      
                   inquire gd-app(riga, 21) hidden-data in app-chiave

              when 26 thru 30                 
                   move 6 to colonna     
                   inquire gd-app(riga, 26) hidden-data in app-chiave

              when other 
                   move 0 to colonna

              end-evaluate          
              if colonna > 0
                 read appuntamenti no lock
                 if app-vuoto and app-recup-data not = 0
                    display message "Verrà cancellato anche il relativo 
      -    "recupero."
                             x"0d0a""Confermi?"
                              title titolo
                               icon 2
                               type mb-yes-no
                             giving scelta
                    if scelta = mb-no
                       exit paragraph
                    end-if
                 end-if
                 delete appuntamenti record
                 if app-recupero
                    move app-data to como-data sav-data
                    move app-recup-data to app-data
                    move app-recup-ora  to app-ora
                    move app-recup-prog to app-prog
                    read appuntamenti no lock
                    move 0 to app-recup-data app-recup-ora 
           app-recup-prog
                    rewrite app-rec
                    move col-data(1) to como-data
                    perform DATE-TO-FILE
                    move como-data to start-data
                    perform AGGIORNA-APPUNTAMENTI
                 else
                    |Cancello l'appuntamento collegato
                    if app-recup-data not = 0
                       move app-recup-data to app-data
                       move app-recup-ora  to app-ora
                       move app-recup-prog to app-prog
                       delete appuntamenti record
                       move col-data(1) to como-data
                       perform DATE-TO-FILE
                       move como-data to start-data
                       perform AGGIORNA-APPUNTAMENTI
                    else  
                       move col-data(colonna) to como-data
                       perform DATE-TO-FILE
                       move como-data to sav-data
                       perform RESET-GIORNO
                       perform CARICA-GIORNO
                    end-if
                 end-if            
              end-if
           end-if 
           .
      * <TOTEM:END>
       pb-recupero-LinkTo.
      * <TOTEM:PARA. pb-recupero-LinkTo>
           inquire gd-app, cursor-x in colonna, cursor-y in riga.
           evaluate colonna
           when  1 thru 5 
                inquire gd-app(riga, 1)  hidden-data in app-chiave 
           when  6 thru 10
                inquire gd-app(riga, 6)  hidden-data in app-chiave 
           when 11 thru 15
                inquire gd-app(riga, 11) hidden-data in app-chiave
           when 16 thru 20
                inquire gd-app(riga, 16) hidden-data in app-chiave
           when 21 thru 25 
                inquire gd-app(riga, 21) hidden-data in app-chiave
           when 26 thru 30
                inquire gd-app(riga, 26) hidden-data in app-chiave
           end-evaluate.

           read appuntamenti no lock
                invalid continue
            not invalid
                if app-assente
                   move app-chiave to sav-chiave
                   perform SCR-RECUPERO-OPEN-ROUTINE
                   if AggiornaAppuntamenti
                      set AggiornaAppuntamenti to false
                      move col-data(1) to como-data
                      perform DATE-TO-FILE
                      move como-data   to start-data
                      perform AGGIORNA-APPUNTAMENTI
                   end-if
                else
                   display message "E' possibile recuperare solo se ASSE
      -    "NTE"
                             title tit-err
                              icon 2
                end-if
           end-read 
           .
      * <TOTEM:END>
       pb-cal-LinkTo.
      * <TOTEM:PARA. pb-cal-LinkTo>
           accept como-data from century-date.
           CALL "SELDATA" USING como-data, 1.
           move como-data to start-data.
           perform AGGIORNA-APPUNTAMENTI.  

           move 3 to riga event-data-2
           perform SPOSTAMENTO
           modify gd-app, cursor-y riga, cursor-x = 1
           move 78-ID-gd-app to control-id
           move 4            to accept-control
           .
      * <TOTEM:END>
       pb-aggiungi-r-LinkTo.
      * <TOTEM:PARA. pb-aggiungi-r-LinkTo>
           move col-data(1) to como-data.
           perform DATE-TO-FILE.
           move como-data to sav-data.
           perform SCR-AGGIUNGI-R-OPEN-ROUTINE.
           if AggiornaAppuntamenti
              move col-data(1) to como-data
              perform DATE-TO-FILE
              move como-data to start-data
              perform AGGIORNA-APPUNTAMENTI
           end-if 
           .
      * <TOTEM:END>
       pb-cancella-r-LinkTo.
      * <TOTEM:PARA. pb-cancella-r-LinkTo>
           move col-data(1) to como-data.
           perform DATE-TO-FILE.
           move como-data to sav-data.
           perform SCR-CANCELLA-R-OPEN-ROUTINE.
           if AggiornaAppuntamenti       
              move col-data(1) to como-data
              perform DATE-TO-FILE
              move como-data to start-data
              perform AGGIORNA-APPUNTAMENTI
           end-if 
           .
      * <TOTEM:END>
       pb-cerca-cli-ar-LinkTo.
      * <TOTEM:PARA. pb-cerca-cli-ar-LinkTo>
           inquire ef-cliente-ar, value in cli-codice
           move "clienti-alfa" to como-file
           call "zoom-gt"   using como-file, cli-rec
                           giving stato-zoom
           cancel "zoom-gt"
           if stato-zoom = 0          
              modify ef-cliente-ar, value cli-codice
              move 78-ID-ef-cliente-ar to control-id
              perform EF-CLIENTE-AR-AFTERPROCEDURE
              modify ef-cliente-ar, value cli-codice
           end-if 
           .
      * <TOTEM:END>
       pb-al-ar-LinkTo.
      * <TOTEM:PARA. pb-al-ar-LinkTo>
           accept como-data from century-date.
           CALL "SELDATA" USING como-data, 1.
           perform DATE-TO-SCREEN.
           move como-data to ef-al-ar-buf.
           display ef-al-ar 
           .
      * <TOTEM:END>
       pb-al-cr-LinkTo.
      * <TOTEM:PARA. pb-al-cr-LinkTo>
           accept como-data from century-date.
           CALL "SELDATA" USING como-data, 1.
           perform DATE-TO-SCREEN.
           move como-data to ef-al-cr-buf.
           display ef-al-cr 
           .
      * <TOTEM:END>
       pb-dal-ar-LinkTo.
      * <TOTEM:PARA. pb-dal-ar-LinkTo>
           accept como-data from century-date.
           CALL "SELDATA" USING como-data, 1.
           perform DATE-TO-SCREEN.
           move como-data to ef-dal-ar-buf.
           display ef-dal-ar 
           .
      * <TOTEM:END>
       pb-cerca-cli-c-LinkTo.
      * <TOTEM:PARA. pb-cerca-cli-c-LinkTo>
           inquire ef-cliente-c, value in cli-codice
           move "clienti-alfa" to como-file
           call "zoom-gt"   using como-file, cli-rec
                           giving stato-zoom
           cancel "zoom-gt"
           if stato-zoom = 0          
              modify ef-cliente-c, value cli-codice
              move 78-ID-ef-cliente-c to control-id
              perform EF-CLIENTE-C-AFTERPROCEDURE
              modify ef-cliente-c, value cli-codice
           end-if 
           .
      * <TOTEM:END>
       ef-cliente-c-BeforeProcedure.
      * <TOTEM:PARA. ef-cliente-c-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-dal-c-BeforeProcedure.
      * <TOTEM:PARA. ef-dal-c-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-al-cra-BeforeProcedure.
      * <TOTEM:PARA. ef-al-cra-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-cliente-c-AfterProcedure.
      * <TOTEM:PARA. ef-cliente-c-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO-C.
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       ef-dal-c-AfterProcedure.
      * <TOTEM:PARA. ef-dal-c-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO-C.
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       pb-dal-c-LinkTo.
      * <TOTEM:PARA. pb-dal-c-LinkTo>
           accept como-data from century-date.
           CALL "SELDATA" USING como-data, 1.
           perform DATE-TO-SCREEN.
           move como-data to ef-dal-c-buf.
           display ef-dal-c 
           .
      * <TOTEM:END>
       pb-al-c-LinkTo.
      * <TOTEM:PARA. pb-al-c-LinkTo>
           accept como-data from century-date.
           CALL "SELDATA" USING como-data, 1.
           perform DATE-TO-SCREEN.
           move como-data to ef-al-c-buf.
           display ef-al-c 
           .
      * <TOTEM:END>
       ef-al-c-AfterProcedure.
      * <TOTEM:PARA. ef-al-c-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO-C.
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       pb-procedi-c-LinkTo.
      * <TOTEM:PARA. pb-procedi-c-LinkTo>
           perform varying control-id from 78-ID-ef-cliente-cr by 1 
                     until control-id > 78-ID-ef-al-cr
              perform CONTROLLO-C
              if errori 
                 exit perform
              end-if
           end-perform.
           if errori
              exit paragraph
           end-if.

           if chk-nessuno-c-buf  = 0 and   
              chk-assente-c-buf  = 0 and
              chk-test-c-buf     = 0 and
              chk-presente-c-buf = 0 and
              chk-inizio-c-buf   = 0 and
              chk-recupero-c-buf = 0 and
              chk-terapia-c-buf  = 0
              display message "Selezionare almeno uno stato"
                        title tit-err
                         icon 2
              exit paragraph
           end-if.

           if chk-pag-n-buf  = 0 and
              chk-pag-si-buf = 0 and
              chk-pag-ft-buf = 0 
              display message "Selezionare almeno uno stato di pagamento
      -    ""
                        title tit-err
                         icon 2
              exit paragraph
           end-if.

           modify gd-cerca, reset-grid = 1.
           perform GD-CERCA-CONTENT.

           move low-value to app-rec.
           move ef-cliente-c-buf to app-cliente.
           move como-data-da     to app-data.
           start appuntamenti key >= k-clidata
                 invalid continue
             not invalid
                 move 1 to riga
                 perform until 1 = 2
                    read appuntamenti next at end exit perform end-read
                    if app-cliente not = ef-cliente-c-buf or
                       app-data > como-data-a
                       exit perform
                    end-if
                    move 0 to sw-agisci
                    if app-assente and chk-assente-c-buf = 1
                       add 1 to sw-agisci
                    end-if            
                    if app-test and chk-test-c-buf = 1
                       add 1 to sw-agisci
                    end-if            
                    if app-terapia and chk-terapia-c-buf = 1
                       add 1 to sw-agisci
                    end-if            
                    if app-inizio and chk-inizio-c-buf = 1
                       add 1 to sw-agisci
                    end-if            
                    if app-presente and chk-presente-c-buf = 1
                       add 1 to sw-agisci
                    end-if
                    if app-recupero and chk-recupero-c-buf = 1
                       add 1 to sw-agisci
                    end-if
                    if app-vuoto and chk-nessuno-c-buf = 1
                       add 1 to sw-agisci
                    end-if
                    if app-pagato-si and chk-pag-si-buf = 1
                       add 1 to sw-agisci
                    end-if
                    if app-pagato-ft and chk-pag-ft-buf = 1
                       add 1 to sw-agisci
                    end-if    
                    if app-pagato-vuoto and chk-pag-n-buf = 1
                       add 1 to sw-agisci
                    end-if
                    if sw-agisci = 2
                       move app-data to como-data
                       perform DATE-TO-SCREEN
                       move como-data to col-data-c
                       move app-ora   to col-ora-c
                       evaluate true   
                       when app-assente  move "Assente"  to col-stato-c
                       when app-inizio   move "Inizio"   to col-stato-c
                       when app-presente move "Presente" to col-stato-c
                       when app-recupero move "Recupero" to col-stato-c
                       when app-test     move "Test"     to col-stato-c
                       when app-terapia  move "Terapia"  to col-stato-c
                       when other        move spaces     to col-stato-c
                       end-evaluate
                       evaluate true
                       when app-pagato-si move "SI"      to col-pag-c
                       when app-pagato-ft move "Fattura" to col-pag-c
                       when other         move spaces    to col-pag-c
                       end-evaluate

                       perform COMPONI-RECUPERO
                       move como-recupero to col-recupero-c

                       add 1 to riga                                
                       modify gd-cerca(riga, 1), hidden-data app-chiave
                       modify gd-cerca(riga, 1), cell-data col-data-c
                       modify gd-cerca(riga, 2), cell-data col-ora-c
                       modify gd-cerca(riga, 3), cell-data col-stato-c
                       modify gd-cerca(riga, 4), cell-data 
           col-recupero-c
                       modify gd-cerca(riga, 5), cell-data col-pag-c
                       modify gd-cerca(riga, 6), 
                              bitmap = edit-icon-bmp
                              bitmap-number = 1,
                              bitmap-width = 16
                    end-if
                 end-perform
           end-start 
           .
      * <TOTEM:END>
       pb-cerca-LinkTo.
      * <TOTEM:PARA. pb-cerca-LinkTo>
           perform SCR-CERCA-OPEN-ROUTINE.
           if ModificaAppuntamento or AggiornaAppuntamenti
              set ModificaAppuntamento to false
              set AggiornaAppuntamenti to false
              move sav-chiave to como-chiave
              move sav-data to start-data
              perform AGGIORNA-APPUNTAMENTI
              move como-chiave to sav-chiave

              inquire gd-app, last-row in tot-righe
              perform varying riga from 3 by 1 
                        until riga > tot-righe
                 inquire gd-app(riga, 1), hidden-data in app-chiave
                 if app-chiave = sav-chiave
                    move riga to event-data-2
                    perform SPOSTAMENTO
                    modify gd-app, cursor-y riga, cursor-x = 1
                    exit perform
                 end-if
              end-perform
              move 78-ID-gd-app to control-id
              move 4            to accept-control

           end-if 
           .
      * <TOTEM:END>
       gd-cerca-Ev-Msg-Begin-Entry.
      * <TOTEM:PARA. gd-cerca-Ev-Msg-Begin-Entry>
           set event-action to event-action-fail-terminate
           inquire gd-cerca, entry-reason in como-entry
           if como-entry = x"13" or x"20" or x"0d" or x"00"        
              if event-data-1 = 6
                 set ModificaInLine       to true
              else
                 set ModificaAppuntamento to true
              end-if
              inquire gd-cerca(event-data-2, 1), hidden-data sav-chiave
           end-if 
           .
      * <TOTEM:END>
       gd-cerca-Ev-Msg-Begin-Drag.
      * <TOTEM:PARA. gd-cerca-Ev-Msg-Begin-Drag>
           perform SPOSTAMENTO-C 
           .
      * <TOTEM:END>
       gd-cerca-Ev-Msg-End-Drag.
      * <TOTEM:PARA. gd-cerca-Ev-Msg-End-Drag>
           perform SPOSTAMENTO-C 
           .
      * <TOTEM:END>
       gd-cerca-Ev-Msg-Goto-Cell.
      * <TOTEM:PARA. gd-cerca-Ev-Msg-Goto-Cell>
           perform SPOSTAMENTO-C 
           .
      * <TOTEM:END>
       gd-cerca-Ev-Msg-Goto-Cell-Drag.
      * <TOTEM:PARA. gd-cerca-Ev-Msg-Goto-Cell-Drag>
           perform SPOSTAMENTO-C 
           .
      * <TOTEM:END>
       gd-cerca-Ev-Msg-Goto-Cell-Mouse.
      * <TOTEM:PARA. gd-cerca-Ev-Msg-Goto-Cell-Mouse>
           perform SPOSTAMENTO-C 
           .
      * <TOTEM:END>
       ef-data-rec-BeforeProcedure.
      * <TOTEM:PARA. ef-data-rec-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-ora-rec-BeforeProcedure.
      * <TOTEM:PARA. ef-ora-rec-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-data-rec-AfterProcedure.
      * <TOTEM:PARA. ef-data-rec-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO-REC.
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       ef-ora-rec-AfterProcedure.
      * <TOTEM:PARA. ef-ora-rec-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO-REC.
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       pb-procedi-rec-LinkTo.
      * <TOTEM:PARA. pb-procedi-rec-LinkTo>
           set AggiornaAppuntamenti to false.
           perform varying control-id from 78-ID-ef-data-rec by 1 
                     until control-id > 78-ID-ef-ora-rec
              perform CONTROLLO-REC
              if errori 
                 exit perform
              end-if
           end-perform.
           if errori
              exit paragraph
           end-if.               

           move ef-data-rec-buf to como-data
           perform DATE-TO-FILE
           move como-data to app-data

           move ef-ora-rec-buf to como-ora
           move como-ora to app-ora

           move spaces to app-cliente
           move sav-cliente to ef-cliente-buf

           move 27 to key-status.
           perform CERCA-APPUNTAMENTO.

           if key-status = 27
              set AggiornaAppuntamenti to true

              |Creo prima il recupero
              initialize app-rec replacing numeric data by zeroes
                                      alphanumeric data by spaces

              move ef-data-rec-buf to como-data
              perform DATE-TO-FILE
              move como-data to app-data

              move ef-ora-rec-buf to como-ora
              move como-ora to app-ora

              move sav-cliente to app-cliente
              set app-recupero to true
              move 1 to app-prog
              move sav-data to app-recup-data
              move sav-ora  to app-recup-ora
              move sav-prog to app-recup-prog
              perform until 1 = 2
                 write app-rec 
                       invalid add 1 to app-prog
                   not invalid exit perform
                 end-write
              end-perform
              |mi salvo la chiave del recupero
              move app-chiave to como-chiave

              |Dopo aggiorno l'assente
              move sav-chiave to app-chiave
              read appuntamenti
              read appuntamenti no lock

              |riprendo la chiave del recupero
              move como-chiave to sav-chiave    
              move sav-data to app-recup-data
              move sav-ora  to app-recup-ora
              move sav-prog to app-recup-prog

              |e riscrivo
              rewrite app-rec

           end-if 
           .
      * <TOTEM:END>
       pb-calendario-rec-LinkTo.
      * <TOTEM:PARA. pb-calendario-rec-LinkTo>
           accept como-data from century-date.
           CALL "SELDATA" USING como-data, 1.
           perform DATE-TO-SCREEN.
           move como-data to ef-data-rec-buf.
           display ef-data-rec 
           .
      * <TOTEM:END>
       appuntamenti-Ev-Before-Program.
      * <TOTEM:PARA. appuntamenti-Ev-Before-Program>
           move LK-BL-PROG-ID    TO COMO-PROG-ID.
           copy resource "edit-icon.bmp".
           call "W$BITMAP" using wbitmap-load, "edit-icon.bmp",
                          giving edit-icon-bmp 
           .
      * <TOTEM:END>
       appuntamenti-Ev-After-Program.
      * <TOTEM:PARA. appuntamenti-Ev-After-Program>
           SET LK-BL-CANCELLAZIONE TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           call "W$BITMAP" using wbitmap-destroy, edit-icon-bmp 
           .
      * <TOTEM:END>
       Screen3-Cb-1-BeforeProcedure.
      * <TOTEM:PARA. Screen3-Cb-1-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       Screen3-Cb-1-AfterProcedure.
      * <TOTEM:PARA. Screen3-Cb-1-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       pb-test-LinkTo.
      * <TOTEM:PARA. pb-test-LinkTo>
           perform SCR-TEST-OPEN-ROUTINE 
           .
      * <TOTEM:END>
       pb-dal-t-LinkTo.
      * <TOTEM:PARA. pb-dal-t-LinkTo>
           accept como-data from century-date.
           call "SELDATA" using como-data, 1.
           perform DATE-TO-SCREEN.
           move como-data to ef-dal-t-buf.
           display ef-dal-t 
           .
      * <TOTEM:END>
       ef-dal-t-BeforeProcedure.
      * <TOTEM:PARA. ef-dal-t-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-al-t-BeforeProcedure.
      * <TOTEM:PARA. ef-al-t-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-cliente-t-BeforeProcedure.
      * <TOTEM:PARA. ef-cliente-t-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-dal-t-AfterProcedure.
      * <TOTEM:PARA. ef-dal-t-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO-T 
           .
      * <TOTEM:END>
       ef-al-t-AfterProcedure.
      * <TOTEM:PARA. ef-al-t-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO-T 
           .
      * <TOTEM:END>
       ef-cliente-t-AfterProcedure.
      * <TOTEM:PARA. ef-cliente-t-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO-T 
           .
      * <TOTEM:END>
       pb-al-t-LinkTo.
      * <TOTEM:PARA. pb-al-t-LinkTo>
           accept como-data from century-date.
           call "SELDATA" using como-data, 1.
           perform DATE-TO-SCREEN.
           move como-data to ef-al-t-buf.
           display ef-al-t 
           .
      * <TOTEM:END>
       pb-cerca-cli-t-LinkTo.
      * <TOTEM:PARA. pb-cerca-cli-t-LinkTo>
           inquire ef-cliente-t, value in cli-codice
           move "clienti-alfa" to como-file
           call "zoom-gt"   using como-file, cli-rec
                           giving stato-zoom
           cancel "zoom-gt"
           if stato-zoom = 0          
              modify ef-cliente-t, value cli-codice
              move 78-ID-ef-cliente-t to control-id
              perform EF-CLIENTE-T-AFTERPROCEDURE
              modify ef-cliente-t, value cli-codice
           end-if 
           .
      * <TOTEM:END>
       pb-dal-v-LinkTo.
      * <TOTEM:PARA. pb-dal-v-LinkTo>
           accept como-data from century-date.
           call "SELDATA" using como-data, 1.
           perform DATE-TO-SCREEN.
           move como-data to ef-dal-v-buf.
           display ef-dal-v 
           .
      * <TOTEM:END>
       pb-procedi-t-LinkTo.
      * <TOTEM:PARA. pb-procedi-t-LinkTo>
           perform varying control-id from 78-id-ef-dal-t by 1 
                     until control-id > 78-ID-ef-cliente-t
              perform CONTROLLO-T
              if errori
                 exit perform
              end-if
           end-perform.
           if errori
              exit paragraph
           end-if.

           modify gd-test, reset-grid = 1
           modify gd-test, mass-update = 1.
           perform GD-TEST-CONTENT.

           move low-value to app-rec.
           set app-test to true.
           move ef-cliente-t-buf to app-cliente.
           move como-data-da to app-data.
           start appuntamenti key >= k-statodata
                 invalid continue
             not invalid
                 move 1 to riga
                 perform until 1 = 2
                    read appuntamenti next at end exit perform end-read
                    if not (app-test) or 
                       app-data > como-data-a
                       exit perform
                    end-if

                    move 0 to sw-agisci
                    if ef-cliente-t-buf = spaces
                       move 1 to sw-agisci
                    else
                       if app-cliente = ef-cliente-t-buf
                          move 1 to sw-agisci
                       end-if
                    end-if

                    if sw-agisci = 1
                       move app-data to como-data
                       perform DATE-TO-SCREEN
                       move como-data to col-data-t
                       move app-ora   to col-ora-t
                       move app-cliente to cli-codice
                       read clienti no lock
                            invalid move "NON TROVATO" to cli-cognome
                                    move spaces to cli-nome
                       end-read
                       initialize lab-cliente-t-buf
                       inspect cli-cognome replacing trailing spaces by 
           low-value
                       string  cli-cognome delimited low-value
                               " "         delimited size
                               cli-nome    delimited size
                          into col-cliente-t
                       end-string
                       add 1 to riga                  
                       modify gd-test(riga, 1), hidden-data app-chiave
                       modify gd-test(riga, 1), cell-data col-data-t
                       modify gd-test(riga, 2), cell-data col-ora-t
                       modify gd-test(riga, 3), cell-data col-cliente-t
                    end-if
                 end-perform
           end-start.
           modify gd-test, mass-update = 0 
           .
      * <TOTEM:END>
       pb-procedi-v-LinkTo.
      * <TOTEM:PARA. pb-procedi-v-LinkTo>
           move 0 to lab-attesa-buf counter counter2.
           set attesa-test to true.
           perform SCR-ATTESA-OPEN-ROUTINE 
           .
      * <TOTEM:END>
       ef-dal-v-BeforeProcedure.
      * <TOTEM:PARA. ef-dal-v-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-dal-v-AfterProcedure.
      * <TOTEM:PARA. ef-dal-v-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO-V 
           .
      * <TOTEM:END>
       gd-test-Ev-Msg-Begin-Drag.
      * <TOTEM:PARA. gd-test-Ev-Msg-Begin-Drag>
           perform SPOSTAMENTO-T 
           .
      * <TOTEM:END>
       gd-test-Ev-Msg-End-Drag.
      * <TOTEM:PARA. gd-test-Ev-Msg-End-Drag>
           perform SPOSTAMENTO-T 
           .
      * <TOTEM:END>
       gd-test-Ev-Msg-Goto-Cell.
      * <TOTEM:PARA. gd-test-Ev-Msg-Goto-Cell>
           perform SPOSTAMENTO-T 
           .
      * <TOTEM:END>
       gd-test-Ev-Msg-Goto-Cell-Drag.
      * <TOTEM:PARA. gd-test-Ev-Msg-Goto-Cell-Drag>
           perform SPOSTAMENTO-T 
           .
      * <TOTEM:END>
       gd-test-Ev-Msg-Goto-Cell-Mouse.
      * <TOTEM:PARA. gd-test-Ev-Msg-Goto-Cell-Mouse>
           perform SPOSTAMENTO-T 
           .
      * <TOTEM:END>
       gd-test-Ev-Msg-Begin-Entry.
      * <TOTEM:PARA. gd-test-Ev-Msg-Begin-Entry>
           set event-action to event-action-fail 
           .
      * <TOTEM:END>
       gd-verifica-Ev-Msg-Begin-Entry.
      * <TOTEM:PARA. gd-verifica-Ev-Msg-Begin-Entry>
           set event-action to event-action-fail 
           .
      * <TOTEM:END>
       gd-verifica-Ev-Msg-Begin-Drag.
      * <TOTEM:PARA. gd-verifica-Ev-Msg-Begin-Drag>
           perform SPOSTAMENTO-V 
           .
      * <TOTEM:END>
       gd-verifica-Ev-Msg-End-Drag.
      * <TOTEM:PARA. gd-verifica-Ev-Msg-End-Drag>
           perform SPOSTAMENTO-V 
           .
      * <TOTEM:END>
       gd-verifica-Ev-Msg-Goto-Cell.
      * <TOTEM:PARA. gd-verifica-Ev-Msg-Goto-Cell>
           perform SPOSTAMENTO-V 
           .
      * <TOTEM:END>
       gd-verifica-Ev-Msg-Goto-Cell-Drag.
      * <TOTEM:PARA. gd-verifica-Ev-Msg-Goto-Cell-Drag>
           perform SPOSTAMENTO-V 
           .
      * <TOTEM:END>
       gd-verifica-Ev-Msg-Goto-Cell-Mouse.
      * <TOTEM:PARA. gd-verifica-Ev-Msg-Goto-Cell-Mouse>
           perform SPOSTAMENTO-V 
           .
      * <TOTEM:END>
       pb-excel-c-LinkTo.
      * <TOTEM:PARA. pb-excel-c-LinkTo>
           perform PB-PROCEDI-C-LINKTO.
           inquire gd-cerca, last-row in tot-righe.
           if tot-righe = 1
              exit paragraph
           end-if.
           accept como-data from century-date.
           accept como-ora  from time.
           initialize wstampa       
           accept  wstampa  from environment "PATH_ST".
           inspect wstampa  replacing trailing spaces by low-value.
           string wstampa        delimited low-value 
                  "APP_CLIENTE_" delimited size
                  como-data      delimited size
                  "_"            delimited size
                  como-ora       delimited size
                  ".csv"         delimited size
             into wstampa
           end-string.                                           
           open output lineseq.                    
           
           string ";"                delimited size
                  ";"                delimited size
                  "Cliente:"         delimited size
                  ";"                delimited size
                  lab-cliente-c-buf  delimited size
              into line-riga  
           end-string
           write line-riga            
           string ";"                delimited size
                  ";"                delimited size
                  "Periodo:"         delimited size
                  ";"                delimited size
                  ef-dal-c-buf       delimited size
                  " - "              delimited size
                  ef-al-c-buf        delimited size
              into line-riga  
           end-string.
           write line-riga.
           write line-riga from spaces.

           initialize line-riga.
           string "Data"      delimited size
                  ";"         delimited size
                  "Ora"       delimited size
                  ";"         delimited size
                  "Stato"     delimited size
                  ";"         delimited size
                  "Recupero"  delimited size
                  ";"         delimited size
                  "Pagato"    delimited size
              into line-riga  
           end-string.
           write line-riga.

           perform varying riga from 2 by 1 
                     until riga > tot-righe
              inquire gd-cerca(riga, 1), cell-data in col-data-c
              inquire gd-cerca(riga, 2), cell-data in col-ora-c
              inquire gd-cerca(riga, 3), cell-data in col-stato-c
              inquire gd-cerca(riga, 4), cell-data in col-recupero-c
              inquire gd-cerca(riga, 5), cell-data in col-pag-c  
              string col-data-c      delimited size
                     ";"             delimited size
                     col-ora-c       delimited size
                     ";"             delimited size
                     col-stato-c     delimited size
                     ";"             delimited size
                     col-recupero-c  delimited size
                     ";"             delimited size
                     col-pag-c       delimited size
                 into line-riga      
              end-string
              write line-riga  
           end-perform.

           close lineseq.

           initialize cmd.
           string "START "       delimited size
                 x"22222022"     delimited size
                  wstampa        delimited size
                 x"22"           delimited size
                 into cmd
           end-string.
           call "C$SYSTEM" using cmd, 64
                          giving StatusCode 
                                           
           .
      * <TOTEM:END>
       pb-stampa-LinkTo.
      * <TOTEM:PARA. pb-stampa-LinkTo>
           perform PB-PROCEDI-C-LINKTO.
           inquire gd-cerca, last-row in tot-righe.
           if tot-righe = 1
              exit paragraph 
           end-if.
           set environment "PRINTER" to "-P SPOOLER". 
           initialize spooler-link
           call   "selprint" using selprint-linkage.
           cancel "selprint".

           if selprint-stampante = spaces
              exit paragraph
           end-if.
           accept como-data from century-date.
           accept como-ora  from time.

           move selprint-num-copie to SPL-NUM-COPIE.
           move selprint-stampante to SPL-NOME-STAMPANTE.

           string "APPUNTAMENTI CLIENTE " delimited size
                  lab-cliente-c-buf       delimited size
             into spl-nome-job
           end-string.
           set spl-apertura to true.
           set spl-vertical to true.
           set WFDEVICE-WIN-PRINTER    to true.
           call "spooler" using spooler-link.
           if spl-sta-annu
              set errori to true
           else   
              perform CARICA-FONT
           end-if.              

           perform STAMPA-INTESTAZIONE.

           move 0 to r-stampa resto pag-di.
           subtract 1 from tot-righe.
           if tot-righe > 44
              divide tot-righe by 44 giving pag-di remainder resto
              if resto > 0 add 1 to pag-di end-if
           else
              move 1 to pag-di
           end-if.
           add 1 to tot-righe.

           move 1 to pag.
           perform varying riga from 2 by 1 
                     until riga > tot-righe
              if r-stampa = 44           
                 perform STAMPA-PIEDE
                 add 1 to pag
                 perform SALTO-PAGINA
                 perform STAMPA-INTESTAZIONE
                 move 0 to r-stampa
              end-if

              add 1 to r-stampa
              inquire gd-cerca(riga, 1), cell-data in r-data-c
              inquire gd-cerca(riga, 2), cell-data in r-ora-c
              inquire gd-cerca(riga, 3), cell-data in r-stato-c
              inquire gd-cerca(riga, 4), cell-data in r-recupero-c
              inquire gd-cerca(riga, 5), cell-data in r-pag-c  
              move riga-stampa to spl-riga-stampa
              perform SCRIVI
           end-perform.   
           perform STAMPA-PIEDE.  

           set spl-chiusura to true,
           call   "spooler" using spooler-link.

      ***---
       STAMPA-PIEDE.               
           move pag to pag-x.
           inspect pag-x replacing leading x"30" by x"20".
           call "C$JUSTIFY" using pag-x, "L".
           inspect pag-x replacing trailing spaces by low-value,

           move pag-di to pag-di-x.
           inspect pag-di-x replacing leading x"30" by x"20".
           call "C$JUSTIFY" using pag-di-x, "L".
           inspect pag-di-X replacing trailing spaces by low-value,

           initialize p-pag.
           string pag-x    delimited low-value
                  " di "   delimited size
                  pag-di-x delimited low-value 
             into p-pag
           end-string.
           move 27,9 to spl-riga.
           perform STAMPA-LINEA.
 
           move 27,6 to spl-riga.
           initialize spl-riga-stampa.
           perform DATE-TO-SCREEN.
           move como-data to p-data.
           move como-ora(1:2) to p-ora(1:2).
           move "."           to p-ora(3:1).
           move como-ora(3:2) to p-ora(4:2).
           move r-piede to spl-riga-stampa.
           perform SCRIVI.       

      ***---                      12,28 6,38
       STAMPA-BITMAP.
           |IMMAGINE                                 
           accept path-logo from environment "BMP_LOGO"
           move 0 to LogoHandle.
           call "W$BITMAP" using WBITMAP-LOAD, path-logo,
                          giving LogoHandle.
      
           initialize spooler-link.
           set spl-bitmap to true.
           move 5,5 to spl-colonna.
           move 3,5 to spl-riga.
           move LogoHandle   to spl-hbitmap.
      
           move  3,50 to spl-bitmap-height.
           move 6,20  to spl-bitmap-width.
      
           call "spooler" using spooler-link.  
            
      ***---
       STAMPA-LINEA.
           move 8                  to spl-pen-width.
           move 1,0                to spl-colonna.
           move 19,2               to spl-colonna-fine.
           move spl-riga           to spl-riga-fine.
           set  spl-oggetto        to true.
           set  spl-linea          to true.
           set  spl-pen-solid      to true.
           set  spl-nero           to true.
           call "spooler"       using spooler-link.

      ***---
       SCRIVI.
           add  0,5           to spl-riga.
           set  spl-stringa   to true.
           call "spooler"  using spooler-link.

      ***---
       SALTO-PAGINA.
           set spl-salto-pagina to true.
           call "spooler" using spooler-link.

      ***---
       CARICA-FONT.          
           initialize wfont-data CourierNew.
           move 10 to wfont-size.
           move "Courier New"        to wfont-name.
           set  wfcharset-dont-care  to true.
           set  wfont-bold           to true.
           set  wfont-italic         to true.
           set  wfont-underline      to false.
           set  wfont-strikeout      to false.
           set  wfont-fixed-pitch    to false.
           move 0                    to wfont-char-set.
           set  wfdevice-win-printer to true. |E' un carattere per la stampante
           call "W$FONT" using wfont-get-font, CourierNew, wfont-data.

      ***---
       STAMPA-INTESTAZIONE.
           move 1,5 to spl-riga. 
           move 7,5 to spl-colonna.                      
           move r-testata1 to spl-riga-stampa.  
           perform SCRIVI.                           
           move lab-cliente-c-buf to t2-cliente.  
           move r-testata2   to spl-riga-stampa.  
           perform SCRIVI.                      
           move ef-dal-c-buf to t3-dal.
           move ef-al-c-buf  to t3-al.            
           move r-testata3   to spl-riga-stampa.  
           perform SCRIVI.                      
           move 4,60 to spl-riga.
           perform STAMPA-LINEA.
           perform STAMPA-BITMAP.
           move 1 to spl-colonna.
           move 4,30 to spl-riga.
           move r-titolo to spl-riga-stampa.
           perform SCRIVI.      
           move 5,35 to spl-riga.
           perform STAMPA-LINEA.
           move 5,1 to spl-riga 
           .
      * <TOTEM:END>

      *{TOTEM}END

      *{TOTEM}SHOW-MSG
       MESSAGE-FOR-FILEERROR.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
              MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           .

       SHOW-TRANSACTION-ROUTINE.
           IF TOTEM-TRANSACTION-FLAG = SPACES
              IF TRANSACTION-STATUS NOT = 0
                 STRING "TRANSACTION ERROR ", TRANSACTION-STATUS
                    DELIMITED BY SIZE INTO TOTEM-MSG-1
              END-IF
           ELSE
              PERFORM SHOW-MSG-ROUTINE
              IF TRANSACTION-STATUS = 0
                 MOVE "Transazione terminata con Rollback." TO 
           TOTEM-MSG-3
              ELSE
                 STRING "TRANSACTION ERROR ", TRANSACTION-STATUS
                    DELIMITED BY SIZE INTO TOTEM-MSG-3
              END-IF
           END-IF
           .

       SHOW-MSG-ROUTINE.
           MOVE SPACE TO TOTEM-MSG-1 TOTEM-MSG-2 TOTEM-MSG-3
           EVALUATE TOTEM-MSG-ID
               WHEN "10"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Nessun altro dato." TO TOTEM-MSG-2
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "22"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Chiave Duplicata." TO TOTEM-MSG-2
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "23"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Raggiunta fine file." TO TOTEM-MSG-2
                    MOVE MB-WARNING-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "101"
                    MOVE "Terminare l'applicazione?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "201"
                    MOVE "Aggiungere un nuovo record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "202"
                    MOVE "Aggiornare il Record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "203"
                    MOVE "Cancellare il Record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "204"
                    MOVE "Chiave duplicata." TO TOTEM-MSG-1
                    MOVE MB-WARNING-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "301"
                    MOVE "Inserimento avvenuto con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "302"
                    MOVE "Aggiornamento avvenuto con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "303"
                    MOVE "Cancellazione avvenuta con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "401"
                    MOVE "Shell non trovata." TO TOTEM-MSG-1
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN OTHER
                    MOVE TEXT-MESSAGE TO TOTEM-MSG-1
                    STRING "FILE:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-3
                    MOVE 0 TO TOTEM-IDX1
                    INSPECT TOTEM-MSG-3 TALLYING TOTEM-IDX1
                       FOR TRAILING SPACE
                    STRING TOTEM-MSG-3(1:TOTEM-MSG-LENGTH - 
           TOTEM-IDX1), 
                       ", FILE STATUS ", PRIMARY-ERROR "," 
                       SECONDARY-ERROR
                    DELIMITED BY SIZE INTO TOTEM-MSG-2
                    MOVE SPACES TO TOTEM-MSG-3
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
           END-EVALUATE
           PERFORM MESSAGE-BOX-ROUTINE
           .

       MESSAGE-BOX-ROUTINE.
           MOVE 1 TO TOTEM-MSG-TEXT-POINTER
           IF TOTEM-MSG-1 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-1 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              STRING TOTEM-MSG-1( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                 DELIMITED BY SIZE
                 INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-2 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-2 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              IF TOTEM-MSG-TEXT-POINTER > 1
                 STRING X"0A" DELIMITED BY SIZE
                     INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
              END-IF
              STRING TOTEM-MSG-2( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                  DELIMITED BY SIZE
                  INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-3 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-3 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              IF TOTEM-MSG-TEXT-POINTER > 1
                 STRING X"0A" DELIMITED BY SIZE
                     INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
              END-IF
              STRING TOTEM-MSG-3( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                  DELIMITED BY SIZE
                  INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-TEXT-POINTER = 1
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-TEXT TALLYING TOTEM-MSG-SIZE FOR 
           TRAILING SPACE
                  COMPUTE TOTEM-MSG-TEXT-POINTER = 
           TOTEM-MSG-FULL-LENGTH - TOTEM-MSG-SIZE + 1
           END-IF
           MOVE LOW-VALUES TO TOTEM-MSG-TEXT(TOTEM-MSG-TEXT-POINTER : 1 
           )
           .

       MESSAGE-BOX-DISPLAY.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

      *{TOTEM}END

