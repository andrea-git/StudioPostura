      *{TOTEM}PRG-COMMENT
      * schedacli.Cbl
      * schedacli.Cbl is generated by TOTEM
      * This is a generated file. DO NOT modify this file directly.
      *{TOTEM}END
       IDENTIFICATION       DIVISION.
      *{TOTEM}PRGID
       PROGRAM-ID.          schedacli.
       AUTHOR.              ANDREA EVENTI.
       DATE-WRITTEN.        lunedì 9 settembre 2013 10:09:32.
       REMARKS.
      *{TOTEM}END

       ENVIRONMENT          DIVISION.
       CONFIGURATION        SECTION.
       SPECIAL-NAMES.
      *{TOTEM}SPECIAL-NAME
      * <TOTEM:EPT. INIT:schedacli, INIT:schedacli, SpecialName>
      * <TOTEM:END>
      *{TOTEM}END
      *{TOTEM}ACTIVEX-DEF
      *{TOTEM}END
      *{TOTEM}DECIMAL-POINT
           DECIMAL-POINT IS COMMA.
      *{TOTEM}END

       INPUT-OUTPUT         SECTION.
       FILE-CONTROL.
      *{TOTEM}FILE-CONTROL
           COPY "rschede.sl".
           COPY "tschede.sl".
           COPY "clienti.sl".
           COPY "articoli.sl".
           COPY "rlistini.sl".
           COPY "tipocli.sl".
           COPY "tlistini.sl".
      *{TOTEM}END
       DATA                 DIVISION.
       FILE                 SECTION.
      *{TOTEM}FILE
           COPY "rschede.fd".
           COPY "tschede.fd".
           COPY "clienti.fd".
           COPY "articoli.fd".
           COPY "rlistini.fd".
           COPY "tipocli.fd".
           COPY "tlistini.fd".
      *{TOTEM}END

       WORKING-STORAGE      SECTION.
      *{TOTEM}ACU-DEF
               COPY "acugui.def".
               COPY "acucobol.def".
               COPY "fonts.def".
               COPY "crtvars.def".
               COPY "showmsg.def".
               COPY "totem.def".
               COPY "comune.def".
               COPY "custom.def".
               COPY "UTYDATA.DEF".
      *{TOTEM}END

      *{TOTEM}COPY-WORKING
      * Key Status
       77 Key-Status IS SPECIAL-NAMES CRT STATUS PIC 9(5) VALUE 0.
          88 Enter-Pushed VALUE 13.
          88 Exit-Pushed VALUE 27.
          88 Message-Received VALUE 95.
          88 Event-Occurred VALUE 96.
          88 Screen-No-Input-Field VALUE 97.
          88 Screen-Time-Out VALUE 99.
      * Properties & User defined Working Stoarge
       78 titolo VALUE IS "Studio - Schede Clienti". 
           COPY  "LINK-VDOCUM.DEF".
       77 num-param        PIC  9
                  USAGE IS COMP-1
                  VALUE IS 0.
       77 RigaCambiata     PIC  9(5)
                  VALUE IS 0.
       77 ColonnaCambiata  PIC  9(5)
                  VALUE IS 0.
       77 Form1-Tb-1-Handle
                  USAGE IS HANDLE OF WINDOW.
       77 val-ini          PIC  99/99/9999.
       77 store-ini        PIC  9(8).
       77 store-codice     PIC  9(5).
       77 data-oggi        PIC  9(8).
       77 toolbar-bmp      PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 E-ESCI           PIC  9
                  VALUE IS 1.
       77 E-NUOVO          PIC  9
                  VALUE IS 1.
       77 E-CANCELLA       PIC  9
                  VALUE IS 1.
       77 E-SALVA          PIC  9
                  VALUE IS 1.
       77 E-ANTEPRIMA      PIC  9
                  VALUE IS 1.
       77 E-MODIFICA       PIC  9
                  VALUE IS 1.
       77 E-STAMPA         PIC  9
                  VALUE IS 0.
       77 E-CERCA          PIC  9
                  VALUE IS 0.
       77 E-SELEZIONA      PIC  9
                  VALUE IS 1.
       77 Small-Font
                  USAGE IS HANDLE OF FONT SMALL-FONT.
       77 Form1-St-1-Handle
                  USAGE IS HANDLE OF STATUS-BAR.
       77 form1-Handle
                  USAGE IS HANDLE OF WINDOW.
       77 como-qta         PIC  9(6).
       77 link-stampante   PIC  x(200).
       77 num-doc          PIC  9(6).
       77 como-prz         PIC  9(12)v99.
       77 cmo-sc           PIC  9(12)v99.
       77 como-netto       PIC  9(12)v99.
       77 AUTO-ID          PIC  9(6)
                  VALUE IS 0,00.
       77 STATUS-articoli  PIC  X(2).
           88 Valid-STATUS-articoli VALUE IS "00" THRU "09". 
       77 STATUS-clienti   PIC  X(2).
           88 Valid-STATUS-clienti VALUE IS "00" THRU "09". 
       77 STATUS-rschede   PIC  X(2).
           88 Valid-STATUS-rschede VALUE IS "00" THRU "09". 
       77 STATUS-tschede   PIC  X(2).
           88 Valid-STATUS-tschede VALUE IS "00" THRU "09". 
       77 BOTTONE-annulla-BMP          PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 Form1-Tb-1-Handlea
                  USAGE IS HANDLE OF WINDOW.
       77 RigheIniziali    PIC  9(3).
       77 store-articolo   PIC  x(6).
       77 PathBmpDefault   PIC  x(256).
       77 prezzo-scelto    PIC  9(6)v99.
       77 como-x           PIC  x.
       01 gruppo-hidden.
           05 hid-documento    PIC  9.
               88 hid-fattura VALUE IS 1    WHEN SET TO FALSE  0. 
               88 hid-corrisp VALUE IS 2    WHEN SET TO FALSE  0. 
       01 FILLER           PIC  9.
           88 SceltoPrezzo VALUE IS 1    WHEN SET TO FALSE  0. 
       01 FILLER           PIC  9.
           88 VediFattura VALUE IS 1    WHEN SET TO FALSE  0. 
       01 FILLER           PIC  9.
           88 SceltoCliente VALUE IS 1    WHEN SET TO FALSE  0. 
       01 FILLER           PIC  9.
           88 RigaVuota VALUE IS 1    WHEN SET TO FALSE  0. 
       01 save-key.
           05 save-cliente     PIC  x(6).
       77 como-old-rsc-articolo        PIC  x(6).
       77 como-old-rsc-data            PIC  9(8).
       01 rec-grid.
           05 col-data         PIC  99/99/9999.
           05 col-art          PIC  x(6).
           05 col-des          PIC  x(50).
           05 col-qta          PIC  zzz.zz9
                      BLANK WHEN ZERO.
           05 col-prz          PIC  zzz.zz9,99
                      BLANK WHEN ZERO.
           05 col-sc1          PIC  zz9,99
                      BLANK WHEN ZERO.
           05 col-netto        PIC  zzz.zz9,99
                      BLANK WHEN ZERO.
           05 col-note         PIC  x(150).
           05 col-numdoc       PIC  z(6).
           05 col-datadoc      PIC  zz/zz/zzzz.
       01 old-rec-grid.
           05 old-col-data     PIC  99/99/9999.
           05 old-col-art      PIC  x(6).
           05 old-col-des      PIC  x(50).
           05 old-col-qta      PIC  zzz.zz9
                      BLANK WHEN ZERO.
           05 old-col-prz      PIC  zzz.zz9,99
                      BLANK WHEN ZERO.
           05 old-col-sc1      PIC  zz9,99
                      BLANK WHEN ZERO.
           05 old-col-netto    PIC  zzz.zz9,99
                      BLANK WHEN ZERO.
           05 old-col-note     PIC  x(150).
           05 old-col-numdoc   PIC  z(6).
           05 old-col-datadoc  PIC  zz/zz/zzzz.
       77 STRIP-GRID-GCLIENTI-BMP      PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 Calibri14-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 Calibri14B-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 LOGO-PICCOLO-BMP PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 STATUS-rlistini  PIC  X(2).
           88 Valid-STATUS-rlistini VALUE IS "00" THRU "09". 
       77 cambia-cliente-bmp           PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 Calibri12-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 Calibri12B-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 lab-cliente-buf  PIC  X(100).
       77 lab-indirizzo-buf            PIC  X(50).
       77 lab-citta-buf    PIC  X(50).
       77 lab-prov-buf     PIC  xx.
       77 lab-mail-buf     PIC  X(50).
       77 lab-tel-buf      PIC  X(20).
       77 lab-cell-buf     PIC  X(20).
       77 lab-tipo-buf     PIC  X(50).
       77 lab-sconto1-buf  PIC  zz9,99.
       77 lab-sconto2-buf  PIC  zz9,99.
       77 contact-bmp
                  USAGE IS HANDLE OF BITMAP.
       77 Calibri18B-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 lab-scontoa-buf  PIC  X(8).
       77 default-bmp
                  USAGE IS HANDLE OF BITMAP.
       77 lab-scont-buf    PIC  x.
       77 STATUS-tipocli   PIC  X(2).
           88 Valid-STATUS-tipocli VALUE IS "00" THRU "09". 
       77 v-sconto         PIC  9
                  VALUE IS 0.
       77 como-col-data    PIC  9(8).
       77 como-col-qta     PIC  9(8).
       77 como-col-prz     PIC  9(8)v99.
       77 como-col-sc1     PIC  9(8)v99.
       77 como-col-netto   PIC  9(8)v99.
       77 como-col-numdoc  PIC  9(6).
       77 como-col-datadoc PIC  9(8).
       77 note-cliente-bmp PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 v-note           PIC  9
                  VALUE IS 0.
       77 Calibri16B-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 form-prezz-SF-HANDLE
                  USAGE IS HANDLE OF WINDOW.
       01 rec-prezzi.
           05 col-listino      PIC  9(5).
           05 col-descriz      PIC  x(50).
           05 col-valido       PIC  99/99/9999.
           05 col-per          PIC  X(50).
           05 col-prz1         PIC  zzz.zz9,99.
           05 col-prz2         PIC  zzz.zz9,99.
           05 col-prz3         PIC  zzz.zz9,99.
       77 STATUS-tlistini  PIC  X(2).
           88 Valid-STATUS-tlistini VALUE IS "00" THRU "09". 
       77 lab-art-buf      PIC  x(100).
       77 v-prezzi         PIC  9
                  VALUE IS 0.
       77 Calibri12BI-Occidentale
                  USAGE IS HANDLE OF FONT.

      ***********************************************************
      *   Code Gen's Buffer                                     *
      ***********************************************************
       77 STATUS-Form1-FLAG-REFRESH PIC  9.
          88 Form1-FLAG-REFRESH  VALUE 1 FALSE 0. 
      * DATA CONTROL BUFFER
       01 Form1-BUF.
      * Data.Entry-Field
              05 ef-cliente-BUF PIC x(6).
              05 ef-cliente-VALUEBUF PIC x(6).

       77 TMP-Form1-KEY1-ORDER  PIC X VALUE "A".
       77 TMP-Form1-tschede-RESTOREBUF  PIC X(574).
       77 TMP-Form1-KEYIS  PIC 9(3) VALUE 1.
       77 Form1-MULKEY-TMPBUF   PIC X(574).
       77 STATUS-form-prezzi-FLAG-REFRESH PIC  9.
          88 form-prezzi-FLAG-REFRESH  VALUE 1 FALSE 0. 
       77 TMP-DataSet1-rschede-BUF     PIC X(848).
       77 TMP-DataSet1-tschede-BUF     PIC X(574).
       77 TMP-DataSet1-clienti-BUF     PIC X(2204).
       77 TMP-DataSet1-articoli-BUF     PIC X(810).
       77 TMP-DataSet1-rlistini-BUF     PIC X(607).
       77 TMP-DataSet1-tipocli-BUF     PIC X(615).
       77 TMP-DataSet1-tlistini-BUF     PIC X(624).
      * VARIABLES FOR RECORD LENGTH.
       77  TotemFdSlRecordClearOffset   PIC 9(5) COMP-4.
       77  TotemFdSlRecordLength        PIC 9(5) COMP-4.
      * FILE'S LOCK MODE FLAG
       77 DataSet1-rschede-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-rschede-LOCK  VALUE "Y".
       77 DataSet1-rschede-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-rschede-KEY-Asc  VALUE "A".
          88 DataSet1-rschede-KEY-Desc VALUE "D".
       77 DataSet1-tschede-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tschede-LOCK  VALUE "Y".
       77 DataSet1-KEYIS   PIC 9(3) VALUE 1.
       77 DataSet1-tschede-KEY1-ORDER  PIC X VALUE "A".
          88 DataSet1-tschede-KEY1-Asc  VALUE "A".
          88 DataSet1-tschede-KEY1-Desc VALUE "D".
       77 DataSet1-clienti-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-clienti-LOCK  VALUE "Y".
       77 DataSet1-clienti-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-clienti-KEY-Asc  VALUE "A".
          88 DataSet1-clienti-KEY-Desc VALUE "D".
       77 DataSet1-articoli-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-articoli-LOCK  VALUE "Y".
       77 DataSet1-articoli-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-articoli-KEY-Asc  VALUE "A".
          88 DataSet1-articoli-KEY-Desc VALUE "D".
       77 DataSet1-rlistini-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-rlistini-LOCK  VALUE "Y".
       77 DataSet1-rlistini-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-rlistini-KEY-Asc  VALUE "A".
          88 DataSet1-rlistini-KEY-Desc VALUE "D".
       77 DataSet1-tipocli-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tipocli-LOCK  VALUE "Y".
       77 DataSet1-tipocli-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tipocli-KEY-Asc  VALUE "A".
          88 DataSet1-tipocli-KEY-Desc VALUE "D".
       77 DataSet1-tlistini-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tlistini-LOCK  VALUE "Y".
       77 DataSet1-tlistini-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tlistini-KEY-Asc  VALUE "A".
          88 DataSet1-tlistini-KEY-Desc VALUE "D".

       77 rschede-rsc-k-art-SPLITBUF  PIC X(21).
       77 rschede-rsc-k-cli-SPLITBUF  PIC X(21).
       77 rschede-rsc-k-fatart-SPLITBUF  PIC X(21).
       77 rschede-rsc-k-fatcli-SPLITBUF  PIC X(21).
       77 rschede-rsc-k-corart-SPLITBUF  PIC X(21).
       77 rschede-rsc-k-corcli-SPLITBUF  PIC X(21).
       77 tschede-tsc-k-data-SPLITBUF  PIC X(15).
       77 tschede-tsc-k-cliente-SPLITBUF  PIC X(7).
       77 clienti-cli-k-ragsoc-SPLITBUF  PIC X(57).
       77 articoli-art-k-descrizione-SPLITBUF  PIC X(57).
       77 rlistini-rls-k-ricerca-SPLITBUF  PIC X(22).
       77 tipocli-tcl-k-descrizione-SPLITBUF  PIC X(57).
       77 tlistini-tls-k-tipo-SPLITBUF  PIC X(21).
       77 tlistini-tls-k-descrizione-SPLITBUF  PIC X(56).

       78  78-col-data       value 1. 
       78  78-col-art        value 2. 
       78  78-col-des        value 3. 
       78  78-col-qta        value 4. 
       78  78-col-prz        value 5. 
       78  78-col-sc1        value 6. 
      ***** 78  78-col-sc2        value 7. 
       78  78-col-netto      value 7. 
       78  78-col-note       value 8. 
       78  78-col-numdoc     value 9. 
       78  78-col-datadoc    value 10. 

       78  78-max-colonne    value 10.

       77  como-riga         pic 9(4).

       01                    pic 9.
           88 controllo-finale  value 1 false zero.

       01                 pic 9.
           88 s-excell    value 1.
           88 s-stampa    value 2.
           88 s-anteprima value 3.

       77  messaggio      pic x(200).  

       01 OLD-tsc-rec.
           05 OLD-tsc-chiave.
               10 OLD-tsc-codice       PIC  9(6).
           05 OLD-tsc-dati.
               10 OLD-tsc-cliente      PIC  x(6).
               10 OLD-tsc-data-creazione           PIC  9(8).
               10 OLD-tsc-vuoti.
                   15 FILLER           PIC  9(18).
                   15 FILLER           PIC  9(18).
                   15 FILLER           PIC  9(18).
                   15 FILLER           PIC  x(500).

       01 OLD-rsc-rec.
           05 OLD-rsc-chiave.
               10 OLD-rsc-codice       PIC  9(6).
               10 OLD-rsc-data         PIC  9(8).
               10 OLD-rsc-articolo     PIC  x(6).
               10 OLD-rsc-riga         PIC  9(6).
           05 OLD-rsc-dati.
               10 OLD-rsc-cliente      PIC  x(6).
               10 OLD-rsc-qta          PIC  9(8).
               10 OLD-rsc-prz          PIC  9(6)v99.
               10 OLD-rsc-sconto       PIC  9(3)v99.
               10 OLD-rsc-netto        PIC  9(6)v99.
               10 OLD-rsc-note         PIC  x(150).
               10 OLD-rsc-fattura.
                   15 OLD-rsc-numfat       PIC  9(6).
                   15 OLD-rsc-datafat      PIC  9(8).
               10 OLD-rsc-corrisp.
                   15 OLD-rsc-numcor       PIC  9(6).
                   15 OLD-rsc-datacor      PIC  9(8).
               10 OLD-rsc-vuoti.
                   15 FILLER           PIC  9(18).
                   15 FILLER           PIC  9(18).
                   15 FILLER           PIC  9(18).
                   15 FILLER           PIC  x(500).
      *{TOTEM}END

      *{TOTEM}ID-LOGICI
      ***** Elenco ID Logici *****
       78  78-ID-ef-cliente VALUE 5001.
       78  78-ID-gd1 VALUE 5002.
       78  78-ID-gd-prezzi VALUE 5001.
      ***** Fine ID Logici *****
      *{TOTEM}END

       LINKAGE          SECTION.
      *{TOTEM}LINKAGE
           COPY  "BLOCKPGM.LKS".
       01 link-codice      PIC  9(6).

      *{TOTEM}END

       SCREEN           SECTION.
      *{TOTEM}COPY-SCREEN
      * FORM
       01 
           Form1, 
           AFTER PROCEDURE Form1-AfterProcedure,
           BEFORE PROCEDURE Form1-BeforeProcedure,
           .

      * ENTRY FIELD
       05
           ef-cliente, 
           Entry-Field, 
           COL 2,00, 
           LINE 3,43,
           LINES 1,30 ,
           SIZE 10,80 ,
           BOXED,
           COLOR IS 513,
           ENABLED mod-k,
           ID IS 78-ID-ef-cliente,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           MAX-TEXT 6,
           VALUE ef-cliente-BUF,
           .

      * GRID
       05
           gd1, 
           Grid, 
           COL 2,00, 
           LINE 10,70,
           LINES 15,74 ,
           SIZE 111,30 ,
           ADJUSTABLE-COLUMNS,
           BOXED,
           CENTERED-HEADINGS,
           DATA-COLUMNS (1, 11, 17, 67, 74, 84, 90, 100, 250, 256),
           ALIGNMENT ("C", "U", "U", "R", "R", "R", "R", "U", "R", "C"),
           SEPARATION (5, 5, 5, 5, 5, 5, 5, 5, 5, 5),
           DATA-TYPES ("D(10)", "X(6)", "x(50)", "zzz.zz9", "zzz.zz9,99"
           , "zz9,99", "zzz.zz9,99", "X(150)", "9(6)", "D(10)"),
           NUM-COL-HEADINGS 1,
           COLUMN-HEADINGS,
           CURSOR-FRAME-WIDTH 2,
           DIVIDER-COLOR 1,
           FONT IS Calibri12-Occidentale,
           HEADING-COLOR 257,
           HEADING-DIVIDER-COLOR 1,
           ID IS 78-ID-gd1,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TILED-HEADINGS,
           VIRTUAL-WIDTH 134,
           VPADDING 5,
           VSCROLL,
           EVENT PROCEDURE Screen1-Gd-1-Event-Proc,
           .

      * LABEL
       05
           Screen1-La-1, 
           Label, 
           COL 2,00, 
           LINE 2,00,
           LINES 1,30 ,
           SIZE 10,80 ,
           ID IS 100,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE "Cliente",
           .

      * BAR
       05
           Screen1-Br-1, 
           Bar,
           COL 1,00, 
           LINE 10,04,
           SIZE 113,50 ,
           ID IS 22,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           COLORS (9, 9),
           WIDTH 2,
           .

      * LABEL
       05
           Screen1-blockpgm-1, 
           Label, 
           COL 83,70, 
           LINE 1,00,
           LINES 0,61 ,
           SIZE 1,50 ,
           ID IS 10,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "BlockPgm",
           VISIBLE v-custom,
           .

      * LABEL
       05
           Screen1-Custom1-1, 
           Label, 
           COL 90,70, 
           LINE 1,13,
           LINES 0,52 ,
           SIZE 0,80 ,
           ID IS 12,
           TRANSPARENT,
           TITLE "CUSTOM CONTROL",
           VISIBLE v-custom,
           .

      * FRAME
       05
           Screen1-Fr-1, 
           Frame, 
           COL 14,00, 
           LINE 1,22,
           LINES 8,35 ,
           SIZE 99,40 ,
           COLOR IS 11,
           FONT IS Calibri14B-Occidentale,
           ID IS 1,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           HEAVY,
           .

      * LABEL
       05
           lab-cliente, 
           Label, 
           COL 16,00, 
           LINE 2,26,
           LINES 1,30 ,
           SIZE 77,00 ,
           COLOR IS 9,
           FONT IS Calibri16B-Occidentale,
           ID IS 3,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-cliente-buf,
           .

      * LABEL
       05
           lab-indirizzo, 
           Label, 
           COL 16,00, 
           LINE 3,96,
           LINES 1,30 ,
           SIZE 35,00 ,
           COLOR IS 9,
           FONT IS Calibri16B-Occidentale,
           ID IS 4,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-indirizzo-buf,
           .

      * LABEL
       05
           lab-prov, 
           Label, 
           COL 90,00, 
           LINE 3,96,
           LINES 1,30 ,
           SIZE 4,00 ,
           COLOR IS 9,
           FONT IS Calibri16B-Occidentale,
           ID IS 5,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-prov-buf,
           .

      * LABEL
       05
           lab-citta, 
           Label, 
           COL 54,00, 
           LINE 3,96,
           LINES 1,30 ,
           SIZE 35,00 ,
           COLOR IS 9,
           FONT IS Calibri16B-Occidentale,
           ID IS 6,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-citta-buf,
           .

      * LABEL
       05
           lab-mail, 
           Label, 
           COL 16,00, 
           LINE 5,70,
           LINES 1,30 ,
           SIZE 35,00 ,
           COLOR IS 9,
           FONT IS Calibri16B-Occidentale,
           ID IS 7,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-mail-buf,
           .

      * LABEL
       05
           lab-tel, 
           Label, 
           COL 78,00, 
           LINE 5,70,
           LINES 1,30 ,
           SIZE 16,00 ,
           COLOR IS 9,
           FONT IS Calibri16B-Occidentale,
           ID IS 8,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-tel-buf,
           .

      * LABEL
       05
           lab-cell, 
           Label, 
           COL 54,00, 
           LINE 5,70,
           LINES 1,30 ,
           SIZE 22,00 ,
           COLOR IS 9,
           FONT IS Calibri16B-Occidentale,
           ID IS 9,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-cell-buf,
           .

      * LABEL
       05
           lab-tipo, 
           Label, 
           COL 16,00, 
           LINE 7,44,
           LINES 1,30 ,
           SIZE 35,00 ,
           COLOR IS 9,
           FONT IS Calibri16B-Occidentale,
           ID IS 11,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-tipo-buf,
           .

      * LABEL
       05
           lab-sconto1, 
           Label, 
           COL 64,00, 
           LINE 7,44,
           LINES 1,30 ,
           SIZE 6,00 ,
           COLOR IS 9,
           FONT IS Calibri16B-Occidentale,
           ID IS 13,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           TRANSPARENT,
           TITLE lab-sconto1-buf,
           VISIBLE v-sconto,
           .

      * BITMAP
       05
           bmp-contact, 
           Bitmap, 
           COL 94,80, 
           LINE 1,92,
           LINES 7,43 ,
           SIZE 18,10 ,
           BITMAP-HANDLE contact-bmp,
           BITMAP-NUMBER 1,
           ID IS 14,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           .

      * BAR
       05
           Screen1-Br-2, 
           Bar,
           COL 94,30, 
           LINE 1,70,
           LINES 7,87 ,
           COLOR IS 11,
           ID IS 15,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           WIDTH 2,
           .

      * LABEL
       05
           lab-scontoa, 
           Label, 
           COL 54,00, 
           LINE 7,44,
           LINES 1,30 ,
           SIZE 9,00 ,
           COLOR IS 9,
           FONT IS Calibri16B-Occidentale,
           ID IS 16,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           LEFT,
           TRANSPARENT,
           TITLE lab-scontoa-buf,
           .

      * PUSH BUTTON
       05
           pb-note, 
           Push-Button, 
           COL 88,50, 
           LINE 7,05,
           LINES 2,39 ,
           SIZE 5,60 ,
           BITMAP-HANDLE NOTE_CLIENTE-BMP,
           BITMAP-NUMBER 1,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 1000,
           ID IS 20,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           VISIBLE v-note,
           .

      * PUSH BUTTON
       05
           pb-cliente, 
           Push-Button, 
           COL 2,00, 
           LINE 5,35,
           LINES 4,17 ,
           SIZE 10,80 ,
           BITMAP-HANDLE CAMBIA-CLIENTE-BMP,
           BITMAP-NUMBER 1,
           FRAMED,
           SQUARE,
           ENABLED mod,
           EXCEPTION-VALUE 1001,
           ID IS 2,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           .

      * LABEL
       05
           Screen1-La-2a, 
           Label, 
           COL 45,00, 
           LINE 1,04,
           LINES 1,00 ,
           SIZE 18,20 ,
           COLOR IS 11,
           FONT IS Calibri14B-Occidentale,
           ID IS 19,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TITLE "INTESTAZIONE CLIENTE",
           .

      * TOOLBAR
       01
           Form1-Tb-1,
           .    

      * PUSH BUTTON
       05
           TOOL-ESCI, 
           Push-Button, 
           COL 1,00, 
           LINE 1,09,
           LINES 64,00 ,
           SIZE 48,00 ,
           BITMAP-HANDLE toolbar-bmp,
           BITMAP-NUMBER 1,
           FRAMED,
           SQUARE,
           ENABLED E-ESCI,
           EXCEPTION-VALUE 27,
           FLAT,
           FONT IS Calibri14-Occidentale,
           ID IS 72,
           SELF-ACT,
           ESCAPE-BUTTON,
           TITLE "Esci (Esc)",
           .

      * PUSH BUTTON
       05
           TOOL-NUOVO, 
           Push-Button, 
           COL 6,30, 
           LINE 1,09,
           LINES 64,00 ,
           SIZE 48,00 ,
           BITMAP-HANDLE toolbar-bmp,
           FRAMED,
           SQUARE,
           ENABLED E-NUOVO,
           EXCEPTION-VALUE 2,
           FLAT,
           FONT IS Calibri14-Occidentale,
           ID IS 73,
           SELF-ACT,
           TITLE "Nuovo (F2)",
           BITMAP-NUMBER BitmapNumNew
           .

      * PUSH BUTTON
       05
           TOOL-CANCELLA, 
           Push-Button, 
           COL 16,90, 
           LINE 1,09,
           LINES 64,00 ,
           SIZE 48,00 ,
           BITMAP-HANDLE toolbar-bmp,
           FRAMED,
           SQUARE,
           ENABLED E-CANCELLA,
           EXCEPTION-VALUE 4,
           FLAT,
           FONT IS Calibri14-Occidentale,
           ID IS 74,
           SELF-ACT,
           TITLE "Cancella (F4)",
           BITMAP-NUMBER BitmapNumDelete
           .

      * PUSH BUTTON
       05
           TOOL-SALVA, 
           Push-Button, 
           COL 11,60, 
           LINE 1,09,
           LINES 64,00 ,
           SIZE 48,00 ,
           BITMAP-HANDLE toolbar-bmp,
           FRAMED,
           SQUARE,
           ENABLED E-SALVA,
           EXCEPTION-VALUE 3,
           FLAT,
           FONT IS Calibri14-Occidentale,
           ID IS 75,
           SELF-ACT,
           TITLE "Salva (F3)",
           BITMAP-NUMBER BitmapNumSave
           .

      * PUSH BUTTON
       05
           TOOL-ANTEPRIMA, 
           Push-Button, 
           COL 27,50, 
           LINE 1,09,
           LINES 64,00 ,
           SIZE 48,00 ,
           BITMAP-HANDLE toolbar-bmp,
           BITMAP-NUMBER 6,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 6,
           FLAT,
           FONT IS Calibri14-Occidentale,
           ID IS 76,
           SELF-ACT,
           TITLE "Anteprima (F6)",
           .

      * CHECK BOX
       05
           TOOL-MODIFICA, 
           Check-Box, 
           COL 22,20, 
           LINE 1,09,
           LINES 64,00 ,
           SIZE 48,00 ,
           BITMAP-HANDLE toolbar-bmp,
           BITMAP-NUMBER 5,
           FRAMED,
           SQUARE,
           ENABLED E-MODIFICA,
           EXCEPTION-VALUE 150
           FLAT,
           FONT IS Calibri14-Occidentale,
           ID IS 77,
           SELF-ACT,
           TITLE "Modifica (F5)",
           VALUE MOD,
           BITMAP-NUMBER BitmapNumEdit
           AFTER PROCEDURE TOOL-MODIFICA-AfterProcedure,
           BEFORE PROCEDURE TOOL-MODIFICA-BeforeProcedure, 
           .
      * PUSH BUTTON
       05
           TOOL-STAMPA, 
           Push-Button, 
           COL 32,80, 
           LINE 1,09,
           LINES 64,00 ,
           SIZE 48,00 ,
           BITMAP-HANDLE toolbar-bmp,
           BITMAP-NUMBER 7,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 7,
           FLAT,
           FONT IS Calibri14-Occidentale,
           ID IS 110,
           SELF-ACT,
           TITLE "Stampa (F7)",
           .

      * PUSH BUTTON
       05
           TOOL-CERCA, 
           Push-Button, 
           COL 38,10, 
           LINE 1,09,
           LINES 64,00 ,
           SIZE 48,00 ,
           BITMAP-HANDLE toolbar-bmp,
           FRAMED,
           SQUARE,
           ENABLED E-CERCA,
           EXCEPTION-VALUE 8,
           FLAT,
           FONT IS Calibri14-Occidentale,
           ID IS 111,
           SELF-ACT,
           TITLE "Cerca (F8)",
           BITMAP-NUMBER BitmapNumZoom
           .

      * PUSH BUTTON
       05
           TOOL-SELEZIONA, 
           Push-Button, 
           COL 43,40, 
           LINE 1,09,
           LINES 64,00 ,
           SIZE 48,00 ,
           BITMAP-HANDLE toolbar-bmp,
           BITMAP-NUMBER 9,
           FRAMED,
           SQUARE,
           ENABLED E-SELEZIONA,
           EXCEPTION-VALUE 9,
           FLAT,
           FONT IS Calibri14-Occidentale,
           ID IS 112,
           SELF-ACT,
           TITLE "Seleziona (F9)",
           .

      * BITMAP
       05
           Form1-Bt-1, 
           Bitmap, 
           COL 109,70, 
           LINE 1,09,
           LINES 64,00 ,
           SIZE 48,00 ,
           BITMAP-HANDLE LOGO_PICCOLO-BMP,
           BITMAP-NUMBER 1,
           ID IS 123,
           .

      * FORM
       01 
           form-prezzi, 
           HELP-ID 1,
           AFTER PROCEDURE  form-prezzi-AFTER-SCREEN
           BEFORE PROCEDURE  form-prezzi-BEFORE-SCREEN
           .

      * GRID
       05
           gd-prezzi, 
           Grid, 
           COL 2,00, 
           LINE 12,10,
           LINES 17,70 CELLS,
           SIZE 111,90 CELLS,
           BOXED,
           DATA-COLUMNS (1, 6, 56, 66, 116, 126, 136),
           ALIGNMENT ("R", "U", "C", "U", "R", "R", "R"),
           SEPARATION (5, 5, 5, 5, 5, 5, 5),
           DATA-TYPES ("X", "X", "X", "X", "zzz.zz9,99", "zzz.zz9,99", 
           "zzz.zz9,99"),
           NUM-COL-HEADINGS 1,
           COLUMN-HEADINGS,
           CURSOR-FRAME-WIDTH 2,
           DIVIDER-COLOR 1,
           HEADING-COLOR 257,
           HEADING-DIVIDER-COLOR 1,
           ID IS 78-ID-gd-prezzi,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RECORD-DATA rec-prezzi,
           TILED-HEADINGS,
           VIRTUAL-WIDTH 100,
           VPADDING 5,
           VSCROLL,
           EVENT PROCEDURE form-prezz-Gd-1-Event-Proc,
           .

      * LABEL
       05
           form-prezz-La-1, 
           Label, 
           COL 8,00, 
           LINE 2,60,
           LINES 2,60 CELLS,
           SIZE 100,00 CELLS,
           COLOR IS 9,
           FONT IS Calibri14B-Occidentale,
           ID IS 2,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE "PREZZI PRESENTI SUI LISTINI",
           .

      * LABEL
       05
           lab-art, 
           Label, 
           COL 8,00, 
           LINE 6,40,
           LINES 2,60 CELLS,
           SIZE 100,00 CELLS,
           COLOR IS 9,
           FONT IS Calibri14B-Occidentale,
           ID IS 3,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE lab-art-buf,
           .

      * BAR
       05
           Screen1-Br-1a, 
           Bar,
           COL 1,00, 
           LINE 10,30,
           SIZE 114,00 CELLS,
           ID IS 22,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           COLORS (9, 9),
           WIDTH 2,
           .

      * BITMAP
       05
           Form1-Bt-1a, 
           Bitmap, 
           COL 110,20, 
           LINE 1,00,
           LINES 64,00 ,
           SIZE 48,00 ,
           BITMAP-HANDLE LOGO_PICCOLO-BMP,
           BITMAP-NUMBER 1,
           ID IS 123,
           .

      *{TOTEM}END

      *{TOTEM}LINKPARA
       PROCEDURE  DIVISION USING LK-BLOCKPGM, link-codice.
      *{TOTEM}END

      *{TOTEM}DECLARATIVE
       DECLARATIVES.
      * <TOTEM:EPT. INIT:schedacli, INIT:schedacli, BeforeDeclarative>
       TSCHEDE-ERROR SECTION.
           use after error procedure on tschede.
           set RecLocked to false.
           evaluate status-tschede
           when "35"
                display message "File [tschede] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [tschede] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[tschede] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           when "99"
           when "93"
                set RecLocked to true
                set errori    to true
                move 0 to mod
                modify tool-modifica, value = mod
                move 1 to mod-k
                display form1
                set StatusVisua to true
                perform STATUS-BAR-MSG
                move "00" to status-tschede
                if ReadSecca
                   read tschede       no lock 
                        invalid      continue
                        not invalid  perform FORM1-IUD-DISPLAY
                   end-read
                end-if
                display message box MSG-Record-gia-in-uso
                        title = tit-err
                        icon is mb-error-icon
           when "23"
                move 1 to mod-k
                move 0 to mod
                modify tool-modifica, value = mod
                set StatusVisua to true
                perform STATUS-BAR-MSG 
                if nuovo              
                   initialize tsc-dati of tschede
                              replacing numeric data by zeroes
                                   alphanumeric data by spaces
                   perform FORM1-FLD-TO-BUF
                   display form1-tb-1
                   set vecchio to true
                end-if      
                perform ABILITAZIONI
                display form1
                |RISETTO IL VALORE A "23" PERCHE DENTRO AL PAR. CLEAR-SCREEN
                |CON L'OPERAZIONE UNLOCK VIENE RISETTATO A ZERO COSICCHÈ 
                |QUANDO TORNA DENTRO AI PAR. DI SCORRIMENTO DI TOTEM SI 
                |TROVA IN UNA SITUAZIONE CORRETTA E PROSEGUE CON LA READ
                |USCENDO CON UN MESSAGGIO DI ERRORE DI TIPO "46"
                move "23" to status-tschede
           end-evaluate.
 
      ***---
       RSCHEDE-ERR SECTION.
           use after error procedure on rschede.
           set tutto-ok  to true.
           evaluate status-rschede
           when "35"
                display message "File [rschede] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [rschede] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[rschede] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.

      * <TOTEM:END>
       INPUT-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON INPUT.
       0100-DECL.
           EXIT.
       I-O-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON I-O.
       0200-DECL.
           EXIT.
       OUTPUT-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON OUTPUT.
       0300-DECL.
           EXIT.
       TRANSACTION-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON TRANSACTION.
       0400-DECL.
           EXIT.
       END DECLARATIVES.
      *{TOTEM}END

       MAIN-LOGIC.
      *{TOTEM}ENTRY-BEFPRG
      *    Before-Program
           PERFORM ginqui-Ev-Before-Program
      *{TOTEM}END
           PERFORM INITIALIZE-ROUTINE.
      * run main screen
      *{TOTEM}RUN-MAINSCR
           PERFORM Form1-OPEN-ROUTINE.
      *{TOTEM}END

      *{TOTEM}COPY-PROCEDURE
       EXIT-STOP-ROUTINE.
           PERFORM CLOSE-FILE-RTN
      * <TOTEM:EPT. INIT:schedacli, INIT:schedacli, BeforeDestroyResource>
      * <TOTEM:END>
           DESTROY Calibri12-Occidentale
           DESTROY Calibri12BI-Occidentale
           DESTROY Calibri12B-Occidentale
           DESTROY Calibri14B-Occidentale
           DESTROY Calibri16B-Occidentale
           DESTROY Calibri14-Occidentale
           CALL "w$bitmap" USING WBITMAP-DESTROY, NOTE_CLIENTE-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, CAMBIA-CLIENTE-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, toolbar-bmp
           CALL "w$bitmap" USING WBITMAP-DESTROY, LOGO_PICCOLO-BMP
      *    After-Program
           PERFORM ginqui-Ev-After-Program
           EXIT PROGRAM TOTEM-PgmStatus
           STOP RUN.

       INITIALIZE-ROUTINE.
      *    Before Init
      * initialize program status variable
           Initialize TOTEM-PgmStatus.
      * get system information
           ACCEPT SYSTEM-INFORMATION FROM SYSTEM-INFO.
      * get terminal information
           ACCEPT TERMINAL-ABILITIES FROM TERMINAL-INFO.
      * set font
           PERFORM INIT-FONT.
      * load bitmap
           PERFORM INIT-BMP.
      * load resource
           PERFORM INIT-RES.
      * create pop-up menu
           PERFORM INIT-POPUP.
      * open files
           PERFORM OPEN-FILE-RTN.
      *    After Init
           .
    
       INIT-FONT.
      * Calibri12-Occidentale
           INITIALIZE WFONT-DATA Calibri12-Occidentale
           MOVE 12 TO WFONT-SIZE
           MOVE "Calibri" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO FALSE
           SET WFONT-ITALIC TO FALSE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Calibri12-Occidentale, WFONT-DATA
      * Calibri12BI-Occidentale
           INITIALIZE WFONT-DATA Calibri12BI-Occidentale
           MOVE 12 TO WFONT-SIZE
           MOVE "Calibri" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO TRUE
           SET WFONT-ITALIC TO FALSE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Calibri12BI-Occidentale, WFONT-DATA
      * Calibri12B-Occidentale
           INITIALIZE WFONT-DATA Calibri12B-Occidentale
           MOVE 12 TO WFONT-SIZE
           MOVE "Calibri" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO TRUE
           SET WFONT-ITALIC TO FALSE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Calibri12B-Occidentale, WFONT-DATA
      * Calibri14B-Occidentale
           INITIALIZE WFONT-DATA Calibri14B-Occidentale
           MOVE 14 TO WFONT-SIZE
           MOVE "Calibri" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO TRUE
           SET WFONT-ITALIC TO FALSE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Calibri14B-Occidentale, WFONT-DATA
      * Calibri16B-Occidentale
           INITIALIZE WFONT-DATA Calibri16B-Occidentale
           MOVE 16 TO WFONT-SIZE
           MOVE "Calibri" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO TRUE
           SET WFONT-ITALIC TO FALSE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Calibri16B-Occidentale, WFONT-DATA
      * Calibri14-Occidentale
           INITIALIZE WFONT-DATA Calibri14-Occidentale
           MOVE 14 TO WFONT-SIZE
           MOVE "Calibri" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO FALSE
           SET WFONT-ITALIC TO FALSE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Calibri14-Occidentale, WFONT-DATA
           .

       INIT-BMP.
      * pb-note
           COPY RESOURCE "NOTE_CLIENTE.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "NOTE_CLIENTE.BMP", 
                   GIVING NOTE_CLIENTE-BMP.
      * pb-cliente
           COPY RESOURCE "CAMBIA-CLIENTE.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "CAMBIA-CLIENTE.BMP", 
                   GIVING CAMBIA-CLIENTE-BMP.
      * TOOL-ESCI
           COPY RESOURCE "toolbar.bmp".
           CALL "w$bitmap" USING WBITMAP-LOAD "toolbar.bmp", 
                   GIVING toolbar-bmp.
      * Form1-Bt-1
           COPY RESOURCE "LOGO_PICCOLO.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "LOGO_PICCOLO.BMP", 
                   GIVING LOGO_PICCOLO-BMP.
           .

       INIT-RES.
           .

       INIT-POPUP.
           .

       OPEN-FILE-RTN.
      *    Before Open
           PERFORM OPEN-rschede
           PERFORM OPEN-tschede
           PERFORM OPEN-clienti
           PERFORM OPEN-articoli
           PERFORM OPEN-rlistini
           PERFORM OPEN-tipocli
           PERFORM OPEN-tlistini
      *    After Open
           .

       OPEN-rschede.
      * <TOTEM:EPT. INIT:schedacli, FD:rschede, BeforeOpen>
      * <TOTEM:END>
           OPEN  I-O rschede
           IF STATUS-rschede = "35"
              OPEN OUTPUT rschede
                IF Valid-STATUS-rschede
                   CLOSE rschede
                   OPEN I-O rschede
                END-IF
           END-IF
           IF NOT Valid-STATUS-rschede
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:schedacli, FD:rschede, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tschede.
      * <TOTEM:EPT. INIT:schedacli, FD:tschede, BeforeOpen>
      * <TOTEM:END>
           OPEN  I-O tschede
           IF STATUS-tschede = "35"
              OPEN OUTPUT tschede
                IF Valid-STATUS-tschede
                   CLOSE tschede
                   OPEN I-O tschede
                END-IF
           END-IF
           IF NOT Valid-STATUS-tschede
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:schedacli, FD:tschede, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-clienti.
      * <TOTEM:EPT. INIT:schedacli, FD:clienti, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT clienti
           IF NOT Valid-STATUS-clienti
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:schedacli, FD:clienti, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-articoli.
      * <TOTEM:EPT. INIT:schedacli, FD:articoli, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT articoli
           IF NOT Valid-STATUS-articoli
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:schedacli, FD:articoli, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-rlistini.
      * <TOTEM:EPT. INIT:schedacli, FD:rlistini, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT rlistini
           IF NOT Valid-STATUS-rlistini
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:schedacli, FD:rlistini, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tipocli.
      * <TOTEM:EPT. INIT:schedacli, FD:tipocli, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tipocli
           IF NOT Valid-STATUS-tipocli
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:schedacli, FD:tipocli, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tlistini.
      * <TOTEM:EPT. INIT:schedacli, FD:tlistini, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tlistini
           IF NOT Valid-STATUS-tlistini
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:schedacli, FD:tlistini, AfterOpen>
      * <TOTEM:END>
           .

       CLOSE-FILE-RTN.
      *    Before Close
           PERFORM CLOSE-rschede
           PERFORM CLOSE-tschede
           PERFORM CLOSE-clienti
           PERFORM CLOSE-articoli
           PERFORM CLOSE-rlistini
           PERFORM CLOSE-tipocli
           PERFORM CLOSE-tlistini
      *    After Close
           .

       CLOSE-rschede.
      * <TOTEM:EPT. INIT:schedacli, FD:rschede, BeforeClose>
      * <TOTEM:END>
           CLOSE rschede
           .

       CLOSE-tschede.
      * <TOTEM:EPT. INIT:schedacli, FD:tschede, BeforeClose>
      * <TOTEM:END>
           CLOSE tschede
           .

       CLOSE-clienti.
      * <TOTEM:EPT. INIT:schedacli, FD:clienti, BeforeClose>
      * <TOTEM:END>
           CLOSE clienti
           .

       CLOSE-articoli.
      * <TOTEM:EPT. INIT:schedacli, FD:articoli, BeforeClose>
      * <TOTEM:END>
           CLOSE articoli
           .

       CLOSE-rlistini.
      * <TOTEM:EPT. INIT:schedacli, FD:rlistini, BeforeClose>
      * <TOTEM:END>
           CLOSE rlistini
           .

       CLOSE-tipocli.
      * <TOTEM:EPT. INIT:schedacli, FD:tipocli, BeforeClose>
      * <TOTEM:END>
           CLOSE tipocli
           .

       CLOSE-tlistini.
      * <TOTEM:EPT. INIT:schedacli, FD:tlistini, BeforeClose>
      * <TOTEM:END>
           CLOSE tlistini
           .

       rschede-rsc-k-art-MERGE-SPLITBUF.
           INITIALIZE rschede-rsc-k-art-SPLITBUF
           MOVE rsc-articolo(1:6) TO rschede-rsc-k-art-SPLITBUF(1:6)
           MOVE rsc-cliente(1:6) TO rschede-rsc-k-art-SPLITBUF(7:6)
           MOVE rsc-data(1:8) TO rschede-rsc-k-art-SPLITBUF(13:8)
           .

       rschede-rsc-k-cli-MERGE-SPLITBUF.
           INITIALIZE rschede-rsc-k-cli-SPLITBUF
           MOVE rsc-cliente(1:6) TO rschede-rsc-k-cli-SPLITBUF(1:6)
           MOVE rsc-articolo(1:6) TO rschede-rsc-k-cli-SPLITBUF(7:6)
           MOVE rsc-data(1:8) TO rschede-rsc-k-cli-SPLITBUF(13:8)
           .

       rschede-rsc-k-fatart-MERGE-SPLITBUF.
           INITIALIZE rschede-rsc-k-fatart-SPLITBUF
           MOVE rsc-fattura(1:14) TO rschede-rsc-k-fatart-SPLITBUF(1:14)
           MOVE rsc-articolo(1:6) TO rschede-rsc-k-fatart-SPLITBUF(15:6)
           .

       rschede-rsc-k-fatcli-MERGE-SPLITBUF.
           INITIALIZE rschede-rsc-k-fatcli-SPLITBUF
           MOVE rsc-fattura(1:14) TO rschede-rsc-k-fatcli-SPLITBUF(1:14)
           MOVE rsc-cliente(1:6) TO rschede-rsc-k-fatcli-SPLITBUF(15:6)
           .

       rschede-rsc-k-corart-MERGE-SPLITBUF.
           INITIALIZE rschede-rsc-k-corart-SPLITBUF
           MOVE rsc-corrisp(1:14) TO rschede-rsc-k-corart-SPLITBUF(1:14)
           MOVE rsc-articolo(1:6) TO rschede-rsc-k-corart-SPLITBUF(15:6)
           .

       rschede-rsc-k-corcli-MERGE-SPLITBUF.
           INITIALIZE rschede-rsc-k-corcli-SPLITBUF
           MOVE rsc-corrisp(1:14) TO rschede-rsc-k-corcli-SPLITBUF(1:14)
           MOVE rsc-cliente(1:6) TO rschede-rsc-k-corcli-SPLITBUF(15:6)
           .

       DataSet1-rschede-INITSTART.
           IF DataSet1-rschede-KEY-Asc
              MOVE Low-Value TO rsc-chiave
           ELSE
              MOVE High-Value TO rsc-chiave
           END-IF
           .

       DataSet1-rschede-INITEND.
           IF DataSet1-rschede-KEY-Asc
              MOVE High-Value TO rsc-chiave
           ELSE
              MOVE Low-Value TO rsc-chiave
           END-IF
           .

      * rschede
       DataSet1-rschede-START.
           IF DataSet1-rschede-KEY-Asc
              START rschede KEY >= rsc-chiave
           ELSE
              START rschede KEY <= rsc-chiave
           END-IF
           .

       DataSet1-rschede-START-NOTGREATER.
           IF DataSet1-rschede-KEY-Asc
              START rschede KEY <= rsc-chiave
           ELSE
              START rschede KEY >= rsc-chiave
           END-IF
           .

       DataSet1-rschede-START-GREATER.
           IF DataSet1-rschede-KEY-Asc
              START rschede KEY > rsc-chiave
           ELSE
              START rschede KEY < rsc-chiave
           END-IF
           .

       DataSet1-rschede-START-LESS.
           IF DataSet1-rschede-KEY-Asc
              START rschede KEY < rsc-chiave
           ELSE
              START rschede KEY > rsc-chiave
           END-IF
           .

       DataSet1-rschede-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:rschede, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rschede, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-rschede-LOCK
              READ rschede WITH LOCK 
              KEY rsc-chiave
           ELSE
              READ rschede WITH NO LOCK 
              KEY rsc-chiave
           END-IF
           PERFORM rschede-rsc-k-art-MERGE-SPLITBUF
           PERFORM rschede-rsc-k-cli-MERGE-SPLITBUF
           PERFORM rschede-rsc-k-fatart-MERGE-SPLITBUF
           PERFORM rschede-rsc-k-fatcli-MERGE-SPLITBUF
           PERFORM rschede-rsc-k-corart-MERGE-SPLITBUF
           PERFORM rschede-rsc-k-corcli-MERGE-SPLITBUF
           MOVE STATUS-rschede TO TOTEM-ERR-STAT 
           MOVE "rschede" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rschede, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rschede, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-rschede-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:rschede, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rschede, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-rschede-KEY-Asc
              IF DataSet1-rschede-LOCK
                 READ rschede NEXT WITH LOCK
              ELSE
                 READ rschede NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-rschede-LOCK
                 READ rschede PREVIOUS WITH LOCK
              ELSE
                 READ rschede PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM rschede-rsc-k-art-MERGE-SPLITBUF
           PERFORM rschede-rsc-k-cli-MERGE-SPLITBUF
           PERFORM rschede-rsc-k-fatart-MERGE-SPLITBUF
           PERFORM rschede-rsc-k-fatcli-MERGE-SPLITBUF
           PERFORM rschede-rsc-k-corart-MERGE-SPLITBUF
           PERFORM rschede-rsc-k-corcli-MERGE-SPLITBUF
           MOVE STATUS-rschede TO TOTEM-ERR-STAT
           MOVE "rschede" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rschede, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rschede, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-rschede-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:rschede, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rschede, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-rschede-KEY-Asc
              IF DataSet1-rschede-LOCK
                 READ rschede PREVIOUS WITH LOCK
              ELSE
                 READ rschede PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-rschede-LOCK
                 READ rschede NEXT WITH LOCK
              ELSE
                 READ rschede NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM rschede-rsc-k-art-MERGE-SPLITBUF
           PERFORM rschede-rsc-k-cli-MERGE-SPLITBUF
           PERFORM rschede-rsc-k-fatart-MERGE-SPLITBUF
           PERFORM rschede-rsc-k-fatcli-MERGE-SPLITBUF
           PERFORM rschede-rsc-k-corart-MERGE-SPLITBUF
           PERFORM rschede-rsc-k-corcli-MERGE-SPLITBUF
           MOVE STATUS-rschede TO TOTEM-ERR-STAT
           MOVE "rschede" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rschede, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rschede, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-rschede-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:rschede, BeforeWrite>
      * <TOTEM:END>
           WRITE rsc-rec OF rschede.
           MOVE STATUS-rschede TO TOTEM-ERR-STAT
           MOVE "rschede" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rschede, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-rschede-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:rschede, BeforeRewrite>
      * <TOTEM:END>
           REWRITE rsc-rec OF rschede.
           MOVE STATUS-rschede TO TOTEM-ERR-STAT
           MOVE "rschede" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rschede, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-rschede-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:rschede, BeforeDelete>
      * <TOTEM:END>
           DELETE rschede.
           MOVE STATUS-rschede TO TOTEM-ERR-STAT
           MOVE "rschede" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rschede, AfterDelete>
      * <TOTEM:END>
           .

       tschede-tsc-k-data-MERGE-SPLITBUF.
           INITIALIZE tschede-tsc-k-data-SPLITBUF
           MOVE tsc-data-creazione(1:8) TO 
           tschede-tsc-k-data-SPLITBUF(1:8)
           MOVE tsc-cliente(1:6) TO tschede-tsc-k-data-SPLITBUF(9:6)
           .

       tschede-tsc-k-cliente-MERGE-SPLITBUF.
           INITIALIZE tschede-tsc-k-cliente-SPLITBUF
           MOVE tsc-cliente(1:6) TO tschede-tsc-k-cliente-SPLITBUF(1:6)
           .

       DataSet1-tschede-INITSTART.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tschede-KEY1-Asc
                 MOVE Low-Value TO tsc-chiave
              ELSE
                 MOVE High-Value TO tsc-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-tschede-INITEND.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tschede-KEY1-Asc
                 MOVE High-Value TO tsc-chiave
              ELSE
                 MOVE Low-Value TO tsc-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-CHANGETO-KEY1.
           MOVE 1 TO DataSet1-KEYIS
           .   

       DataSet1-Change-CurrentKey-Asc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "A" TO DataSet1-tschede-KEY1-ORDER
           END-EVALUATE
           .

       DataSet1-Change-CurrentKey-Desc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "D" TO DataSet1-tschede-KEY1-ORDER
           END-EVALUATE
           .

      * tschede
       DataSet1-tschede-START.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tschede-KEY1-Asc
                 START tschede KEY >= tsc-chiave
              ELSE
                 START tschede KEY <= tsc-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-tschede-START-NOTGREATER.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tschede-KEY1-Asc
                 START tschede KEY <= tsc-chiave
              ELSE
                 START tschede KEY >= tsc-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-tschede-START-GREATER.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tschede-KEY1-Asc
                 START tschede KEY > tsc-chiave
              ELSE
                 START tschede KEY < tsc-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-tschede-START-LESS.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tschede-KEY1-Asc
                 START tschede KEY < tsc-chiave
              ELSE
                 START tschede KEY > tsc-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-tschede-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tschede, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tschede, BeforeReadRecord>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tschede-LOCK
                 READ tschede WITH LOCK 
                 KEY tsc-chiave
              ELSE
                 READ tschede WITH NO LOCK 
                 KEY tsc-chiave
              END-IF
           END-EVALUATE
           PERFORM tschede-tsc-k-data-MERGE-SPLITBUF
           PERFORM tschede-tsc-k-cliente-MERGE-SPLITBUF
           MOVE STATUS-tschede TO TOTEM-ERR-STAT 
           MOVE "tschede" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tschede, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tschede, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tschede-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tschede, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tschede, BeforeReadNext>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tschede-KEY1-Asc
                 IF DataSet1-tschede-LOCK
                    READ tschede NEXT WITH LOCK
                 ELSE
                    READ tschede NEXT WITH NO LOCK
                 END-IF
              ELSE
                 IF DataSet1-tschede-LOCK
                    READ tschede PREVIOUS WITH LOCK
                 ELSE
                    READ tschede PREVIOUS WITH NO LOCK
                 END-IF
              END-IF
           END-EVALUATE
           PERFORM tschede-tsc-k-data-MERGE-SPLITBUF
           PERFORM tschede-tsc-k-cliente-MERGE-SPLITBUF
           MOVE STATUS-tschede TO TOTEM-ERR-STAT
           MOVE "tschede" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tschede, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tschede, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tschede-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tschede, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tschede, BeforeReadPrev>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tschede-KEY1-Asc
                 IF DataSet1-tschede-LOCK
                    READ tschede PREVIOUS WITH LOCK
                 ELSE
                    READ tschede PREVIOUS WITH NO LOCK
                 END-IF
              ELSE
                 IF DataSet1-tschede-LOCK
                    READ tschede NEXT WITH LOCK
                 ELSE
                    READ tschede NEXT WITH NO LOCK
                 END-IF
              END-IF
           END-EVALUATE
           PERFORM tschede-tsc-k-data-MERGE-SPLITBUF
           PERFORM tschede-tsc-k-cliente-MERGE-SPLITBUF
           MOVE STATUS-tschede TO TOTEM-ERR-STAT
           MOVE "tschede" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tschede, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tschede, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tschede-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tschede, BeforeWrite>
      * <TOTEM:END>
           WRITE tsc-rec OF tschede.
           MOVE STATUS-tschede TO TOTEM-ERR-STAT
           MOVE "tschede" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tschede, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tschede-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tschede, BeforeRewrite>
      * <TOTEM:END>
           REWRITE tsc-rec OF tschede.
           MOVE STATUS-tschede TO TOTEM-ERR-STAT
           MOVE "tschede" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tschede, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tschede-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tschede, BeforeDelete>
      * <TOTEM:END>
           DELETE tschede.
           MOVE STATUS-tschede TO TOTEM-ERR-STAT
           MOVE "tschede" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tschede, AfterDelete>
      * <TOTEM:END>
           .

       clienti-cli-k-ragsoc-MERGE-SPLITBUF.
           INITIALIZE clienti-cli-k-ragsoc-SPLITBUF
           MOVE cli-ragsoc(1:50) TO clienti-cli-k-ragsoc-SPLITBUF(1:50)
           MOVE cli-chiave(1:6) TO clienti-cli-k-ragsoc-SPLITBUF(51:6)
           .

       DataSet1-clienti-INITSTART.
           IF DataSet1-clienti-KEY-Asc
              MOVE Low-Value TO cli-chiave
           ELSE
              MOVE High-Value TO cli-chiave
           END-IF
           .

       DataSet1-clienti-INITEND.
           IF DataSet1-clienti-KEY-Asc
              MOVE High-Value TO cli-chiave
           ELSE
              MOVE Low-Value TO cli-chiave
           END-IF
           .

      * clienti
       DataSet1-clienti-START.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY >= cli-chiave
           ELSE
              START clienti KEY <= cli-chiave
           END-IF
           .

       DataSet1-clienti-START-NOTGREATER.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY <= cli-chiave
           ELSE
              START clienti KEY >= cli-chiave
           END-IF
           .

       DataSet1-clienti-START-GREATER.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY > cli-chiave
           ELSE
              START clienti KEY < cli-chiave
           END-IF
           .

       DataSet1-clienti-START-LESS.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY < cli-chiave
           ELSE
              START clienti KEY > cli-chiave
           END-IF
           .

       DataSet1-clienti-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-clienti-LOCK
              READ clienti WITH LOCK 
              KEY cli-chiave
           ELSE
              READ clienti WITH NO LOCK 
              KEY cli-chiave
           END-IF
           PERFORM clienti-cli-k-ragsoc-MERGE-SPLITBUF
           MOVE STATUS-clienti TO TOTEM-ERR-STAT 
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-clienti-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-clienti-KEY-Asc
              IF DataSet1-clienti-LOCK
                 READ clienti NEXT WITH LOCK
              ELSE
                 READ clienti NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-clienti-LOCK
                 READ clienti PREVIOUS WITH LOCK
              ELSE
                 READ clienti PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM clienti-cli-k-ragsoc-MERGE-SPLITBUF
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-clienti-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-clienti-KEY-Asc
              IF DataSet1-clienti-LOCK
                 READ clienti PREVIOUS WITH LOCK
              ELSE
                 READ clienti PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-clienti-LOCK
                 READ clienti NEXT WITH LOCK
              ELSE
                 READ clienti NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM clienti-cli-k-ragsoc-MERGE-SPLITBUF
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-clienti-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-clienti-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-clienti-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterDelete>
      * <TOTEM:END>
           .

       articoli-art-k-descrizione-MERGE-SPLITBUF.
           INITIALIZE articoli-art-k-descrizione-SPLITBUF
           MOVE art-descrizione(1:50) TO 
           articoli-art-k-descrizione-SPLITBUF(1:50)
           MOVE art-chiave(1:6) TO 
           articoli-art-k-descrizione-SPLITBUF(51:6)
           .

       DataSet1-articoli-INITSTART.
           IF DataSet1-articoli-KEY-Asc
              MOVE Low-Value TO art-chiave
           ELSE
              MOVE High-Value TO art-chiave
           END-IF
           .

       DataSet1-articoli-INITEND.
           IF DataSet1-articoli-KEY-Asc
              MOVE High-Value TO art-chiave
           ELSE
              MOVE Low-Value TO art-chiave
           END-IF
           .

      * articoli
       DataSet1-articoli-START.
           IF DataSet1-articoli-KEY-Asc
              START articoli KEY >= art-chiave
           ELSE
              START articoli KEY <= art-chiave
           END-IF
           .

       DataSet1-articoli-START-NOTGREATER.
           IF DataSet1-articoli-KEY-Asc
              START articoli KEY <= art-chiave
           ELSE
              START articoli KEY >= art-chiave
           END-IF
           .

       DataSet1-articoli-START-GREATER.
           IF DataSet1-articoli-KEY-Asc
              START articoli KEY > art-chiave
           ELSE
              START articoli KEY < art-chiave
           END-IF
           .

       DataSet1-articoli-START-LESS.
           IF DataSet1-articoli-KEY-Asc
              START articoli KEY < art-chiave
           ELSE
              START articoli KEY > art-chiave
           END-IF
           .

       DataSet1-articoli-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-articoli-LOCK
              READ articoli WITH LOCK 
              KEY art-chiave
           ELSE
              READ articoli WITH NO LOCK 
              KEY art-chiave
           END-IF
           PERFORM articoli-art-k-descrizione-MERGE-SPLITBUF
           MOVE STATUS-articoli TO TOTEM-ERR-STAT 
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-articoli-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-articoli-KEY-Asc
              IF DataSet1-articoli-LOCK
                 READ articoli NEXT WITH LOCK
              ELSE
                 READ articoli NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-articoli-LOCK
                 READ articoli PREVIOUS WITH LOCK
              ELSE
                 READ articoli PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM articoli-art-k-descrizione-MERGE-SPLITBUF
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-articoli-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-articoli-KEY-Asc
              IF DataSet1-articoli-LOCK
                 READ articoli PREVIOUS WITH LOCK
              ELSE
                 READ articoli PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-articoli-LOCK
                 READ articoli NEXT WITH LOCK
              ELSE
                 READ articoli NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM articoli-art-k-descrizione-MERGE-SPLITBUF
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-articoli-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-articoli-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-articoli-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterDelete>
      * <TOTEM:END>
           .

       rlistini-rls-k-ricerca-MERGE-SPLITBUF.
           INITIALIZE rlistini-rls-k-ricerca-SPLITBUF
           MOVE rls-tipo(1:1) TO rlistini-rls-k-ricerca-SPLITBUF(1:1)
           MOVE rls-codice-tipo(1:6) TO 
           rlistini-rls-k-ricerca-SPLITBUF(2:6)
           MOVE rls-articolo(1:6) TO 
           rlistini-rls-k-ricerca-SPLITBUF(8:6)
           MOVE rls-ini-val(1:8) TO 
           rlistini-rls-k-ricerca-SPLITBUF(14:8)
           .

       DataSet1-rlistini-INITSTART.
           IF DataSet1-rlistini-KEY-Asc
              MOVE Low-Value TO rls-chiave
           ELSE
              MOVE High-Value TO rls-chiave
           END-IF
           .

       DataSet1-rlistini-INITEND.
           IF DataSet1-rlistini-KEY-Asc
              MOVE High-Value TO rls-chiave
           ELSE
              MOVE Low-Value TO rls-chiave
           END-IF
           .

      * rlistini
       DataSet1-rlistini-START.
           IF DataSet1-rlistini-KEY-Asc
              START rlistini KEY >= rls-chiave
           ELSE
              START rlistini KEY <= rls-chiave
           END-IF
           .

       DataSet1-rlistini-START-NOTGREATER.
           IF DataSet1-rlistini-KEY-Asc
              START rlistini KEY <= rls-chiave
           ELSE
              START rlistini KEY >= rls-chiave
           END-IF
           .

       DataSet1-rlistini-START-GREATER.
           IF DataSet1-rlistini-KEY-Asc
              START rlistini KEY > rls-chiave
           ELSE
              START rlistini KEY < rls-chiave
           END-IF
           .

       DataSet1-rlistini-START-LESS.
           IF DataSet1-rlistini-KEY-Asc
              START rlistini KEY < rls-chiave
           ELSE
              START rlistini KEY > rls-chiave
           END-IF
           .

       DataSet1-rlistini-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:rlistini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rlistini, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-rlistini-LOCK
              READ rlistini WITH LOCK 
              KEY rls-chiave
           ELSE
              READ rlistini WITH NO LOCK 
              KEY rls-chiave
           END-IF
           PERFORM rlistini-rls-k-ricerca-MERGE-SPLITBUF
           MOVE STATUS-rlistini TO TOTEM-ERR-STAT 
           MOVE "rlistini" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rlistini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rlistini, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-rlistini-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:rlistini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rlistini, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-rlistini-KEY-Asc
              IF DataSet1-rlistini-LOCK
                 READ rlistini NEXT WITH LOCK
              ELSE
                 READ rlistini NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-rlistini-LOCK
                 READ rlistini PREVIOUS WITH LOCK
              ELSE
                 READ rlistini PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM rlistini-rls-k-ricerca-MERGE-SPLITBUF
           MOVE STATUS-rlistini TO TOTEM-ERR-STAT
           MOVE "rlistini" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rlistini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rlistini, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-rlistini-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:rlistini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rlistini, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-rlistini-KEY-Asc
              IF DataSet1-rlistini-LOCK
                 READ rlistini PREVIOUS WITH LOCK
              ELSE
                 READ rlistini PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-rlistini-LOCK
                 READ rlistini NEXT WITH LOCK
              ELSE
                 READ rlistini NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM rlistini-rls-k-ricerca-MERGE-SPLITBUF
           MOVE STATUS-rlistini TO TOTEM-ERR-STAT
           MOVE "rlistini" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rlistini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rlistini, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-rlistini-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:rlistini, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-rlistini TO TOTEM-ERR-STAT
           MOVE "rlistini" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rlistini, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-rlistini-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:rlistini, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-rlistini TO TOTEM-ERR-STAT
           MOVE "rlistini" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rlistini, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-rlistini-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:rlistini, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-rlistini TO TOTEM-ERR-STAT
           MOVE "rlistini" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rlistini, AfterDelete>
      * <TOTEM:END>
           .

       tipocli-tcl-k-descrizione-MERGE-SPLITBUF.
           INITIALIZE tipocli-tcl-k-descrizione-SPLITBUF
           MOVE tcl-descrizione(1:50) TO 
           tipocli-tcl-k-descrizione-SPLITBUF(1:50)
           MOVE tcl-chiave(1:6) TO 
           tipocli-tcl-k-descrizione-SPLITBUF(51:6)
           .

       DataSet1-tipocli-INITSTART.
           IF DataSet1-tipocli-KEY-Asc
              MOVE Low-Value TO tcl-chiave
           ELSE
              MOVE High-Value TO tcl-chiave
           END-IF
           .

       DataSet1-tipocli-INITEND.
           IF DataSet1-tipocli-KEY-Asc
              MOVE High-Value TO tcl-chiave
           ELSE
              MOVE Low-Value TO tcl-chiave
           END-IF
           .

      * tipocli
       DataSet1-tipocli-START.
           IF DataSet1-tipocli-KEY-Asc
              START tipocli KEY >= tcl-chiave
           ELSE
              START tipocli KEY <= tcl-chiave
           END-IF
           .

       DataSet1-tipocli-START-NOTGREATER.
           IF DataSet1-tipocli-KEY-Asc
              START tipocli KEY <= tcl-chiave
           ELSE
              START tipocli KEY >= tcl-chiave
           END-IF
           .

       DataSet1-tipocli-START-GREATER.
           IF DataSet1-tipocli-KEY-Asc
              START tipocli KEY > tcl-chiave
           ELSE
              START tipocli KEY < tcl-chiave
           END-IF
           .

       DataSet1-tipocli-START-LESS.
           IF DataSet1-tipocli-KEY-Asc
              START tipocli KEY < tcl-chiave
           ELSE
              START tipocli KEY > tcl-chiave
           END-IF
           .

       DataSet1-tipocli-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tipocli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tipocli, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tipocli-LOCK
              READ tipocli WITH LOCK 
              KEY tcl-chiave
           ELSE
              READ tipocli WITH NO LOCK 
              KEY tcl-chiave
           END-IF
           PERFORM tipocli-tcl-k-descrizione-MERGE-SPLITBUF
           MOVE STATUS-tipocli TO TOTEM-ERR-STAT 
           MOVE "tipocli" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tipocli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tipocli, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tipocli-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tipocli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tipocli, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tipocli-KEY-Asc
              IF DataSet1-tipocli-LOCK
                 READ tipocli NEXT WITH LOCK
              ELSE
                 READ tipocli NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tipocli-LOCK
                 READ tipocli PREVIOUS WITH LOCK
              ELSE
                 READ tipocli PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM tipocli-tcl-k-descrizione-MERGE-SPLITBUF
           MOVE STATUS-tipocli TO TOTEM-ERR-STAT
           MOVE "tipocli" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tipocli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tipocli, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tipocli-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tipocli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tipocli, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tipocli-KEY-Asc
              IF DataSet1-tipocli-LOCK
                 READ tipocli PREVIOUS WITH LOCK
              ELSE
                 READ tipocli PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tipocli-LOCK
                 READ tipocli NEXT WITH LOCK
              ELSE
                 READ tipocli NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM tipocli-tcl-k-descrizione-MERGE-SPLITBUF
           MOVE STATUS-tipocli TO TOTEM-ERR-STAT
           MOVE "tipocli" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tipocli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tipocli, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tipocli-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tipocli, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tipocli TO TOTEM-ERR-STAT
           MOVE "tipocli" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tipocli, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tipocli-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tipocli, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tipocli TO TOTEM-ERR-STAT
           MOVE "tipocli" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tipocli, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tipocli-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tipocli, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tipocli TO TOTEM-ERR-STAT
           MOVE "tipocli" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tipocli, AfterDelete>
      * <TOTEM:END>
           .

       tlistini-tls-k-tipo-MERGE-SPLITBUF.
           INITIALIZE tlistini-tls-k-tipo-SPLITBUF
           MOVE tls-tipo(1:1) TO tlistini-tls-k-tipo-SPLITBUF(1:1)
           MOVE tls-codice-tipo(1:6) TO 
           tlistini-tls-k-tipo-SPLITBUF(2:6)
           MOVE tls-ini-val(1:8) TO tlistini-tls-k-tipo-SPLITBUF(8:8)
           MOVE tls-chiave(1:5) TO tlistini-tls-k-tipo-SPLITBUF(16:5)
           .

       tlistini-tls-k-descrizione-MERGE-SPLITBUF.
           INITIALIZE tlistini-tls-k-descrizione-SPLITBUF
           MOVE tls-descrizione(1:50) TO 
           tlistini-tls-k-descrizione-SPLITBUF(1:50)
           MOVE tls-codice(1:5) TO 
           tlistini-tls-k-descrizione-SPLITBUF(51:5)
           .

       DataSet1-tlistini-INITSTART.
           IF DataSet1-tlistini-KEY-Asc
              MOVE Low-Value TO tls-chiave
           ELSE
              MOVE High-Value TO tls-chiave
           END-IF
           .

       DataSet1-tlistini-INITEND.
           IF DataSet1-tlistini-KEY-Asc
              MOVE High-Value TO tls-chiave
           ELSE
              MOVE Low-Value TO tls-chiave
           END-IF
           .

      * tlistini
       DataSet1-tlistini-START.
           IF DataSet1-tlistini-KEY-Asc
              START tlistini KEY >= tls-chiave
           ELSE
              START tlistini KEY <= tls-chiave
           END-IF
           .

       DataSet1-tlistini-START-NOTGREATER.
           IF DataSet1-tlistini-KEY-Asc
              START tlistini KEY <= tls-chiave
           ELSE
              START tlistini KEY >= tls-chiave
           END-IF
           .

       DataSet1-tlistini-START-GREATER.
           IF DataSet1-tlistini-KEY-Asc
              START tlistini KEY > tls-chiave
           ELSE
              START tlistini KEY < tls-chiave
           END-IF
           .

       DataSet1-tlistini-START-LESS.
           IF DataSet1-tlistini-KEY-Asc
              START tlistini KEY < tls-chiave
           ELSE
              START tlistini KEY > tls-chiave
           END-IF
           .

       DataSet1-tlistini-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tlistini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tlistini, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tlistini-LOCK
              READ tlistini WITH LOCK 
              KEY tls-chiave
           ELSE
              READ tlistini WITH NO LOCK 
              KEY tls-chiave
           END-IF
           PERFORM tlistini-tls-k-tipo-MERGE-SPLITBUF
           PERFORM tlistini-tls-k-descrizione-MERGE-SPLITBUF
           MOVE STATUS-tlistini TO TOTEM-ERR-STAT 
           MOVE "tlistini" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tlistini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tlistini, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tlistini-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tlistini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tlistini, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tlistini-KEY-Asc
              IF DataSet1-tlistini-LOCK
                 READ tlistini NEXT WITH LOCK
              ELSE
                 READ tlistini NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tlistini-LOCK
                 READ tlistini PREVIOUS WITH LOCK
              ELSE
                 READ tlistini PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM tlistini-tls-k-tipo-MERGE-SPLITBUF
           PERFORM tlistini-tls-k-descrizione-MERGE-SPLITBUF
           MOVE STATUS-tlistini TO TOTEM-ERR-STAT
           MOVE "tlistini" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tlistini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tlistini, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tlistini-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tlistini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tlistini, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tlistini-KEY-Asc
              IF DataSet1-tlistini-LOCK
                 READ tlistini PREVIOUS WITH LOCK
              ELSE
                 READ tlistini PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tlistini-LOCK
                 READ tlistini NEXT WITH LOCK
              ELSE
                 READ tlistini NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM tlistini-tls-k-tipo-MERGE-SPLITBUF
           PERFORM tlistini-tls-k-descrizione-MERGE-SPLITBUF
           MOVE STATUS-tlistini TO TOTEM-ERR-STAT
           MOVE "tlistini" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tlistini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tlistini, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tlistini-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tlistini, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tlistini TO TOTEM-ERR-STAT
           MOVE "tlistini" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tlistini, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tlistini-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tlistini, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tlistini TO TOTEM-ERR-STAT
           MOVE "tlistini" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tlistini, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tlistini-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tlistini, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tlistini TO TOTEM-ERR-STAT
           MOVE "tlistini" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tlistini, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-INIT-RECORD.
           INITIALIZE rsc-rec OF rschede
           INITIALIZE tsc-rec OF tschede
           INITIALIZE cli-rec OF clienti
           INITIALIZE art-rec OF articoli
           INITIALIZE rls-rec OF rlistini
           INITIALIZE tcl-rec OF tipocli
           INITIALIZE tls-rec OF tlistini
           .


      * GRID
       gd1-Content.
      * CELLS' SETTING
              MODIFY gd1, X = 1, Y = 1,
                CELL-COLOR = 299,
                CELL-FONT Calibri12BI-Occidentale,
                CELL-DATA = "Data",
      * CELLS' SETTING
              MODIFY gd1, X = 2, Y = 1,
                CELL-COLOR = 299,
                CELL-FONT Calibri12B-Occidentale,
                CELL-DATA = "Articolo",
      * CELLS' SETTING
              MODIFY gd1, X = 3, Y = 1,
                CELL-COLOR = 299,
                CELL-FONT Calibri12B-Occidentale,
                CELL-DATA = "Descrizione",
      * CELLS' SETTING
              MODIFY gd1, X = 4, Y = 1,
                CELL-COLOR = 299,
                CELL-FONT Calibri12B-Occidentale,
                CELL-DATA = "Qta",
      * CELLS' SETTING
              MODIFY gd1, X = 5, Y = 1,
                CELL-COLOR = 299,
                CELL-FONT Calibri12B-Occidentale,
                CELL-DATA = "Prezzo",
      * CELLS' SETTING
              MODIFY gd1, X = 6, Y = 1,
                CELL-COLOR = 299,
                CELL-FONT Calibri12B-Occidentale,
                CELL-DATA = "Sconto",
      * CELLS' SETTING
              MODIFY gd1, X = 7, Y = 1,
                CELL-COLOR = 299,
                CELL-FONT Calibri12B-Occidentale,
                CELL-DATA = "Netto",
      * CELLS' SETTING
              MODIFY gd1, X = 8, Y = 1,
                CELL-COLOR = 299,
                CELL-FONT Calibri12B-Occidentale,
                CELL-DATA = "Note",
      * CELLS' SETTING
              MODIFY gd1, X = 9, Y = 1,
                CELL-COLOR = 299,
                CELL-FONT Calibri12B-Occidentale,
                CELL-DATA = "Num. F/C",
      * CELLS' SETTING
              MODIFY gd1, X = 10, Y = 1,
                CELL-COLOR = 299,
                CELL-FONT Calibri12B-Occidentale,
                CELL-DATA = "Data F/C",
      * COLUMNS' SETTING
              MODIFY gd1, X = 9  
                COLUMN-COLOR = 257,
      * COLUMNS' SETTING
              MODIFY gd1, X = 10  
                COLUMN-COLOR = 257,
           .

      * GRID
       gd-prezzi-Content.
      * CELLS' SETTING
              MODIFY gd-prezzi, X = 1, Y = 1,
                CELL-COLOR = 299,
                CELL-FONT Calibri14B-Occidentale,
                CELL-DATA = "Listino",
      * CELLS' SETTING
              MODIFY gd-prezzi, X = 2, Y = 1,
                CELL-COLOR = 299,
                CELL-FONT Calibri14B-Occidentale,
                CELL-DATA = "Descrizione",
      * CELLS' SETTING
              MODIFY gd-prezzi, X = 3, Y = 1,
                CELL-COLOR = 299,
                CELL-FONT Calibri14B-Occidentale,
                CELL-DATA = "Valido dal",
      * CELLS' SETTING
              MODIFY gd-prezzi, X = 4, Y = 1,
                CELL-COLOR = 299,
                CELL-FONT Calibri14B-Occidentale,
                CELL-DATA = "Listino per",
      * CELLS' SETTING
              MODIFY gd-prezzi, X = 5, Y = 1,
                CELL-COLOR = 299,
                CELL-FONT Calibri14B-Occidentale,
                CELL-DATA = "Prezzo1",
      * CELLS' SETTING
              MODIFY gd-prezzi, X = 6, Y = 1,
                CELL-COLOR = 299,
                CELL-FONT Calibri14B-Occidentale,
                CELL-DATA = "Prezzo2",
      * CELLS' SETTING
              MODIFY gd-prezzi, X = 7, Y = 1,
                CELL-COLOR = 299,
                CELL-FONT Calibri14B-Occidentale,
                CELL-DATA = "Prezzo3",
           .

      * FD's Initialize Paragraph
       DataSet1-rschede-INITREC.
           INITIALIZE rsc-rec OF rschede
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tschede-INITREC.
           INITIALIZE tsc-rec OF tschede
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-clienti-INITREC.
           INITIALIZE cli-rec OF clienti
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-articoli-INITREC.
           INITIALIZE art-rec OF articoli
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-rlistini-INITREC.
           INITIALIZE rls-rec OF rlistini
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tipocli-INITREC.
           INITIALIZE tcl-rec OF tipocli
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tlistini-INITREC.
           INITIALIZE tls-rec OF tlistini
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      *
       DataSet1-DISPATCH-BUFTOFLD.
           EVALUATE TOTEM-Form-Index ALSO TOTEM-Frame-Index
              WHEN 1 ALSO 0
                  PERFORM Form1-Buf-To-Fld
           END-EVALUATE
           .

       Form1-DISPLAY-STATUS-MSG.
            MODIFY Form1-St-1-Handle PANEL-INDEX = 1
                PANEL-TEXT = TOTEM-HINT-TEXT
           .

       Form1-CLEAR-STATUS-MSG.
           MOVE SPACES TO TOTEM-MSG-1, TOTEM-MSG-2, TOTEM-MSG-3, 
           TOTEM-MSG-TEXT
           PERFORM Form1-DISPLAY-STATUS-MSG
           .

       Form1-Open-Routine.
           PERFORM Form1-Scrn
           PERFORM Form1-Proc
           .

       Form1-Scrn.
           PERFORM Form1-Create-Win
           PERFORM Form1-Init-Value
           PERFORM Form1-Init-Data
      * Tab keystrok settings
      * Tool Bar
           DISPLAY Form1-Tb-1
           PERFORM Form1-DISPLAY
           .

       Form1-Create-Win.
           Display Independent GRAPHICAL WINDOW
              SCREEN LINE 2,
              SCREEN COLUMN 2,
              LINES 27,00,
              SIZE 113,50,
              HEIGHT-IN-CELLS,
              WIDTH-IN-CELLS,
              COLOR 131329,
              CONTROL FONT Calibri14-Occidentale,
              LABEL-OFFSET 23,
              LINK TO THREAD,
              MODELESS,
              NO SCROLL,
              TITLE-BAR,
              TITLE titolo,
              AUTO-MINIMIZE,
              WITH SYSTEM MENU,
              USER-GRAY,
              USER-WHITE,
              No WRAP,
              EVENT PROCEDURE Screen1-Event-Proc,
              HANDLE IS form1-Handle,
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterCreateWin>
      * <TOTEM:END>


      * Tool Bar    
           DISPLAY TOOL-BAR 
              LINES 3,35,   
              CONTROL FONT IS Calibri14-Occidentale
              HANDLE IN Form1-Tb-1-Handle
           DISPLAY Form1-Tb-1 UPON Form1-Tb-1-Handle

      * Status-bar
           DISPLAY STATUS-BAR
              FONT IS Calibri14-Occidentale,
              GRIP,
              PANEL-WIDTHS (65, 28, 999),
              PANEL-STYLE  (1, 1, 1),
              PANEL-TEXT   (SPACE, SPACE, SPACE),
              HANDLE IS Form1-St-1-Handle
           DISPLAY Form1 UPON form1-Handle
      * DISPLAY-COLUMNS settings
              MODIFY gd1, DISPLAY-COLUMNS (1, 11, 22, 60, 66, 76, 82, 
           92, 116, 125)
           .

       Form1-PROC.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeAccept>
           perform INIT.
           perform ABILITA-TOOLBAR.
           perform ABILITAZIONI.
           perform STATUS-BAR-MSG.
           perform CLEAR-CLIENTE.
           display form1.
           set VediFattura to false. 
           call "C$NARG" using num-param.
           if num-param = 2
              move link-codice to num-doc tsc-codice
              read tschede no lock 
                   invalid continue 
               not invalid
                   move tsc-cliente to ef-cliente-buf
                   display ef-cliente
                   perform CURRENT-RECORD
              end-read
           else
              move 0 to num-doc
           end-if.

           .
      * <TOTEM:END>
           PERFORM UNTIL Exit-Pushed
              ACCEPT Form1
                 ON EXCEPTION
                    PERFORM Form1-Evaluate-Func
                 MOVE 1 TO TOTEM-Form-Index
              END-ACCEPT
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterEndAccept>
           if VediFattura
              modify form1-Handle, visible false
              inquire gd1(event-data-2, 1), hidden-data in gruppo-hidden

              evaluate hid-documento
              when 1 set vdocum-tipo-fattura to true
              when 2 set vdocum-tipo-corrisp to true
              when 3 set vdocum-tipo-nota    to true
              end-evaluate
              
              inquire gd1(event-data-2, 78-col-numdoc),  cell-data in 
           col-numdoc
              inquire gd1(event-data-2, 78-col-datadoc), cell-data in 
           col-datadoc
              move col-numdoc     to vdocum-numero
              move col-datadoc    to como-data   
              move como-data(5:4) to vdocum-anno  

              call   "vdocum" using vdocum-linkage
              cancel "vdocum"

              perform RIEMPI-GRID

              modify form1-Handle, visible true

              set VediFattura to false
           end-if

      * <TOTEM:END>
           END-PERFORM
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDestroyWindow>
      * <TOTEM:END>
           DESTROY form1-Handle
           INITIALIZE Key-Status
           .

       Form1-Evaluate-Func.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterAccept>
           evaluate key-status
           when 5 |MODIFICA
                inquire tool-modifica, enabled in e-modifica
                if e-modifica = 1
                   if mod = zero 
                      move 1    to mod
                   else          
                      move zero to mod
                   end-if
                   modify tool-modifica, value = mod
                   perform MODIFICA
                end-if
           end-evaluate.

           .
      * <TOTEM:END>
           EVALUATE TRUE
              WHEN Exit-Pushed
                 PERFORM Form1-Exit
              WHEN Event-Occurred
                 IF Event-Type = Cmd-Close
                    PERFORM Form1-Exit
                 END-IF
              WHEN Key-Status = 1000
                 PERFORM pb-note-LinkTo
              WHEN Key-Status = 1001
                 PERFORM pb-cliente-LinkTo
              WHEN Key-Status = 2
                 PERFORM NUOVO-LinkTo
              WHEN Key-Status = 4
                 PERFORM CANCELLA-LinkTo
              WHEN Key-Status = 3
                 PERFORM TOOL-SALVA-LinkTo
              WHEN Key-Status = 6
                 PERFORM ANTEPRIMA-LinkTo
              WHEN Key-Status = 150
                 PERFORM TOOL-MODIFICA-LinkTo
              WHEN Key-Status = 7
                 PERFORM STAMPA-LinkTo
              WHEN Key-Status = 8
                 PERFORM TOOL-CERCA-LinkTo
              WHEN Key-Status = 9
                 PERFORM TOOL-SELEZIONA-LinkTo
           END-EVALUATE
      * avoid changing focus
           MOVE 4 TO Accept-Control
           .

       Form1-CLEAR.
           PERFORM Form1-INIT-VALUE
           PERFORM Form1-DISPLAY
           .

       Form1-DISPLAY.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDisplay>
      * <TOTEM:END>
           DISPLAY Form1-Tb-1
           DISPLAY Form1 UPON form1-Handle
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterDisplay>
           SET LK-BL-SCRITTURA     TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           MOVE FORM1-HANDLE       TO LK-HND-WIN.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           CANCEL "BLOCKPGM".

           .
      * <TOTEM:END>
           .

       Form1-Exit.
      * for main screen
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeExit>
           perform SALV-MOD.

           if errori
              move 26 to key-status
              exit paragraph
           end-if.

           .
      * <TOTEM:END>
           MOVE 27 TO Key-Status
           .

       Form1-Init-Data.
           MOVE 1 TO TOTEM-Form-Index
           MOVE 0 TO TOTEM-Frame-Index
      * GRID
           PERFORM gd1-Content
           .

       Form1-DataSet1-CHANGETO-KEY1.
           MOVE 1 TO DataSet1-KEYIS
           PERFORM Form1-DataSet1-Update-Key
           .

       Form1-DataSet1-Change-CurrentKey-Asc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "A" TO DataSet1-tschede-KEY1-ORDER
           END-EVALUATE
           PERFORM Form1-DataSet1-Update-Key
           .

       Form1-DataSet1-Change-CurrentKey-Desc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "D" TO DataSet1-tschede-KEY1-ORDER
           END-EVALUATE
           PERFORM Form1-DataSet1-Update-Key
           .

       Form1-DataSet1-Update-Key.
           MOVE tsc-rec OF tschede TO
                     Form1-MULKEY-TMPBUF
           PERFORM Form1-CLEAR
           PERFORM Form1-INIT-DATA
           MOVE Form1-MULKEY-TMPBUF TO
                     tsc-rec OF tschede
           PERFORM DataSet1-tschede-Read
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-CURR
           PERFORM Form1-IUD-Display
           .

       Form1-DUPLICATE-MOVEKEY.
           .

       Form1-First.
           PERFORM Form1-DUMMY-FIRST
           PERFORM DataSet1-tschede-INITSTART
           PERFORM DataSet1-tschede-START
           IF NOT Valid-STATUS-tschede
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeFirst>
      * <TOTEM:END>
           PERFORM DataSet1-tschede-Read-Next
           IF NOT Valid-STATUS-tschede
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterFirst>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY.
           PERFORM Form1-IUD-Display
           .

       Form1-Previous.
              PERFORM Form1-Buf-To-Fld
              PERFORM DataSet1-tschede-START-LESS
           IF NOT Valid-STATUS-tschede
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforePrevious>
      * <TOTEM:END>
           PERFORM DataSet1-tschede-Read-Prev
           IF NOT Valid-STATUS-tschede
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterPrevious>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-PREVIOUS
           PERFORM Form1-IUD-Display
           .

       Form1-Next.
              PERFORM Form1-Buf-To-Fld
              PERFORM DataSet1-tschede-START-GREATER
           IF NOT Valid-STATUS-tschede
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeNext>
      * <TOTEM:END>
           PERFORM DataSet1-tschede-Read-Next
           IF NOT Valid-STATUS-tschede
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterNext>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-NEXT
           PERFORM Form1-IUD-Display
           .
      
       Form1-Last.
           PERFORM Form1-DUMMY-LAST
           PERFORM DataSet1-tschede-INITEND
           PERFORM DataSet1-tschede-START-NOTGREATER
           IF NOT Valid-STATUS-tschede
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeLast>
      * <TOTEM:END>
           PERFORM DataSet1-tschede-Read-Prev
           IF NOT Valid-STATUS-tschede
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterLast>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY.
           PERFORM Form1-IUD-Display
           .

       Form1-Curr.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeCurrent>
      * <TOTEM:END>
           PERFORM Form1-Buf-To-Fld
           PERFORM DataSet1-tschede-Read
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-CURR
           PERFORM Form1-IUD-Display
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterCurrent>
      * <TOTEM:END>
           .

       Form1-IUD-Display.
           IF Valid-STATUS-tschede
              PERFORM Form1-ALLGRID-RESET
              PERFORM Form1-Fld-To-Buf
              PERFORM Form1-NAVI-FOR-MASTERGRID
              PERFORM Form1-DISPLAY
           ELSE
              IF Form1-FLAG-REFRESH
                 CONTINUE
              ELSE
                 PERFORM Form1-Extended-File-Status
              END-IF
           END-IF
           .

       Form1-Add.
           PERFORM Form1-Buf-To-Fld
           PERFORM Form1-VALIDATION-ROUTINE
           IF NOT TOTEM-CHECK-OK
               EXIT PARAGRAPH
           END-IF
           PERFORM Form1-DUMMY-ADD
           PERFORM DataSet1-tschede-INITREC
           PERFORM Form1-Buf-To-Fld
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeAdd>
      * <TOTEM:END>
      * write
           PERFORM DataSet1-tschede-Rec-Write
           IF Valid-STATUS-tschede
              PERFORM Form1-RESUMMARY-INS
              PERFORM Form1-DUMMY-UPDATE-INIT
              MOVE "301" TO TOTEM-MSG-ID
              PERFORM Form1-IUD-Display
           END-IF
           PERFORM Form1-ERR-CHECKING
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterAdd>
      * <TOTEM:END>
           .
     
       Form1-Update.
           PERFORM Form1-Buf-To-Fld
           PERFORM DataSet1-tschede-START              
           IF NOT Valid-STATUS-tschede
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
           PERFORM DataSet1-tschede-Read
           PERFORM Form1-Buf-To-Fld
           PERFORM Form1-VALIDATION-ROUTINE
           IF NOT TOTEM-CHECK-OK
               EXIT PARAGRAPH
           END-IF
           PERFORM Form1-DUMMY-UPDATE
           PERFORM Form1-Buf-To-Fld
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeUpdate>
      * <TOTEM:END>
      * write
           PERFORM DataSet1-tschede-Rec-Rewrite
           IF Valid-STATUS-tschede
              PERFORM Form1-RESUMMARY-DEL
              PERFORM Form1-DUMMY-UPDATE-INIT
              MOVE "302" TO TOTEM-MSG-ID
              PERFORM Form1-IUD-Display
           END-IF
           PERFORM Form1-ERR-CHECKING
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterUpdate>
      * <TOTEM:END>
           .

       Form1-Delete.
           MOVE "203" TO TOTEM-MSG-ID
           PERFORM MESSAGE-BOX-DISPLAY
           IF TOTEM-MSG-RETURN-VALUE NOT = 1
              INITIALIZE TOTEM-MSG-TEXT
              EXIT PARAGRAPH 
           END-IF
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDelete>
      * <TOTEM:END>
           PERFORM Form1-DUMMY-DELETE
      * delete
           PERFORM Form1-Buf-To-Fld
           PERFORM DataSet1-tschede-Rec-Delete
           IF Valid-STATUS-tschede
              PERFORM Form1-CLEAR
              PERFORM Form1-DUMMY-DELETE-INIT
              MOVE "303" TO TOTEM-MSG-ID
              MOVE "00" to STATUS-tschede
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterDelete>
      * <TOTEM:END>
           PERFORM Form1-ERR-CHECKING
           .

       Form1-NAVI-FOR-MASTERGRID.
           .

       Form1-ERR-CHECKING.
           IF Valid-STATUS-tschede
              PERFORM Form1-SHOW-MSG-ROUTINE
           ELSE
              PERFORM Form1-Extended-File-Status
           END-IF
           .

       Form1-RESUMMARY-INS.
           .

       Form1-RESUMMARY-DEL.
           .


       Form1-DUMMY-FIRST.
           .

       Form1-DUMMY-PREVIOUS.
           .

       Form1-DUMMY-NEXT.
           .

       Form1-DUMMY-LAST.
           .

       Form1-DUMMY-CURR.
           .

       Form1-DUMMY-ADD.
           .

       Form1-DUMMY-UPDATE.
           .

       Form1-DUMMY-UPDATE-INIT.
           .

       Form1-DUMMY-DELETE.
           .

       Form1-DUMMY-DELETE-INIT.
           .

       Form1-Init-Value.
           MOVE titolo TO TOTEM-MSG-TITLE
           INITIALIZE Form1-BUF
      * FORM : Form1
           PERFORM DataSet1-INIT-RECORD
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, SetDefault>
      * <TOTEM:END>
           PERFORM Form1-FLD-TO-BUF
           .


       Form1-ALLGRID-RESET.
           .

      * for Form's Validation
       Form1-VALIDATION-ROUTINE.
           SET TOTEM-CHECK-OK TO TRUE
      * ef-cliente's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-cliente-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5001 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
           .

       ef-cliente-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-cliente, BeforeValidation>
      * <TOTEM:END>
           .

       ef-cliente-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-cliente, AfterValidation>
      * <TOTEM:END>
           .

      * ef-cliente's Validation
       ef-cliente-VALIDATION.
           PERFORM ef-cliente-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-cliente-AFTER-VALIDATION
           .


       Form1-Buf-To-Fld.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeBufToFld>
      * <TOTEM:END>
      * DB_Entry-Field : ef-cliente
           MOVE ef-cliente-BUF TO tsc-cliente
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterBufToFld>
      * <TOTEM:END>
           .

       Form1-Fld-To-Buf.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeFldToBuf>
      * <TOTEM:END>
      * DB_Entry-Field : ef-cliente
           MOVE tsc-cliente TO ef-cliente-BUF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterFldToBuf>
           perform ABILITAZIONI. 
           perform VALORIZZA-OLD. 
           perform DISPLAY-CLIENTE.

           .
      * <TOTEM:END>
           .

       Form1-CONTROLLO-OLD.
           set SiSalvato to true.
           if mod = 0 exit paragraph end-if.
           perform Form1-BUF-TO-FLD.
           move 0 to scelta.
           .
       Form1-EXTENDED-FILE-STATUS.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
           MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           PERFORM Form1-SHOW-MSG-ROUTINE
           .

       Form1-SHOW-MSG-ROUTINE.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM Form1-DISPLAY-MESSAGE
           .

       Form1-DISPLAY-MESSAGE.
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

       Form1-Save-Status.
           MOVE DataSet1-tschede-KEY1-ORDER TO TMP-Form1-KEY1-ORDER
           MOVE DataSet1-KEYIS TO TMP-Form1-KEYIS
           MOVE tsc-rec OF tschede TO 
              TMP-Form1-tschede-RESTOREBUF
           .             

       Form1-Restore-Status.
           MOVE TMP-Form1-KEY1-ORDER TO DataSet1-tschede-KEY1-ORDER
           MOVE TMP-Form1-KEYIS TO DataSet1-KEYIS
           MOVE TMP-Form1-tschede-RESTOREBUF TO
              tsc-rec OF tschede
           PERFORM DataSet1-tschede-START
           IF Valid-STATUS-tschede
              PERFORM DataSet1-tschede-Read-Next
           ELSE
              PERFORM DataSet1-tschede-INITREC
           END-IF
           PERFORM UNTIL NOT Valid-STATUS-tschede OR
              (Valid-STATUS-tschede AND
                 tsc-rec OF tschede = 
                   TMP-Form1-tschede-RESTOREBUF)
              PERFORM DataSet1-tschede-Read-Next
           END-PERFORM
           .


      * Paragrafo per la struttura del codice in BEFORE sulla screen Form1
      ***---
       Form1-BEFORE-SCREEN.
           evaluate control-id
           |78-ID-ef-cliente è l'ID del campo ef-cliente
           when 78-ID-ef-cliente
                move 1 to StatusHelp
                perform STATUS-HELP
           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella BEFORE della screen
           when 99999 continue
           when other continue
           end-evaluate.

      * Generazione settaggio keyboard "." ---> ","

      * Paragrafo per la struttura del codice in AFTER sulla screen Form1
      ***---
       Form1-AFTER-SCREEN.
           evaluate control-id
           |78-ID-ef-cliente è l'ID del campo ef-cliente
           when 78-ID-ef-cliente
                move 0 to StatusHelp
                perform STATUS-HELP

           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella AFTER della screen
           when 99999 continue
           when other continue
           end-evaluate.

      * Generazione risettaggio keyboard "." ---> "."

      * Generazione stringa perform CONTROLLO
           evaluate control-id
           |78-ID-ef-cliente è l'ID del campo ef-cliente
           when 78-ID-ef-cliente
                perform CONTROLLO
           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella AFTER CONTROLLO della screen
           when 99999 continue
           when other continue
           end-evaluate.

       form-prezzi-Open-Routine.
           PERFORM form-prezzi-Scrn
           PERFORM form-prezzi-Proc
           .

       form-prezzi-Scrn.
           PERFORM form-prezzi-Create-Win
           PERFORM form-prezzi-Init-Value
           PERFORM form-prezzi-Init-Data
      * Tab keystrok settings
      * Tool Bar
           PERFORM form-prezzi-DISPLAY
           .

       form-prezzi-Create-Win.
           Display Floating GRAPHICAL WINDOW
              LINES 30,20,
              SIZE 114,00,
              CELL HEIGHT 10,
              CELL WIDTH 10,
              HEIGHT-IN-CELLS,
              WIDTH-IN-CELLS,
              COLOR 131329,
              ERASE,
              CONTROL FONT Calibri14-Occidentale,
              LABEL-OFFSET 0,
              LINK TO THREAD,
              NO SCROLL,
              TITLE-BAR,
              TITLE titolo,
              WITH SYSTEM MENU,
              USER-GRAY,
           VISIBLE v-prezzi,
              USER-WHITE,
              No WRAP,
              HANDLE IS form-prezz-SF-HANDLE,
      * <TOTEM:EPT. FORM:form-prezzi, FORM:form-prezzi, AfterCreateWin>
      * <TOTEM:END>


      * Tool Bar    
      * Status-bar
           DISPLAY form-prezzi UPON form-prezz-SF-HANDLE
      * DISPLAY-COLUMNS settings
              MODIFY gd-prezzi, DISPLAY-COLUMNS (1, 7, 34, 44, 71, 81, 
           91)
           .

       form-prezzi-PROC.
      * <TOTEM:EPT. FORM:form-prezzi, FORM:form-prezzi, BeforeAccept>
           set SceltoPrezzo to false.

           move 0 to prezzo-scelto.
           initialize lab-art-buf.
           string col-art delimited size
                  " - "   delimited size
                  col-des delimited size
                  into lab-art-buf
           end-string.
           display lab-art.

           modify gd-prezzi, reset-grid = 1.
           perform GD-PREZZI-CONTENT.

           move 1 to riga.
           set rlis-tipo-individuale to true.
           move cli-codice to rls-codice-tipo.
           move 0          to rls-ini-val.
           move col-art    to rls-articolo.
           start rlistini key >= rls-k-ricerca
                 invalid continue
             not invalid
                 perform until 1 = 2
                    read rlistini next at end exit perform end-read
                    if rlis-tipo-catcli 
                       exit perform 
                    end-if
                    if rls-codice-tipo not = cli-codice
                       exit perform
                    end-if
                    if rls-articolo not = col-art
                       exit perform
                    end-if
                    move rls-codice to tls-codice
                    read tlistini no lock 
                         invalid  move "NON TROVATO" to tls-descrizione
                    end-read
                    add 1 to riga
                    move tls-codice      to col-listino
                    move tls-descrizione to col-descriz
                    move tls-ini-val     to como-data
                    perform DATE-TO-SCREEN
                    move como-data       to col-valido
                    move lab-cliente-buf to col-per
                    move rls-prezzo1     to col-prz1
                    move rls-prezzo2     to col-prz2
                    move rls-prezzo3     to col-prz3
                    modify gd-prezzi(riga, 1), cell-data col-listino
                    modify gd-prezzi(riga, 2), cell-data col-descriz
                    modify gd-prezzi(riga, 3), cell-data col-valido
                    modify gd-prezzi(riga, 4), cell-data col-per
                    modify gd-prezzi(riga, 5), cell-data col-prz1
                    modify gd-prezzi(riga, 6), cell-data col-prz2
                    modify gd-prezzi(riga, 7), cell-data col-prz3
                 end-perform
           end-start.


           set rlis-tipo-catcli to true.
           move cli-tipologia   to rls-codice-tipo.
           move 0               to rls-ini-val.
           move col-art         to rls-articolo.
           start rlistini key >= rls-k-ricerca
                 invalid continue
             not invalid
                 perform until 1 = 2
                    read rlistini next at end exit perform end-read
                    if rlis-tipo-individuale
                       exit perform 
                    end-if
                    if rls-codice-tipo not = cli-tipologia
                       exit perform
                    end-if
                    if rls-articolo not = col-art
                       exit perform
                    end-if
                    move rls-codice to tls-codice
                    read tlistini no lock 
                         invalid  move "NON TROVATO" to tls-descrizione
                    end-read
                    add 1 to riga
                    move tls-codice      to col-listino
                    move tls-descrizione to col-descriz
                    move tls-ini-val     to como-data
                    perform DATE-TO-SCREEN
                    move como-data       to col-valido
                    move lab-tipo-buf    to col-per
                    move rls-prezzo1     to col-prz1
                    move rls-prezzo2     to col-prz2
                    move rls-prezzo3     to col-prz3
                    modify gd-prezzi(riga, 1), cell-data col-listino
                    modify gd-prezzi(riga, 2), cell-data col-descriz
                    modify gd-prezzi(riga, 3), cell-data col-valido
                    modify gd-prezzi(riga, 4), cell-data col-per
                    modify gd-prezzi(riga, 5), cell-data col-prz1
                    modify gd-prezzi(riga, 6), cell-data col-prz2
                    modify gd-prezzi(riga, 7), cell-data col-prz3
                 end-perform
           end-start.

           if riga = 1
              display message "Nessun Listino trovato per questo articol
      -    "o"
                         title titolo
                          icon 2
              move 27 to key-status
           else
              move 1 to v-prezzi
              modify form-prezz-SF-HANDLE, visible v-prezzi 
              move 2 to event-data-2 riga
              move 5 to event-data-1 colonna
              modify gd-prezzi, cursor-y riga, cursor-x colonna
              move 78-ID-gd-prezzi to control-id
              move 4               to accept-control

              modify gd-prezzi, start-x = 1,  
                                      x = 7,
                                start-y = riga,
                                      y = riga,
                           region-color = 257,
                           cursor-color = colore-nu

           end-if.

           .
      * <TOTEM:END>
           PERFORM UNTIL Exit-Pushed
              ACCEPT form-prezzi
                 ON EXCEPTION
                    PERFORM form-prezzi-Evaluate-Func
                 MOVE 2 TO TOTEM-Form-Index
              END-ACCEPT
      * <TOTEM:EPT. FORM:form-prezzi, FORM:form-prezzi, AfterEndAccept>
           if SceltoPrezzo
              move 27 to key-status
           end-if

      * <TOTEM:END>
           END-PERFORM
      * <TOTEM:EPT. FORM:form-prezzi, FORM:form-prezzi, BeforeDestroyWindow>
      * <TOTEM:END>
           DESTROY form-prezz-SF-HANDLE
           INITIALIZE Key-Status
           .

       form-prezzi-Evaluate-Func.
      * <TOTEM:EPT. FORM:form-prezzi, FORM:form-prezzi, AfterAccept>
      * <TOTEM:END>
           EVALUATE TRUE
              WHEN Exit-Pushed
                 PERFORM form-prezzi-Exit
              WHEN Event-Occurred
                 IF Event-Type = Cmd-Close
                    PERFORM form-prezzi-Exit
                 END-IF
           END-EVALUATE
      * avoid changing focus
           MOVE 4 TO Accept-Control
           .

       form-prezzi-CLEAR.
           PERFORM form-prezzi-INIT-VALUE
           PERFORM form-prezzi-DISPLAY
           .

       form-prezzi-DISPLAY.
      * <TOTEM:EPT. FORM:form-prezzi, FORM:form-prezzi, BeforeDisplay>
      * <TOTEM:END>
           DISPLAY form-prezzi UPON form-prezz-SF-HANDLE
      * <TOTEM:EPT. FORM:form-prezzi, FORM:form-prezzi, AfterDisplay>
           SET LK-BL-SCRITTURA     TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           MOVE FORM1-HANDLE       TO LK-HND-WIN.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           CANCEL "BLOCKPGM".

           .
      * <TOTEM:END>
           .

       form-prezzi-Exit.
      * for main screen
      * <TOTEM:EPT. FORM:form-prezzi, FORM:form-prezzi, BeforeExit>
           move 0 to v-prezzi.

           .
      * <TOTEM:END>
           MOVE 27 TO Key-Status
           .

       form-prezzi-Init-Data.
           MOVE 2 TO TOTEM-Form-Index
           MOVE 0 TO TOTEM-Frame-Index
      * GRID
           PERFORM gd-prezzi-Content
           .

       form-prezzi-Init-Value.
      * <TOTEM:EPT. FORM:form-prezzi, FORM:form-prezzi, SetDefault>
      * <TOTEM:END>
           PERFORM form-prezzi-FLD-TO-BUF
           .


       form-prezzi-ALLGRID-RESET.
           .

      * for Form's Validation
       form-prezzi-VALIDATION-ROUTINE.
           SET TOTEM-CHECK-OK TO TRUE
           .


       form-prezzi-Buf-To-Fld.
      * <TOTEM:EPT. FORM:form-prezzi, FORM:form-prezzi, BeforeBufToFld>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:form-prezzi, FORM:form-prezzi, AfterBufToFld>
      * <TOTEM:END>
           .

       form-prezzi-Fld-To-Buf.
      * <TOTEM:EPT. FORM:form-prezzi, FORM:form-prezzi, BeforeFldToBuf>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:form-prezzi, FORM:form-prezzi, AfterFldToBuf>
      * <TOTEM:END>
           .

       form-prezzi-CONTROLLO-OLD.
           set SiSalvato to true.
           if mod = 0 exit paragraph end-if.
           perform form-prezzi-BUF-TO-FLD.
           move 0 to scelta.
           .
       form-prezzi-EXTENDED-FILE-STATUS.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
           MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           PERFORM form-prezzi-SHOW-MSG-ROUTINE
           .

       form-prezzi-SHOW-MSG-ROUTINE.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM form-prezzi-DISPLAY-MESSAGE
           .

       form-prezzi-DISPLAY-MESSAGE.
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

       form-prezzi-Save-Status.
           .             

       form-prezzi-Restore-Status.
           .


      * Paragrafo per la struttura del codice in BEFORE sulla screen form-prezzi
      ***---
       form-prezzi-BEFORE-SCREEN.
           evaluate control-id
           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella BEFORE della screen
           when 99999 continue
           when other continue
           end-evaluate.

      * Generazione settaggio keyboard "." ---> ","

      * Paragrafo per la struttura del codice in AFTER sulla screen form-prezzi
      ***---
       form-prezzi-AFTER-SCREEN.
           evaluate control-id
           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella AFTER della screen
           when 99999 continue
           when other continue
           end-evaluate.

      * Generazione risettaggio keyboard "." ---> "."

      * Generazione stringa perform CONTROLLO
           evaluate control-id
           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella AFTER CONTROLLO della screen
           when 99999 continue
           when other continue
           end-evaluate.



       Form1-BeforeProcedure.
           EVALUATE Control-Id
           WHEN 5001 MOVE "." to TOTEM-HINT-TEXT
           WHEN OTHER MOVE SPACES TO TOTEM-HINT-TEXT
           END-EVALUATE
           EVALUATE Control-Id
           When 5001 PERFORM Screen1-DaEf-1-BeforeProcedure
           END-EVALUATE
           PERFORM Form1-DISPLAY-STATUS-MSG
           perform Form1-BEFORE-SCREEN
           .

       Form1-AfterProcedure.
           EVALUATE Control-Id
           When 5001 PERFORM Screen1-DaEf-1-AfterProcedure
           END-EVALUATE
           perform Form1-AFTER-SCREEN
           .

       Screen1-Event-Proc.
           .

       Screen1-Gd-1-Event-Proc.
           EVALUATE Event-Type ALSO Event-Control-Id ALSO
                                    Event-Window-Handle
           WHEN Msg-Begin-Drag ALSO 5002 ALSO
                    form1-Handle 
              PERFORM gd1-Ev-Msg-Begin-Drag
           WHEN Msg-Begin-Entry ALSO 5002 ALSO
                    form1-Handle 
              PERFORM gd1-Ev-Msg-Begin-Entry
           WHEN Msg-End-Drag ALSO 5002 ALSO
                    form1-Handle 
              PERFORM gd1-Ev-Msg-End-Drag
           WHEN Msg-Finish-Entry ALSO 5002 ALSO
                    form1-Handle 
              PERFORM gd1-Ev-Msg-Finish-Entry
           WHEN Msg-Goto-Cell ALSO 5002 ALSO
                    form1-Handle 
              PERFORM gd1-Ev-Msg-Goto-Cell
           WHEN Msg-Goto-Cell-Drag ALSO 5002 ALSO
                    form1-Handle 
              PERFORM gd1-Ev-Msg-Goto-Cell-Drag
           WHEN Msg-Goto-Cell-Mouse ALSO 5002 ALSO
                    form1-Handle 
              PERFORM gd1-Ev-Msg-Goto-Cell-Mouse
           END-EVALUATE
           .

       form-prezz-Gd-1-Event-Proc.
           EVALUATE Event-Type ALSO Event-Control-Id ALSO
                                    Event-Window-Handle
           WHEN Msg-Begin-Drag ALSO 5001 ALSO
                    form-prezz-SF-HANDLE 
              PERFORM gd-prezzi-Ev-Msg-Begin-Drag
           WHEN Msg-Begin-Entry ALSO 5001 ALSO
                    form-prezz-SF-HANDLE 
              PERFORM gd-prezzi-Ev-Msg-Begin-Entry
           WHEN Msg-End-Drag ALSO 5001 ALSO
                    form-prezz-SF-HANDLE 
              PERFORM gd-prezzi-Ev-Msg-End-Drag
           WHEN Msg-Goto-Cell ALSO 5001 ALSO
                    form-prezz-SF-HANDLE 
              PERFORM gd-prezzi-Ev-Msg-Goto-Cell
           WHEN Msg-Goto-Cell-Drag ALSO 5001 ALSO
                    form-prezz-SF-HANDLE 
              PERFORM gd-prezzi-Ev-Msg-Goto-Cell-Drag
           WHEN Msg-Goto-Cell-Mouse ALSO 5001 ALSO
                    form-prezz-SF-HANDLE 
              PERFORM gd-prezzi-Ev-Msg-Goto-Cell-Mouse
           END-EVALUATE
           .

      * USER DEFINE PARAGRAPH
       PARAGRAFO-COPY.
      * <TOTEM:PARA. PARAGRAFO-COPY>
           copy "abilita-toolbar.cpy".
           copy "color-custom.cpy".
           copy "status.cpy".
           copy "utydata.cpy" 
           .
      * <TOTEM:END>

       ABILITAZIONI.
      * <TOTEM:PARA. ABILITAZIONI>
           if mod = 1              
              move BitmapDeleteEnabled to BitmapNumDelete
              move BitmapSaveEnabled   to BitmapNumSave
              move 1 to e-salva e-cancella
           else           
              move BitmapDeleteDisabled to BitmapNumDelete
              move BitmapSaveDisabled   to BitmapNumSave
              move 0 to e-salva e-cancella
           end-if.      


           modify tool-cancella, enabled = e-cancella.
           modify tool-salva,    enabled = e-salva.
       
      * ISACCO (SERVE SEMPRE PER LA MODIFICA PRCEDENTE E PER RIPRISTINARE
      * LE BITMAP DISABILITATE. - 10/11/2003
      *     perform FORM1-DISPLAY.
           display tool-nuovo, tool-salva, tool-cancella, tool-modifica.
      * FINE 
           .
      * <TOTEM:END>

       ANTEPRIMA.
      * <TOTEM:PARA. ANTEPRIMA>
           set s-anteprima to true.
           perform STAMPA-ANTEPRIMA 
           .
      * <TOTEM:END>

       CALCOLA-NETTO.
      * <TOTEM:PARA. CALCOLA-NETTO>
           if como-col-prz not = 0
              compute como-col-netto =
                      como-col-prz   -
                    ( como-col-prz   * como-col-sc1 / 100 )
      *****        compute como-col-netto =
      *****                como-col-netto - 
      *****              ( como-col-netto * como-col-sc2 / 100 )
           else
              move 0 to como-col-netto
           end-if.
           move como-col-netto to col-netto.
           modify gd1(riga, 78-col-netto), cell-data col-netto 
           .
      * <TOTEM:END>

       CANCELLA.
      * <TOTEM:PARA. CANCELLA>
           if mod = 0 exit paragraph end-if.
      *
           display message MSG-Cancellare-il-record-corrente
                   title   titolo
                   type    mb-yes-no 
                   default mb-no
                   giving  scelta

           if scelta = mb-yes
              perform RIEMPI-CHIAVE
              delete tschede record 
                     invalid  continue
                 not invalid  perform DELETE-RIGHE
              end-delete

              move 0   to mod
              move 1   to mod-k
              perform FORM1-CLEAR
              set vecchio to true
              perform CANCELLA-COLORE
              perform INIT-OLD-REC
              perform RESETTA-GRID
              
              display message MSG-Cancellazione-avvenuta-con-successo
                      title titolo                         

              unlock tschede all records

              move 78-ID-ef-cliente to control-id     
              move 4                to accept-control 

              set Statusvisua to true
              perform STATUS-BAR-MSG
              modify TOOL-MODIFICA value = mod
           end-if 
           .
      * <TOTEM:END>

       CERCA.
      * <TOTEM:PARA. CERCA>
           evaluate CONTROL-ID
      *
           when 78-ID-ef-cliente           
                set SceltoCliente to false
                inquire ef-cliente, value in cli-codice
                move "clienti-alfa" to como-file
                call "zoom-gt"   using como-file, cli-rec
                                giving stato-zoom
                cancel "zoom-gt"
                if stato-zoom = 0
                   set SceltoCliente to true
                   move cli-codice   to tsc-cliente
                   modify ef-cliente, value tsc-cliente
                   move 4                to ACCEPT-CONTROL   
                end-if

           when 78-ID-gd1
                perform X-Y
                evaluate colonna
                when 78-col-art
                     inquire gd1(riga, 78-col-art), 
                                               cell-data in art-codice
                     move "articoli"     to Como-File
                     call   "zoom-gt" using  como-file, art-rec
                                      giving stato-zoom
                     cancel "zoom-gt"
                     if stato-zoom = 0
                        move art-codice        to col-art
                        move art-descrizione   to col-des
                        modify gd1(riga, 78-col-art), 
                               cell-data = col-art
                        modify gd1(riga, 78-col-des), 
                               cell-data = col-des
                        perform CONTROLLO-RIGA
                     end-if

                when 78-col-prz
                     perform VALORE-RIGA
                     move riga to store-riga
                     perform FORM-PREZZI-OPEN-ROUTINE
                     move store-riga to riga
                     if prezzo-scelto not = 0
                        move prezzo-scelto to col-prz
                        modify gd1(riga, 78-col-prz), cell-data col-prz
                        if como-col-sc1 = 0 |and como-col-sc2 = 0
                           move cli-sconto1 to como-col-sc1 col-sc1
      *****                     move cli-sconto2 to como-col-sc2 col-sc2
                           modify gd1(riga, 78-col-sc1), cell-data 
           col-sc1
      *****                     modify gd1(riga, 78-col-sc2), cell-data col-sc2
                        end-if
                        perform VALORE-RIGA
                        perform CALCOLA-NETTO
                        if col-prz not = old-col-prz
                           move riga        to RigaCambiata
                           move 78-col-prz  to ColonnaCambiata
                        end-if
                     end-if
                     move 78-ID-gd1 to control-id
                     move 4         to accept-control
                     modify gd1, cursor-y riga, cursor-x 78-col-prz

                end-evaluate
           end-evaluate  
           .
      * <TOTEM:END>

       COLORE-RIGA.
      * <TOTEM:PARA. COLORE-RIGA>
           modify gd1, start-x = 1,
                             x = 78-max-colonne - 2,
                       start-y = riga,
                             y = riga,
                  region-color = 257,
                  cursor-color = colore-nu 
           .
      * <TOTEM:END>

       CLEAR-CLIENTE.
      * <TOTEM:PARA. CLEAR-CLIENTE>
           move spaces to lab-cliente-buf lab-tipo-buf lab-scontoa-buf
                          lab-mail-buf lab-tel-buf lab-indirizzo-buf
                          lab-citta-buf lab-prov-buf lab-cell-buf
                          lab-scont-buf.
           move 0      to lab-sconto1-buf. 
           move 0      to lab-sconto2-buf. 
           move 0      to v-sconto v-note.

           move default-bmp to contact-bmp.
           modify bmp-contact, bitmap-handle contact-bmp 
           .
      * <TOTEM:END>

       CLEAR-SCREEN.
      * <TOTEM:PARA. CLEAR-SCREEN>
           move tsc-chiave to old-tsc-chiave.

           initialize tsc-dati of tschede 
                     replacing numeric data by zeroes
                          alphanumeric data by spaces.
                         
           perform FORM1-FLD-TO-BUF. 

           perform INIT-OLD-REC.

           perform CLEAR-CLIENTE.
                                         
           display form1. 

           perform RESETTA-GRID.
  
           unlock tschede all records    
           .
      * <TOTEM:END>

       CHECK-INSERIMENTO.
      * <TOTEM:PARA. CHECK-INSERIMENTO>
      * MODIFICA LA STATUS-BAR
      * CONTROLLO SE DA INSERIMENTO SCORRO. ALLORA DEVO SEGNALARE CHE
      * SONO TORNATO IN MODIFICA.
           inquire tool-modifica, value in mod.

           evaluate mod
           when 1  
                set StatusModifica to true
           when 0
                set StatusVisua    to true   
           end-evaluate.
      
           perform STATUS-BAR-MSG 
           .
      * <TOTEM:END>

       CONTROLLO.
      * <TOTEM:PARA. CONTROLLO>
           set tutto-ok to true. 
      
           evaluate CONTROL-ID
           when 78-ID-ef-cliente
                perform RIEMPI-CHIAVE           
                if ef-cliente-buf not = spaces
                   read tschede no lock key tsc-k-cliente
                        invalid
                        if vecchio
                           display message MSG-record-inesistente
                                     title tit-err
                                      icon 2
                           perform CLEAR-SCREEN
                           set errori to true
                        else
                           perform DISPLAY-CLIENTE
                           display form1
                        end-if
                    not invalid      
                        if old-tsc-chiave not = tsc-chiave or mod = 0
                           perform CURRENT-RECORD 
                        end-if
                   end-read
      
                else
                   set errori to true  
                   move 78-ID-ef-cliente to control-id
                   display message box MSG-record-inesistente
                           title = tit-err
                           icon mb-warning-icon
                end-if
                if errori
                   move 78-ID-ef-cliente to control-id
                   move 4               to accept-control
                end-if
      
           end-evaluate.
      
           if errori
              perform CANCELLA-COLORE
              move CONTROL-ID to store-id
              move 4          to ACCEPT-CONTROL
           end-if 
           .
      * <TOTEM:END>

       CONTROLLO-RIGA.
      * <TOTEM:PARA. CONTROLLO-RIGA>
           set tutto-ok to true.
           if mod = 0 
              exit paragraph 
           end-if.

           evaluate colonna
           when 78-col-data
                move como-col-data to como-data
                perform DATE-FORMAT
                move como-data to col-data
                modify gd1(riga, 78-col-data), cell-data col-data
           when 78-col-art
                move col-art to art-codice
                if art-codice not = spaces
                   read articoli no lock
                        invalid
                        move spaces to art-descrizione
                        set errori to true
                        display message "Articolo NON valido"
                                  title tit-err
                                icon 2
                   end-read
                   modify gd1(riga, 78-col-des), cell-data 
           art-descrizione
                end-if
           when 78-col-des
                if col-art = spaces and col-des = spaces
                   set errori to true
                   display message "Articolo o Descrizione obbligatorio"
                             title tit-err
                              icon 2
                end-if

           when 78-col-prz
                if como-col-prz = 0 and col-art not = spaces
                   set errori to true
                   display message "Prezzo obbligatorio"
                             title tit-err
                              icon 2
                end-if
                if tutto-ok
                   perform CALCOLA-NETTO
                end-if

           when 78-col-sc1
      *****     when 78-col-sc2
                perform CALCOLA-NETTO
           end-evaluate.


      ***** 78  78-col-qta        value 4. 
      ***** 78  78-col-prz        value 5. 
      ***** 78  78-col-sc         value 6. 
      ***** 78  78-col-note       value 8. 
      ***** 78  78-col-numdoc     value 9. 
      ***** 78  78-col-datadoc    value 10  
           .
      * <TOTEM:END>

       CURRENT-RECORD.
      * <TOTEM:PARA. CURRENT-RECORD>
           perform RIEMPI-CHIAVE.
           set tutto-ok  to true.
           set ReadSecca to true.
           if nuovo move 0 to mod end-if.
      
           if mod = 1
              read tschede lock key tsc-k-cliente
                 invalid
                    set errori to true 
              end-read
           else
              read tschede no lock key tsc-k-cliente
                 invalid 
                    set errori to true 
              end-read
           end-if.                    
           set ReadSecca to false.
      
           if RecLocked
              set RecLocked to false
           else
              if tutto-ok
                 perform CANCELLA-COLORE
                 if nuovo
                    move 0      to mod
                    move 1      to mod-k
                    move 78-ID-ef-cliente to control-id
                    move 4                to accept-control
                 else
                    move 78-ID-gd1 to control-id
                    move 4         to accept-control
                 end-if   
                 perform FORM1-IUD-DISPLAY
                 set vecchio to true
                 if mod = 1
                    set StatusModifica to true
                 else                         
                    set StatusVisua    to true
                 end-if
                 perform STATUS-BAR-MSG 
                 perform VALORIZZA-OLD
                 perform RIEMPI-GRID
              else
                 move 0 to mod
                 move 1 to mod-k
                 if vecchio
                    perform CLEAR-SCREEN
                    if YesMessage
                       move 78-ID-ef-cliente to CONTROL-ID
                       move 4                to accept-control
                       display message MSG-Record-inesistente
                                 title tit-err
                                  icon 2
                    end-if
                 end-if
              end-if
           end-if 
           .
      * <TOTEM:END>

       DELETE-RIGHE.
      * <TOTEM:PARA. DELETE-RIGHE>
           move low-value  to rsc-rec.
           move tsc-codice to rsc-codice.
           start rschede key >= rsc-chiave
                 invalid continue
             not invalid
                 perform until 1 = 2
                    read rschede next at end exit perform end-read
                    if rsc-codice not = tsc-codice
                       exit perform 
                    end-if
                    delete rschede record invalid continue end-delete
                 end-perform
           end-start 
           .
      * <TOTEM:END>

       DESCRIZIONE-CLIENTE.
      * <TOTEM:PARA. DESCRIZIONE-CLIENTE>
           initialize lab-tipo-buf.
           inspect cli-ragsoc replacing trailing spaces by low-value.
           string  cli-ragsoc delimited low-value
                   " "        delimited size
                   cli-nome   delimited size
                   into lab-tipo-buf
           end-string 
           .
      * <TOTEM:END>

       DISPLAY-CLIENTE.
      * <TOTEM:PARA. DISPLAY-CLIENTE>
           initialize cli-rec.
           move tsc-cliente to cli-codice.
           read clienti no lock 
                invalid 
                move spaces     to lab-scontoa-buf
                move spaces     to lab-scont-buf
                move 0          to v-sconto
            not invalid
                move "Sconto %" to lab-scontoa-buf
      *****          move "+"        to lab-scont-buf
                move 1          to v-sconto
           end-read.
           initialize lab-cliente-buf.
           inspect cli-ragsoc replacing trailing spaces by low-value
           string  cli-ragsoc delimited low-value
                   " "        delimited size
                   cli-nome   delimited size
                   into lab-cliente-buf
           end-string.

           move cli-indirizzo to lab-indirizzo-buf.
           move cli-localita  to lab-citta-buf.
           move cli-prov      to lab-prov-buf.
           move cli-email     to lab-mail-buf.
           move cli-tel       to lab-tel-buf.
           move cli-cell      to lab-cell-buf.
                                
           move cli-sconto1   to lab-sconto1-buf.
      *****     move cli-sconto2   to lab-sconto2-buf.

           move cli-tipologia to tcl-codice.
           read tipocli no lock 
                invalid move spaces to tcl-descrizione
           end-read.
           move tcl-descrizione to lab-tipo-buf.

           CALL "w$bitmap" USING WBITMAP-LOAD cli-fotografia, 
                   GIVING contact-bmp.
           if contact-bmp > 999999
              move default-bmp to contact-bmp
           end-if.
           modify bmp-contact, bitmap-handle contact-bmp.

           if cli-righe-default not = spaces
              move 1 to v-note
           else
              move 0 to v-note
           end-if 
           .
      * <TOTEM:END>

       INIT.
      * <TOTEM:PARA. INIT>
           move 0 to StatusHelp.
           move 1 to mod-k.
           set StatusVisua    to true  
           .
      * <TOTEM:END>

       INIT-OLD-REC.
      * <TOTEM:PARA. INIT-OLD-REC>
           initialize old-tsc-rec replacing numeric data by zeroes
                                       alphanumeric data by spaces.

           initialize old-rsc-rec replacing numeric data by zeroes
                                       alphanumeric data by spaces.

           move tsc-cliente to old-tsc-cliente 
           .
      * <TOTEM:END>

       MODIFICA.
      * <TOTEM:PARA. MODIFICA>
           move 5 to key-status.
           inquire tool-modifica, value in mod.
           set tutto-ok to true.

           if nuovo
              move 1   to mod                  
              modify tool-modifica, value mod
           else
      *  SE L'UTENTE E' ABILITATO PUO' MODIFICARE UN RECORD
              if mod = 1
                 set YesMessage to true
                 perform CURRENT-RECORD
                 if tutto-ok
                    move 0   to mod-k
                    move 1   to mod
                    set StatusModifica to true
                    perform STATUS-BAR-MSG
                 end-if
              else
                 move 1 to mod
                 perform SALV-MOD            
                 move 0 to mod
                 move 1 to mod-k
                 if errori
                    move 1 to mod
                    move 0 to mod-k
                 else                  
                    set NoMessage to true
                    perform CURRENT-RECORD
                    set StatusVisua to true
                    perform STATUS-BAR-MSG 
                    unlock tschede all records
                    move 78-ID-ef-cliente to control-id
                 end-if
              end-if

              display form1
              modify tool-modifica,  value mod
              perform CANCELLA-COLORE 

              move 4 to ACCEPT-CONTROL
           end-if 
           .
      * <TOTEM:END>

       NUOVO.
      * <TOTEM:PARA. NUOVO>
           perform SALV-MOD.

           if tutto-ok  
              move 78-ID-ef-cliente to control-id
              move 4                to accept-control
              set nuovo to true
              perform CERCA
              if SceltoCliente
                 move 1                to mod mod-k
                 modify tool-modifica,  value = mod
                 perform CANCELLA-COLORE
                 perform VALORIZZA-NUOVO
                 perform INIT-OLD-REC
                 set StatusIns to true
                 perform STATUS-BAR-MSG  
                 set nuovo to true
              else
                 set vecchio to true
              end-if
           end-if 
           .
      * <TOTEM:END>

       PUNTA-CELLA.
      * <TOTEM:PARA. PUNTA-CELLA>
           move 78-ID-gd1    to control-id store-id.
           move 4            to accept-control.
           modify gd1,       cursor-y riga, 
                             cursor-x colonna.
           perform COLORE-RIGA 
           .
      * <TOTEM:END>

       RESETTA-GRID.
      * <TOTEM:PARA. RESETTA-GRID>
           modify gd1, reset-grid = 1.
           perform GD1-CONTENT.
           initialize rec-grid.
           modify gd1, insert-rows = 999 
           .
      * <TOTEM:END>

       RIEMPI-CHIAVE.
      * <TOTEM:PARA. RIEMPI-CHIAVE>
           inquire ef-cliente, value in ef-cliente-buf.
           move ef-cliente-buf to tsc-cliente 
           .
      * <TOTEM:END>

       RIEMPI-GRID.
      * <TOTEM:PARA. RIEMPI-GRID>
           move 0 to store-riga.
           modify gd1, mass-update = 1.
           perform RESETTA-GRID.
           move low-value  to rsc-rec.
           move tsc-codice to rsc-codice.
      
           set tutto-ok   to true.
           start rschede key >= rsc-chiave
                 invalid  set errori  to true
           end-start.
      
           if tutto-ok
              move 2 to riga
              perform until 1 = 2
                 read rschede next no lock 
                    at end 
                       exit perform 
                 end-read
                 if rsc-codice not = tsc-codice
                    exit perform
                 end-if
                 move rsc-data  to como-data
                 perform DATE-TO-SCREEN
                 move como-data to col-data
                 move rsc-articolo to art-codice col-art
                 if col-art = spaces 
                    move rsc-descrizione to art-descrizione
                 else
                    read articoli no lock 
                      invalid move "** NON TROVATO **" to 
           art-descrizione
                    end-read
                 end-if
                 move art-descrizione to col-des
                 move rsc-qta         to col-qta
                 move rsc-prz         to col-prz
                 move rsc-sconto1     to col-sc1
      *****           move rsc-sconto2     to col-sc2
                 move rsc-netto       to col-netto
                 move rsc-note        to col-note
                 move 0               to col-numdoc
                 move 0               to col-datadoc
                 move spaces          to hid-documento
                 if rsc-numfat not = 0
                    move rsc-numfat  to col-numdoc
                    move rsc-datafat to como-data
                    perform DATE-TO-SCREEN
                    move como-data   to col-datadoc
                    modify gd1(riga, 78-col-numdoc),  cell-color 481
                    modify gd1(riga, 78-col-datadoc), cell-color 481
                    set hid-fattura to true
                 end-if
                 if rsc-numcor not = 0
                    move rsc-numcor  to col-numdoc
                    move rsc-datacor to como-data
                    perform DATE-TO-SCREEN
                    move como-data   to col-datadoc
                    modify gd1(riga, 78-col-numdoc),  cell-color 193
                    modify gd1(riga, 78-col-datadoc), cell-color 193
                    set hid-corrisp to true
                 end-if
                 if rsc-numcor      = 0 and 
                    rsc-numfat      = 0 and 
                    num-doc     not = 0 and
                    store-riga      = 0
                    move riga to store-riga
                 end-if
                 modify gd1(riga, 78-col-data),    cell-data col-data
                 modify gd1(riga, 78-col-art),     cell-data col-art
                 modify gd1(riga, 78-col-des),     cell-data col-des
                 modify gd1(riga, 78-col-qta),     cell-data col-qta
                 modify gd1(riga, 78-col-prz),     cell-data col-prz
                 modify gd1(riga, 78-col-sc1),     cell-data col-sc1
      *****           modify gd1(riga, 78-col-sc2),     cell-data col-sc2
                 modify gd1(riga, 78-col-netto),   cell-data col-netto
                 modify gd1(riga, 78-col-note),    cell-data col-note
                 modify gd1(riga, 78-col-numdoc),  cell-data col-numdoc
                 modify gd1(riga, 78-col-datadoc), cell-data col-datadoc
                 modify gd1(riga, 1), hidden-data gruppo-hidden
                 add 1 to riga
              end-perform
              subtract 2 from riga giving RigheIniziali
           end-if.
           modify gd1, mass-update = 0.
           if store-riga = 0
              move 2 to store-riga
           end-if.
           move store-riga to riga.
           move 1          to colonna.
           perform PUNTA-CELLA.
           perform VALORE-RIGA.
           move rsc-rec      to old-rsc-rec.
           move rsc-data     to como-old-rsc-data.
           move rsc-articolo to como-old-rsc-articolo 
           .
      * <TOTEM:END>

       SALVA.
      * <TOTEM:PARA. SALVA>
           if mod = 0 
              exit paragraph 
           end-if.

           set tutto-ok to true.

           set controllo-finale to true.
           perform varying control-id from 78-ID-ef-cliente by 1
                     until control-id > 78-ID-ef-cliente
              perform CONTROLLO
              if errori 
                 exit perform
              end-if
           end-perform.
      
           if tutto-ok
              perform X-Y
              if tot-righe = 1
                 set errori to true
                 display message "Nessun articolo inserito"
                           title tit-err
                            icon 2
                 move 78-ID-gd1 to control-id
                 move 1 to colonna
              else
                 perform VALORE-RIGA
                 if not RigaVuota
                    perform varying colonna from 78-col-data by 1
                              until colonna > 78-max-colonne|78-col-tipo-imp
                       perform CONTROLLO-RIGA
                       if errori exit perform end-if
                    end-perform
                 end-if
              end-if
           end-if.
                  
           set controllo-finale to false.
      
           if errori
              perform ABILITAZIONI
              if store-id = 78-ID-gd1
                 perform CANCELLA-COLORE
                 perform PUNTA-CELLA
              else
                 move store-id to control-id
                 move 4        to accept-control
              end-if
           else

              if nuovo
                 move high-value to      tsc-codice
                 start tschede key <=    tsc-codice
                       invalid move 1 to tsc-codice
                   not invalid
                       read tschede previous with no lock
                            at end move 1 to tsc-codice
                        not at end add  1 to tsc-codice
                       end-read
                 end-start
                 accept tsc-data-creazione from century-date
              end-if

              perform DELETE-RIGHE
              perform FORM1-BUF-TO-FLD
              perform varying riga from 2 by 1 
                        until riga > tot-righe
                 perform VALORE-RIGA
                 perform SCRIVI-RIGA
              end-perform

              perform CANCELLA-COLORE
              write tsc-rec invalid rewrite tsc-rec end-write 

              if nuovo
                 set vecchio to true
                 perform STAMPA
              end-if

              set vecchio      to true
              set stampa       to true

              perform TORNA-IN-VISUA
              perform VALORIZZA-OLD

           end-if.

           display form1 
           .
      * <TOTEM:END>

       SALV-MOD.
      * <TOTEM:PARA. SALV-MOD>
           set tutto-ok to true.
           perform FORM1-CONTROLLO-OLD.

           if SiSalvato and mod = 1
              if RigaCambiata not = 0 or ColonnaCambiata not = 0
                 set NoSalvato  to true
                 move 78-ID-gd1 to store-id
                 move ColonnaCambiata to colonna
                 move RigaCambiata    to riga
              end-if
           end-if.    

           if SiSalvato and mod = 1
              inquire gd1, last-row in tot-righe
              subtract 1 from tot-righe
              if tot-righe not = RigheIniziali |or inserito-extra
                 move tot-righe to riga
                 set NoSalvato  to true
                 move 78-ID-gd1 to store-id
                 move 1 to colonna
              end-if
           end-if.
      
           if NoSalvato
              display message MSG-Salvare-le-modifiche
                        title titolo
                         type mb-yes-no-cancel 
                       giving scelta       
       
              evaluate scelta
              when mb-yes 
                   perform SALVA
              when mb-no  
                   continue
                   if nuovo
                      perform RIEMPI-CHIAVE
                      delete tschede record invalid continue end-delete
                   end-if
              when other                
                   perform CANCELLA-COLORE
                   set errori to true
                   evaluate store-id
                   when 78-ID-gd1     
                        perform PUNTA-CELLA
                   when other
                      move store-id to control-id       
                      move 4        to accept-control   
                   end-evaluate
              end-evaluate
           end-if 
           .
      * <TOTEM:END>

       SCRIVI-RIGA.
      * <TOTEM:PARA. SCRIVI-RIGA>
           if como-col-data = 0
              exit paragraph
           end-if.
           initialize rsc-rec replacing numeric data by zeroes
                                   alphanumeric data by spaces.
           move 1           to rsc-riga
           move tsc-codice  to rsc-codice.
           move como-col-data to como-data.
           perform DATE-TO-FILE.
           move como-data   to rsc-data.
           move col-art     to rsc-articolo.

           move tsc-cliente to rsc-cliente.
           move col-des     to rsc-descrizione.
           move col-qta     to rsc-qta.
           move col-prz     to rsc-prz.
           move col-sc1     to rsc-sconto1.
      *****     move col-sc2     to rsc-sconto2.
           move col-netto   to rsc-netto.
           move col-note    to rsc-note.
           if como-col-numdoc not = 0
              if Hid-Fattura
                 move col-numdoc  to rsc-numfat
                 move col-datadoc to como-data
                 perform DATE-TO-FILE
                 move como-data   to rsc-datafat
              else
                 move col-numdoc  to rsc-numcor
                 move col-datadoc to como-data
                 perform DATE-TO-FILE
                 move como-data   to rsc-datacor
              end-if
           end-if.
           
           perform until 1 = 2
              write rsc-rec 
                    invalid add 1 to rsc-riga
                not invalid exit perform
              end-write
           end-perform 
           .
      * <TOTEM:END>

       SELEZIONA.
      * <TOTEM:PARA. SELEZIONA>
           inquire ef-cliente, value in tsc-cliente.
           move "tschede"     to Como-File
           call   "zoom-gt" using  como-file, tsc-rec
                            giving stato-zoom
           cancel "zoom-gt"
           if stato-zoom = 0
              if old-tsc-chiave not = tsc-chiave or
               ( tsc-codice = 0 and mod = 0 )
                 move tsc-cliente to save-cliente
                 perform SALV-MOD
                 if tutto-ok
                    move save-cliente to tsc-cliente
                    set ReadSecca to true
                    modify ef-cliente, value tsc-cliente
                    perform CURRENT-RECORD
                    perform CANCELLA-COLORE
                    move 78-ID-ef-cliente to CONTROL-ID       
                    move 4                to ACCEPT-CONTROL   
                 end-if                                  
              end-if
           end-if.

      *****     set tutto-ok to true.
      *****     move zero   to link-fornitore
      *****     perform SEL-LISTINI.
      *****
      ********---
      ***** SEL-LISTINI.
      *****     call   "sel-listini" using link-codice 
      *****                                link-articolo 
      *****                                link-fornitore.
      *****     cancel "sel-listini".
      *****
      *****     if link-codice not = 0
      *****
      *****        if link-codice not = tsc-codice of tschede
      *****           perform SALV-MOD
      *****        end-if
      *****
      *****        if tutto-ok
      *****           set  ReadSecca   to true
      *****           move link-codice to tsc-codice of tschede 
      *****           move link-codice to ef-codice-buf
      *****           display ef-codice
      *****           perform CURRENT-RECORD
      *****           if link-articolo = 0
      *****              move 2 to riga
      *****           else
      *****              move store-riga to riga
      *****           end-if
      *****           move 1 to colonna
      *****           perform PUNTA-CELLA
      *****           perform CANCELLA-COLORE
      *****           if link-articolo = 0
      *****              move 78-ID-ef-codice to control-id
      *****              move 4               to accept-control
      *****           end-if
      *****        end-if
      *****
      *****     end-if.
      *****
      *****
      ********---
      ***** SELEZIONA-NUMERICO.
      *****     if tsc-codice of tschede not > 0
      *****        set errori to true
      *****        move 78-ID-ef-codice to control-id
      *****        display message box msg-codice-obbligatorio
      *****                title tit-err
      *****                icon  mb-warning-icon
      *****     else           
      *****        read tschede no lock
      *****             invalid
      *****             if vecchio
      *****                display message MSG-record-inesistente
      *****                          title tit-err
      *****                           icon 2
      *****                perform CLEAR-SCREEN
      *****                set errori to true
      *****             end-if
      *****         not invalid      
      *****             if old-tsc-chiave not = tsc-chiave of tschede or
      *****              ( tsc-codice of tschede = 0 and mod = 0 )
      *****                perform CURRENT-RECORD 
      *****             end-if
      *****        end-read
      *****     end-if.
      *****
      ********---
      ***** SELEZIONA-ALFA.
      ****** LA SECONDA CHIAVE E' ALFANUMERICA E LA VALUE VARIABLE CONTIENE
      ****** ANCORA GLI ZERI DAVANTI CHE ELIMINO
      *****     inspect ef-codice-buf replacing leading ZERO by SPACES.
      *****     move ef-codice-buf to cli-ragsoc-1.
      *****
      *****
      ****** POI GIUSTIFICO A SINISTRA E MI POSIZIONO SULLO ZOOM PER CHIAVE
      ****** ALTERNATA
      *****     call "C$JUSTIFY" using cli-ragsoc-1, "L".
      *****     move low-value to cli-codice
      *****                  
      *****     set cli-tipo-F to true.
      *****     start clienti key not < cli-k1
      *****        invalid 
      *****           initialize cli-rec
      *****        not invalid 
      *****           read clienti next 
      *****              if cli-tipo-C
      *****                 initialize cli-rec
      *****              end-if
      *****     end-start.
      *****     set cli-tipo-F to true.
      *****
      *****     if cli-ragsoc-1 = ef-codice-buf
      *****        move cli-codice   to link-fornitore
      *****        perform SEL-LISTINI
      *****     else
      *****        move "clienti-alfa-all" to como-file
      *****        call "zoom-gt"  using  como-file, cli-rec
      *****                        giving  stato-zoom
      *****        cancel "zoom-gt"
      *****        if stato-zoom = 0
      *****           move cli-codice    to link-fornitore
      *****           perform SEL-LISTINI
      *****        end-if
      ******     else
      ******        set errori           to true
      ******        move 78-ID-ef-codice to CONTROL-ID
      *****     end-if.
      *****


       
           .
      * <TOTEM:END>

       SPOSTAMENTO.
      * <TOTEM:PARA. SPOSTAMENTO>
           set tutto-ok to true.
           perform X-Y.
      
           if event-data-2 not = riga
      
              perform VALORE-RIGA

              if not RigaVuota
                 perform varying colonna from 78-col-data by 1
                           until colonna > 78-max-colonne|78-col-tipo-imp
                    perform CONTROLLO-RIGA
                    if errori exit perform end-if
                 end-perform
              end-if
      
      *****        if tutto-ok and mod = 1
      *****           perform SCRIVI-RIGA
      *****        end-if

              if tutto-ok
                 evaluate true
                 when event-data-2 < 2 
                      move 2            to riga
                      move event-data-1 to colonna
      
                 when event-data-2 > tot-righe
                      add  1                to tot-righe giving riga
                      set event-action      to event-action-fail
                      move 1                to colonna
                      perform PUNTA-CELLA
                 when other
                      move event-data-2 to riga
                      move event-data-1 to colonna
                 end-evaluate
                 perform VALORE-RIGA
                 if art-codice = 0
                    initialize rsc-rec 
                               replacing numeric data by zeroes
                                    alphanumeric data by spaces
                 end-if
                 move rsc-rec       to old-rsc-rec
                 move rsc-data      to como-old-rsc-data
                 move rsc-articolo  to como-old-rsc-articolo
              else                  
                 set event-action   to event-action-fail
                 perform PUNTA-CELLA
              end-if
           else
              if event-data-1 not = colonna
                 inquire gd1(riga, 1), cell-data in art-codice
                 if art-codice = 0
                    set event-action to event-action-fail
                    move 1 to colonna event-data-1
                    perform PUNTA-CELLA
                 end-if
              end-if
              move event-data-1 to colonna
           end-if.
      
           perform COLORE-RIGA.
           move 0 to StatusHelp.
           if mod = 1 and como-col-data not = 0
              if colonna = 78-col-art
                 move 1 to StatusHelp
              end-if
              if colonna = 78-col-prz and col-art not = spaces
                 move 1 to StatusHelp
              end-if
           end-if.
           perform STATUS-HELP 
           .
      * <TOTEM:END>

       SPOSTAMENTO-PREZZI.
      * <TOTEM:PARA. SPOSTAMENTO-PREZZI>
           set tutto-ok to true.
           inquire gd-prezzi, last-row in tot-righe.
      
           evaluate true
           when event-data-2 < 2 
                move 2              to riga
                move event-data-1   to colonna
      
           when event-data-2 > tot-righe
                add  1              to tot-righe giving riga
                set event-action    to event-action-fail
                move 1              to colonna

                move 78-ID-gd-prezzi to control-id store-id
                move 4               to accept-control
                modify gd1,   cursor-y riga, 
                              cursor-x colonna
           when other
                move event-data-2 to riga
                if event-data-1 < 5 
                   set event-action to event-action-fail
                   move 5           to colonna
                end-if
                move 78-ID-gd-prezzi to control-id store-id
                move 4               to accept-control
                modify gd1,    cursor-y riga, 
                               cursor-x colonna
           end-evaluate.

           modify gd-prezzi, start-x = 1,
                                   x = 7,
                             start-y = riga,
                                   y = riga,
                        region-color = 257,
                        cursor-color = colore-nu 
           .
      * <TOTEM:END>

       STAMPA.
      * <TOTEM:PARA. STAMPA>
           set s-stampa to true.
           perform STAMPA-ANTEPRIMA 
           .
      * <TOTEM:END>

       STAMPA-ANTEPRIMA.
      * <TOTEM:PARA. STAMPA-ANTEPRIMA>
           if nuovo
              display message "Salvare prima la scheda"
                        title tit-err
                         icon 2
           else
              if s-anteprima
                 accept link-stampante from environment "STAMPANTE_ANTEP
      -    "RIMA"
              else
                 move spaces to link-stampante
              end-if
              call   "st-schedacli" using tsc-codice, link-stampante
              cancel "st-schedacli"
           end-if 
           .
      * <TOTEM:END>

       TORNA-IN-VISUA.
      * <TOTEM:PARA. TORNA-IN-VISUA>
           move 0 to mod.
           move 1 to mod-k.
           move 78-ID-ef-cliente to CONTROL-ID.
           set NoMessage to true.
           perform ABILITAZIONI.
           set StatusVisua to true.
           perform STATUS-BAR-MSG.
           unlock tschede all records.
                        
           modify tool-modifica,  value mod.
           perform CANCELLA-COLORE.
           move 4 to ACCEPT-CONTROL 
           .
      * <TOTEM:END>

       VALORE-RIGA.
      * <TOTEM:PARA. VALORE-RIGA>
           inquire gd1(riga, 78-col-data),    cell-data col-data.
           inquire gd1(riga, 78-col-art),     cell-data col-art. 
           inquire gd1(riga, 78-col-des),     cell-data col-des.
           inquire gd1(riga, 78-col-qta),     cell-data col-qta.
           inquire gd1(riga, 78-col-prz),     cell-data col-prz.
           inquire gd1(riga, 78-col-sc1),     cell-data col-sc1.
      *****     inquire gd1(riga, 78-col-sc2),     cell-data col-sc2.
           inquire gd1(riga, 78-col-netto),   cell-data col-netto.
           inquire gd1(riga, 78-col-note),    cell-data col-note.
           inquire gd1(riga, 78-col-numdoc),  cell-data col-numdoc.
           inquire gd1(riga, 78-col-datadoc), cell-data col-datadoc.
           inquire gd1(riga, 1), hidden-data gruppo-hidden.

           move col-data    to como-col-data.
           move col-qta     to como-col-qta.
           move col-prz     to como-col-prz.
           move col-sc1     to como-col-sc1.
      *****     move col-sc2     to como-col-sc2.
           move col-netto   to como-col-netto.
           move col-numdoc  to como-col-numdoc.
           move col-datadoc to como-col-datadoc.

           if como-col-data    = 0 and
              col-art          = spaces and
              col-des          = spaces and
              como-col-qta     = 0 and
              como-col-prz     = 0 and
              como-col-sc1     = 0 and
      *****        como-col-sc2     = 0 and
              como-col-netto   = 0 and
              col-note         = spaces and
              como-col-numdoc  = 0 and
              como-col-datadoc = 0
              set RigaVuota to true
           else
              set RigaVuota to false
           end-if 
           .
      * <TOTEM:END>

       VALORIZZA-OLD.
      * <TOTEM:PARA. VALORIZZA-OLD>
           move tsc-rec to old-tsc-rec.

           set vecchio to true.

           move 0 to StatusHelp
           perform STATUS-HELP.

           inquire gd1, last-row in tot-righe.
           move 0 to RigaCambiata ColonnaCambiata 
           .
      * <TOTEM:END>

       VALORIZZA-NUOVO.
      * <TOTEM:PARA. VALORIZZA-NUOVO>
           move "00"       to status-tschede.
           move cli-codice to tsc-cliente.
           perform FORM1-IUD-DISPLAY.
           display form1.

           perform RESETTA-GRID.

           move 0 to RigheIniziali.
           move 0 to RigaCambiata ColonnaCambiata 
           .
      * <TOTEM:END>

       X-Y.
      * <TOTEM:PARA. X-Y>
           inquire gd1, cursor-y in riga,
                        cursor-x in colonna,
                        last-row in tot-righe 
           .
      * <TOTEM:END>

      * EVENT PARAGRAPH
       NUOVO-LinkTo.
      * <TOTEM:PARA. NUOVO-LinkTo>
           INQUIRE TOOL-NUOVO, ENABLED IN E-NUOVO.

           IF E-NUOVO = 1
              PERFORM NUOVO
           END-IF                    
           .
      * <TOTEM:END>
       CANCELLA-LinkTo.
      * <TOTEM:PARA. CANCELLA-LinkTo>
           INQUIRE TOOL-MODIFICA, VALUE IN MOD.
                              
           INQUIRE TOOL-CANCELLA, ENABLED IN E-CANCELLA
           IF E-CANCELLA = 1
              PERFORM CANCELLA
           END-IF                                                
           .
      * <TOTEM:END>
       TOOL-SALVA-LinkTo.
      * <TOTEM:PARA. TOOL-SALVA-LinkTo>
           INQUIRE TOOL-MODIFICA, VALUE IN MOD           

           INQUIRE TOOL-SALVA, ENABLED IN E-SALVA
           IF E-SALVA = 1
              PERFORM SALVA
           END-IF           
           .
      * <TOTEM:END>
       ANTEPRIMA-LinkTo.
      * <TOTEM:PARA. ANTEPRIMA-LinkTo>
           INQUIRE TOOL-ANTEPRIMA, ENABLED IN E-ANTEPRIMA.
           IF E-ANTEPRIMA = 1
              PERFORM ANTEPRIMA
           END-IF 
           .
      * <TOTEM:END>
       TOOL-MODIFICA-BeforeProcedure.
      * <TOTEM:PARA. TOOL-MODIFICA-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       TOOL-MODIFICA-AfterProcedure.
      * <TOTEM:PARA. TOOL-MODIFICA-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       TOOL-MODIFICA-LinkTo.
      * <TOTEM:PARA. TOOL-MODIFICA-LinkTo>
           INQUIRE TOOL-MODIFICA, ENABLED IN E-MODIFICA.

           IF E-MODIFICA = 1
              PERFORM MODIFICA
           END-IF 
           .
      * <TOTEM:END>
       STAMPA-LinkTo.
      * <TOTEM:PARA. STAMPA-LinkTo>
           INQUIRE TOOL-STAMPA, ENABLED IN E-STAMPA
           IF E-STAMPA = 1
              PERFORM STAMPA
           END-IF 
           .
      * <TOTEM:END>
       TOOL-CERCA-LinkTo.
      * <TOTEM:PARA. TOOL-CERCA-LinkTo>
           inquire tool-cerca, enabled in e-cerca
           if e-cerca = 1
              perform CERCA
           end-if 
           .
      * <TOTEM:END>
       TOOL-SELEZIONA-LinkTo.
      * <TOTEM:PARA. TOOL-SELEZIONA-LinkTo>
           inquire tool-seleziona, enabled in e-seleziona
           if e-seleziona = 1
              perform SELEZIONA
           end-if 
           .
      * <TOTEM:END>
       ginqui-Ev-Before-Program.
      * <TOTEM:PARA. ginqui-Ev-Before-Program>
           move LK-BL-PROG-ID    TO COMO-PROG-ID.
           accept PathBmpDefault from environment "BMP_CONTACT".
           CALL "w$bitmap" USING WBITMAP-LOAD PathBmpDefault, 
                   GIVING default-bmp   
           .
      * <TOTEM:END>
       ginqui-Ev-After-Program.
      * <TOTEM:PARA. ginqui-Ev-After-Program>
           set environment "KEYSTROKE" to "DATA=44 44".
           set environment "KEYSTROKE" to "DATA=46 46".
           SET LK-BL-CANCELLAZIONE TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           destroy contact-bmp.
           destroy default-bmp 
           .
      * <TOTEM:END>
       Screen1-DaEf-1-BeforeProcedure.
      * <TOTEM:PARA. Screen1-DaEf-1-BeforeProcedure>
           move ZERO to StatusHelp.
           perform STATUS-HELP.
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       Screen1-DaEf-1-AfterProcedure.
      * <TOTEM:PARA. Screen1-DaEf-1-AfterProcedure>
              INQUIRE ef-cliente, VALUE IN tsc-cliente
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-cliente-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       gd1-Ev-Msg-Begin-Drag.
      * <TOTEM:PARA. gd1-Ev-Msg-Begin-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       gd1-Ev-Msg-End-Drag.
      * <TOTEM:PARA. gd1-Ev-Msg-End-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       gd1-Ev-Msg-Goto-Cell.
      * <TOTEM:PARA. gd1-Ev-Msg-Goto-Cell>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       gd1-Ev-Msg-Goto-Cell-Drag.
      * <TOTEM:PARA. gd1-Ev-Msg-Goto-Cell-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       gd1-Ev-Msg-Goto-Cell-Mouse.
      * <TOTEM:PARA. gd1-Ev-Msg-Goto-Cell-Mouse>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       gd1-Ev-Msg-Begin-Entry.
      * <TOTEM:PARA. gd1-Ev-Msg-Begin-Entry>
           if mod = 0                       
              set  event-action to event-action-fail-terminate
              inquire gd1(riga, 78-col-numdoc),  cell-data 
           OLD-col-numdoc
              inquire gd1(riga, 78-col-datadoc), cell-data 
           OLD-col-datadoc

              move OLD-col-numdoc to como-col-numdoc
              if como-col-numdoc not = 0
                 if colonna >= 78-col-numdoc
                    inquire gd1, entry-reason in como-x
                    evaluate como-x
                    when X"00"|doppio click
                    when X"0D"|invio
      *****                   move OLD-col-numdoc  to tfa-numero
      *****                   move OLD-col-datadoc to como-data
      *****                   perform DATE-TO-FILE
      *****                   move como-data(1:4)  to tfa-numero
                         set VediFattura to true
                    end-evaluate
                 end-if
              end-if
           else
              perform X-Y
              inquire gd1(riga, 78-col-data), cell-data OLD-col-data
              move OLD-col-data to como-data
              inquire gd1(riga, 78-col-art),  cell-data OLD-col-art
      
              if como-col-data = 0 and colonna not = 78-col-data
                 set event-action to event-action-fail
              end-if
      
              inquire gd1(riga, 78-col-des),     cell-data OLD-col-des
              inquire gd1(riga, 78-col-qta),     cell-data OLD-col-qta
              inquire gd1(riga, 78-col-sc1),     cell-data OLD-col-sc1
      *****        inquire gd1(riga, 78-col-sc2),     cell-data OLD-col-sc2
              inquire gd1(riga, 78-col-netto),   cell-data OLD-col-netto
              inquire gd1(riga, 78-col-note),    cell-data OLD-col-note
              inquire gd1(riga, 78-col-numdoc),  cell-data 
           OLD-col-numdoc
              inquire gd1(riga, 78-col-datadoc), cell-data 
           OLD-col-datadoc

              move OLD-col-numdoc to como-col-numdoc
              if como-col-numdoc not = 0
                 if colonna >= 78-col-numdoc
                    set  event-action to event-action-fail-terminate
                    inquire gd1, entry-reason in como-x
                    evaluate como-x
                    when X"00"|doppio click
                    when X"0D"|invio
      *****                   move OLD-col-numdoc  to tfa-numero
      *****                   move OLD-col-datadoc to como-data
      *****                   perform DATE-TO-FILE
      *****                   move como-data(1:4)  to tfa-numero
                         set VediFattura to true
                    end-evaluate
                 else
                    set event-action to event-action-fail
                 end-if
              else
                 evaluate colonna
                 when 78-col-data
                 when 78-col-art
                      continue
                 when 78-col-des
                      if col-art = spaces
                         continue
                      else
                         set event-action to event-action-fail 
                      end-if
                 when 78-col-netto
                 when 78-col-numdoc
                 when 78-col-datadoc
                      set event-action to event-action-fail 
                 when 78-col-qta 
                 when 78-col-note
                      continue
                 when other
                      set environment "KEYSTROKE" to "DATA=44 46"    
                 end-evaluate
              end-if

           end-if 
           .
      * <TOTEM:END>
       gd1-Ev-Msg-Finish-Entry.
      * <TOTEM:PARA. gd1-Ev-Msg-Finish-Entry>
           set tutto-ok to true.
           perform X-Y.
           perform VALORE-RIGA.
      
           evaluate colonna
           when 78-col-data
                if como-col-data = 0
                   if not RigaVuota
                      display message "Cancellare la riga?"
                                title titolo
                                 type mb-yes-no
                              default mb-no
                               giving scelta
                      if scelta = mb-no
                         set errori to true
                      else
                         initialize rec-grid 
                                    replacing numeric data by zeroes
                                         alphanumeric data by spaces
      
                         move riga to store-riga
                         add 1 to riga
                         perform VALORE-RIGA
                         move rsc-rec to old-rsc-rec
                         move store-riga to riga
                 
                         modify gd1, record-to-delete = riga
                         modify gd1, insert-rows = 1
                      end-if
                   end-if
                else
                   perform CONTROLLO-RIGA
                end-if
                if tutto-ok
                   if rsc-data not = old-rsc-data
                      move riga to RigaCambiata
                      move 1    to ColonnaCambiata
                   end-if
                end-if
      
           when 78-col-art
                perform CONTROLLO-RIGA
                if tutto-ok
                   if col-art not = old-col-art
                      move riga        to RigaCambiata
                      move 78-col-art  to ColonnaCambiata
                   end-if
                end-if
      
           when 78-col-des
                if col-des not = old-col-des
                   move riga        to RigaCambiata
                   move 78-col-des  to ColonnaCambiata
                end-if

           when 78-col-qta
                if col-qta not = old-col-qta
                   move riga        to RigaCambiata
                   move 78-col-qta  to ColonnaCambiata
                end-if

           when 78-col-prz 
                if como-col-prz not = 0
                   if como-col-sc1 = 0 |and como-col-sc2 = 0
                      move cli-sconto1 to como-col-sc1 col-sc1
      *****                move cli-sconto2 to como-col-sc2 col-sc2
                      modify gd1(riga, 78-col-sc1), cell-data col-sc1
      *****                modify gd1(riga, 78-col-sc2), cell-data col-sc2
                   end-if
                end-if
                perform CONTROLLO-RIGA
                if tutto-ok
                   if col-prz not = old-col-prz
                      move riga        to RigaCambiata
                      move 78-col-prz  to ColonnaCambiata
                   end-if
                end-if

           when 78-col-sc1
                perform CONTROLLO-RIGA
                if col-sc1 not = old-col-sc1
                   move riga        to RigaCambiata
                   move 78-col-sc1  to ColonnaCambiata
                end-if

      *****     when 78-col-sc2
      *****          perform CONTROLLO-RIGA
      *****          if col-sc1 not = old-col-sc1
      *****             move riga        to RigaCambiata
      *****             move 78-col-sc2  to ColonnaCambiata
      *****          end-if

           when 78-col-note
                if col-note not = old-col-note
                   move riga        to RigaCambiata
                   move 78-col-note to ColonnaCambiata
                end-if 
           end-evaluate.
      
           if errori
              move 78-ID-gd1 to store-id
              set event-action to event-action-fail
           else                                              
              modify gd1(riga, 78-col-qta),   cell-data col-qta
              modify gd1(riga, 78-col-prz),   cell-data col-prz
              modify gd1(riga, 78-col-sc1),   cell-data col-sc1
      *****        modify gd1(riga, 78-col-sc2),   cell-data col-sc2
              modify gd1(riga, 78-col-netto), cell-data col-netto
              set environment "KEYSTROKE" to "DATA=44 44"
              set environment "KEYSTROKE" to "DATA=46 46"
           end-if 
           .
      * <TOTEM:END>
       pb-note-LinkTo.
      * <TOTEM:PARA. pb-note-LinkTo>
           if mod = 0
              exit paragraph
           end-if.

           inquire gd1, last-row in tot-righe.
           add 1 to tot-righe giving riga
           perform varying idx from 1 by 1 
                     until idx > 15
              if cli-riga(idx) not = spaces
                 initialize rec-grid old-rec-grid
                            replacing numeric data by zeroes
                                 alphanumeric data by spaces
                 accept como-data from century-date
                 perform DATE-TO-SCREEN
                 move como-data     to col-data
                 move cli-riga(idx) to col-des
                 modify gd1(riga, 78-col-data), cell-data col-data
                 modify gd1(riga, 78-col-des),  cell-data col-des
                 add 1 to riga
              end-if
           end-perform 
           .
      * <TOTEM:END>
       pb-cliente-LinkTo.
      * <TOTEM:PARA. pb-cliente-LinkTo>
           if mod = 0 or nuovo exit paragraph end-if.
           display message "Assegnare questa scheda ad un altro cliente?
      -    ""
                     title titolo
                      icon 2
                      type mb-yes-no
                    giving scelta
                   default mb-no
           if scelta = mb-yes
              inquire ef-cliente, value in cli-codice
              move cli-codice     to store-codice
              move "clienti-alfa" to como-file
              call "zoom-gt"   using como-file, cli-rec
                              giving stato-zoom
              cancel "zoom-gt"
              if stato-zoom = 0
                 move cli-codice   to tsc-cliente
                 modify ef-cliente, value tsc-cliente
                 move 4            to ACCEPT-CONTROL   
                 rewrite tsc-rec 
                         invalid 
                         display message "Scheda già presente"
                                   title tit-err
                                    icon 2
                     not invalid
                         move cli-codice   to tsc-cliente
                         perform DISPLAY-CLIENTE
                         display form1
                 end-rewrite
                 move tsc-cliente to ef-cliente-buf
                 display ef-cliente
                 inquire gd1, last-row in tot-righe
                 perform varying riga from 2 by 1 
                           until riga > tot-righe
                    inquire gd1(riga, 78-col-prz), cell-data in col-prz
                    move col-prz to como-col-prz
                    if como-col-prz not = 0
                       move lab-sconto1-buf to col-sc1 como-col-sc1
      *****                 move lab-sconto2-buf to col-sc2 como-col-sc2
                       modify gd1(riga, 78-col-sc1), cell-data col-sc1
      *****                 modify gd1(riga, 78-col-sc2), cell-data col-sc2
                       perform CALCOLA-NETTO
                    end-if
                 end-perform
                 perform SALVA
              end-if
           end-if 
           .
      * <TOTEM:END>
       gd-prezzi-Ev-Msg-Begin-Drag.
      * <TOTEM:PARA. gd-prezzi-Ev-Msg-Begin-Drag>
           perform SPOSTAMENTO-PREZZI 
           .
      * <TOTEM:END>
       gd-prezzi-Ev-Msg-End-Drag.
      * <TOTEM:PARA. gd-prezzi-Ev-Msg-End-Drag>
           perform SPOSTAMENTO-PREZZI 
           .
      * <TOTEM:END>
       gd-prezzi-Ev-Msg-Goto-Cell.
      * <TOTEM:PARA. gd-prezzi-Ev-Msg-Goto-Cell>
           perform SPOSTAMENTO-PREZZI 
           .
      * <TOTEM:END>
       gd-prezzi-Ev-Msg-Goto-Cell-Drag.
      * <TOTEM:PARA. gd-prezzi-Ev-Msg-Goto-Cell-Drag>
           perform SPOSTAMENTO-PREZZI 
           .
      * <TOTEM:END>
       gd-prezzi-Ev-Msg-Goto-Cell-Mouse.
      * <TOTEM:PARA. gd-prezzi-Ev-Msg-Goto-Cell-Mouse>
           perform SPOSTAMENTO-PREZZI 
           .
      * <TOTEM:END>
       gd-prezzi-Ev-Msg-Begin-Entry.
      * <TOTEM:PARA. gd-prezzi-Ev-Msg-Begin-Entry>
           set  event-action to event-action-fail-terminate.
           move event-data-2 to riga.
           if riga > 1 and event-data-1 > 4
              inquire gd-prezzi, entry-reason in como-x
              evaluate como-x
              when X"00"|doppio click
              when X"0D"|invio
                   inquire gd-prezzi(riga, event-data-1)
                           cell-data in prezzo-scelto
                   set SceltoPrezzo to true
              end-evaluate
           end-if 
           .
      * <TOTEM:END>

      *{TOTEM}END

      *{TOTEM}SHOW-MSG
       MESSAGE-FOR-FILEERROR.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
              MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           .

       SHOW-TRANSACTION-ROUTINE.
           IF TOTEM-TRANSACTION-FLAG = SPACES
              IF TRANSACTION-STATUS NOT = 0
                 STRING "TRANSACTION ERROR ", TRANSACTION-STATUS
                    DELIMITED BY SIZE INTO TOTEM-MSG-1
              END-IF
           ELSE
              PERFORM SHOW-MSG-ROUTINE
              IF TRANSACTION-STATUS = 0
                 MOVE "Transazione terminata con Rollback." TO 
           TOTEM-MSG-3
              ELSE
                 STRING "TRANSACTION ERROR ", TRANSACTION-STATUS
                    DELIMITED BY SIZE INTO TOTEM-MSG-3
              END-IF
           END-IF
           .

       SHOW-MSG-ROUTINE.
           MOVE SPACE TO TOTEM-MSG-1 TOTEM-MSG-2 TOTEM-MSG-3
           EVALUATE TOTEM-MSG-ID
               WHEN "10"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Nessun altro dato." TO TOTEM-MSG-2
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "22"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Chiave Duplicata." TO TOTEM-MSG-2
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "23"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Raggiunta fine file." TO TOTEM-MSG-2
                    MOVE MB-WARNING-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "101"
                    MOVE "Terminare l'applicazione?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "201"
                    MOVE "Aggiungere un nuovo record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "202"
                    MOVE "Aggiornare il Record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "203"
                    MOVE "Cancellare il Record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "204"
                    MOVE "Chiave duplicata." TO TOTEM-MSG-1
                    MOVE MB-WARNING-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "301"
                    MOVE "Inserimento avvenuto con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "302"
                    MOVE "Aggiornamento avvenuto con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "303"
                    MOVE "Cancellazione avvenuta con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "401"
                    MOVE "Shell non trovata." TO TOTEM-MSG-1
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN OTHER
                    MOVE TEXT-MESSAGE TO TOTEM-MSG-1
                    STRING "FILE:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-3
                    MOVE 0 TO TOTEM-IDX1
                    INSPECT TOTEM-MSG-3 TALLYING TOTEM-IDX1
                       FOR TRAILING SPACE
                    STRING TOTEM-MSG-3(1:TOTEM-MSG-LENGTH - 
           TOTEM-IDX1), 
                       ", FILE STATUS ", PRIMARY-ERROR "," 
                       SECONDARY-ERROR
                    DELIMITED BY SIZE INTO TOTEM-MSG-2
                    MOVE SPACES TO TOTEM-MSG-3
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
           END-EVALUATE
           PERFORM MESSAGE-BOX-ROUTINE
           .

       MESSAGE-BOX-ROUTINE.
           MOVE 1 TO TOTEM-MSG-TEXT-POINTER
           IF TOTEM-MSG-1 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-1 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              STRING TOTEM-MSG-1( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                 DELIMITED BY SIZE
                 INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-2 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-2 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              IF TOTEM-MSG-TEXT-POINTER > 1
                 STRING X"0A" DELIMITED BY SIZE
                     INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
              END-IF
              STRING TOTEM-MSG-2( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                  DELIMITED BY SIZE
                  INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-3 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-3 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              IF TOTEM-MSG-TEXT-POINTER > 1
                 STRING X"0A" DELIMITED BY SIZE
                     INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
              END-IF
              STRING TOTEM-MSG-3( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                  DELIMITED BY SIZE
                  INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-TEXT-POINTER = 1
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-TEXT TALLYING TOTEM-MSG-SIZE FOR 
           TRAILING SPACE
                  COMPUTE TOTEM-MSG-TEXT-POINTER = 
           TOTEM-MSG-FULL-LENGTH - TOTEM-MSG-SIZE + 1
           END-IF
           MOVE LOW-VALUES TO TOTEM-MSG-TEXT(TOTEM-MSG-TEXT-POINTER : 1 
           )
           .

       MESSAGE-BOX-DISPLAY.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

      *{TOTEM}END

