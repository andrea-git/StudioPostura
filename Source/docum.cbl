      *{TOTEM}PRG-COMMENT
      * docum.Cbl
      * docum.Cbl is generated by TOTEM
      * This is a generated file. DO NOT modify this file directly.
      *{TOTEM}END
       IDENTIFICATION       DIVISION.
      *{TOTEM}PRGID
       PROGRAM-ID.          docum.
       AUTHOR.              ANDREA EVENTI.
       DATE-WRITTEN.        martedì 31 maggio 2016 09:27:09.
       REMARKS.
      *{TOTEM}END

       ENVIRONMENT          DIVISION.
       CONFIGURATION        SECTION.
       SPECIAL-NAMES.
      *{TOTEM}SPECIAL-NAME
      * <TOTEM:EPT. INIT:docum, INIT:docum, SpecialName>
      * <TOTEM:END>
      *{TOTEM}END
      *{TOTEM}ACTIVEX-DEF
      *{TOTEM}END
      *{TOTEM}DECIMAL-POINT
           DECIMAL-POINT IS COMMA.
      *{TOTEM}END

       INPUT-OUTPUT         SECTION.
       FILE-CONTROL.
      *{TOTEM}FILE-CONTROL
           COPY "tfatture.sl".
           COPY "tcorrisp.sl".
           COPY "rfatture.sl".
           COPY "rcorrisp.sl".
           COPY "clienti.sl".
           COPY "tipocli.sl".
           COPY "rnotacr.sl".
           COPY "tnotacr.sl".
           COPY "tschede.sl".
           COPY "rschede.sl".
           COPY "tmp-docum.sl".
           COPY "lineseq.sl".
      *{TOTEM}END
       DATA                 DIVISION.
       FILE                 SECTION.
      *{TOTEM}FILE
           COPY "tfatture.fd".
           COPY "tcorrisp.fd".
           COPY "rfatture.fd".
           COPY "rcorrisp.fd".
           COPY "clienti.fd".
           COPY "tipocli.fd".
           COPY "rnotacr.fd".
           COPY "tnotacr.fd".
           COPY "tschede.fd".
           COPY "rschede.fd".
           COPY "tmp-docum.fd".
           COPY "lineseq.fd".
      *{TOTEM}END

       WORKING-STORAGE      SECTION.
      *{TOTEM}ACU-DEF
               COPY "acugui.def".
               COPY "acucobol.def".
               COPY "fonts.def".
               COPY "crtvars.def".
               COPY "showmsg.def".
               COPY "totem.def".
               COPY "comune.def".
               COPY "custom.def".
               COPY "UTYDATA.DEF".
      *{TOTEM}END

      *{TOTEM}COPY-WORKING
      * Key Status
       77 Key-Status IS SPECIAL-NAMES CRT STATUS PIC 9(5) VALUE 0.
          88 Enter-Pushed VALUE 13.
          88 Exit-Pushed VALUE 27.
          88 Message-Received VALUE 95.
          88 Event-Occurred VALUE 96.
          88 Screen-No-Input-Field VALUE 97.
          88 Screen-Time-Out VALUE 99.
      * Properties & User defined Working Stoarge
       77 Form1-handle
                  USAGE IS HANDLE OF WINDOW.
           COPY  "LINK-VDOCUM.DEF".
       77 Calibri14-Occidentale
                  USAGE IS HANDLE OF FONT.
       78 titolo VALUE IS "Studio - Reportistica Fatturati". 
       77 LOGO-PICCOLO-BMP PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 Default-Font
                  USAGE IS HANDLE OF FONT DEFAULT-FONT.
       77 Calibri14B-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 Small-Font
                  USAGE IS HANDLE OF FONT SMALL-FONT.
       77 strip-docum-bmp  PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 tipo-doc         PIC  9
                  VALUE IS 1.
       77 como-tipo-doc    PIC  9
                  VALUE IS 1.
       77 como-730         PIC  x.
       77 como-unico       PIC  x.
       77 save-data        PIC  9(8).
       77 Calibri16B-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 ef-data-stampa-buf           PIC  99/99/9999.
       77 tipo-elenco      PIC  x(20).
       77 comando          PIC  x(200).
       77 ReturnCode
                  USAGE IS SIGNED-SHORT.
       77 singola-bmp      PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 como-x           PIC  x.
       77 r-numero         PIC  z(10).
       77 r-data           PIC  99/99/9999.
       77 r-importo        PIC  ---.---.--9,99.
       77 r-iva            PIC  ---.---.--9,99.
       77 r-totale         PIC  ---.---.--9,99.
       01 FILLER           PIC  9.
           88 VediFattura VALUE IS 1    WHEN SET TO FALSE  0. 
       01 FILLER           PIC  9.
           88 prima-volta VALUE IS 1    WHEN SET TO FALSE  0. 
       77 AUTO-ID          PIC  9(6).
       77 cmd-lancio       PIC  x(200).
       77 tot-importo      PIC  s9(9)v99.
       77 tot-iva          PIC  s9(9)v99.
       77 tot-totale       PIC  s9(9)v99.
       77 tot-tot-importo  PIC  s9(9)v99.
       77 tot-tot-iva      PIC  s9(9)v99.
       77 tot-tot-totale   PIC  s9(9)v99.
       77 numero-al        PIC  9(6).
       77 numero-dal       PIC  9(6).
       77 data-dal         PIC  9(8).
       77 data-al          PIC  9(8).
       77 ef-anno-s-buf    PIC  9999.
       77 ef-numero-s-buf  PIC  z(6).
       77 ef-cliente-buf   PIC  x(6).
       77 lab-cliente-buf  PIC  X(50).
       77 ef-tipo-buf      PIC  x(6).
       77 lab-tipo-buf     PIC  x(50).
       77 ef-num-dal-buf   PIC  zzz.zz9.
       77 ef-num-al-buf    PIC  zzz.zz9.
       77 ef-data-dal-buf  PIC  99/99/9999.
       77 ef-data-al-buf   PIC  99/99/9999.
       77 CERCA-BMP        PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 vedi-doc-bmp     PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 FATCLI-BMP       PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 Calibri24BI-Occidentale
                  USAGE IS HANDLE OF FONT.
       01 FILLER           PIC  9.
           88 record-ok VALUE IS 1    WHEN SET TO FALSE  0. 
       77 STATUS-rcorrisp  PIC  X(2).
           88 Valid-STATUS-rcorrisp VALUE IS "00" THRU "09". 
       77 STATUS-rfatture  PIC  X(2).
           88 Valid-STATUS-rfatture VALUE IS "00" THRU "09". 
       77 STATUS-tcorrisp  PIC  X(2).
           88 Valid-STATUS-tcorrisp VALUE IS "00" THRU "09". 
       77 STATUS-tfatture  PIC  X(2).
           88 Valid-STATUS-tfatture VALUE IS "00" THRU "09". 
       77 STATUS-clienti   PIC  X(2).
           88 Valid-STATUS-clienti VALUE IS "00" THRU "09". 
       77 STATUS-tipocli   PIC  X(2).
           88 Valid-STATUS-tipocli VALUE IS "00" THRU "09". 
       77 form-elenco-Handle
                  USAGE IS HANDLE OF WINDOW.
       77 scr-elabora-Handle
                  USAGE IS HANDLE OF WINDOW.
       01 rec-grid.
           05 col-anno         PIC  9(4).
           05 col-num          PIC  9(6).
           05 col-data         PIC  99/99/9999.
           05 col-cliente      PIC  X(6).
           05 col-des          PIC  X(50).
           05 col-sub          PIC  zz.zzz.zz9,99.
           05 col-iva          PIC  zz.zzz.zz9,99.
           05 col-tot          PIC  zz.zzz.zz9,99.
       77 frame-titolo     PIC  x(50).
       78 separatore VALUE IS ";". 
       01 TipoElaborazione PIC  x.
           88 ElaboraDoc VALUE IS "D". 
           88 ElaboraExcel VALUE IS "E". 
           88 ElaboraEtichette VALUE IS "T". 
           88 ElaboraElenco VALUE IS "L". 
       77 esci-bmp         PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 STATUS-rnotacr   PIC  X(2).
           88 Valid-STATUS-rnotacr VALUE IS "00" THRU "09". 
       77 STATUS-tnotacr   PIC  X(2).
           88 Valid-STATUS-tnotacr VALUE IS "00" THRU "09". 
       77 STATUS-tschede   PIC  X(2).
           88 Valid-STATUS-tschede VALUE IS "00" THRU "09". 
       77 e-singolo        PIC  9
                  VALUE IS 1.
       77 STATUS-rschede   PIC  X(2).
           88 Valid-STATUS-rschede VALUE IS "00" THRU "09". 
       77 EXCEL-BMP        PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 toEXCEL-BMP      PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 path-tmp-docum   PIC  X(256).
       77 STATUS-tmp-docum PIC  X(2).
           88 Valid-STATUS-tmp-docum VALUE IS "00" THRU "09". 
       77 wstampa          PIC  X(256).
       77 STATUS-lineseq   PIC  X(2).
           88 Valid-STATUS-lineseq VALUE IS "00" THRU "09". 
       77 vedi-eti-bmp     PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 ef-anno-e-buf    PIC  9999.
       77 vedi-ele-bmp     PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 ef-anno-ele-buf  PIC  9999.
       77 rb-tipo          PIC  S9(1)
                  VALUE IS 1.
       77 ele-730-U-bmp    PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 ele-U-bmp        PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 ele-730-bmp      PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.

      ***********************************************************
      *   Code Gen's Buffer                                     *
      ***********************************************************
       77 STATUS-Form1-FLAG-REFRESH PIC  9.
          88 Form1-FLAG-REFRESH  VALUE 1 FALSE 0. 
       77 STATUS-form-elenco-FLAG-REFRESH PIC  9.
          88 form-elenco-FLAG-REFRESH  VALUE 1 FALSE 0. 
       77 STATUS-scr-elabora-FLAG-REFRESH PIC  9.
          88 scr-elabora-FLAG-REFRESH  VALUE 1 FALSE 0. 
       77 TMP-DataSet1-tfatture-BUF     PIC X(922).
       77 TMP-DataSet1-tcorrisp-BUF     PIC X(922).
       77 TMP-DataSet1-rfatture-BUF     PIC X(643).
       77 TMP-DataSet1-rcorrisp-BUF     PIC X(640).
       77 TMP-DataSet1-clienti-BUF     PIC X(2204).
       77 TMP-DataSet1-tipocli-BUF     PIC X(615).
       77 TMP-DataSet1-rnotacr-BUF     PIC X(643).
       77 TMP-DataSet1-tnotacr-BUF     PIC X(942).
       77 TMP-DataSet1-tschede-BUF     PIC X(574).
       77 TMP-DataSet1-rschede-BUF     PIC X(848).
       77 TMP-DataSet1-tmp-docum-BUF     PIC X(104).
       77 TMP-DataSet1-lineseq-BUF     PIC X(900).
      * VARIABLES FOR RECORD LENGTH.
       77  TotemFdSlRecordClearOffset   PIC 9(5) COMP-4.
       77  TotemFdSlRecordLength        PIC 9(5) COMP-4.
      * FILE'S LOCK MODE FLAG
       77 DataSet1-tfatture-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tfatture-LOCK  VALUE "Y".
       77 DataSet1-tfatture-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tfatture-KEY-Asc  VALUE "A".
          88 DataSet1-tfatture-KEY-Desc VALUE "D".
       77 DataSet1-tcorrisp-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tcorrisp-LOCK  VALUE "Y".
       77 DataSet1-tcorrisp-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tcorrisp-KEY-Asc  VALUE "A".
          88 DataSet1-tcorrisp-KEY-Desc VALUE "D".
       77 DataSet1-rfatture-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-rfatture-LOCK  VALUE "Y".
       77 DataSet1-rfatture-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-rfatture-KEY-Asc  VALUE "A".
          88 DataSet1-rfatture-KEY-Desc VALUE "D".
       77 DataSet1-rcorrisp-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-rcorrisp-LOCK  VALUE "Y".
       77 DataSet1-KEYIS   PIC 9(3) VALUE 1.
       77 DataSet1-rcorrisp-KEY1-ORDER  PIC X VALUE "A".
          88 DataSet1-rcorrisp-KEY1-Asc  VALUE "A".
          88 DataSet1-rcorrisp-KEY1-Desc VALUE "D".
       77 DataSet1-clienti-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-clienti-LOCK  VALUE "Y".
       77 DataSet1-clienti-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-clienti-KEY-Asc  VALUE "A".
          88 DataSet1-clienti-KEY-Desc VALUE "D".
       77 DataSet1-tipocli-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tipocli-LOCK  VALUE "Y".
       77 DataSet1-tipocli-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tipocli-KEY-Asc  VALUE "A".
          88 DataSet1-tipocli-KEY-Desc VALUE "D".
       77 DataSet1-rnotacr-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-rnotacr-LOCK  VALUE "Y".
       77 DataSet1-rnotacr-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-rnotacr-KEY-Asc  VALUE "A".
          88 DataSet1-rnotacr-KEY-Desc VALUE "D".
       77 DataSet1-tnotacr-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tnotacr-LOCK  VALUE "Y".
       77 DataSet1-tnotacr-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tnotacr-KEY-Asc  VALUE "A".
          88 DataSet1-tnotacr-KEY-Desc VALUE "D".
       77 DataSet1-tschede-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tschede-LOCK  VALUE "Y".
       77 DataSet1-tschede-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tschede-KEY-Asc  VALUE "A".
          88 DataSet1-tschede-KEY-Desc VALUE "D".
       77 DataSet1-rschede-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-rschede-LOCK  VALUE "Y".
       77 DataSet1-rschede-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-rschede-KEY-Asc  VALUE "A".
          88 DataSet1-rschede-KEY-Desc VALUE "D".
       77 DataSet1-tmp-docum-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tmp-docum-LOCK  VALUE "Y".
       77 DataSet1-tmp-docum-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tmp-docum-KEY-Asc  VALUE "A".
          88 DataSet1-tmp-docum-KEY-Desc VALUE "D".
       77 DataSet1-lineseq-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-lineseq-LOCK  VALUE "Y".
       77 DataSet1-lineseq-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-lineseq-KEY-Asc  VALUE "A".
          88 DataSet1-lineseq-KEY-Desc VALUE "D".

       77 tfatture-tfa-k-data-SPLITBUF  PIC X(19).
       77 tfatture-tfa-k-cliente-SPLITBUF  PIC X(21).
       77 tcorrisp-tco-k-data-SPLITBUF  PIC X(19).
       77 tcorrisp-tco-k-cliente-SPLITBUF  PIC X(21).
       77 clienti-cli-k-ragsoc-SPLITBUF  PIC X(57).
       77 tipocli-tcl-k-descrizione-SPLITBUF  PIC X(57).
       77 tnotacr-tno-k-data-SPLITBUF  PIC X(19).
       77 tnotacr-tno-k-cliente-SPLITBUF  PIC X(21).
       77 tnotacr-tno-k-fattura-SPLITBUF  PIC X(21).
       77 tnotacr-tno-k-corrisp-SPLITBUF  PIC X(21).
       77 tschede-tsc-k-data-SPLITBUF  PIC X(15).
       77 tschede-tsc-k-cliente-SPLITBUF  PIC X(7).
       77 rschede-rsc-k-art-SPLITBUF  PIC X(21).
       77 rschede-rsc-k-cli-SPLITBUF  PIC X(21).
       77 rschede-rsc-k-fatart-SPLITBUF  PIC X(21).
       77 rschede-rsc-k-fatcli-SPLITBUF  PIC X(21).
       77 rschede-rsc-k-corart-SPLITBUF  PIC X(21).
       77 rschede-rsc-k-corcli-SPLITBUF  PIC X(21).

      *{TOTEM}END

      *{TOTEM}ID-LOGICI
      ***** Elenco ID Logici *****
       78  78-ID-ef-anno-s VALUE 5001.
       78  78-ID-ef-numero-s VALUE 5002.
       78  78-ID-ef-cliente VALUE 5003.
       78  78-ID-ef-tipo VALUE 5004.
       78  78-ID-ef-num-dal VALUE 5005.
       78  78-ID-ef-num-al VALUE 5006.
       78  78-ID-ef-data-dal VALUE 5007.
       78  78-ID-ef-data-al VALUE 5008.
       78  78-ID-ef-anno-e VALUE 5009.
       78  78-ID-ef-anno-ele VALUE 5010.
      ***** Fine ID Logici *****
      *{TOTEM}END

       LINKAGE          SECTION.
      *{TOTEM}LINKAGE
           COPY  "BLOCKPGM.LKS".
      *{TOTEM}END

       SCREEN           SECTION.
      *{TOTEM}COPY-SCREEN
      * FORM
       01 
           Form1, 
           .

      * BITMAP
       05
           Form1-Bt-1a, 
           Bitmap, 
           COL 78,90, 
           LINE 30,09,
           LINES 58,00 ,
           SIZE 48,00 ,
           BITMAP-HANDLE LOGO_PICCOLO-BMP,
           BITMAP-NUMBER 1,
           ID IS 123,
           .

      * LABEL
       05
           Screen1-Custom1-1, 
           Label, 
           COL 9,10, 
           LINE 1,39,
           LINES 0,57 ,
           SIZE 3,00 ,
           FONT IS Default-Font,
           ID IS 124,
           TRANSPARENT,
           TITLE "CUSTOM CONTROL",
           VISIBLE v-custom,
           .

      * LABEL
       05
           Screen1-blockpgm-1, 
           Label, 
           COL 3,40, 
           LINE 1,52,
           LINES 0,87 ,
           SIZE 1,40 ,
           ID IS 125,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "BlockPgm",
           VISIBLE v-custom,
           .

      * FRAME
       05
           Screen1-Fr-1, 
           Frame, 
           COL 3,10, 
           LINE 1,35,
           LINES 20,61 ,
           SIZE 78,50 ,
           COLOR IS 11,
           FONT IS Calibri14B-Occidentale,
           ID IS 126,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           HEAVY,
           TITLE "SELEZIONE DOCUMENTO",
           TITLE-POSITION 2,
           .

      * ENTRY FIELD
       05
           ef-anno-s, 
           Entry-Field, 
           COL 18,80, 
           LINE 10,87,
           LINES 1,30 ,
           SIZE 9,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED e-singolo,
           ID IS 78-ID-ef-anno-s,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 4,
           VALUE ef-anno-s-buf,
           AFTER PROCEDURE ef-anno-s-AfterProcedure, 
           BEFORE PROCEDURE ef-anno-s-BeforeProcedure, 
           .

      * ENTRY FIELD
       05
           ef-numero-s, 
           Entry-Field, 
           COL 44,00, 
           LINE 11,00,
           LINES 1,30 ,
           SIZE 11,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED e-singolo,
           ID IS 78-ID-ef-numero-s,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 6,
           VALUE ef-numero-s-buf,
           AFTER PROCEDURE ef-numero-s-AfterProcedure, 
           BEFORE PROCEDURE ef-numero-s-BeforeProcedure, 
           .

      * ENTRY FIELD
       05
           ef-cliente, 
           Entry-Field, 
           COL 18,80, 
           LINE 14,52,
           LINES 1,30 ,
           SIZE 9,00 ,
           BOXED,
           COLOR IS 513,
           ID IS 78-ID-ef-cliente,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 6,
           VALUE ef-cliente-buf,
           AFTER PROCEDURE ef-cliente-AfterProcedure, 
           BEFORE PROCEDURE ef-cliente-BeforeProcedure, 
           .

      * ENTRY FIELD
       05
           ef-tipo, 
           Entry-Field, 
           COL 18,80, 
           LINE 16,26,
           LINES 1,30 ,
           SIZE 9,00 ,
           BOXED,
           COLOR IS 513,
           ID IS 78-ID-ef-tipo,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 6,
           VALUE ef-tipo-buf,
           AFTER PROCEDURE ef-tipo-AfterProcedure, 
           BEFORE PROCEDURE ef-tipo-BeforeProcedure, 
           .

      * ENTRY FIELD
       05
           ef-num-dal, 
           Entry-Field, 
           COL 18,80, 
           LINE 18,44,
           LINES 1,30 ,
           SIZE 9,00 ,
           BOXED,
           COLOR IS 513,
           ID IS 78-ID-ef-num-dal,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 6,
           VALUE ef-num-dal-buf,
           AFTER PROCEDURE ef-num-dal-AfterProcedure, 
           BEFORE PROCEDURE ef-num-dal-BeforeProcedure, 
           .

      * ENTRY FIELD
       05
           ef-num-al, 
           Entry-Field, 
           COL 18,80, 
           LINE 20,18,
           LINES 1,30 ,
           SIZE 9,00 ,
           BOXED,
           COLOR IS 513,
           ID IS 78-ID-ef-num-al,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 6,
           VALUE ef-num-al-buf,
           AFTER PROCEDURE ef-num-al-AfterProcedure, 
           BEFORE PROCEDURE ef-num-al-BeforeProcedure, 
           .

      * ENTRY FIELD
       05
           ef-data-dal, 
           Entry-Field, 
           COL 44,00, 
           LINE 18,44,
           LINES 1,30 ,
           SIZE 11,00 ,
           BOXED,
           COLOR IS 513,
           ID IS 78-ID-ef-data-dal,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           MAX-TEXT 10,
           VALUE ef-data-dal-buf,
           AFTER PROCEDURE ef-data-dal-AfterProcedure, 
           BEFORE PROCEDURE ef-data-dal-BeforeProcedure, 
           .

      * ENTRY FIELD
       05
           ef-data-al, 
           Entry-Field, 
           COL 44,00, 
           LINE 20,18,
           LINES 1,30 ,
           SIZE 11,00 ,
           BOXED,
           COLOR IS 513,
           ID IS 78-ID-ef-data-al,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           MAX-TEXT 10,
           VALUE ef-data-al-buf,
           AFTER PROCEDURE ef-data-al-AfterProcedure, 
           BEFORE PROCEDURE ef-data-al-BeforeProcedure, 
           .

      * RADIO BUTTON
       05
           rb-fatture, 
           Radio-Button, 
           COL 5,30, 
           LINE 2,65,
           LINES 128,00 ,
           SIZE 128,00 ,
           BITMAP-HANDLE STRIP-DOCUM-BMP,
           BITMAP-NUMBER 6,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 1000
           GROUP 1,
           GROUP-VALUE 1,
           ID IS 127,
           NO-TAB,
           SELF-ACT,
           VALUE tipo-doc,
           AFTER PROCEDURE Screen1-Rb-1-AfterProcedure, 
           BEFORE PROCEDURE Screen1-Rb-1-BeforeProcedure, 
           .
      * RADIO BUTTON
       05
           rb-corrisp, 
           Radio-Button, 
           COL 20,30, 
           LINE 2,74,
           LINES 128,00 ,
           SIZE 128,00 ,
           BITMAP-HANDLE STRIP-DOCUM-BMP,
           BITMAP-NUMBER 1,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 1001
           GROUP 1,
           GROUP-VALUE 2,
           ID IS 128,
           NO-TAB,
           SELF-ACT,
           VALUE tipo-doc,
           AFTER PROCEDURE Screen1-Rb-1-AfterProcedure, 
           BEFORE PROCEDURE Screen1-Rb-1-BeforeProcedure, 
           .
      * RADIO BUTTON
       05
           rb-note, 
           Radio-Button, 
           COL 35,30, 
           LINE 2,78,
           LINES 128,00 ,
           SIZE 128,00 ,
           BITMAP-HANDLE STRIP-DOCUM-BMP,
           BITMAP-NUMBER 7,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 1002
           GROUP 1,
           GROUP-VALUE 3,
           ID IS 129,
           NO-TAB,
           SELF-ACT,
           VALUE tipo-doc,
           AFTER PROCEDURE Screen1-Rb-1-AfterProcedure, 
           BEFORE PROCEDURE Screen1-Rb-1-BeforeProcedure, 
           .
      * RADIO BUTTON
       05
           rb-schede, 
           Radio-Button, 
           COL 50,50, 
           LINE 2,74,
           LINES 128,00 ,
           SIZE 128,00 ,
           BITMAP-HANDLE STRIP-DOCUM-BMP,
           BITMAP-NUMBER 3,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 1003
           GROUP 1,
           GROUP-VALUE 4,
           ID IS 130,
           NO-TAB,
           SELF-ACT,
           VALUE tipo-doc,
           AFTER PROCEDURE Screen1-Rb-1-AfterProcedure, 
           BEFORE PROCEDURE Screen1-Rb-1-BeforeProcedure, 
           .
      * RADIO BUTTON
       05
           rb-tutti, 
           Radio-Button, 
           COL 65,30, 
           LINE 2,70,
           LINES 128,00 ,
           SIZE 128,00 ,
           BITMAP-HANDLE STRIP-DOCUM-BMP,
           BITMAP-NUMBER 9,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 1003
           GROUP 1,
           GROUP-VALUE 5,
           ID IS 131,
           NO-TAB,
           SELF-ACT,
           VALUE tipo-doc,
           AFTER PROCEDURE Screen1-Rb-1-AfterProcedure, 
           BEFORE PROCEDURE Screen1-Rb-1-BeforeProcedure, 
           .
      * LABEL
       05
           lab-clientebaa, 
           Label, 
           COL 8,80, 
           LINE 10,87,
           LINES 1,30 ,
           SIZE 8,00 ,
           COLOR IS 9,
           FONT IS Calibri16B-Occidentale,
           ID IS 5,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Anno",
           .

      * LABEL
       05
           form-stamp-La-1, 
           Label, 
           COL 7,80, 
           LINE 9,13,
           LINES 1,30 ,
           SIZE 26,00 ,
           COLOR IS 11,
           FONT IS Calibri14B-Occidentale,
           ID IS 11,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "SINGOLO DOCUMENTO FISCALE",
           .

      * BAR
       05
           form-stamp-Br-1, 
           Bar,
           COL 34,30, 
           LINE 9,78,
           SIZE 41,30 ,
           COLOR IS 11,
           ID IS 12,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           WIDTH 2,
           .

      * LABEL
       05
           lab-clientebaaa, 
           Label, 
           COL 32,80, 
           LINE 10,96,
           LINES 1,30 ,
           SIZE 9,00 ,
           COLOR IS 9,
           FONT IS Calibri16B-Occidentale,
           ID IS 13,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Numero",
           .

      * LABEL
       05
           form-stamp-La-1a, 
           Label, 
           COL 7,80, 
           LINE 12,83,
           LINES 1,30 ,
           SIZE 14,00 ,
           COLOR IS 11,
           FONT IS Calibri14B-Occidentale,
           ID IS 15,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "PIU' DOCUMENTI",
           .

      * BAR
       05
           form-stamp-Br-1a, 
           Bar,
           COL 22,60, 
           LINE 13,48,
           SIZE 53,00 ,
           COLOR IS 11,
           ID IS 16,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           WIDTH 2,
           .

      * PUSH BUTTON
       05
           pb-singola, 
           Push-Button, 
           COL 62,00, 
           LINE 10,39,
           LINES 50,00 ,
           SIZE 128,00 ,
           BITMAP-HANDLE SINGOLA-BMP,
           BITMAP-NUMBER 1,
           FRAMED,
           SQUARE,
           ENABLED e-singolo,
           EXCEPTION-VALUE 13,
           ID IS 1,
           NO-TAB,
           SELF-ACT,
           .

      * LABEL
       05
           lab-clientebaab, 
           Label, 
           COL 8,80, 
           LINE 14,48,
           LINES 1,30 ,
           SIZE 8,00 ,
           COLOR IS 9,
           FONT IS Calibri16B-Occidentale,
           ID IS 2,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Cliente",
           .

      * LABEL
       05
           lab-clientebaac, 
           Label, 
           COL 8,80, 
           LINE 16,22,
           LINES 1,30 ,
           SIZE 8,00 ,
           COLOR IS 9,
           FONT IS Calibri16B-Occidentale,
           ID IS 4,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Tipologia",
           .

      * LABEL
       05
           lab-cliente, 
           Label, 
           COL 32,80, 
           LINE 14,52,
           LINES 1,30 ,
           SIZE 44,00 ,
           COLOR IS 11,
           FONT IS Calibri16B-Occidentale,
           ID IS 7,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-cliente-buf,
           .

      * LABEL
       05
           lab-tipo, 
           Label, 
           COL 32,80, 
           LINE 16,26,
           LINES 1,30 ,
           SIZE 44,00 ,
           COLOR IS 11,
           FONT IS Calibri16B-Occidentale,
           ID IS 9,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-tipo-buf,
           .

      * LABEL
       05
           lab-clientebaadaa, 
           Label, 
           COL 8,80, 
           LINE 18,44,
           LINES 1,30 ,
           SIZE 9,00 ,
           COLOR IS 9,
           FONT IS Calibri16B-Occidentale,
           ID IS 20,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Dal num.",
           .

      * LABEL
       05
           lab-clientebaadaaa, 
           Label, 
           COL 8,80, 
           LINE 20,18,
           LINES 1,30 ,
           SIZE 9,00 ,
           COLOR IS 9,
           FONT IS Calibri16B-Occidentale,
           ID IS 21,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Al num.",
           .

      * LABEL
       05
           lab-clientebaadaab, 
           Label, 
           COL 32,80, 
           LINE 18,44,
           LINES 1,30 ,
           SIZE 9,00 ,
           COLOR IS 9,
           FONT IS Calibri16B-Occidentale,
           ID IS 22,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Dalla data",
           .

      * LABEL
       05
           lab-clientebaadaaaa, 
           Label, 
           COL 32,80, 
           LINE 20,18,
           LINES 1,30 ,
           SIZE 9,00 ,
           COLOR IS 9,
           FONT IS Calibri16B-Occidentale,
           ID IS 23,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Alla data",
           .

      * PUSH BUTTON
       05
           pb-cerca-cli, 
           Push-Button, 
           COL 27,80, 
           LINE 14,52,
           LINES 24,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE CERCA-BMP,
           BITMAP-NUMBER 1,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 224,
           ID IS 26,
           NO-TAB,
           SELF-ACT,
           .

      * PUSH BUTTON
       05
           pb-cerca-tipo, 
           Push-Button, 
           COL 27,80, 
           LINE 16,26,
           LINES 24,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE CERCA-BMP,
           BITMAP-NUMBER 1,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 2687,
           ID IS 27,
           NO-TAB,
           SELF-ACT,
           .

      * PUSH BUTTON
       05
           pb-vedi, 
           Push-Button, 
           COL 62,00, 
           LINE 19,00,
           LINES 50,00 ,
           SIZE 128,00 ,
           BITMAP-HANDLE VEDI-DOC-BMP,
           BITMAP-NUMBER 1,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 67,
           ID IS 28,
           NO-TAB,
           SELF-ACT,
           .

      * PUSH BUTTON
       05
           Screen1-Pb-1, 
           Push-Button, 
           COL 37,40, 
           LINE 30,04,
           LINES 48,00 ,
           SIZE 90,00 ,
           BITMAP-HANDLE ESCI-BMP,
           BITMAP-NUMBER 1,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 27,
           ID IS 10,
           SELF-ACT,
           ESCAPE-BUTTON,
           .

      * FRAME
       05
           Screen1-Fr-1a, 
           Frame, 
           COL 3,10, 
           LINE 22,22,
           LINES 3,61 ,
           SIZE 78,50 ,
           COLOR IS 11,
           FONT IS Calibri14B-Occidentale,
           ID IS 17,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           HEAVY,
           TITLE "STAMPA ETICHETTE CLIENTI",
           TITLE-POSITION 2,
           .

      * ENTRY FIELD
       05
           ef-anno-e, 
           Entry-Field, 
           COL 18,80, 
           LINE 23,61,
           LINES 1,30 ,
           SIZE 9,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED e-singolo,
           ID IS 78-ID-ef-anno-e,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 4,
           VALUE ef-anno-e-buf,
           AFTER PROCEDURE ef-anno-e-AfterProcedure, 
           BEFORE PROCEDURE ef-anno-e-BeforeProcedure, 
           .

      * LABEL
       05
           lab-clientebaad, 
           Label, 
           COL 8,80, 
           LINE 23,61,
           LINES 1,30 ,
           SIZE 8,00 ,
           COLOR IS 9,
           FONT IS Calibri16B-Occidentale,
           ID IS 30,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Anno",
           .

      * PUSH BUTTON
       05
           pb-etichetta, 
           Push-Button, 
           COL 62,00, 
           LINE 23,00,
           LINES 50,00 ,
           SIZE 128,00 ,
           BITMAP-HANDLE VEDI-ETI-BMP,
           BITMAP-NUMBER 1,
           FRAMED,
           SQUARE,
           ENABLED e-singolo,
           EXCEPTION-VALUE 1004,
           ID IS 31,
           NO-TAB,
           SELF-ACT,
           .

      * FRAME
       05
           Screen1-Fr-1aa, 
           Frame, 
           COL 3,10, 
           LINE 25,78,
           LINES 3,96 ,
           SIZE 78,50 ,
           COLOR IS 11,
           FONT IS Calibri14B-Occidentale,
           ID IS 32,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           HEAVY,
           TITLE-POSITION 2,
           .

      * ENTRY FIELD
       05
           ef-anno-ele, 
           Entry-Field, 
           COL 18,80, 
           LINE 27,39,
           LINES 1,30 ,
           SIZE 9,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED e-singolo,
           ID IS 78-ID-ef-anno-ele,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 4,
           VALUE ef-anno-ele-buf,
           AFTER PROCEDURE ef-anno-ele-AfterProcedure, 
           BEFORE PROCEDURE ef-anno-ele-BeforeProcedure, 
           .

      * PUSH BUTTON
       05
           pb-ele-730, 
           Push-Button, 
           COL 29,80, 
           LINE 26,78,
           LINES 50,00 ,
           SIZE 128,00 ,
           BITMAP-HANDLE ELE-730-BMP,
           BITMAP-NUMBER 1,
           FRAMED,
           SQUARE,
           ENABLED e-singolo,
           EXCEPTION-VALUE 1006,
           ID IS 35,
           NO-TAB,
           SELF-ACT,
           .

      * PUSH BUTTON
       05
           pb-ele-U, 
           Push-Button, 
           COL 45,80, 
           LINE 26,78,
           LINES 50,00 ,
           SIZE 128,00 ,
           BITMAP-HANDLE ELE-U-BMP,
           BITMAP-NUMBER 1,
           FRAMED,
           SQUARE,
           ENABLED e-singolo,
           EXCEPTION-VALUE 1007,
           ID IS 35,
           NO-TAB,
           SELF-ACT,
           .

      * PUSH BUTTON
       05
           pb-ele-730-U, 
           Push-Button, 
           COL 62,00, 
           LINE 26,78,
           LINES 50,00 ,
           SIZE 128,00 ,
           BITMAP-HANDLE ELE-730-U-BMP,
           BITMAP-NUMBER 1,
           FRAMED,
           SQUARE,
           ENABLED e-singolo,
           EXCEPTION-VALUE 1005,
           ID IS 35,
           NO-TAB,
           SELF-ACT,
           .

      * LABEL
       05
           lab-clientebaada, 
           Label, 
           COL 8,80, 
           LINE 27,39,
           LINES 1,30 ,
           SIZE 8,00 ,
           COLOR IS 9,
           FONT IS Calibri16B-Occidentale,
           ID IS 34,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Anno",
           .

      * FORM
       01 
           form-elenco, 
           .

      * GRID
       05
           gd-elenco, 
           Grid, 
           COL 2,90, 
           LINE 6,65,
           LINES 21,83 ,
           SIZE 103,00 ,
           BOXED,
           DATA-COLUMNS (1, 5, 11, 21, 27, 77, 90, 103),
           ALIGNMENT ("R", "R", "C", "C", "U", "R", "R", "R"),
           SEPARATION (5, 5, 5, 5, 5, 5, 5, 5),
           NUM-COL-HEADINGS 1,
           COLUMN-HEADINGS,
           CURSOR-FRAME-WIDTH 0,
           DIVIDER-COLOR 1,
           HEADING-COLOR 257,
           HEADING-DIVIDER-COLOR 1,
           ID IS 1,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RECORD-DATA rec-grid,
           TILED-HEADINGS,
           VIRTUAL-WIDTH 101,
           VPADDING 5,
           VSCROLL,
           EVENT PROCEDURE form-elenc-Gd-1-Event-Proc,
           .

      * FRAME
       05
           form-elenc-Fr-1, 
           Frame, 
           COL 1,10, 
           LINE 28,39,
           LINES 3,00 ,
           SIZE 106,70 ,
           COLOR IS 9,
           ID IS 3,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           HEAVY,
           .

      * LABEL
       05
           form-elenc-La-2, 
           Label, 
           COL 24,40, 
           LINE 29,52,
           LINES 1,22 ,
           SIZE 60,00 ,
           COLOR IS 9,
           FONT IS Calibri16B-Occidentale,
           ID IS 4,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE "Doppio click o invio per modificare il documento selez
      -    "ionato",
           .

      * BITMAP
       05
           Form1-Bt-1aa, 
           Bitmap, 
           COL 102,80, 
           LINE 28,91,
           LINES 54,00 ,
           SIZE 48,00 ,
           BITMAP-HANDLE LOGO_PICCOLO-BMP,
           BITMAP-NUMBER 1,
           ID IS 123,
           .

      * PUSH BUTTON
       05
           Screen1-Pb-1a, 
           Push-Button, 
           COL 1,30, 
           LINE 28,91,
           LINES 48,00 ,
           SIZE 90,00 ,
           BITMAP-HANDLE ESCI-BMP,
           BITMAP-NUMBER 1,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 27,
           ID IS 10,
           SELF-ACT,
           ESCAPE-BUTTON,
           .

      * PUSH BUTTON
       05
           pb-excel, 
           Push-Button, 
           COL 11,10, 
           LINE 28,91,
           LINES 48,00 ,
           SIZE 90,00 ,
           BITMAP-HANDLE TOEXCEL-BMP,
           BITMAP-NUMBER 1,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 3,
           ID IS 11,
           SELF-ACT,
           TITLE "Porta in &Excel",
           .

      * FRAME
       05
           frame-documenti, 
           Frame, 
           COL 2,90, 
           LINE 1,13,
           LINES 5,17 ,
           SIZE 103,00 ,
           COLOR IS 11,
           FONT IS Calibri16B-Occidentale,
           ID IS 2,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           HEAVY,
           TITLE frame-titolo,
           TITLE-POSITION 2,
           .

      * LABEL
       05
           lab-clientea, 
           Label, 
           COL 9,90, 
           LINE 2,52,
           LINES 1,30 ,
           SIZE 44,00 ,
           COLOR IS 11,
           FONT IS Calibri16B-Occidentale,
           ID IS 7,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-cliente-buf,
           .

      * LABEL
       05
           lab-tipoa, 
           Label, 
           COL 54,90, 
           LINE 2,52,
           LINES 1,30 ,
           SIZE 44,00 ,
           COLOR IS 11,
           FONT IS Calibri16B-Occidentale,
           ID IS 9,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-tipo-buf,
           .

      * LABEL
       05
           form-elenc-La-1, 
           Label, 
           COL 9,90, 
           LINE 4,39,
           LINES 1,30 ,
           SIZE 12,00 ,
           COLOR IS 11,
           FONT IS Calibri16B-Occidentale,
           ID IS 12,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Numerazione",
           .

      * LABEL
       05
           form-elenc-La-1a, 
           Label, 
           COL 23,90, 
           LINE 4,39,
           LINES 1,30 ,
           SIZE 12,00 ,
           COLOR IS 11,
           FONT IS Calibri16B-Occidentale,
           ID IS 13,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           TRANSPARENT,
           TITLE ef-num-dal-buf,
           .

      * LABEL
       05
           form-elenc-La-1aa, 
           Label, 
           COL 36,90, 
           LINE 4,39,
           LINES 1,30 ,
           SIZE 2,00 ,
           COLOR IS 11,
           FONT IS Calibri16B-Occidentale,
           ID IS 14,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE "-",
           .

      * LABEL
       05
           form-elenc-La-1ab, 
           Label, 
           COL 39,90, 
           LINE 4,39,
           LINES 1,30 ,
           SIZE 12,00 ,
           COLOR IS 11,
           FONT IS Calibri16B-Occidentale,
           ID IS 15,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           LEFT,
           TRANSPARENT,
           TITLE ef-num-al-buf,
           .

      * LABEL
       05
           form-elenc-La-1aaa, 
           Label, 
           COL 81,90, 
           LINE 4,39,
           LINES 1,30 ,
           SIZE 2,00 ,
           COLOR IS 11,
           FONT IS Calibri16B-Occidentale,
           ID IS 16,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE "-",
           .

      * LABEL
       05
           form-elenc-La-1ac, 
           Label, 
           COL 68,90, 
           LINE 4,39,
           LINES 1,30 ,
           SIZE 12,00 ,
           COLOR IS 11,
           FONT IS Calibri16B-Occidentale,
           ID IS 17,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           TRANSPARENT,
           TITLE ef-data-dal-buf,
           .

      * LABEL
       05
           form-elenc-La-1aba, 
           Label, 
           COL 84,90, 
           LINE 4,39,
           LINES 1,30 ,
           SIZE 12,00 ,
           COLOR IS 11,
           FONT IS Calibri16B-Occidentale,
           ID IS 18,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           LEFT,
           TRANSPARENT,
           TITLE ef-data-al-buf,
           .

      * LABEL
       05
           form-elenc-La-1b, 
           Label, 
           COL 54,90, 
           LINE 4,39,
           LINES 1,30 ,
           SIZE 12,00 ,
           COLOR IS 11,
           FONT IS Calibri16B-Occidentale,
           ID IS 19,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Date",
           .

      * FORM
       01 
           scr-elabora, 
           .

      * LABEL
       05
           scr-elabor-La-1, 
           Label, 
           COL 4,80, 
           LINE 1,52,
           LINES 1,30 ,
           SIZE 31,40 ,
           FONT IS Calibri16B-Occidentale,
           ID IS 1,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE "Elaborazione in corso...",
           .

      *{TOTEM}END

      *{TOTEM}LINKPARA
       PROCEDURE  DIVISION USING LK-BLOCKPGM.
      *{TOTEM}END

      *{TOTEM}DECLARATIVE
       DECLARATIVES.
      * <TOTEM:EPT. INIT:docum, INIT:docum, BeforeDeclarative>
      * <TOTEM:END>
       INPUT-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON INPUT.
       0100-DECL.
           EXIT.
       I-O-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON I-O.
       0200-DECL.
           EXIT.
       OUTPUT-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON OUTPUT.
       0300-DECL.
           EXIT.
       TRANSACTION-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON TRANSACTION.
       0400-DECL.
           EXIT.
       END DECLARATIVES.
      *{TOTEM}END

       MAIN-LOGIC.
      *{TOTEM}ENTRY-BEFPRG
      *    Before-Program
           PERFORM docum-Ev-Before-Program
      *{TOTEM}END
           PERFORM INITIALIZE-ROUTINE.
      * run main screen
      *{TOTEM}RUN-MAINSCR
           PERFORM Form1-OPEN-ROUTINE.
      *{TOTEM}END

      *{TOTEM}COPY-PROCEDURE
       EXIT-STOP-ROUTINE.
           PERFORM CLOSE-FILE-RTN
      * <TOTEM:EPT. INIT:docum, INIT:docum, BeforeDestroyResource>
      * <TOTEM:END>
           DESTROY Calibri14B-Occidentale
           DESTROY Calibri16B-Occidentale
           DESTROY Calibri14-Occidentale
           CALL "w$bitmap" USING WBITMAP-DESTROY, LOGO_PICCOLO-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, STRIP-DOCUM-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, SINGOLA-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, CERCA-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, VEDI-DOC-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, ESCI-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, VEDI-ETI-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, ELE-730-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, ELE-U-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, ELE-730-U-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, TOEXCEL-BMP
      *    After-Program
           PERFORM docum-Ev-After-Program
           EXIT PROGRAM TOTEM-PgmStatus
           STOP RUN.

       INITIALIZE-ROUTINE.
      *    Before Init
      * initialize program status variable
           Initialize TOTEM-PgmStatus.
      * get system information
           ACCEPT SYSTEM-INFORMATION FROM SYSTEM-INFO.
      * get terminal information
           ACCEPT TERMINAL-ABILITIES FROM TERMINAL-INFO.
      * set font
           PERFORM INIT-FONT.
      * load bitmap
           PERFORM INIT-BMP.
      * load resource
           PERFORM INIT-RES.
      * create pop-up menu
           PERFORM INIT-POPUP.
      * open files
           PERFORM OPEN-FILE-RTN.
      *    After Init
           .
    
       INIT-FONT.
      * Calibri14B-Occidentale
           INITIALIZE WFONT-DATA Calibri14B-Occidentale
           MOVE 14 TO WFONT-SIZE
           MOVE "Calibri" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO TRUE
           SET WFONT-ITALIC TO FALSE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Calibri14B-Occidentale, WFONT-DATA
      * Calibri16B-Occidentale
           INITIALIZE WFONT-DATA Calibri16B-Occidentale
           MOVE 16 TO WFONT-SIZE
           MOVE "Calibri" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO TRUE
           SET WFONT-ITALIC TO FALSE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Calibri16B-Occidentale, WFONT-DATA
      * Calibri14-Occidentale
           INITIALIZE WFONT-DATA Calibri14-Occidentale
           MOVE 14 TO WFONT-SIZE
           MOVE "Calibri" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO FALSE
           SET WFONT-ITALIC TO FALSE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Calibri14-Occidentale, WFONT-DATA
           .

       INIT-BMP.
      * Form1-Bt-1a
           COPY RESOURCE "LOGO_PICCOLO.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "LOGO_PICCOLO.BMP", 
                   GIVING LOGO_PICCOLO-BMP.
      * rb-fatture
           COPY RESOURCE "STRIP-DOCUM.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "STRIP-DOCUM.BMP", 
                   GIVING STRIP-DOCUM-BMP.
      * pb-singola
           COPY RESOURCE "SINGOLA.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "SINGOLA.BMP", 
                   GIVING SINGOLA-BMP.
      * pb-cerca-cli
           COPY RESOURCE "CERCA.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "CERCA.BMP", 
                   GIVING CERCA-BMP.
      * pb-vedi
           COPY RESOURCE "VEDI-DOC.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "VEDI-DOC.BMP", 
                   GIVING VEDI-DOC-BMP.
      * Screen1-Pb-1
           COPY RESOURCE "ESCI.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "ESCI.BMP", 
                   GIVING ESCI-BMP.
      * pb-etichetta
           COPY RESOURCE "VEDI-ETI.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "VEDI-ETI.BMP", 
                   GIVING VEDI-ETI-BMP.
      * pb-ele-730
           COPY RESOURCE "ELE-730.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "ELE-730.BMP", 
                   GIVING ELE-730-BMP.
      * pb-ele-U
           COPY RESOURCE "ELE-U.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "ELE-U.BMP", 
                   GIVING ELE-U-BMP.
      * pb-ele-730-U
           COPY RESOURCE "ELE-730-U.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "ELE-730-U.BMP", 
                   GIVING ELE-730-U-BMP.
      * pb-excel
           COPY RESOURCE "TOEXCEL.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "TOEXCEL.BMP", 
                   GIVING TOEXCEL-BMP.
           .

       INIT-RES.
           .

       INIT-POPUP.
           .

       OPEN-FILE-RTN.
      *    Before Open
           PERFORM OPEN-tfatture
           PERFORM OPEN-tcorrisp
           PERFORM OPEN-rfatture
           PERFORM OPEN-rcorrisp
           PERFORM OPEN-clienti
           PERFORM OPEN-tipocli
           PERFORM OPEN-rnotacr
           PERFORM OPEN-tnotacr
           PERFORM OPEN-tschede
           PERFORM OPEN-rschede
      *    tmp-docum OPEN MODE IS FALSE
      *    PERFORM OPEN-tmp-docum
      *    lineseq OPEN MODE IS FALSE
      *    PERFORM OPEN-lineseq
      *    After Open
           .

       OPEN-tfatture.
      * <TOTEM:EPT. INIT:docum, FD:tfatture, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tfatture
           IF NOT Valid-STATUS-tfatture
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:docum, FD:tfatture, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tcorrisp.
      * <TOTEM:EPT. INIT:docum, FD:tcorrisp, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tcorrisp
           IF NOT Valid-STATUS-tcorrisp
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:docum, FD:tcorrisp, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-rfatture.
      * <TOTEM:EPT. INIT:docum, FD:rfatture, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT rfatture
           IF NOT Valid-STATUS-rfatture
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:docum, FD:rfatture, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-rcorrisp.
      * <TOTEM:EPT. INIT:docum, FD:rcorrisp, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT rcorrisp
           IF NOT Valid-STATUS-rcorrisp
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:docum, FD:rcorrisp, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-clienti.
      * <TOTEM:EPT. INIT:docum, FD:clienti, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT clienti
           IF NOT Valid-STATUS-clienti
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:docum, FD:clienti, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tipocli.
      * <TOTEM:EPT. INIT:docum, FD:tipocli, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tipocli
           IF NOT Valid-STATUS-tipocli
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:docum, FD:tipocli, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-rnotacr.
      * <TOTEM:EPT. INIT:docum, FD:rnotacr, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT rnotacr
           IF NOT Valid-STATUS-rnotacr
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:docum, FD:rnotacr, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tnotacr.
      * <TOTEM:EPT. INIT:docum, FD:tnotacr, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tnotacr
           IF NOT Valid-STATUS-tnotacr
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:docum, FD:tnotacr, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tschede.
      * <TOTEM:EPT. INIT:docum, FD:tschede, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tschede
           IF NOT Valid-STATUS-tschede
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:docum, FD:tschede, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-rschede.
      * <TOTEM:EPT. INIT:docum, FD:rschede, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT rschede
           IF NOT Valid-STATUS-rschede
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:docum, FD:rschede, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tmp-docum.
      * <TOTEM:EPT. INIT:docum, FD:tmp-docum, BeforeOpen>
      * <TOTEM:END>
           OPEN  OUTPUT tmp-docum
           IF NOT Valid-STATUS-tmp-docum
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:docum, FD:tmp-docum, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-lineseq.
      * <TOTEM:EPT. INIT:docum, FD:lineseq, BeforeOpen>
      * <TOTEM:END>
           OPEN  OUTPUT lineseq
           IF NOT Valid-STATUS-lineseq
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:docum, FD:lineseq, AfterOpen>
      * <TOTEM:END>
           .

       CLOSE-FILE-RTN.
      *    Before Close
           PERFORM CLOSE-tfatture
           PERFORM CLOSE-tcorrisp
           PERFORM CLOSE-rfatture
           PERFORM CLOSE-rcorrisp
           PERFORM CLOSE-clienti
           PERFORM CLOSE-tipocli
           PERFORM CLOSE-rnotacr
           PERFORM CLOSE-tnotacr
           PERFORM CLOSE-tschede
           PERFORM CLOSE-rschede
      *    tmp-docum CLOSE MODE IS FALSE
      *    PERFORM CLOSE-tmp-docum
      *    lineseq CLOSE MODE IS FALSE
      *    PERFORM CLOSE-lineseq
      *    After Close
           .

       CLOSE-tfatture.
      * <TOTEM:EPT. INIT:docum, FD:tfatture, BeforeClose>
      * <TOTEM:END>
           CLOSE tfatture
           .

       CLOSE-tcorrisp.
      * <TOTEM:EPT. INIT:docum, FD:tcorrisp, BeforeClose>
      * <TOTEM:END>
           CLOSE tcorrisp
           .

       CLOSE-rfatture.
      * <TOTEM:EPT. INIT:docum, FD:rfatture, BeforeClose>
      * <TOTEM:END>
           CLOSE rfatture
           .

       CLOSE-rcorrisp.
      * <TOTEM:EPT. INIT:docum, FD:rcorrisp, BeforeClose>
      * <TOTEM:END>
           CLOSE rcorrisp
           .

       CLOSE-clienti.
      * <TOTEM:EPT. INIT:docum, FD:clienti, BeforeClose>
      * <TOTEM:END>
           CLOSE clienti
           .

       CLOSE-tipocli.
      * <TOTEM:EPT. INIT:docum, FD:tipocli, BeforeClose>
      * <TOTEM:END>
           CLOSE tipocli
           .

       CLOSE-rnotacr.
      * <TOTEM:EPT. INIT:docum, FD:rnotacr, BeforeClose>
      * <TOTEM:END>
           CLOSE rnotacr
           .

       CLOSE-tnotacr.
      * <TOTEM:EPT. INIT:docum, FD:tnotacr, BeforeClose>
      * <TOTEM:END>
           CLOSE tnotacr
           .

       CLOSE-tschede.
      * <TOTEM:EPT. INIT:docum, FD:tschede, BeforeClose>
      * <TOTEM:END>
           CLOSE tschede
           .

       CLOSE-rschede.
      * <TOTEM:EPT. INIT:docum, FD:rschede, BeforeClose>
      * <TOTEM:END>
           CLOSE rschede
           .

       CLOSE-tmp-docum.
      * <TOTEM:EPT. INIT:docum, FD:tmp-docum, BeforeClose>
      * <TOTEM:END>
           .

       CLOSE-lineseq.
      * <TOTEM:EPT. INIT:docum, FD:lineseq, BeforeClose>
      * <TOTEM:END>
           .

       tfatture-tfa-k-data-MERGE-SPLITBUF.
           INITIALIZE tfatture-tfa-k-data-SPLITBUF
           MOVE tfa-data-doc(1:8) TO tfatture-tfa-k-data-SPLITBUF(1:8)
           MOVE tfa-chiave(1:10) TO tfatture-tfa-k-data-SPLITBUF(9:10)
           .

       tfatture-tfa-k-cliente-MERGE-SPLITBUF.
           INITIALIZE tfatture-tfa-k-cliente-SPLITBUF
           MOVE tfa-cliente(1:6) TO tfatture-tfa-k-cliente-SPLITBUF(1:6)
           MOVE tfa-data-doc(1:8) TO 
           tfatture-tfa-k-cliente-SPLITBUF(7:8)
           MOVE tfa-numero(1:6) TO tfatture-tfa-k-cliente-SPLITBUF(15:6)
           .

       DataSet1-tfatture-INITSTART.
           IF DataSet1-tfatture-KEY-Asc
              MOVE Low-Value TO tfa-chiave
           ELSE
              MOVE High-Value TO tfa-chiave
           END-IF
           .

       DataSet1-tfatture-INITEND.
           IF DataSet1-tfatture-KEY-Asc
              MOVE High-Value TO tfa-chiave
           ELSE
              MOVE Low-Value TO tfa-chiave
           END-IF
           .

      * tfatture
       DataSet1-tfatture-START.
           IF DataSet1-tfatture-KEY-Asc
              START tfatture KEY >= tfa-chiave
           ELSE
              START tfatture KEY <= tfa-chiave
           END-IF
           .

       DataSet1-tfatture-START-NOTGREATER.
           IF DataSet1-tfatture-KEY-Asc
              START tfatture KEY <= tfa-chiave
           ELSE
              START tfatture KEY >= tfa-chiave
           END-IF
           .

       DataSet1-tfatture-START-GREATER.
           IF DataSet1-tfatture-KEY-Asc
              START tfatture KEY > tfa-chiave
           ELSE
              START tfatture KEY < tfa-chiave
           END-IF
           .

       DataSet1-tfatture-START-LESS.
           IF DataSet1-tfatture-KEY-Asc
              START tfatture KEY < tfa-chiave
           ELSE
              START tfatture KEY > tfa-chiave
           END-IF
           .

       DataSet1-tfatture-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tfatture, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tfatture, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tfatture-LOCK
              READ tfatture WITH LOCK 
              KEY tfa-chiave
           ELSE
              READ tfatture WITH NO LOCK 
              KEY tfa-chiave
           END-IF
           PERFORM tfatture-tfa-k-data-MERGE-SPLITBUF
           PERFORM tfatture-tfa-k-cliente-MERGE-SPLITBUF
           MOVE STATUS-tfatture TO TOTEM-ERR-STAT 
           MOVE "tfatture" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tfatture, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tfatture, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tfatture-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tfatture, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tfatture, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tfatture-KEY-Asc
              IF DataSet1-tfatture-LOCK
                 READ tfatture NEXT WITH LOCK
              ELSE
                 READ tfatture NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tfatture-LOCK
                 READ tfatture PREVIOUS WITH LOCK
              ELSE
                 READ tfatture PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM tfatture-tfa-k-data-MERGE-SPLITBUF
           PERFORM tfatture-tfa-k-cliente-MERGE-SPLITBUF
           MOVE STATUS-tfatture TO TOTEM-ERR-STAT
           MOVE "tfatture" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tfatture, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tfatture, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tfatture-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tfatture, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tfatture, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tfatture-KEY-Asc
              IF DataSet1-tfatture-LOCK
                 READ tfatture PREVIOUS WITH LOCK
              ELSE
                 READ tfatture PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tfatture-LOCK
                 READ tfatture NEXT WITH LOCK
              ELSE
                 READ tfatture NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM tfatture-tfa-k-data-MERGE-SPLITBUF
           PERFORM tfatture-tfa-k-cliente-MERGE-SPLITBUF
           MOVE STATUS-tfatture TO TOTEM-ERR-STAT
           MOVE "tfatture" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tfatture, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tfatture, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tfatture-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tfatture, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tfatture TO TOTEM-ERR-STAT
           MOVE "tfatture" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tfatture, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tfatture-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tfatture, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tfatture TO TOTEM-ERR-STAT
           MOVE "tfatture" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tfatture, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tfatture-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tfatture, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tfatture TO TOTEM-ERR-STAT
           MOVE "tfatture" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tfatture, AfterDelete>
      * <TOTEM:END>
           .

       tcorrisp-tco-k-data-MERGE-SPLITBUF.
           INITIALIZE tcorrisp-tco-k-data-SPLITBUF
           MOVE tco-data-doc(1:8) TO tcorrisp-tco-k-data-SPLITBUF(1:8)
           MOVE tco-chiave(1:10) TO tcorrisp-tco-k-data-SPLITBUF(9:10)
           .

       tcorrisp-tco-k-cliente-MERGE-SPLITBUF.
           INITIALIZE tcorrisp-tco-k-cliente-SPLITBUF
           MOVE tco-cliente(1:6) TO tcorrisp-tco-k-cliente-SPLITBUF(1:6)
           MOVE tco-data-doc(1:8) TO 
           tcorrisp-tco-k-cliente-SPLITBUF(7:8)
           MOVE tco-numero(1:6) TO tcorrisp-tco-k-cliente-SPLITBUF(15:6)
           .

       DataSet1-tcorrisp-INITSTART.
           IF DataSet1-tcorrisp-KEY-Asc
              MOVE Low-Value TO tco-chiave
           ELSE
              MOVE High-Value TO tco-chiave
           END-IF
           .

       DataSet1-tcorrisp-INITEND.
           IF DataSet1-tcorrisp-KEY-Asc
              MOVE High-Value TO tco-chiave
           ELSE
              MOVE Low-Value TO tco-chiave
           END-IF
           .

      * tcorrisp
       DataSet1-tcorrisp-START.
           IF DataSet1-tcorrisp-KEY-Asc
              START tcorrisp KEY >= tco-chiave
           ELSE
              START tcorrisp KEY <= tco-chiave
           END-IF
           .

       DataSet1-tcorrisp-START-NOTGREATER.
           IF DataSet1-tcorrisp-KEY-Asc
              START tcorrisp KEY <= tco-chiave
           ELSE
              START tcorrisp KEY >= tco-chiave
           END-IF
           .

       DataSet1-tcorrisp-START-GREATER.
           IF DataSet1-tcorrisp-KEY-Asc
              START tcorrisp KEY > tco-chiave
           ELSE
              START tcorrisp KEY < tco-chiave
           END-IF
           .

       DataSet1-tcorrisp-START-LESS.
           IF DataSet1-tcorrisp-KEY-Asc
              START tcorrisp KEY < tco-chiave
           ELSE
              START tcorrisp KEY > tco-chiave
           END-IF
           .

       DataSet1-tcorrisp-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tcorrisp, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcorrisp, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tcorrisp-LOCK
              READ tcorrisp WITH LOCK 
              KEY tco-chiave
           ELSE
              READ tcorrisp WITH NO LOCK 
              KEY tco-chiave
           END-IF
           PERFORM tcorrisp-tco-k-data-MERGE-SPLITBUF
           PERFORM tcorrisp-tco-k-cliente-MERGE-SPLITBUF
           MOVE STATUS-tcorrisp TO TOTEM-ERR-STAT 
           MOVE "tcorrisp" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcorrisp, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcorrisp, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tcorrisp-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tcorrisp, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcorrisp, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tcorrisp-KEY-Asc
              IF DataSet1-tcorrisp-LOCK
                 READ tcorrisp NEXT WITH LOCK
              ELSE
                 READ tcorrisp NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tcorrisp-LOCK
                 READ tcorrisp PREVIOUS WITH LOCK
              ELSE
                 READ tcorrisp PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM tcorrisp-tco-k-data-MERGE-SPLITBUF
           PERFORM tcorrisp-tco-k-cliente-MERGE-SPLITBUF
           MOVE STATUS-tcorrisp TO TOTEM-ERR-STAT
           MOVE "tcorrisp" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcorrisp, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcorrisp, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tcorrisp-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tcorrisp, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcorrisp, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tcorrisp-KEY-Asc
              IF DataSet1-tcorrisp-LOCK
                 READ tcorrisp PREVIOUS WITH LOCK
              ELSE
                 READ tcorrisp PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tcorrisp-LOCK
                 READ tcorrisp NEXT WITH LOCK
              ELSE
                 READ tcorrisp NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM tcorrisp-tco-k-data-MERGE-SPLITBUF
           PERFORM tcorrisp-tco-k-cliente-MERGE-SPLITBUF
           MOVE STATUS-tcorrisp TO TOTEM-ERR-STAT
           MOVE "tcorrisp" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcorrisp, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcorrisp, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tcorrisp-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tcorrisp, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tcorrisp TO TOTEM-ERR-STAT
           MOVE "tcorrisp" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcorrisp, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tcorrisp-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tcorrisp, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tcorrisp TO TOTEM-ERR-STAT
           MOVE "tcorrisp" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcorrisp, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tcorrisp-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tcorrisp, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tcorrisp TO TOTEM-ERR-STAT
           MOVE "tcorrisp" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcorrisp, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-rfatture-INITSTART.
           IF DataSet1-rfatture-KEY-Asc
              MOVE Low-Value TO rfa-chiave
           ELSE
              MOVE High-Value TO rfa-chiave
           END-IF
           .

       DataSet1-rfatture-INITEND.
           IF DataSet1-rfatture-KEY-Asc
              MOVE High-Value TO rfa-chiave
           ELSE
              MOVE Low-Value TO rfa-chiave
           END-IF
           .

      * rfatture
       DataSet1-rfatture-START.
           IF DataSet1-rfatture-KEY-Asc
              START rfatture KEY >= rfa-chiave
           ELSE
              START rfatture KEY <= rfa-chiave
           END-IF
           .

       DataSet1-rfatture-START-NOTGREATER.
           IF DataSet1-rfatture-KEY-Asc
              START rfatture KEY <= rfa-chiave
           ELSE
              START rfatture KEY >= rfa-chiave
           END-IF
           .

       DataSet1-rfatture-START-GREATER.
           IF DataSet1-rfatture-KEY-Asc
              START rfatture KEY > rfa-chiave
           ELSE
              START rfatture KEY < rfa-chiave
           END-IF
           .

       DataSet1-rfatture-START-LESS.
           IF DataSet1-rfatture-KEY-Asc
              START rfatture KEY < rfa-chiave
           ELSE
              START rfatture KEY > rfa-chiave
           END-IF
           .

       DataSet1-rfatture-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:rfatture, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rfatture, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-rfatture-LOCK
              READ rfatture WITH LOCK 
              KEY rfa-chiave
           ELSE
              READ rfatture WITH NO LOCK 
              KEY rfa-chiave
           END-IF
           MOVE STATUS-rfatture TO TOTEM-ERR-STAT 
           MOVE "rfatture" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rfatture, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rfatture, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-rfatture-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:rfatture, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rfatture, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-rfatture-KEY-Asc
              IF DataSet1-rfatture-LOCK
                 READ rfatture NEXT WITH LOCK
              ELSE
                 READ rfatture NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-rfatture-LOCK
                 READ rfatture PREVIOUS WITH LOCK
              ELSE
                 READ rfatture PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-rfatture TO TOTEM-ERR-STAT
           MOVE "rfatture" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rfatture, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rfatture, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-rfatture-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:rfatture, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rfatture, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-rfatture-KEY-Asc
              IF DataSet1-rfatture-LOCK
                 READ rfatture PREVIOUS WITH LOCK
              ELSE
                 READ rfatture PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-rfatture-LOCK
                 READ rfatture NEXT WITH LOCK
              ELSE
                 READ rfatture NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-rfatture TO TOTEM-ERR-STAT
           MOVE "rfatture" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rfatture, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rfatture, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-rfatture-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:rfatture, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-rfatture TO TOTEM-ERR-STAT
           MOVE "rfatture" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rfatture, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-rfatture-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:rfatture, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-rfatture TO TOTEM-ERR-STAT
           MOVE "rfatture" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rfatture, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-rfatture-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:rfatture, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-rfatture TO TOTEM-ERR-STAT
           MOVE "rfatture" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rfatture, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-rcorrisp-INITSTART.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-rcorrisp-KEY1-Asc
                 MOVE Low-Value TO rco-chiave
              ELSE
                 MOVE High-Value TO rco-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-rcorrisp-INITEND.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-rcorrisp-KEY1-Asc
                 MOVE High-Value TO rco-chiave
              ELSE
                 MOVE Low-Value TO rco-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-CHANGETO-KEY1.
           MOVE 1 TO DataSet1-KEYIS
           .   

       DataSet1-Change-CurrentKey-Asc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "A" TO DataSet1-rcorrisp-KEY1-ORDER
           END-EVALUATE
           .

       DataSet1-Change-CurrentKey-Desc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "D" TO DataSet1-rcorrisp-KEY1-ORDER
           END-EVALUATE
           .

      * rcorrisp
       DataSet1-rcorrisp-START.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-rcorrisp-KEY1-Asc
                 START rcorrisp KEY >= rco-chiave
              ELSE
                 START rcorrisp KEY <= rco-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-rcorrisp-START-NOTGREATER.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-rcorrisp-KEY1-Asc
                 START rcorrisp KEY <= rco-chiave
              ELSE
                 START rcorrisp KEY >= rco-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-rcorrisp-START-GREATER.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-rcorrisp-KEY1-Asc
                 START rcorrisp KEY > rco-chiave
              ELSE
                 START rcorrisp KEY < rco-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-rcorrisp-START-LESS.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-rcorrisp-KEY1-Asc
                 START rcorrisp KEY < rco-chiave
              ELSE
                 START rcorrisp KEY > rco-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-rcorrisp-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:rcorrisp, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rcorrisp, BeforeReadRecord>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-rcorrisp-LOCK
                 READ rcorrisp WITH LOCK 
                 KEY rco-chiave
              ELSE
                 READ rcorrisp WITH NO LOCK 
                 KEY rco-chiave
              END-IF
           END-EVALUATE
           MOVE STATUS-rcorrisp TO TOTEM-ERR-STAT 
           MOVE "rcorrisp" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rcorrisp, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rcorrisp, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-rcorrisp-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:rcorrisp, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rcorrisp, BeforeReadNext>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-rcorrisp-KEY1-Asc
                 IF DataSet1-rcorrisp-LOCK
                    READ rcorrisp NEXT WITH LOCK
                 ELSE
                    READ rcorrisp NEXT WITH NO LOCK
                 END-IF
              ELSE
                 IF DataSet1-rcorrisp-LOCK
                    READ rcorrisp PREVIOUS WITH LOCK
                 ELSE
                    READ rcorrisp PREVIOUS WITH NO LOCK
                 END-IF
              END-IF
           END-EVALUATE
           MOVE STATUS-rcorrisp TO TOTEM-ERR-STAT
           MOVE "rcorrisp" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rcorrisp, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rcorrisp, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-rcorrisp-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:rcorrisp, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rcorrisp, BeforeReadPrev>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-rcorrisp-KEY1-Asc
                 IF DataSet1-rcorrisp-LOCK
                    READ rcorrisp PREVIOUS WITH LOCK
                 ELSE
                    READ rcorrisp PREVIOUS WITH NO LOCK
                 END-IF
              ELSE
                 IF DataSet1-rcorrisp-LOCK
                    READ rcorrisp NEXT WITH LOCK
                 ELSE
                    READ rcorrisp NEXT WITH NO LOCK
                 END-IF
              END-IF
           END-EVALUATE
           MOVE STATUS-rcorrisp TO TOTEM-ERR-STAT
           MOVE "rcorrisp" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rcorrisp, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rcorrisp, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-rcorrisp-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:rcorrisp, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-rcorrisp TO TOTEM-ERR-STAT
           MOVE "rcorrisp" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rcorrisp, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-rcorrisp-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:rcorrisp, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-rcorrisp TO TOTEM-ERR-STAT
           MOVE "rcorrisp" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rcorrisp, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-rcorrisp-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:rcorrisp, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-rcorrisp TO TOTEM-ERR-STAT
           MOVE "rcorrisp" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rcorrisp, AfterDelete>
      * <TOTEM:END>
           .

       clienti-cli-k-ragsoc-MERGE-SPLITBUF.
           INITIALIZE clienti-cli-k-ragsoc-SPLITBUF
           MOVE cli-ragsoc(1:50) TO clienti-cli-k-ragsoc-SPLITBUF(1:50)
           MOVE cli-chiave(1:6) TO clienti-cli-k-ragsoc-SPLITBUF(51:6)
           .

       DataSet1-clienti-INITSTART.
           IF DataSet1-clienti-KEY-Asc
              MOVE Low-Value TO cli-chiave
           ELSE
              MOVE High-Value TO cli-chiave
           END-IF
           .

       DataSet1-clienti-INITEND.
           IF DataSet1-clienti-KEY-Asc
              MOVE High-Value TO cli-chiave
           ELSE
              MOVE Low-Value TO cli-chiave
           END-IF
           .

      * clienti
       DataSet1-clienti-START.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY >= cli-chiave
           ELSE
              START clienti KEY <= cli-chiave
           END-IF
           .

       DataSet1-clienti-START-NOTGREATER.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY <= cli-chiave
           ELSE
              START clienti KEY >= cli-chiave
           END-IF
           .

       DataSet1-clienti-START-GREATER.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY > cli-chiave
           ELSE
              START clienti KEY < cli-chiave
           END-IF
           .

       DataSet1-clienti-START-LESS.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY < cli-chiave
           ELSE
              START clienti KEY > cli-chiave
           END-IF
           .

       DataSet1-clienti-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-clienti-LOCK
              READ clienti WITH LOCK 
              KEY cli-chiave
           ELSE
              READ clienti WITH NO LOCK 
              KEY cli-chiave
           END-IF
           PERFORM clienti-cli-k-ragsoc-MERGE-SPLITBUF
           MOVE STATUS-clienti TO TOTEM-ERR-STAT 
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-clienti-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-clienti-KEY-Asc
              IF DataSet1-clienti-LOCK
                 READ clienti NEXT WITH LOCK
              ELSE
                 READ clienti NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-clienti-LOCK
                 READ clienti PREVIOUS WITH LOCK
              ELSE
                 READ clienti PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM clienti-cli-k-ragsoc-MERGE-SPLITBUF
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-clienti-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-clienti-KEY-Asc
              IF DataSet1-clienti-LOCK
                 READ clienti PREVIOUS WITH LOCK
              ELSE
                 READ clienti PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-clienti-LOCK
                 READ clienti NEXT WITH LOCK
              ELSE
                 READ clienti NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM clienti-cli-k-ragsoc-MERGE-SPLITBUF
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-clienti-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-clienti-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-clienti-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterDelete>
      * <TOTEM:END>
           .

       tipocli-tcl-k-descrizione-MERGE-SPLITBUF.
           INITIALIZE tipocli-tcl-k-descrizione-SPLITBUF
           MOVE tcl-descrizione(1:50) TO 
           tipocli-tcl-k-descrizione-SPLITBUF(1:50)
           MOVE tcl-chiave(1:6) TO 
           tipocli-tcl-k-descrizione-SPLITBUF(51:6)
           .

       DataSet1-tipocli-INITSTART.
           IF DataSet1-tipocli-KEY-Asc
              MOVE Low-Value TO tcl-chiave
           ELSE
              MOVE High-Value TO tcl-chiave
           END-IF
           .

       DataSet1-tipocli-INITEND.
           IF DataSet1-tipocli-KEY-Asc
              MOVE High-Value TO tcl-chiave
           ELSE
              MOVE Low-Value TO tcl-chiave
           END-IF
           .

      * tipocli
       DataSet1-tipocli-START.
           IF DataSet1-tipocli-KEY-Asc
              START tipocli KEY >= tcl-chiave
           ELSE
              START tipocli KEY <= tcl-chiave
           END-IF
           .

       DataSet1-tipocli-START-NOTGREATER.
           IF DataSet1-tipocli-KEY-Asc
              START tipocli KEY <= tcl-chiave
           ELSE
              START tipocli KEY >= tcl-chiave
           END-IF
           .

       DataSet1-tipocli-START-GREATER.
           IF DataSet1-tipocli-KEY-Asc
              START tipocli KEY > tcl-chiave
           ELSE
              START tipocli KEY < tcl-chiave
           END-IF
           .

       DataSet1-tipocli-START-LESS.
           IF DataSet1-tipocli-KEY-Asc
              START tipocli KEY < tcl-chiave
           ELSE
              START tipocli KEY > tcl-chiave
           END-IF
           .

       DataSet1-tipocli-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tipocli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tipocli, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tipocli-LOCK
              READ tipocli WITH LOCK 
              KEY tcl-chiave
           ELSE
              READ tipocli WITH NO LOCK 
              KEY tcl-chiave
           END-IF
           PERFORM tipocli-tcl-k-descrizione-MERGE-SPLITBUF
           MOVE STATUS-tipocli TO TOTEM-ERR-STAT 
           MOVE "tipocli" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tipocli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tipocli, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tipocli-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tipocli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tipocli, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tipocli-KEY-Asc
              IF DataSet1-tipocli-LOCK
                 READ tipocli NEXT WITH LOCK
              ELSE
                 READ tipocli NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tipocli-LOCK
                 READ tipocli PREVIOUS WITH LOCK
              ELSE
                 READ tipocli PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM tipocli-tcl-k-descrizione-MERGE-SPLITBUF
           MOVE STATUS-tipocli TO TOTEM-ERR-STAT
           MOVE "tipocli" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tipocli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tipocli, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tipocli-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tipocli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tipocli, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tipocli-KEY-Asc
              IF DataSet1-tipocli-LOCK
                 READ tipocli PREVIOUS WITH LOCK
              ELSE
                 READ tipocli PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tipocli-LOCK
                 READ tipocli NEXT WITH LOCK
              ELSE
                 READ tipocli NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM tipocli-tcl-k-descrizione-MERGE-SPLITBUF
           MOVE STATUS-tipocli TO TOTEM-ERR-STAT
           MOVE "tipocli" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tipocli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tipocli, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tipocli-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tipocli, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tipocli TO TOTEM-ERR-STAT
           MOVE "tipocli" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tipocli, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tipocli-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tipocli, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tipocli TO TOTEM-ERR-STAT
           MOVE "tipocli" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tipocli, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tipocli-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tipocli, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tipocli TO TOTEM-ERR-STAT
           MOVE "tipocli" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tipocli, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-rnotacr-INITSTART.
           IF DataSet1-rnotacr-KEY-Asc
              MOVE Low-Value TO rno-chiave
           ELSE
              MOVE High-Value TO rno-chiave
           END-IF
           .

       DataSet1-rnotacr-INITEND.
           IF DataSet1-rnotacr-KEY-Asc
              MOVE High-Value TO rno-chiave
           ELSE
              MOVE Low-Value TO rno-chiave
           END-IF
           .

      * rnotacr
       DataSet1-rnotacr-START.
           IF DataSet1-rnotacr-KEY-Asc
              START rnotacr KEY >= rno-chiave
           ELSE
              START rnotacr KEY <= rno-chiave
           END-IF
           .

       DataSet1-rnotacr-START-NOTGREATER.
           IF DataSet1-rnotacr-KEY-Asc
              START rnotacr KEY <= rno-chiave
           ELSE
              START rnotacr KEY >= rno-chiave
           END-IF
           .

       DataSet1-rnotacr-START-GREATER.
           IF DataSet1-rnotacr-KEY-Asc
              START rnotacr KEY > rno-chiave
           ELSE
              START rnotacr KEY < rno-chiave
           END-IF
           .

       DataSet1-rnotacr-START-LESS.
           IF DataSet1-rnotacr-KEY-Asc
              START rnotacr KEY < rno-chiave
           ELSE
              START rnotacr KEY > rno-chiave
           END-IF
           .

       DataSet1-rnotacr-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:rnotacr, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rnotacr, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-rnotacr-LOCK
              READ rnotacr WITH LOCK 
              KEY rno-chiave
           ELSE
              READ rnotacr WITH NO LOCK 
              KEY rno-chiave
           END-IF
           MOVE STATUS-rnotacr TO TOTEM-ERR-STAT 
           MOVE "rnotacr" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rnotacr, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rnotacr, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-rnotacr-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:rnotacr, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rnotacr, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-rnotacr-KEY-Asc
              IF DataSet1-rnotacr-LOCK
                 READ rnotacr NEXT WITH LOCK
              ELSE
                 READ rnotacr NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-rnotacr-LOCK
                 READ rnotacr PREVIOUS WITH LOCK
              ELSE
                 READ rnotacr PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-rnotacr TO TOTEM-ERR-STAT
           MOVE "rnotacr" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rnotacr, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rnotacr, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-rnotacr-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:rnotacr, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rnotacr, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-rnotacr-KEY-Asc
              IF DataSet1-rnotacr-LOCK
                 READ rnotacr PREVIOUS WITH LOCK
              ELSE
                 READ rnotacr PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-rnotacr-LOCK
                 READ rnotacr NEXT WITH LOCK
              ELSE
                 READ rnotacr NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-rnotacr TO TOTEM-ERR-STAT
           MOVE "rnotacr" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rnotacr, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rnotacr, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-rnotacr-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:rnotacr, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-rnotacr TO TOTEM-ERR-STAT
           MOVE "rnotacr" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rnotacr, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-rnotacr-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:rnotacr, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-rnotacr TO TOTEM-ERR-STAT
           MOVE "rnotacr" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rnotacr, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-rnotacr-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:rnotacr, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-rnotacr TO TOTEM-ERR-STAT
           MOVE "rnotacr" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rnotacr, AfterDelete>
      * <TOTEM:END>
           .

       tnotacr-tno-k-data-MERGE-SPLITBUF.
           INITIALIZE tnotacr-tno-k-data-SPLITBUF
           MOVE tno-data-doc(1:8) TO tnotacr-tno-k-data-SPLITBUF(1:8)
           MOVE tno-chiave(1:10) TO tnotacr-tno-k-data-SPLITBUF(9:10)
           .

       tnotacr-tno-k-cliente-MERGE-SPLITBUF.
           INITIALIZE tnotacr-tno-k-cliente-SPLITBUF
           MOVE tno-cliente(1:6) TO tnotacr-tno-k-cliente-SPLITBUF(1:6)
           MOVE tno-data-doc(1:8) TO tnotacr-tno-k-cliente-SPLITBUF(7:8)
           MOVE tno-numero(1:6) TO tnotacr-tno-k-cliente-SPLITBUF(15:6)
           .

       tnotacr-tno-k-fattura-MERGE-SPLITBUF.
           INITIALIZE tnotacr-tno-k-fattura-SPLITBUF
           MOVE tno-fattura(1:10) TO 
           tnotacr-tno-k-fattura-SPLITBUF(1:10)
           MOVE tno-chiave(1:10) TO 
           tnotacr-tno-k-fattura-SPLITBUF(11:10)
           .

       tnotacr-tno-k-corrisp-MERGE-SPLITBUF.
           INITIALIZE tnotacr-tno-k-corrisp-SPLITBUF
           MOVE tno-corrisp(1:10) TO 
           tnotacr-tno-k-corrisp-SPLITBUF(1:10)
           MOVE tno-chiave(1:10) TO 
           tnotacr-tno-k-corrisp-SPLITBUF(11:10)
           .

       DataSet1-tnotacr-INITSTART.
           IF DataSet1-tnotacr-KEY-Asc
              MOVE Low-Value TO tno-chiave
           ELSE
              MOVE High-Value TO tno-chiave
           END-IF
           .

       DataSet1-tnotacr-INITEND.
           IF DataSet1-tnotacr-KEY-Asc
              MOVE High-Value TO tno-chiave
           ELSE
              MOVE Low-Value TO tno-chiave
           END-IF
           .

      * tnotacr
       DataSet1-tnotacr-START.
           IF DataSet1-tnotacr-KEY-Asc
              START tnotacr KEY >= tno-chiave
           ELSE
              START tnotacr KEY <= tno-chiave
           END-IF
           .

       DataSet1-tnotacr-START-NOTGREATER.
           IF DataSet1-tnotacr-KEY-Asc
              START tnotacr KEY <= tno-chiave
           ELSE
              START tnotacr KEY >= tno-chiave
           END-IF
           .

       DataSet1-tnotacr-START-GREATER.
           IF DataSet1-tnotacr-KEY-Asc
              START tnotacr KEY > tno-chiave
           ELSE
              START tnotacr KEY < tno-chiave
           END-IF
           .

       DataSet1-tnotacr-START-LESS.
           IF DataSet1-tnotacr-KEY-Asc
              START tnotacr KEY < tno-chiave
           ELSE
              START tnotacr KEY > tno-chiave
           END-IF
           .

       DataSet1-tnotacr-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tnotacr-LOCK
              READ tnotacr WITH LOCK 
              KEY tno-chiave
           ELSE
              READ tnotacr WITH NO LOCK 
              KEY tno-chiave
           END-IF
           PERFORM tnotacr-tno-k-data-MERGE-SPLITBUF
           PERFORM tnotacr-tno-k-cliente-MERGE-SPLITBUF
           PERFORM tnotacr-tno-k-fattura-MERGE-SPLITBUF
           PERFORM tnotacr-tno-k-corrisp-MERGE-SPLITBUF
           MOVE STATUS-tnotacr TO TOTEM-ERR-STAT 
           MOVE "tnotacr" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tnotacr-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tnotacr-KEY-Asc
              IF DataSet1-tnotacr-LOCK
                 READ tnotacr NEXT WITH LOCK
              ELSE
                 READ tnotacr NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tnotacr-LOCK
                 READ tnotacr PREVIOUS WITH LOCK
              ELSE
                 READ tnotacr PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM tnotacr-tno-k-data-MERGE-SPLITBUF
           PERFORM tnotacr-tno-k-cliente-MERGE-SPLITBUF
           PERFORM tnotacr-tno-k-fattura-MERGE-SPLITBUF
           PERFORM tnotacr-tno-k-corrisp-MERGE-SPLITBUF
           MOVE STATUS-tnotacr TO TOTEM-ERR-STAT
           MOVE "tnotacr" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tnotacr-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tnotacr-KEY-Asc
              IF DataSet1-tnotacr-LOCK
                 READ tnotacr PREVIOUS WITH LOCK
              ELSE
                 READ tnotacr PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tnotacr-LOCK
                 READ tnotacr NEXT WITH LOCK
              ELSE
                 READ tnotacr NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM tnotacr-tno-k-data-MERGE-SPLITBUF
           PERFORM tnotacr-tno-k-cliente-MERGE-SPLITBUF
           PERFORM tnotacr-tno-k-fattura-MERGE-SPLITBUF
           PERFORM tnotacr-tno-k-corrisp-MERGE-SPLITBUF
           MOVE STATUS-tnotacr TO TOTEM-ERR-STAT
           MOVE "tnotacr" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tnotacr-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tnotacr TO TOTEM-ERR-STAT
           MOVE "tnotacr" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tnotacr-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tnotacr TO TOTEM-ERR-STAT
           MOVE "tnotacr" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tnotacr-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tnotacr TO TOTEM-ERR-STAT
           MOVE "tnotacr" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, AfterDelete>
      * <TOTEM:END>
           .

       tschede-tsc-k-data-MERGE-SPLITBUF.
           INITIALIZE tschede-tsc-k-data-SPLITBUF
           MOVE tsc-data-creazione(1:8) TO 
           tschede-tsc-k-data-SPLITBUF(1:8)
           MOVE tsc-cliente(1:6) TO tschede-tsc-k-data-SPLITBUF(9:6)
           .

       tschede-tsc-k-cliente-MERGE-SPLITBUF.
           INITIALIZE tschede-tsc-k-cliente-SPLITBUF
           MOVE tsc-cliente(1:6) TO tschede-tsc-k-cliente-SPLITBUF(1:6)
           .

       DataSet1-tschede-INITSTART.
           IF DataSet1-tschede-KEY-Asc
              MOVE Low-Value TO tsc-chiave
           ELSE
              MOVE High-Value TO tsc-chiave
           END-IF
           .

       DataSet1-tschede-INITEND.
           IF DataSet1-tschede-KEY-Asc
              MOVE High-Value TO tsc-chiave
           ELSE
              MOVE Low-Value TO tsc-chiave
           END-IF
           .

      * tschede
       DataSet1-tschede-START.
           IF DataSet1-tschede-KEY-Asc
              START tschede KEY >= tsc-chiave
           ELSE
              START tschede KEY <= tsc-chiave
           END-IF
           .

       DataSet1-tschede-START-NOTGREATER.
           IF DataSet1-tschede-KEY-Asc
              START tschede KEY <= tsc-chiave
           ELSE
              START tschede KEY >= tsc-chiave
           END-IF
           .

       DataSet1-tschede-START-GREATER.
           IF DataSet1-tschede-KEY-Asc
              START tschede KEY > tsc-chiave
           ELSE
              START tschede KEY < tsc-chiave
           END-IF
           .

       DataSet1-tschede-START-LESS.
           IF DataSet1-tschede-KEY-Asc
              START tschede KEY < tsc-chiave
           ELSE
              START tschede KEY > tsc-chiave
           END-IF
           .

       DataSet1-tschede-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tschede, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tschede, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tschede-LOCK
              READ tschede WITH LOCK 
              KEY tsc-chiave
           ELSE
              READ tschede WITH NO LOCK 
              KEY tsc-chiave
           END-IF
           PERFORM tschede-tsc-k-data-MERGE-SPLITBUF
           PERFORM tschede-tsc-k-cliente-MERGE-SPLITBUF
           MOVE STATUS-tschede TO TOTEM-ERR-STAT 
           MOVE "tschede" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tschede, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tschede, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tschede-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tschede, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tschede, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tschede-KEY-Asc
              IF DataSet1-tschede-LOCK
                 READ tschede NEXT WITH LOCK
              ELSE
                 READ tschede NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tschede-LOCK
                 READ tschede PREVIOUS WITH LOCK
              ELSE
                 READ tschede PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM tschede-tsc-k-data-MERGE-SPLITBUF
           PERFORM tschede-tsc-k-cliente-MERGE-SPLITBUF
           MOVE STATUS-tschede TO TOTEM-ERR-STAT
           MOVE "tschede" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tschede, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tschede, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tschede-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tschede, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tschede, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tschede-KEY-Asc
              IF DataSet1-tschede-LOCK
                 READ tschede PREVIOUS WITH LOCK
              ELSE
                 READ tschede PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tschede-LOCK
                 READ tschede NEXT WITH LOCK
              ELSE
                 READ tschede NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM tschede-tsc-k-data-MERGE-SPLITBUF
           PERFORM tschede-tsc-k-cliente-MERGE-SPLITBUF
           MOVE STATUS-tschede TO TOTEM-ERR-STAT
           MOVE "tschede" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tschede, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tschede, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tschede-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tschede, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tschede TO TOTEM-ERR-STAT
           MOVE "tschede" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tschede, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tschede-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tschede, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tschede TO TOTEM-ERR-STAT
           MOVE "tschede" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tschede, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tschede-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tschede, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tschede TO TOTEM-ERR-STAT
           MOVE "tschede" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tschede, AfterDelete>
      * <TOTEM:END>
           .

       rschede-rsc-k-art-MERGE-SPLITBUF.
           INITIALIZE rschede-rsc-k-art-SPLITBUF
           MOVE rsc-articolo(1:6) TO rschede-rsc-k-art-SPLITBUF(1:6)
           MOVE rsc-cliente(1:6) TO rschede-rsc-k-art-SPLITBUF(7:6)
           MOVE rsc-data(1:8) TO rschede-rsc-k-art-SPLITBUF(13:8)
           .

       rschede-rsc-k-cli-MERGE-SPLITBUF.
           INITIALIZE rschede-rsc-k-cli-SPLITBUF
           MOVE rsc-cliente(1:6) TO rschede-rsc-k-cli-SPLITBUF(1:6)
           MOVE rsc-articolo(1:6) TO rschede-rsc-k-cli-SPLITBUF(7:6)
           MOVE rsc-data(1:8) TO rschede-rsc-k-cli-SPLITBUF(13:8)
           .

       rschede-rsc-k-fatart-MERGE-SPLITBUF.
           INITIALIZE rschede-rsc-k-fatart-SPLITBUF
           MOVE rsc-fattura(1:14) TO rschede-rsc-k-fatart-SPLITBUF(1:14)
           MOVE rsc-articolo(1:6) TO rschede-rsc-k-fatart-SPLITBUF(15:6)
           .

       rschede-rsc-k-fatcli-MERGE-SPLITBUF.
           INITIALIZE rschede-rsc-k-fatcli-SPLITBUF
           MOVE rsc-fattura(1:14) TO rschede-rsc-k-fatcli-SPLITBUF(1:14)
           MOVE rsc-cliente(1:6) TO rschede-rsc-k-fatcli-SPLITBUF(15:6)
           .

       rschede-rsc-k-corart-MERGE-SPLITBUF.
           INITIALIZE rschede-rsc-k-corart-SPLITBUF
           MOVE rsc-corrisp(1:14) TO rschede-rsc-k-corart-SPLITBUF(1:14)
           MOVE rsc-articolo(1:6) TO rschede-rsc-k-corart-SPLITBUF(15:6)
           .

       rschede-rsc-k-corcli-MERGE-SPLITBUF.
           INITIALIZE rschede-rsc-k-corcli-SPLITBUF
           MOVE rsc-corrisp(1:14) TO rschede-rsc-k-corcli-SPLITBUF(1:14)
           MOVE rsc-cliente(1:6) TO rschede-rsc-k-corcli-SPLITBUF(15:6)
           .

       DataSet1-rschede-INITSTART.
           IF DataSet1-rschede-KEY-Asc
              MOVE Low-Value TO rsc-chiave
           ELSE
              MOVE High-Value TO rsc-chiave
           END-IF
           .

       DataSet1-rschede-INITEND.
           IF DataSet1-rschede-KEY-Asc
              MOVE High-Value TO rsc-chiave
           ELSE
              MOVE Low-Value TO rsc-chiave
           END-IF
           .

      * rschede
       DataSet1-rschede-START.
           IF DataSet1-rschede-KEY-Asc
              START rschede KEY >= rsc-chiave
           ELSE
              START rschede KEY <= rsc-chiave
           END-IF
           .

       DataSet1-rschede-START-NOTGREATER.
           IF DataSet1-rschede-KEY-Asc
              START rschede KEY <= rsc-chiave
           ELSE
              START rschede KEY >= rsc-chiave
           END-IF
           .

       DataSet1-rschede-START-GREATER.
           IF DataSet1-rschede-KEY-Asc
              START rschede KEY > rsc-chiave
           ELSE
              START rschede KEY < rsc-chiave
           END-IF
           .

       DataSet1-rschede-START-LESS.
           IF DataSet1-rschede-KEY-Asc
              START rschede KEY < rsc-chiave
           ELSE
              START rschede KEY > rsc-chiave
           END-IF
           .

       DataSet1-rschede-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:rschede, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rschede, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-rschede-LOCK
              READ rschede WITH LOCK 
              KEY rsc-chiave
           ELSE
              READ rschede WITH NO LOCK 
              KEY rsc-chiave
           END-IF
           PERFORM rschede-rsc-k-art-MERGE-SPLITBUF
           PERFORM rschede-rsc-k-cli-MERGE-SPLITBUF
           PERFORM rschede-rsc-k-fatart-MERGE-SPLITBUF
           PERFORM rschede-rsc-k-fatcli-MERGE-SPLITBUF
           PERFORM rschede-rsc-k-corart-MERGE-SPLITBUF
           PERFORM rschede-rsc-k-corcli-MERGE-SPLITBUF
           MOVE STATUS-rschede TO TOTEM-ERR-STAT 
           MOVE "rschede" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rschede, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rschede, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-rschede-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:rschede, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rschede, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-rschede-KEY-Asc
              IF DataSet1-rschede-LOCK
                 READ rschede NEXT WITH LOCK
              ELSE
                 READ rschede NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-rschede-LOCK
                 READ rschede PREVIOUS WITH LOCK
              ELSE
                 READ rschede PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM rschede-rsc-k-art-MERGE-SPLITBUF
           PERFORM rschede-rsc-k-cli-MERGE-SPLITBUF
           PERFORM rschede-rsc-k-fatart-MERGE-SPLITBUF
           PERFORM rschede-rsc-k-fatcli-MERGE-SPLITBUF
           PERFORM rschede-rsc-k-corart-MERGE-SPLITBUF
           PERFORM rschede-rsc-k-corcli-MERGE-SPLITBUF
           MOVE STATUS-rschede TO TOTEM-ERR-STAT
           MOVE "rschede" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rschede, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rschede, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-rschede-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:rschede, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rschede, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-rschede-KEY-Asc
              IF DataSet1-rschede-LOCK
                 READ rschede PREVIOUS WITH LOCK
              ELSE
                 READ rschede PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-rschede-LOCK
                 READ rschede NEXT WITH LOCK
              ELSE
                 READ rschede NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM rschede-rsc-k-art-MERGE-SPLITBUF
           PERFORM rschede-rsc-k-cli-MERGE-SPLITBUF
           PERFORM rschede-rsc-k-fatart-MERGE-SPLITBUF
           PERFORM rschede-rsc-k-fatcli-MERGE-SPLITBUF
           PERFORM rschede-rsc-k-corart-MERGE-SPLITBUF
           PERFORM rschede-rsc-k-corcli-MERGE-SPLITBUF
           MOVE STATUS-rschede TO TOTEM-ERR-STAT
           MOVE "rschede" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rschede, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rschede, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-rschede-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:rschede, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-rschede TO TOTEM-ERR-STAT
           MOVE "rschede" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rschede, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-rschede-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:rschede, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-rschede TO TOTEM-ERR-STAT
           MOVE "rschede" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rschede, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-rschede-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:rschede, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-rschede TO TOTEM-ERR-STAT
           MOVE "rschede" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rschede, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-tmp-docum-INITSTART.
           IF DataSet1-tmp-docum-KEY-Asc
              MOVE Low-Value TO tdoc-chiave
           ELSE
              MOVE High-Value TO tdoc-chiave
           END-IF
           .

       DataSet1-tmp-docum-INITEND.
           IF DataSet1-tmp-docum-KEY-Asc
              MOVE High-Value TO tdoc-chiave
           ELSE
              MOVE Low-Value TO tdoc-chiave
           END-IF
           .

      * tmp-docum
       DataSet1-tmp-docum-START.
           IF DataSet1-tmp-docum-KEY-Asc
              START tmp-docum KEY >= tdoc-chiave
           ELSE
              START tmp-docum KEY <= tdoc-chiave
           END-IF
           .

       DataSet1-tmp-docum-START-NOTGREATER.
           IF DataSet1-tmp-docum-KEY-Asc
              START tmp-docum KEY <= tdoc-chiave
           ELSE
              START tmp-docum KEY >= tdoc-chiave
           END-IF
           .

       DataSet1-tmp-docum-START-GREATER.
           IF DataSet1-tmp-docum-KEY-Asc
              START tmp-docum KEY > tdoc-chiave
           ELSE
              START tmp-docum KEY < tdoc-chiave
           END-IF
           .

       DataSet1-tmp-docum-START-LESS.
           IF DataSet1-tmp-docum-KEY-Asc
              START tmp-docum KEY < tdoc-chiave
           ELSE
              START tmp-docum KEY > tdoc-chiave
           END-IF
           .

       DataSet1-tmp-docum-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-docum, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-docum, BeforeReadRecord>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-docum, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-docum, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tmp-docum-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-docum, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-docum, BeforeReadNext>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-docum, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-docum, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tmp-docum-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-docum, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-docum, BeforeReadPrev>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-docum, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-docum, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tmp-docum-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-docum, BeforeWrite>
      * <TOTEM:END>
           WRITE tdoc-rec OF tmp-docum.
           MOVE STATUS-tmp-docum TO TOTEM-ERR-STAT
           MOVE "tmp-docum" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-docum, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tmp-docum-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-docum, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tmp-docum TO TOTEM-ERR-STAT
           MOVE "tmp-docum" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-docum, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tmp-docum-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-docum, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tmp-docum TO TOTEM-ERR-STAT
           MOVE "tmp-docum" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-docum, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-lineseq-INITSTART.
           .

       DataSet1-lineseq-INITEND.
           .

       DataSet1-lineseq-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, BeforeReadRecord>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-lineseq-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, BeforeReadNext>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-lineseq-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, BeforeReadPrev>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-lineseq-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, BeforeWrite>
      * <TOTEM:END>
           WRITE line-riga OF lineseq.
           MOVE STATUS-lineseq TO TOTEM-ERR-STAT
           MOVE "lineseq" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-lineseq-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-lineseq TO TOTEM-ERR-STAT
           MOVE "lineseq" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-lineseq-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-lineseq TO TOTEM-ERR-STAT
           MOVE "lineseq" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-INIT-RECORD.
           INITIALIZE tfa-rec OF tfatture
           INITIALIZE tco-rec OF tcorrisp
           INITIALIZE rfa-rec OF rfatture
           INITIALIZE rco-rec OF rcorrisp
           INITIALIZE cli-rec OF clienti
           INITIALIZE tcl-rec OF tipocli
           INITIALIZE rno-rec OF rnotacr
           INITIALIZE tno-rec OF tnotacr
           INITIALIZE tsc-rec OF tschede
           INITIALIZE rsc-rec OF rschede
           INITIALIZE tdoc-rec OF tmp-docum
           INITIALIZE line-riga OF lineseq
           .


      * GRID
       gd-elenco-Content.
      * CELLS' SETTING
              MODIFY gd-elenco, X = 1, Y = 1,
                CELL-COLOR = 299,
                CELL-FONT Calibri14B-Occidentale,
                CELL-DATA = "Anno",
      * CELLS' SETTING
              MODIFY gd-elenco, X = 2, Y = 1,
                CELL-COLOR = 299,
                CELL-FONT Calibri14B-Occidentale,
                CELL-DATA = "Numero",
      * CELLS' SETTING
              MODIFY gd-elenco, X = 3, Y = 1,
                CELL-COLOR = 299,
                CELL-FONT Calibri14B-Occidentale,
                CELL-DATA = "Data",
      * CELLS' SETTING
              MODIFY gd-elenco, X = 4, Y = 1,
                CELL-COLOR = 299,
                CELL-FONT Calibri14B-Occidentale,
                CELL-DATA = "Cliente",
      * CELLS' SETTING
              MODIFY gd-elenco, X = 5, Y = 1,
                CELL-COLOR = 299,
                CELL-FONT Calibri14B-Occidentale,
                CELL-DATA = "Descrizione",
      * CELLS' SETTING
              MODIFY gd-elenco, X = 6, Y = 1,
                CELL-COLOR = 299,
                CELL-FONT Calibri14B-Occidentale,
                CELL-DATA = "Imponibile",
      * CELLS' SETTING
              MODIFY gd-elenco, X = 7, Y = 1,
                CELL-COLOR = 299,
                CELL-FONT Calibri14B-Occidentale,
                CELL-DATA = "IVA",
      * CELLS' SETTING
              MODIFY gd-elenco, X = 8, Y = 1,
                CELL-COLOR = 299,
                CELL-FONT Calibri14B-Occidentale,
                CELL-DATA = "Totale",
           .

      * FD's Initialize Paragraph
       DataSet1-tfatture-INITREC.
           INITIALIZE tfa-rec OF tfatture
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tcorrisp-INITREC.
           INITIALIZE tco-rec OF tcorrisp
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-rfatture-INITREC.
           INITIALIZE rfa-rec OF rfatture
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-rcorrisp-INITREC.
           INITIALIZE rco-rec OF rcorrisp
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-clienti-INITREC.
           INITIALIZE cli-rec OF clienti
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tipocli-INITREC.
           INITIALIZE tcl-rec OF tipocli
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-rnotacr-INITREC.
           INITIALIZE rno-rec OF rnotacr
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tnotacr-INITREC.
           INITIALIZE tno-rec OF tnotacr
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tschede-INITREC.
           INITIALIZE tsc-rec OF tschede
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-rschede-INITREC.
           INITIALIZE rsc-rec OF rschede
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tmp-docum-INITREC.
           INITIALIZE tdoc-rec OF tmp-docum
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-lineseq-INITREC.
           INITIALIZE line-riga OF lineseq
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      *
       DataSet1-DISPATCH-BUFTOFLD.
           .

       Form1-Open-Routine.
           PERFORM Form1-Scrn
           PERFORM Form1-Proc
           .

       Form1-Scrn.
           PERFORM Form1-Create-Win
           PERFORM Form1-Init-Value
           PERFORM Form1-Init-Data
      * Tab keystrok settings
      * Tool Bar
           PERFORM Form1-DISPLAY
           .

       Form1-Create-Win.
           Display Independent GRAPHICAL WINDOW
              LINES 31,61,
              SIZE 82,70,
              HEIGHT-IN-CELLS,
              WIDTH-IN-CELLS,
              COLOR 131329,
              CONTROL FONT Calibri14-Occidentale,
              LINK TO THREAD,
              MODELESS,
              NO SCROLL,
              TITLE-BAR,
              TITLE titolo,
              AUTO-MINIMIZE,
              WITH SYSTEM MENU,
              USER-GRAY,
              USER-WHITE,
              No WRAP,
              EVENT PROCEDURE Screen1-Event-Proc,
              HANDLE IS Form1-handle,
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterCreateWin>
      * <TOTEM:END>


      * Tool Bar    
      * Status-bar
           DISPLAY Form1 UPON Form1-handle
      * DISPLAY-COLUMNS settings
           .

       Form1-PROC.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeAccept>
           move "BLANK = TUTTI" to lab-cliente-buf lab-tipo-buf.
           display lab-cliente lab-tipo.

           .
      * <TOTEM:END>
           PERFORM UNTIL Exit-Pushed
              ACCEPT Form1
                 ON EXCEPTION
                    PERFORM Form1-Evaluate-Func
                 MOVE 1 TO TOTEM-Form-Index
              END-ACCEPT
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterEndAccept>
      * <TOTEM:END>
           END-PERFORM
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDestroyWindow>
      * <TOTEM:END>
           DESTROY Form1-handle
           INITIALIZE Key-Status
           .

       Form1-Evaluate-Func.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterAccept>
      * <TOTEM:END>
           EVALUATE TRUE
              WHEN Exit-Pushed
                 PERFORM Form1-Exit
              WHEN Event-Occurred
                 IF Event-Type = Cmd-Close
                    PERFORM Form1-Exit
                 END-IF
              WHEN Key-Status = 1000
                 PERFORM rb-fatture-LinkTo
              WHEN Key-Status = 1001
                 PERFORM rb-corrisp-LinkTo
              WHEN Key-Status = 1002
                 PERFORM rb-note-LinkTo
              WHEN Key-Status = 1003
                 PERFORM rb-tutti-LinkTo
              WHEN Key-Status = 1003
                 PERFORM rb-tutti-LinkTo
              WHEN Key-Status = 13
                 PERFORM pb-singola-LinkTo
              WHEN Key-Status = 224
                 PERFORM pb-cerca-cli-LinkTo
              WHEN Key-Status = 2687
                 PERFORM pb-cerca-tipo-LinkTo
              WHEN Key-Status = 67
                 PERFORM pb-vedi-LinkTo
              WHEN Key-Status = 1004
                 PERFORM pb-etichetta-LinkTo
              WHEN Key-Status = 1006
                 PERFORM pb-ele-730-LinkTo
              WHEN Key-Status = 1007
                 PERFORM pb-ele-U-LinkTo
              WHEN Key-Status = 1005
                 PERFORM pb-ele-730-U-LinkTo
           END-EVALUATE
      * avoid changing focus
           MOVE 4 TO Accept-Control
           .

       Form1-CLEAR.
           PERFORM Form1-INIT-VALUE
           PERFORM Form1-DISPLAY
           .

       Form1-DISPLAY.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDisplay>
      * <TOTEM:END>
           DISPLAY Form1 UPON Form1-handle
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterDisplay>
           SET LK-BL-SCRITTURA     TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           MOVE FORM1-HANDLE       TO LK-HND-WIN.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           CANCEL "BLOCKPGM".

           .
      * <TOTEM:END>
           .

       Form1-Exit.
      * for main screen
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeExit>
      * <TOTEM:END>
           MOVE 27 TO Key-Status
           .

       Form1-Init-Data.
           MOVE 1 TO TOTEM-Form-Index
           MOVE 0 TO TOTEM-Frame-Index
           .

       Form1-Init-Value.
           MOVE titolo TO TOTEM-MSG-TITLE
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, SetDefault>
      * <TOTEM:END>
           PERFORM Form1-FLD-TO-BUF
           .


       Form1-ALLGRID-RESET.
           .

      * for Form's Validation
       Form1-VALIDATION-ROUTINE.
           SET TOTEM-CHECK-OK TO TRUE
           .


       Form1-Buf-To-Fld.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeBufToFld>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterBufToFld>
      * <TOTEM:END>
           .

       Form1-Fld-To-Buf.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeFldToBuf>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterFldToBuf>
      * <TOTEM:END>
           .

       Form1-CONTROLLO-OLD.
           set SiSalvato to true.
           if mod = 0 exit paragraph end-if.
           perform Form1-BUF-TO-FLD.
           move 0 to scelta.
           .
       Form1-EXTENDED-FILE-STATUS.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
           MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           PERFORM Form1-SHOW-MSG-ROUTINE
           .

       Form1-SHOW-MSG-ROUTINE.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM Form1-DISPLAY-MESSAGE
           .

       Form1-DISPLAY-MESSAGE.
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

       Form1-Save-Status.
           .             

       Form1-Restore-Status.
           .

       form-elenco-Open-Routine.
           PERFORM form-elenco-Scrn
           PERFORM form-elenco-Proc
           .

       form-elenco-Scrn.
           PERFORM form-elenco-Create-Win
           PERFORM form-elenco-Init-Value
           PERFORM form-elenco-Init-Data
      * Tab keystrok settings
      * Tool Bar
           PERFORM form-elenco-DISPLAY
           .

       form-elenco-Create-Win.
           Display Independent GRAPHICAL WINDOW
              SCREEN LINE 2,
              SCREEN COLUMN 2,
              LINES 30,39,
              SIZE 106,90,
              HEIGHT-IN-CELLS,
              WIDTH-IN-CELLS,
              COLOR 131329,
              CONTROL FONT Calibri14-Occidentale,
              LINK TO THREAD,
              NO SCROLL,
              TITLE-BAR,
              TITLE titolo,
              WITH SYSTEM MENU,
              USER-GRAY,
           VISIBLE 1,
              USER-WHITE,
              No WRAP,
              EVENT PROCEDURE form-elenco-Event-Proc,
              HANDLE IS form-elenco-Handle,
      * <TOTEM:EPT. FORM:form-elenco, FORM:form-elenco, AfterCreateWin>
      * <TOTEM:END>


      * Tool Bar    
      * Status-bar
           DISPLAY form-elenco UPON form-elenco-Handle
      * DISPLAY-COLUMNS settings
              MODIFY gd-elenco, DISPLAY-COLUMNS (1, 7, 15, 25, 34, 74, 
           84, 92)
           .

       form-elenco-PROC.
      * <TOTEM:EPT. FORM:form-elenco, FORM:form-elenco, BeforeAccept>
           evaluate tipo-doc
           when 1 move "ELENCO FATTURE"           to frame-titolo
           when 2 move "ELENCO CORRISPETTIVI"     to frame-titolo
           when 3 move "ELENCO NOTE CREDITO"      to frame-titolo
           when 4 move "ELENCO SCHEDE CLIENTI"    to frame-titolo
           when 5 move "ELENCO TUTTI I DOCUMENTI" to frame-titolo
           end-evaluate.
           display frame-documenti.

           call "W$MOUSE" using set-mouse-shape, wait-pointer. 
           set ElaboraDoc to true.
           perform SCR-ELABORA-OPEN-ROUTINE.
           call "W$MOUSE" using set-mouse-shape, arrow-pointer.
           
           if riga = 1
              display message "Nessun documento trovato"
                        title titolo
                         icon 2
              move 27 to key-status
           else
              modify gd-elenco, cursor-y 2
              modify gd-elenco(2), row-font Calibri14B-Occidentale
           end-if.

           .
      * <TOTEM:END>
           PERFORM UNTIL Exit-Pushed
              ACCEPT form-elenco
                 ON EXCEPTION
                    PERFORM form-elenco-Evaluate-Func
                 MOVE 2 TO TOTEM-Form-Index
              END-ACCEPT
      * <TOTEM:EPT. FORM:form-elenco, FORM:form-elenco, AfterEndAccept>
           if VediFattura
              modify form-elenco-Handle, visible false
              inquire gd-elenco(event-data-2, 1), hidden-data in 
           como-tipo-doc

              evaluate como-tipo-doc
              when 1 set vdocum-tipo-fattura to true
              when 2 set vdocum-tipo-corrisp to true
              when 3 set vdocum-tipo-nota    to true
              when 4 set vdocum-tipo-scheda  to true
              end-evaluate
              
              if como-tipo-doc < 4
                 inquire gd-elenco(event-data-2, 1), cell-data in 
           col-anno
                 inquire gd-elenco(event-data-2, 2), cell-data in 
           col-num
                 move col-num    to vdocum-numero
                 move col-anno   to vdocum-anno

                 call   "vdocum" using vdocum-linkage
                 cancel "vdocum"                  
              else
                 inquire gd-elenco(event-data-2, 2), cell-data in 
           col-num
                 move col-num    to vdocum-numero

                 call   "schedacli" using lk-blockpgm, vdocum-numero
                 cancel "schedacli"  
              end-if

              modify form-elenco-Handle, visible true

              perform SCR-ELABORA-OPEN-ROUTINE
              set VediFattura to false
           end-if

      * <TOTEM:END>
           END-PERFORM
      * <TOTEM:EPT. FORM:form-elenco, FORM:form-elenco, BeforeDestroyWindow>
      * <TOTEM:END>
           DESTROY form-elenco-Handle
           INITIALIZE Key-Status
           .

       form-elenco-Evaluate-Func.
      * <TOTEM:EPT. FORM:form-elenco, FORM:form-elenco, AfterAccept>
      * <TOTEM:END>
           EVALUATE TRUE
              WHEN Exit-Pushed
                 PERFORM form-elenco-Exit
              WHEN Event-Occurred
                 IF Event-Type = Cmd-Close
                    PERFORM form-elenco-Exit
                 END-IF
              WHEN Key-Status = 3
                 PERFORM pb-excel-LinkTo
           END-EVALUATE
      * avoid changing focus
           MOVE 4 TO Accept-Control
           .

       form-elenco-CLEAR.
           PERFORM form-elenco-INIT-VALUE
           PERFORM form-elenco-DISPLAY
           .

       form-elenco-DISPLAY.
      * <TOTEM:EPT. FORM:form-elenco, FORM:form-elenco, BeforeDisplay>
      * <TOTEM:END>
           DISPLAY form-elenco UPON form-elenco-Handle
      * <TOTEM:EPT. FORM:form-elenco, FORM:form-elenco, AfterDisplay>
           SET LK-BL-SCRITTURA     TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           MOVE FORM1-HANDLE       TO LK-HND-WIN.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           CANCEL "BLOCKPGM".

           .
      * <TOTEM:END>
           .

       form-elenco-Exit.
      * for main screen
      * <TOTEM:EPT. FORM:form-elenco, FORM:form-elenco, BeforeExit>
      * <TOTEM:END>
           MOVE 27 TO Key-Status
           .

       form-elenco-Init-Data.
           MOVE 2 TO TOTEM-Form-Index
           MOVE 0 TO TOTEM-Frame-Index
      * GRID
           PERFORM gd-elenco-Content
           .

       form-elenco-Init-Value.
      * <TOTEM:EPT. FORM:form-elenco, FORM:form-elenco, SetDefault>
      * <TOTEM:END>
           PERFORM form-elenco-FLD-TO-BUF
           .


       form-elenco-ALLGRID-RESET.
           .

      * for Form's Validation
       form-elenco-VALIDATION-ROUTINE.
           SET TOTEM-CHECK-OK TO TRUE
           .


       form-elenco-Buf-To-Fld.
      * <TOTEM:EPT. FORM:form-elenco, FORM:form-elenco, BeforeBufToFld>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:form-elenco, FORM:form-elenco, AfterBufToFld>
      * <TOTEM:END>
           .

       form-elenco-Fld-To-Buf.
      * <TOTEM:EPT. FORM:form-elenco, FORM:form-elenco, BeforeFldToBuf>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:form-elenco, FORM:form-elenco, AfterFldToBuf>
      * <TOTEM:END>
           .

       form-elenco-CONTROLLO-OLD.
           set SiSalvato to true.
           if mod = 0 exit paragraph end-if.
           perform form-elenco-BUF-TO-FLD.
           move 0 to scelta.
           .
       form-elenco-EXTENDED-FILE-STATUS.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
           MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           PERFORM form-elenco-SHOW-MSG-ROUTINE
           .

       form-elenco-SHOW-MSG-ROUTINE.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM form-elenco-DISPLAY-MESSAGE
           .

       form-elenco-DISPLAY-MESSAGE.
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

       form-elenco-Save-Status.
           .             

       form-elenco-Restore-Status.
           .

       scr-elabora-Open-Routine.
           PERFORM scr-elabora-Scrn
           PERFORM scr-elabora-Proc
           .

       scr-elabora-Scrn.
           PERFORM scr-elabora-Create-Win
           PERFORM scr-elabora-Init-Value
           PERFORM scr-elabora-Init-Data
      * Tab keystrok settings
      * Tool Bar
           PERFORM scr-elabora-DISPLAY
           .

       scr-elabora-Create-Win.
           Display Floating GRAPHICAL WINDOW
              LINES 2,39,
              SIZE 39,00,
              HEIGHT-IN-CELLS,
              WIDTH-IN-CELLS,
              COLOR 131115,
              CONTROL FONT Calibri14-Occidentale,
              LINK TO THREAD,
              NO SCROLL,
              USER-GRAY,
              USER-WHITE,
              No WRAP,
              EVENT PROCEDURE scr-elabora-Event-Proc,
              HANDLE IS scr-elabora-Handle,
      * <TOTEM:EPT. FORM:scr-elabora, FORM:scr-elabora, AfterCreateWin>
      * <TOTEM:END>


      * Tool Bar    
      * Status-bar
           DISPLAY scr-elabora UPON scr-elabora-Handle
      * DISPLAY-COLUMNS settings
           .

       scr-elabora-PROC.
      * <TOTEM:EPT. FORM:scr-elabora, FORM:scr-elabora, BeforeAccept>
           evaluate true
           when ElaboraDoc
                modify gd-elenco, reset-grid 1
                perform GD-ELENCO-CONTENT

                move 1 to riga
                evaluate tipo-doc
                when 1 perform SCORRI-FATTURE
                when 2 perform SCORRI-CORRISPETTIVI
                when 3 perform SCORRI-NOTE-CREDITO
                when 4 perform SCORRI-SCHEDE
                when 5 perform SCORRI-FATTURE
                       perform SCORRI-CORRISPETTIVI
                       perform SCORRI-NOTE-CREDITO
                       perform SCORRI-SCHEDE
                end-evaluate

           when ElaboraExcel
                initialize path-tmp-docum
                accept  path-tmp-docum from environment "PATH_CONTABILIT
      -    "A"
                if path-tmp-docum = spaces 
                   display message "IMPOSTARE IL PATH DI LAVORO PER LA C
      -    "ONTABILITA"
                end-if
                accept  como-data      from century-date
                accept  como-ora       from time
                inspect path-tmp-docum replacing trailing spaces by 
           low-value
                string  path-tmp-docum delimited low-value
                        "TMP-DOCUM_"   delimited size
                        como-data      delimited size
                        "_"            delimited size
                        como-ora       delimited size
                        into path-tmp-docum
                end-string
                set trovato to false
                open output tmp-docum
                inquire gd-elenco, last-row in tot-righe
                perform varying riga from 2 by 1 
                          until riga > tot-righe                   
                   inquire gd-elenco(riga, 1), hidden-data in 
           como-tipo-doc
                   evaluate como-tipo-doc
                   when 1 set tdoc-fattura to true
                          set trovato      to true
                          perform SCRIVI-RIGA
                   when 2 set tdoc-corrisp to true
                          set trovato      to true
                          perform SCRIVI-RIGA
                   when 3 set tdoc-notacr  to true
                          set trovato      to true
                          perform SCRIVI-RIGA
                   end-evaluate 
                end-perform
                close       tmp-docum
                if trovato
                   open input  tmp-docum
                   perform SCRIVI-CSV
                   close       tmp-docum
                else
                   display message "Nessun documento fiscale"
                             title titolo
                              icon 2
                end-if
                delete file tmp-docum

           when ElaboraEtichette   
                set prima-volta to true
                initialize wstampa
                accept  wstampa from environment "PATH_ST"
                if wstampa = spaces 
                   display message "IMPOSTARE IL PATH DI LAVORO PER LE S
      -    "TAMPE"
                end-if
                accept  como-data      from century-date
                accept  como-ora       from time
                inspect wstampa replacing trailing spaces by low-value
                string  wstampa       delimited low-value
                        "ETICHETTE_"  delimited size
                        como-data     delimited size
                        "_"           delimited size
                        como-ora      delimited size
                        ".txt"        delimited size
                        into wstampa
                end-string 
                move low-value to cli-chiave
                start clienti key >= cli-chiave
                      invalid continue
                  not invalid
                      perform until 1 = 2
                         read clienti next no lock at end exit perform 
           end-read
                         set trovato to false      
                         move cli-codice    to tfa-cliente
                         move ef-anno-e-buf to tfa-data-doc
                         move 0             to tfa-numero
                         start tfatture key >= tfa-k-cliente
                               invalid continue
                           not invalid
                               read tfatture next
                               if tfa-cliente = cli-codice and
                                  tfa-data-doc(1:4) = ef-anno-e-buf
                                  set trovato to true
                               end-if
                         end-start
                         if trovato
                            if prima-volta
                               set prima-volta to false
                               open output lineseq
                            end-if
                            inspect cli-ragsoc    replacing trailing 
           spaces by low-value
                            inspect cli-nome      replacing trailing 
           spaces by low-value
                            inspect cli-indirizzo replacing trailing 
           spaces by low-value
                            inspect cli-localita  replacing trailing 
           spaces by low-value
                            inspect cli-cap       replacing trailing 
           spaces by low-value
                            initialize line-riga
                            string cli-ragsoc delimited low-value
                                   " "        delimited size
                                   cli-nome   delimited low-value
                              into line-riga
                            end-string
                            write line-riga
                            move cli-indirizzo to line-riga
                            write line-riga
                            initialize line-riga
                            string cli-cap       delimited low-value
                                   " "           delimited size
                                   cli-localita  delimited low-value
                                   " "           delimited size
                                   cli-prov      delimited size
                              into line-riga
                            end-string
                            write line-riga            
                            write line-riga from spaces
                            write line-riga from spaces
                         end-if
                      end-perform
                end-start

                if not prima-volta
                   close lineseq
                   initialize comando
                   inspect wstampa replacing trailing spaces by 
           low-value
                   string "START "   delimited size
                         x"22222022" delimited size
                          wstampa    delimited low-value
                         x"22"       delimited size
                          into comando
                   end-string
                   call "C$SYSTEM" using comando, 64
                                  giving ReturnCode
                   if ReturnCode = -1
                      display message box "Comando fallito!"
                              title = tit-err
                              icon mb-error-icon
                   end-if
         
                end-if

           when ElaboraElenco   
                set prima-volta to true
                initialize wstampa
                accept  wstampa from environment "PATH_ST"
                if wstampa = spaces 
                   display message "IMPOSTARE IL PATH DI LAVORO PER LE S
      -    "TAMPE"
                end-if
                accept  como-data      from century-date
                accept  como-ora       from time
                evaluate rb-tipo
                when 1 move "Dich-730"  to tipo-elenco
                when 2 move "Mod-UNICO" to tipo-elenco
                when 3 move "730+UNICO" to tipo-elenco
                end-evaluate
                inspect tipo-elenco replacing trailing spaces by 
           low-value
                inspect wstampa replacing trailing spaces by low-value
                string  wstampa         delimited low-value
                        "ELENCO_"       delimited size
                        tipo-elenco     delimited low-value
                        "_"             delimited size
                        ef-anno-ele-buf delimited size
                        "___"           delimited size
                        como-data       delimited size
                        "_"             delimited size
                        como-ora        delimited size
                        ".csv"          delimited size
                        into wstampa
                end-string 
                move low-value to cli-chiave
                start clienti key >= cli-chiave
                      invalid continue
                  not invalid
                      perform until 1 = 2
                         read clienti next no lock at end exit perform 
           end-read
                         set trovato to false
                         if cli-dichiarazione-730-si
                            if rb-tipo = 1 or 3
                               move cli-codice      to tfa-cliente
                               move ef-anno-ele-buf to tfa-data-doc
                               move 0               to tfa-numero
                               start tfatture key >= tfa-k-cliente
                                     invalid continue
                                 not invalid
                                     perform until 1 = 2
                                        read tfatture next at end exit 
           perform end-read
                                        if tfa-cliente not = cli-codice
                                           exit perform
                                        end-if
                                        if tfa-data-doc(1:4) > 
           ef-anno-ele-buf
                                           exit perform
                                        end-if
                                        if tfa-cliente = cli-codice and
                                           tfa-data-doc(1:4) = 
           ef-anno-ele-buf
                                           set trovato to true
                                           exit perform
                                        end-if
                                     end-perform
                               end-start
                            end-if
                         end-if
                         if cli-unico-si
                            if rb-tipo = 2 or 3
                               move cli-codice      to tfa-cliente
                               move ef-anno-ele-buf to tfa-data-doc
                               move 0               to tfa-numero
                               start tfatture key >= tfa-k-cliente
                                     invalid continue
                                 not invalid
                                     perform until 1 = 2
                                        read tfatture next at end exit 
           perform end-read
                                        if tfa-cliente not = cli-codice
                                           exit perform
                                        end-if
                                        if tfa-data-doc(1:4) > 
           ef-anno-ele-buf
                                           exit perform
                                        end-if
                                        if tfa-cliente = cli-codice and
                                           tfa-data-doc(1:4) = 
           ef-anno-ele-buf
                                           set trovato to true
                                           exit perform
                                        end-if
                                     end-perform
                               end-start
                            end-if
                         end-if
                         if trovato
                            if prima-volta
                               set prima-volta to false
                               open output lineseq
                               string "Ragione Sociale/Cognome" 
           delimited size
                                      ";"           delimited size
                                      "Nome"        delimited size
                                      ";"           delimited size
                                      "Indirizzo"   delimited size
                                      ";"           delimited size
                                      "Località"    delimited size
                                      ";"           delimited size
                                      "CAP"         delimited size
                                      ";"           delimited size
                                      "Dich. 730"   delimited size
                                      ";"           delimited size
                                      "Mod. Unico"  delimited size
                                into line-riga 
                               end-string
                               write line-riga
                            end-if
                            if cli-dichiarazione-730-si
                               move "X" to como-730
                            else
                               move " " to como-730
                            end-if
                            if cli-unico-si
                               move "X" to como-unico
                            else
                               move " " to como-unico
                            end-if
                            string cli-ragsoc    delimited low-value
                                   ";"           delimited size
                                   cli-nome      delimited low-value
                                   ";"           delimited size
                                   cli-indirizzo delimited low-value
                                   ";"           delimited size
                                   cli-localita  delimited low-value
                                   ";"           delimited size
                                   cli-cap       delimited low-value
                                   ";"           delimited size
                                   como-730      delimited size
                                   ";"           delimited size
                                   como-unico    delimited size
                              into line-riga 
                            end-string
                            write line-riga
                         end-if
                      end-perform
                end-start

                if not prima-volta
                   close lineseq
                   initialize comando
                   inspect wstampa replacing trailing spaces by 
           low-value
                   string "START "   delimited size
                         x"22222022" delimited size
                          wstampa    delimited low-value
                         x"22"       delimited size
                          into comando
                   end-string
                   call "C$SYSTEM" using comando, 64
                                  giving ReturnCode
                   if ReturnCode = -1
                      display message box "Comando fallito!"
                              title = tit-err
                              icon mb-error-icon
                   end-if
         
                end-if
           end-evaluate.

           move 27 to key-status.

           .
      * <TOTEM:END>
           PERFORM UNTIL Exit-Pushed
              ACCEPT OMITTED LINE 1 COL 1
                 ON EXCEPTION
                    PERFORM scr-elabora-Evaluate-Func
                 MOVE 3 TO TOTEM-Form-Index
              END-ACCEPT
      * <TOTEM:EPT. FORM:scr-elabora, FORM:scr-elabora, AfterEndAccept>
      * <TOTEM:END>
           END-PERFORM
      * <TOTEM:EPT. FORM:scr-elabora, FORM:scr-elabora, BeforeDestroyWindow>
      * <TOTEM:END>
           DESTROY scr-elabora-Handle
           INITIALIZE Key-Status
           .

       scr-elabora-Evaluate-Func.
      * <TOTEM:EPT. FORM:scr-elabora, FORM:scr-elabora, AfterAccept>
      * <TOTEM:END>
           EVALUATE TRUE
              WHEN Exit-Pushed
                 PERFORM scr-elabora-Exit
              WHEN Event-Occurred
                 IF Event-Type = Cmd-Close
                    PERFORM scr-elabora-Exit
                 END-IF
           END-EVALUATE
      * avoid changing focus
           MOVE 4 TO Accept-Control
           .

       scr-elabora-CLEAR.
           PERFORM scr-elabora-INIT-VALUE
           PERFORM scr-elabora-DISPLAY
           .

       scr-elabora-DISPLAY.
      * <TOTEM:EPT. FORM:scr-elabora, FORM:scr-elabora, BeforeDisplay>
      * <TOTEM:END>
           DISPLAY scr-elabora UPON scr-elabora-Handle
      * <TOTEM:EPT. FORM:scr-elabora, FORM:scr-elabora, AfterDisplay>
           SET LK-BL-SCRITTURA     TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           MOVE FORM1-HANDLE       TO LK-HND-WIN.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           CANCEL "BLOCKPGM".

           .
      * <TOTEM:END>
           .

       scr-elabora-Exit.
      * for main screen
      * <TOTEM:EPT. FORM:scr-elabora, FORM:scr-elabora, BeforeExit>
      * <TOTEM:END>
           MOVE 27 TO Key-Status
           .

       scr-elabora-Init-Data.
           MOVE 3 TO TOTEM-Form-Index
           MOVE 0 TO TOTEM-Frame-Index
           .

       scr-elabora-Init-Value.
      * <TOTEM:EPT. FORM:scr-elabora, FORM:scr-elabora, SetDefault>
      * <TOTEM:END>
           PERFORM scr-elabora-FLD-TO-BUF
           .


       scr-elabora-ALLGRID-RESET.
           .

      * for Form's Validation
       scr-elabora-VALIDATION-ROUTINE.
           SET TOTEM-CHECK-OK TO TRUE
           .


       scr-elabora-Buf-To-Fld.
      * <TOTEM:EPT. FORM:scr-elabora, FORM:scr-elabora, BeforeBufToFld>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:scr-elabora, FORM:scr-elabora, AfterBufToFld>
      * <TOTEM:END>
           .

       scr-elabora-Fld-To-Buf.
      * <TOTEM:EPT. FORM:scr-elabora, FORM:scr-elabora, BeforeFldToBuf>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:scr-elabora, FORM:scr-elabora, AfterFldToBuf>
      * <TOTEM:END>
           .

       scr-elabora-CONTROLLO-OLD.
           set SiSalvato to true.
           if mod = 0 exit paragraph end-if.
           perform scr-elabora-BUF-TO-FLD.
           move 0 to scelta.
           .
       scr-elabora-EXTENDED-FILE-STATUS.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
           MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           PERFORM scr-elabora-SHOW-MSG-ROUTINE
           .

       scr-elabora-SHOW-MSG-ROUTINE.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM scr-elabora-DISPLAY-MESSAGE
           .

       scr-elabora-DISPLAY-MESSAGE.
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

       scr-elabora-Save-Status.
           .             

       scr-elabora-Restore-Status.
           .



       Screen1-Event-Proc.
           .

       form-elenco-Event-Proc.
           .

       form-elenc-Gd-1-Event-Proc.
           EVALUATE Event-Type ALSO Event-Control-Id ALSO
                                    Event-Window-Handle
           WHEN Msg-Begin-Drag ALSO 1 ALSO
                    form-elenco-Handle 
              PERFORM gd-elenco-Ev-Msg-Begin-Drag
           WHEN Msg-Begin-Entry ALSO 1 ALSO
                    form-elenco-Handle 
              PERFORM gd-elenco-Ev-Msg-Begin-Entry
           WHEN Msg-End-Drag ALSO 1 ALSO
                    form-elenco-Handle 
              PERFORM gd-elenco-Ev-Msg-End-Drag
           WHEN Msg-Goto-Cell ALSO 1 ALSO
                    form-elenco-Handle 
              PERFORM gd-elenco-Ev-Msg-Goto-Cell
           WHEN Msg-Goto-Cell-Drag ALSO 1 ALSO
                    form-elenco-Handle 
              PERFORM gd-elenco-Ev-Msg-Goto-Cell-Drag
           WHEN Msg-Goto-Cell-Mouse ALSO 1 ALSO
                    form-elenco-Handle 
              PERFORM gd-elenco-Ev-Msg-Goto-Cell-Mouse
           END-EVALUATE
           .

       scr-elabora-Event-Proc.
           .

      * USER DEFINE PARAGRAPH
       CHIAMA-DOCUMENTO.
      * <TOTEM:PARA. CHIAMA-DOCUMENTO>
           evaluate tipo-doc
           when 1 set vdocum-tipo-fattura to true
           when 2 set vdocum-tipo-corrisp to true
           when 3 set vdocum-tipo-nota    to true
           when 4 set vdocum-tipo-scheda  to true
           end-evaluate.

           if tipo-doc < 4
              move ef-anno-s-buf   to vdocum-anno
              move ef-numero-s-buf to vdocum-numero

              call   "vdocum" using vdocum-linkage
              cancel "vdocum"
           end-if 
           .
      * <TOTEM:END>

       CONTROLLO.
      * <TOTEM:PARA. CONTROLLO>
           set tutto-ok to true.
           evaluate control-id
           when 78-ID-ef-cliente
                inquire ef-cliente, value in cli-codice
                if cli-codice = spaces
                   move "TUTTI I CLIENTI" to lab-cliente-buf
                else
                   read clienti no lock
                        invalid
                        set errori to true
                        display message "Cliente non valido"
                                  title tit-err
                                   icon 2
                        move spaces to lab-cliente-buf
                    not invalid
                        initialize lab-cliente-buf
                        inspect cli-ragsoc replacing trailing spaces by 
           low-value
                        string  cli-ragsoc delimited low-value
                                " "        delimited size
                                cli-nome   delimited size
                           into lab-cliente-buf
                        end-string
                   end-read
                end-if
                display lab-cliente

           when 78-ID-ef-tipo
                inquire ef-tipo, value in tcl-codice
                if tcl-codice = spaces
                   move "TUTTE LE TIPOLOGIE" to lab-tipo-buf
                else
                   read tipocli no lock
                        invalid
                        set errori to true
                        display message "Tipologia non valida"
                                  title tit-err
                                   icon 2
                        move spaces to lab-tipo-buf
                    not invalid
                        move tcl-descrizione to lab-tipo-buf
                   end-read
                end-if
                display lab-tipo

           when 78-ID-ef-num-al
                inquire ef-num-dal, value in numero-dal
                inquire ef-num-al,  value in numero-al
                if numero-al = 0
                   move 999999 to ef-num-al-buf numero-al
                   display ef-num-al
                end-if
                if numero-al < numero-dal
                   display message "Numerazione errata"
                             title tit-err
                              icon 2
                   set errori to true
                   move 78-ID-ef-num-dal to control-id
                end-if

           when 78-ID-ef-data-dal
                inquire ef-data-dal, value in ef-data-dal-buf
                move ef-data-dal-buf to como-data
                if como-data not = 0
                   perform DATE-FORMAT
                   move como-data to ef-data-dal-buf
                   display ef-data-dal
                end-if

           when 78-ID-ef-data-al
                inquire ef-data-dal, value in ef-data-dal-buf
                inquire ef-data-al,  value in ef-data-al-buf
                move ef-data-al-buf to como-data
                if como-data = 0 or
                   como-data = 99999999
                   move 99999999 to ef-data-al-buf
                else
                   perform DATE-FORMAT
                   move como-data to ef-data-al-buf
                end-if
                display ef-data-al

                move ef-data-dal-buf to como-data
                perform DATE-TO-FILE
                move como-data to data-dal

                move ef-data-al-buf to como-data
                perform DATE-TO-FILE
                move como-data to data-al

                if data-al < data-dal
                   display message "Periodo errato"
                             title tit-err
                              icon 2
                   set errori to true
                   move 78-ID-ef-data-dal to control-id
                end-if

           end-evaluate.

           if errori
              perform CANCELLA-COLORE
              move 4 to accept-control
           end-if 
           .
      * <TOTEM:END>

       PARAGRAFO-COPY.
      * <TOTEM:PARA. PARAGRAFO-COPY>
           copy "utydata.cpy".
           copy "color-custom.cpy" 
           .
      * <TOTEM:END>

       SCELTA-DOC.
      * <TOTEM:PARA. SCELTA-DOC>
           move 1 to e-singolo.
           evaluate tipo-doc
           when 1 |FATTURE
                modify rb-fatture, bitmap-number = 6
                modify rb-corrisp, bitmap-number = 1
                modify rb-schede,  bitmap-number = 3
                modify rb-note,    bitmap-number = 7
                modify rb-tutti,   bitmap-number = 9
           when 2 |CORRISPETTIVI
                modify rb-fatture, bitmap-number = 5
                modify rb-corrisp, bitmap-number = 2
                modify rb-schede,  bitmap-number = 3
                modify rb-tutti,   bitmap-number = 9
                modify rb-note,    bitmap-number = 7
           when 3 |NOTE CREDITO
                modify rb-fatture, bitmap-number = 5
                modify rb-corrisp, bitmap-number = 1
                modify rb-schede,  bitmap-number = 3
                modify rb-tutti,   bitmap-number = 9
                modify rb-note,    bitmap-number = 8
           when 4 |SCHEDE
                modify rb-fatture, bitmap-number = 5
                modify rb-corrisp, bitmap-number = 1
                modify rb-schede,  bitmap-number = 4
                modify rb-tutti,   bitmap-number = 9
                modify rb-note,    bitmap-number = 7
                move 0 to e-singolo    
                perform CANCELLA-COLORE
           when 5 |TUTTI
                modify rb-fatture, bitmap-number = 5
                modify rb-corrisp, bitmap-number = 1
                modify rb-schede,  bitmap-number = 3
                modify rb-tutti,   bitmap-number = 10
                modify rb-note,    bitmap-number = 7
                move 0 to e-singolo     
                perform CANCELLA-COLORE
           end-evaluate.

           modify ef-anno-s,   enabled e-singolo.
           modify ef-numero-s, enabled e-singolo.
           modify pb-singola,  enabled e-singolo  
           .
      * <TOTEM:END>

       SCORRIMENTO-DOCUMENTI.
      * <TOTEM:PARA. SCORRIMENTO-DOCUMENTI>
      ***---
       SCORRI-FATTURE.
           move low-value to tfa-rec.
           move data-dal  to tfa-data-doc.
           start tfatture key >= tfa-k-data
                 invalid continue
             not invalid
                 perform until 1 = 2
                    read tfatture next at end exit perform end-read
                    set record-ok to true
                    if tfa-data-doc > data-al
                       exit perform
                    end-if
                    if tfa-numero < numero-dal or
                       tfa-numero > numero-al
                       set record-ok to false
                    end-if
                    if tfa-cliente    not = ef-cliente-buf and
                       ef-cliente-buf not = spaces
                       set record-ok to false
                    end-if
                    if ef-tipo-buf not = spaces
                       move tfa-cliente to cli-codice
                       read clienti no lock
                            invalid move spaces to cli-tipologia
                       end-read
                       if cli-tipologia not = ef-tipo-buf
                          set record-ok to false
                       end-if
                    end-if
                    if record-ok           
                       add 1             to riga
                       move tfa-anno     to col-anno
                       move tfa-numero   to col-num
                       move tfa-data-doc to como-data
                       perform DATE-TO-SCREEN
                       move como-data    to col-data
                       move tfa-cliente  to cli-codice col-cliente
                       read clienti no lock
                            invalid
                            move "*** NON TROVATO ***" to col-des
                        not invalid
                            initialize col-des
                            inspect cli-ragsoc replacing trailing 
           spaces by low-value
                            string  cli-ragsoc delimited low-value
                                    " "        delimited size
                                    cli-nome   delimited size
                               into col-des
                            end-string
                       end-read
                       move tfa-importo-sub  to col-sub
                       move tfa-importo-iva  to col-iva
                       move tfa-importo-tot  to col-tot
                       modify gd-elenco(riga, 1), hidden-data 1
                       modify gd-elenco(riga, 1), cell-data col-anno
                       modify gd-elenco(riga, 2), cell-data col-num
                       modify gd-elenco(riga, 3), cell-data col-data
                       modify gd-elenco(riga, 4), cell-data col-cliente
                       modify gd-elenco(riga, 5), cell-data col-des
                       modify gd-elenco(riga, 6), cell-data col-sub
                       modify gd-elenco(riga, 7), cell-data col-iva
                       modify gd-elenco(riga, 8), cell-data col-tot
                       modify gd-elenco(riga),    row-color = 481     
                    end-if
                 end-perform
           end-start.

      ***---
       SCORRI-CORRISPETTIVI.
           move low-value to tco-rec.
           move data-dal  to tco-data-doc.
           start tcorrisp key >= tco-k-data
                 invalid continue
             not invalid
                 perform until 1 = 2
                    read tcorrisp next at end exit perform end-read
                    set record-ok to true
                    if tco-data-doc > data-al
                       exit perform
                    end-if
                    if tco-numero < numero-dal or
                       tco-numero > numero-al
                       set record-ok to false
                    end-if
                    if tco-cliente    not = ef-cliente-buf and
                       ef-cliente-buf not = spaces
                       set record-ok to false
                    end-if
                    if ef-tipo-buf not = spaces
                       move tco-cliente to cli-codice
                       read clienti no lock
                            invalid move spaces to cli-tipologia
                       end-read
                       if cli-tipologia not = ef-tipo-buf
                          set record-ok to false
                       end-if
                    end-if
                    if record-ok       
                       add 1             to riga
                       move tco-anno     to col-anno
                       move tco-numero   to col-num
                       move tco-data-doc to como-data
                       perform DATE-TO-SCREEN
                       move como-data    to col-data
                       move tco-cliente  to cli-codice col-cliente
                       read clienti no lock
                            invalid
                            move "*** NON TROVATO ***" to col-des
                       not invalid
                           initialize col-des
                           inspect cli-ragsoc replacing trailing spaces 
           by low-value
                           string  cli-ragsoc delimited low-value
                                   " "        delimited size
                                   cli-nome   delimited size
                              into col-des
                           end-string
                       end-read
                       move tco-importo-sub  to col-sub
                       move tco-importo-iva  to col-iva
                       move tco-importo-tot  to col-tot
                       modify gd-elenco(riga, 1), hidden-data 2
                       modify gd-elenco(riga, 1), cell-data col-anno
                       modify gd-elenco(riga, 2), cell-data col-num
                       modify gd-elenco(riga, 3), cell-data col-data
                       modify gd-elenco(riga, 4), cell-data col-cliente
                       modify gd-elenco(riga, 5), cell-data col-des
                       modify gd-elenco(riga, 6), cell-data col-sub
                       modify gd-elenco(riga, 7), cell-data col-iva
                       modify gd-elenco(riga, 8), cell-data col-tot
                       modify gd-elenco(riga),    row-color = 193
                    end-if
                 end-perform
           end-start.

      ***---
       SCORRI-NOTE-CREDITO.
           move low-value to tno-rec.
           move data-dal  to tno-data-doc.
           start tnotacr key >= tno-k-data
                 invalid continue
             not invalid
                 perform until 1 = 2
                    read tnotacr next at end exit perform end-read
                    set record-ok to true
                    if tno-data-doc > data-al
                       exit perform
                    end-if
                    if tno-numero < numero-dal or
                       tno-numero > numero-al
                       set record-ok to false
                    end-if
                    if tno-cliente    not = ef-cliente-buf and
                       ef-cliente-buf not = spaces
                       set record-ok to false
                    end-if
                    if ef-tipo-buf not = spaces
                       move tno-cliente to cli-codice
                       read clienti no lock
                            invalid move spaces to cli-tipologia
                       end-read
                       if cli-tipologia not = ef-tipo-buf
                          set record-ok to false
                       end-if
                    end-if
                    if record-ok       
                       add 1             to riga
                       move tno-anno     to col-anno
                       move tno-numero   to col-num
                       move tno-data-doc to como-data
                       perform DATE-TO-SCREEN
                       move como-data    to col-data
                       move tno-cliente  to cli-codice col-cliente
                       read clienti no lock
                            invalid
                            move "*** NON TROVATO ***" to col-des
                       not invalid
                           initialize col-des
                           inspect cli-ragsoc replacing trailing spaces 
           by low-value
                           string  cli-ragsoc delimited low-value
                                   " "        delimited size
                                   cli-nome   delimited size
                              into col-des
                           end-string
                       end-read
                       move tno-importo-sub  to col-sub
                       move tno-importo-iva  to col-iva
                       move tno-importo-tot  to col-tot
                       modify gd-elenco(riga, 1), hidden-data 3
                       modify gd-elenco(riga, 1), cell-data col-anno
                       modify gd-elenco(riga, 2), cell-data col-num
                       modify gd-elenco(riga, 3), cell-data col-data
                       modify gd-elenco(riga, 4), cell-data col-cliente
                       modify gd-elenco(riga, 5), cell-data col-des
                       modify gd-elenco(riga, 6), cell-data col-sub
                       modify gd-elenco(riga, 7), cell-data col-iva
                       modify gd-elenco(riga, 8), cell-data col-tot
                       modify gd-elenco(riga),    row-color = 385
                    end-if
                 end-perform
           end-start.

      ***---
       SCORRI-SCHEDE.
           move low-value to tsc-rec.
      *****     move data-dal  to tsc-data-creazione.
           move low-value to tsc-data-creazione.
           start tschede key >= tsc-k-data
                 invalid continue
             not invalid
                 perform until 1 = 2
                    read tschede next at end exit perform end-read
                    set record-ok to true
      *****              if tsc-data-creazione > data-al
      *****                 exit perform
      *****              end-if
                    if tsc-codice < numero-dal or
                       tsc-codice > numero-al
                       set record-ok to false
                    end-if
                    if tsc-cliente    not = ef-cliente-buf and
                       ef-cliente-buf not = spaces
                       set record-ok to false
                    end-if
                    if ef-tipo-buf not = spaces
                       move tsc-cliente to cli-codice
                       read clienti no lock
                            invalid move spaces to cli-tipologia
                       end-read
                       if cli-tipologia not = ef-tipo-buf
                          set record-ok to false
                       end-if
                    end-if
                    if record-ok
                       set record-ok to false
                       move low-value  to rsc-rec
                       move tsc-codice to rsc-codice
                       start rschede key >= rsc-chiave
                             invalid continue
                         not invalid
                             perform until 1 = 2
                                read rschede next 
                                     at end exit perform 
                                end-read
                                if rsc-codice not = tsc-codice
                                   exit perform
                                end-if
                                if rsc-numfat  = 0 and
                                   rsc-datafat = 0 and
                                   rsc-numcor  = 0 and
                                   rsc-datacor = 0
                                   if rsc-data >= data-dal and
                                      rsc-data <= data-al
                                      set record-ok to true
                                      exit perform
                                   end-if
                                end-if
                             end-perform
                       end-start
                    end-if
                    if record-ok       
                       add 1             to riga
                       move tsc-data-creazione(1:4) to col-anno
                       move tsc-codice   to col-num
                       move tsc-data-creazione to como-data
                       perform DATE-TO-SCREEN
                       move como-data    to col-data
                       move tsc-cliente  to cli-codice col-cliente
                       read clienti no lock
                            invalid
                            move "*** NON TROVATO ***" to col-des
                       not invalid
                           initialize col-des
                           inspect cli-ragsoc replacing trailing spaces 
           by low-value
                           string  cli-ragsoc delimited low-value
                                   " "        delimited size
                                   cli-nome   delimited size
                              into col-des
                           end-string
                       end-read
                       move 0 to col-sub
                       move 0 to col-iva
                       move 0 to col-tot
                       modify gd-elenco(riga, 1), hidden-data 4
                       modify gd-elenco(riga, 1), cell-data col-anno
                       modify gd-elenco(riga, 2), cell-data col-num
                       modify gd-elenco(riga, 3), cell-data col-data
                       modify gd-elenco(riga, 4), cell-data col-cliente
                       modify gd-elenco(riga, 5), cell-data col-des
                       modify gd-elenco(riga, 6), cell-data col-sub
                       modify gd-elenco(riga, 7), cell-data col-iva
                       modify gd-elenco(riga, 8), cell-data col-tot
                       modify gd-elenco(riga),    row-color = 353
                    end-if
                 end-perform
           end-start 
           .
      * <TOTEM:END>

       SCRIVI-CSV.
      * <TOTEM:PARA. SCRIVI-CSV>
           move 0 to save-data.  
           move 0 to tot-importo tot-tot-importo.
           move 0 to tot-iva     tot-tot-iva.
           move 0 to tot-totale  tot-tot-totale.
           initialize wstampa.
           accept  wstampa        from environment "PATH_CONTABILITA".
           accept  como-data      from century-date.
           accept  como-ora       from time.
           inspect wstampa replacing trailing spaces by low-value.
           string  wstampa                delimited low-value
                   "RIEPOLOGO_DOCUMENTI_CREATO_IL"  delimited size
                   como-data    delimited size
                   "_ALLE_"     delimited size
                   como-ora     delimited size
                   ".csv"       delimited size
                   into wstampa
           end-string.
           open output lineseq.
           write line-riga from spaces.
           string separatore delimited size
                  separatore delimited size     
                  separatore delimited size
                  "DOCUMENTI FISCALI DAL " delimited size
                  ef-data-dal-buf          delimited size
                  " AL "                   delimited size
                  ef-data-al-buf           delimited size
                  into line-riga
           end-string.
           write line-riga.
           write line-riga from spaces.
           string "Num."       delimited size
                  separatore   delimited size
                  "Documento"  delimited size
                  separatore   delimited size
                  "Data"       delimited size
                  separatore   delimited size
                  "Cliente"    delimited size
                  separatore   delimited size
                  "Imponibile" delimited size
                  separatore   delimited size
                  "IVA"        delimited size
                  separatore   delimited size
                  "Totale"     delimited size
                  into line-riga
           end-string.                 
           write line-riga.
           write line-riga from spaces.

           move low-value to tdoc-rec.
           start tmp-docum key >= tdoc-chiave
                 invalid continue
             not invalid
                 perform until 1 = 2
                    read tmp-docum next at end exit perform end-read
                    if save-data = 0
                       move tdoc-data to save-data
                    end-if
                    if save-data not = tdoc-data
                       perform TOTALE-DATA
                    end-if
                    add tdoc-importo to tot-importo tot-tot-importo
                    add tdoc-iva     to tot-iva     tot-tot-iva
                    add tdoc-totale  to tot-totale  tot-tot-totale
                    move tdoc-data   to como-data
                    perform DATE-TO-SCREEN
                    move como-data    to r-data
                    move tdoc-numero  to r-numero
                    move tdoc-importo to r-importo
                    move tdoc-iva     to r-iva
                    move tdoc-totale  to r-totale
                    string r-numero     delimited size
                           separatore   delimited size
                           tdoc-tipo    delimited size
                           separatore   delimited size
                           r-data       delimited size
                           separatore   delimited size
                           tdoc-cliente delimited size
                           separatore   delimited size
                           r-importo    delimited size
                           separatore   delimited size
                           r-iva        delimited size
                           separatore   delimited size
                           r-totale     delimited size
                      into line-riga
                    end-string
                    write line-riga
                 end-perform     
                 perform TOTALE-DATA
                 move tot-tot-importo to r-importo
                 move tot-tot-iva     to r-iva
                 move tot-tot-totale  to r-totale
                 initialize line-riga
                 string separatore   delimited size
                        separatore   delimited size
                        separatore   delimited size
                        "TOTALE DOCUMENTI"  delimited size
                        separatore   delimited size
                        r-importo    delimited size
                        separatore   delimited size
                        r-iva        delimited size
                        separatore   delimited size
                        r-totale     delimited size
                   into line-riga
                 end-string
                 write line-riga
           end-start.
                                            
           close lineseq.
           initialize cmd-lancio.
           inspect wstampa
                   replacing trailing spaces by low-value
           string "START "      delimited size
                 x"22222022"    delimited size
                   wstampa      delimited low-value
                 x"22"          delimited size
                 into cmd-lancio
           end-string.
           call "C$SYSTEM" using cmd-lancio, 225.

      ***---
       TOTALE-DATA.
           move save-data to como-data.
           perform DATE-TO-SCREEN.
           move como-data   to r-data.
           move tot-importo to r-importo.
           move tot-iva     to r-iva.
           move tot-totale  to r-totale.
           initialize line-riga.
           string separatore    delimited size
                  separatore    delimited size
                  separatore    delimited size
                  "TOTALE DEL " delimited size
                  r-data        delimited size
                  separatore    delimited size
                  r-importo     delimited size
                  separatore    delimited size
                  r-iva         delimited size
                  separatore    delimited size
                  r-totale      delimited size
             into line-riga
           end-string.
           write line-riga.
           write line-riga from spaces.
           move tdoc-data to save-data.
           move 0 to tot-importo tot-iva tot-totale 
           .
      * <TOTEM:END>

       SCRIVI-RIGA.
      * <TOTEM:PARA. SCRIVI-RIGA>
           inquire gd-elenco(riga, 2), cell-data in col-num.
           inquire gd-elenco(riga, 3), cell-data in col-data.
           inquire gd-elenco(riga, 5), cell-data in col-des.
           inquire gd-elenco(riga, 6), cell-data in col-sub.
           inquire gd-elenco(riga, 7), cell-data in col-iva.
           inquire gd-elenco(riga, 8), cell-data in col-tot.
           move col-num   to tdoc-numero.
           move col-data  to como-data.
           perform DATE-TO-FILE.
           move como-data to tdoc-data.
           move col-des   to tdoc-cliente.
           move col-sub   to tdoc-importo.
           move col-iva   to tdoc-iva.
           move col-tot   to tdoc-totale. 
           if tdoc-notacr
              compute tdoc-importo = tdoc-importo * -1
              compute tdoc-iva     = tdoc-iva     * -1
              compute tdoc-totale  = tdoc-totale  * -1
           end-if.
           write tdoc-rec 
           .
      * <TOTEM:END>

       SPOSTAMENTO.
      * <TOTEM:PARA. SPOSTAMENTO>
           inquire gd-elenco, last-row in tot-righe.
           if event-data-2 < 2
              move 2 to event-data-2
           end-if.
           if event-data-2 > tot-righe
              move tot-righe to event-data-2
           end-if.
           inquire gd-elenco, cursor-y in riga.
           modify  gd-elenco(riga),         row-font 
           Calibri14-Occidentale.
           modify  gd-elenco(event-data-2), row-font 
           Calibri14B-Occidentale 
           .
      * <TOTEM:END>

      * EVENT PARAGRAPH
       docum-Ev-Before-Program.
      * <TOTEM:PARA. docum-Ev-Before-Program>
           move LK-BL-PROG-ID    TO COMO-PROG-ID 
           .
      * <TOTEM:END>
       docum-Ev-After-Program.
      * <TOTEM:PARA. docum-Ev-After-Program>
           SET LK-BL-CANCELLAZIONE TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM 
           .
      * <TOTEM:END>
       Screen1-Rb-1-BeforeProcedure.
      * <TOTEM:PARA. Screen1-Rb-1-BeforeProcedure>
           modify control-handle, color = colore-nu
           .
      * <TOTEM:END>
       Screen1-Rb-1-AfterProcedure.
      * <TOTEM:PARA. Screen1-Rb-1-AfterProcedure>
           modify control-handle, color = colore-or
           .
      * <TOTEM:END>
       rb-fatture-LinkTo.
      * <TOTEM:PARA. rb-fatture-LinkTo>
           perform SCELTA-DOC    
           .
      * <TOTEM:END>
       rb-corrisp-LinkTo.
      * <TOTEM:PARA. rb-corrisp-LinkTo>
           perform SCELTA-DOC    
           .
      * <TOTEM:END>
       rb-note-LinkTo.
      * <TOTEM:PARA. rb-note-LinkTo>
           perform SCELTA-DOC    
           .
      * <TOTEM:END>
       rb-tutti-LinkTo.
      * <TOTEM:PARA. rb-tutti-LinkTo>
           perform SCELTA-DOC    
           .
      * <TOTEM:END>
       pb-cerca-cli-LinkTo.
      * <TOTEM:PARA. pb-cerca-cli-LinkTo>
           inquire ef-cliente, value in cli-codice
           move "clienti-alfa" to como-file
           call "zoom-gt"   using como-file, cli-rec
                           giving stato-zoom
           cancel "zoom-gt"
           if stato-zoom = 0
              move cli-codice to ef-cliente-buf
              inspect cli-ragsoc replacing trailing spaces by low-value
              string  cli-ragsoc delimited low-value
                      " "        delimited size
                      cli-nome   delimited size
                 into lab-cliente-buf
              end-string
              display ef-cliente lab-cliente
           end-if 
           .
      * <TOTEM:END>
       pb-singola-LinkTo.
      * <TOTEM:PARA. pb-singola-LinkTo>
           set tutto-ok to true.
           evaluate tipo-doc
           when 1
                inquire ef-anno-s,   value tfa-anno
                inquire ef-numero-s, value tfa-numero
                read tfatture no lock
                     invalid
                     set errori to true
                     display message "Fattura non valida"
                               title tit-err
                                icon 2
                end-read
           when 2
                inquire ef-anno-s,   value tco-anno
                inquire ef-numero-s, value tco-numero
                read tcorrisp no lock
                     invalid
                     set errori to true
                     display message "Corrispettivo non valido"
                               title tit-err
                                icon 2
                end-read
           when 3
                inquire ef-anno-s,   value tno-anno
                inquire ef-numero-s, value tno-numero
                read tnotacr no lock
                     invalid
                     set errori to true
                     display message "Nota Credito non valida"
                               title tit-err
                                icon 2
                end-read
           when 4
                set errori to true
                display message "Possibile solo su documenti fiscali"
                          title tit-err
                           icon 2
           when 5
                set errori to true
                display message "Selezionare un documento specifico"
                          title tit-err
                           icon 2
           end-evaluate.

           if tutto-ok
              perform CHIAMA-DOCUMENTO
           else
              perform CANCELLA-COLORE
              move 78-ID-ef-anno-s to control-id
              move 4               to accept-control
           end-if 
           .
      * <TOTEM:END>
       ef-cliente-BeforeProcedure.
      * <TOTEM:PARA. ef-cliente-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-tipo-BeforeProcedure.
      * <TOTEM:PARA. ef-tipo-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-num-dal-BeforeProcedure.
      * <TOTEM:PARA. ef-num-dal-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-num-al-BeforeProcedure.
      * <TOTEM:PARA. ef-num-al-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-data-dal-BeforeProcedure.
      * <TOTEM:PARA. ef-data-dal-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-data-al-BeforeProcedure.
      * <TOTEM:PARA. ef-data-al-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-cliente-AfterProcedure.
      * <TOTEM:PARA. ef-cliente-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO 
           .
      * <TOTEM:END>
       ef-tipo-AfterProcedure.
      * <TOTEM:PARA. ef-tipo-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO 
           .
      * <TOTEM:END>
       ef-num-dal-AfterProcedure.
      * <TOTEM:PARA. ef-num-dal-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       ef-num-al-AfterProcedure.
      * <TOTEM:PARA. ef-num-al-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO 
           .
      * <TOTEM:END>
       ef-data-dal-AfterProcedure.
      * <TOTEM:PARA. ef-data-dal-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO 
           .
      * <TOTEM:END>
       ef-data-al-AfterProcedure.
      * <TOTEM:PARA. ef-data-al-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO 
           .
      * <TOTEM:END>
       ef-anno-s-BeforeProcedure.
      * <TOTEM:PARA. ef-anno-s-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-numero-s-BeforeProcedure.
      * <TOTEM:PARA. ef-numero-s-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-anno-s-AfterProcedure.
      * <TOTEM:PARA. ef-anno-s-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       ef-numero-s-AfterProcedure.
      * <TOTEM:PARA. ef-numero-s-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       pb-vedi-LinkTo.
      * <TOTEM:PARA. pb-vedi-LinkTo>
           set tutto-ok to true.
           perform varying control-id from 78-ID-ef-cliente by 1
                     until control-id > 78-ID-ef-data-al
              perform CONTROLLO
              if errori
                 exit perform
              end-if
           end-perform.

           if tutto-ok
              if ef-cliente-buf not = spaces and
                 ef-tipo-buf    not = spaces
                 display message "Selezionare cliente O tipologia"
                           title tit-err
                            icon 2
                 set errori to true
                 move 78-ID-ef-cliente to control-id
              end-if
           end-if.

           if tutto-ok
              perform CANCELLA-COLORE
              modify form1-handle, visible false
              perform FORM-ELENCO-OPEN-ROUTINE
              modify form1-handle, visible true
              move 78-ID-ef-anno-s to control-id
              move 4 to accept-control
           else
              perform CANCELLA-COLORE
              move 4 to accept-control
           end-if 
           .
      * <TOTEM:END>
       pb-cerca-tipo-LinkTo.
      * <TOTEM:PARA. pb-cerca-tipo-LinkTo>
           inquire ef-tipo, value in tcl-codice
           move "tipocli-alfa" to como-file
           call "zoom-gt"   using como-file, tcl-rec
                           giving stato-zoom
           cancel "zoom-gt"
           if stato-zoom = 0
              move tcl-codice      to ef-tipo-buf
              move tcl-descrizione to lab-tipo-buf
              display ef-tipo lab-tipo
           end-if 
           .
      * <TOTEM:END>
       gd-elenco-Ev-Msg-Begin-Entry.
      * <TOTEM:PARA. gd-elenco-Ev-Msg-Begin-Entry>
           set event-action to event-action-fail-terminate.
           inquire gd-elenco, entry-reason in como-x
           evaluate como-x
           when X"00"|doppio click
           when X"0D"|invio
                set VediFattura to true
           end-evaluate 
           .
      * <TOTEM:END>
       gd-elenco-Ev-Msg-Begin-Drag.
      * <TOTEM:PARA. gd-elenco-Ev-Msg-Begin-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       gd-elenco-Ev-Msg-End-Drag.
      * <TOTEM:PARA. gd-elenco-Ev-Msg-End-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       gd-elenco-Ev-Msg-Goto-Cell.
      * <TOTEM:PARA. gd-elenco-Ev-Msg-Goto-Cell>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       gd-elenco-Ev-Msg-Goto-Cell-Drag.
      * <TOTEM:PARA. gd-elenco-Ev-Msg-Goto-Cell-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       gd-elenco-Ev-Msg-Goto-Cell-Mouse.
      * <TOTEM:PARA. gd-elenco-Ev-Msg-Goto-Cell-Mouse>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       pb-excel-LinkTo.
      * <TOTEM:PARA. pb-excel-LinkTo>
           call "W$MOUSE" using set-mouse-shape, wait-pointer. 
           set ElaboraExcel to true.
           perform SCR-ELABORA-OPEN-ROUTINE.
           call "W$MOUSE" using set-mouse-shape, arrow-pointer 
           .
      * <TOTEM:END>
       pb-etichetta-LinkTo.
      * <TOTEM:PARA. pb-etichetta-LinkTo>
           set tutto-ok to true.

           inquire ef-anno-e,   value ef-anno-e-buf.
           if ef-anno-e-buf = 0
              set errori to true
              display message "Indicare un anno"
                        title tit-err
                         icon 2
           end-if.

           if tutto-ok
              call "W$MOUSE" using set-mouse-shape, wait-pointer
              set ElaboraEtichette to true
              perform SCR-ELABORA-OPEN-ROUTINE
              call "W$MOUSE" using set-mouse-shape, arrow-pointer
           else
              perform CANCELLA-COLORE
              move 78-ID-ef-anno-e to control-id
              move 4               to accept-control
           end-if 
           .
      * <TOTEM:END>
       ef-anno-e-BeforeProcedure.
      * <TOTEM:PARA. ef-anno-e-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-anno-e-AfterProcedure.
      * <TOTEM:PARA. ef-anno-e-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       ef-anno-ele-BeforeProcedure.
      * <TOTEM:PARA. ef-anno-ele-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-anno-ele-AfterProcedure.
      * <TOTEM:PARA. ef-anno-ele-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       pb-ele-U-LinkTo.
      * <TOTEM:PARA. pb-ele-U-LinkTo>
           set tutto-ok to true.

           inquire ef-anno-ele,   value ef-anno-ele-buf.
           if ef-anno-ele-buf = 0
              set errori to true
              display message "Indicare un anno"
                        title tit-err
                         icon 2
           end-if.

           if tutto-ok
              call "W$MOUSE" using set-mouse-shape, wait-pointer
              move 2 to rb-tipo
              set ElaboraElenco to true
              perform SCR-ELABORA-OPEN-ROUTINE
              call "W$MOUSE" using set-mouse-shape, arrow-pointer
           else
              perform CANCELLA-COLORE
              move 78-ID-ef-anno-ele to control-id
              move 4                 to accept-control
           end-if 
           .
      * <TOTEM:END>
       pb-ele-730-LinkTo.
      * <TOTEM:PARA. pb-ele-730-LinkTo>
           set tutto-ok to true.

           inquire ef-anno-ele,   value ef-anno-ele-buf.
           if ef-anno-ele-buf = 0
              set errori to true
              display message "Indicare un anno"
                        title tit-err
                         icon 2
           end-if.

           if tutto-ok
              call "W$MOUSE" using set-mouse-shape, wait-pointer
              move 1 to rb-tipo
              set ElaboraElenco to true
              perform SCR-ELABORA-OPEN-ROUTINE
              call "W$MOUSE" using set-mouse-shape, arrow-pointer
           else
              perform CANCELLA-COLORE
              move 78-ID-ef-anno-ele to control-id
              move 4                 to accept-control
           end-if 
           .
      * <TOTEM:END>
       pb-ele-730-U-LinkTo.
      * <TOTEM:PARA. pb-ele-730-U-LinkTo>
           set tutto-ok to true.

           inquire ef-anno-ele,   value ef-anno-ele-buf.
           if ef-anno-ele-buf = 0
              set errori to true
              display message "Indicare un anno"
                        title tit-err
                         icon 2
           end-if.

           if tutto-ok
              call "W$MOUSE" using set-mouse-shape, wait-pointer
              move 3 to rb-tipo
              set ElaboraElenco to true
              perform SCR-ELABORA-OPEN-ROUTINE
              call "W$MOUSE" using set-mouse-shape, arrow-pointer
           else
              perform CANCELLA-COLORE
              move 78-ID-ef-anno-ele to control-id
              move 4                 to accept-control
           end-if 
           .
      * <TOTEM:END>

      *{TOTEM}END

      *{TOTEM}SHOW-MSG
       MESSAGE-FOR-FILEERROR.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
              MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           .

       SHOW-TRANSACTION-ROUTINE.
           IF TOTEM-TRANSACTION-FLAG = SPACES
              IF TRANSACTION-STATUS NOT = 0
                 STRING "TRANSACTION ERROR ", TRANSACTION-STATUS
                    DELIMITED BY SIZE INTO TOTEM-MSG-1
              END-IF
           ELSE
              PERFORM SHOW-MSG-ROUTINE
              IF TRANSACTION-STATUS = 0
                 MOVE "Transazione terminata con Rollback." TO 
           TOTEM-MSG-3
              ELSE
                 STRING "TRANSACTION ERROR ", TRANSACTION-STATUS
                    DELIMITED BY SIZE INTO TOTEM-MSG-3
              END-IF
           END-IF
           .

       SHOW-MSG-ROUTINE.
           MOVE SPACE TO TOTEM-MSG-1 TOTEM-MSG-2 TOTEM-MSG-3
           EVALUATE TOTEM-MSG-ID
               WHEN "10"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Nessun altro dato." TO TOTEM-MSG-2
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "22"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Chiave Duplicata." TO TOTEM-MSG-2
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "23"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Raggiunta fine file." TO TOTEM-MSG-2
                    MOVE MB-WARNING-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "101"
                    MOVE "Terminare l'applicazione?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "201"
                    MOVE "Aggiungere un nuovo record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "202"
                    MOVE "Aggiornare il Record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "203"
                    MOVE "Cancellare il Record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "204"
                    MOVE "Chiave duplicata." TO TOTEM-MSG-1
                    MOVE MB-WARNING-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "301"
                    MOVE "Inserimento avvenuto con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "302"
                    MOVE "Aggiornamento avvenuto con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "303"
                    MOVE "Cancellazione avvenuta con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "401"
                    MOVE "Shell non trovata." TO TOTEM-MSG-1
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN OTHER
                    MOVE TEXT-MESSAGE TO TOTEM-MSG-1
                    STRING "FILE:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-3
                    MOVE 0 TO TOTEM-IDX1
                    INSPECT TOTEM-MSG-3 TALLYING TOTEM-IDX1
                       FOR TRAILING SPACE
                    STRING TOTEM-MSG-3(1:TOTEM-MSG-LENGTH - 
           TOTEM-IDX1), 
                       ", FILE STATUS ", PRIMARY-ERROR "," 
                       SECONDARY-ERROR
                    DELIMITED BY SIZE INTO TOTEM-MSG-2
                    MOVE SPACES TO TOTEM-MSG-3
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
           END-EVALUATE
           PERFORM MESSAGE-BOX-ROUTINE
           .

       MESSAGE-BOX-ROUTINE.
           MOVE 1 TO TOTEM-MSG-TEXT-POINTER
           IF TOTEM-MSG-1 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-1 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              STRING TOTEM-MSG-1( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                 DELIMITED BY SIZE
                 INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-2 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-2 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              IF TOTEM-MSG-TEXT-POINTER > 1
                 STRING X"0A" DELIMITED BY SIZE
                     INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
              END-IF
              STRING TOTEM-MSG-2( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                  DELIMITED BY SIZE
                  INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-3 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-3 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              IF TOTEM-MSG-TEXT-POINTER > 1
                 STRING X"0A" DELIMITED BY SIZE
                     INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
              END-IF
              STRING TOTEM-MSG-3( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                  DELIMITED BY SIZE
                  INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-TEXT-POINTER = 1
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-TEXT TALLYING TOTEM-MSG-SIZE FOR 
           TRAILING SPACE
                  COMPUTE TOTEM-MSG-TEXT-POINTER = 
           TOTEM-MSG-FULL-LENGTH - TOTEM-MSG-SIZE + 1
           END-IF
           MOVE LOW-VALUES TO TOTEM-MSG-TEXT(TOTEM-MSG-TEXT-POINTER : 1 
           )
           .

       MESSAGE-BOX-DISPLAY.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

      *{TOTEM}END

